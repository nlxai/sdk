var R1=Object.defineProperty,ig=t=>{throw TypeError(t)},I1=(t,e,n)=>e in t?R1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ie=(t,e,n)=>I1(t,typeof e!="symbol"?e+"":e,n),pd=(t,e,n)=>e.has(t)||ig("Cannot "+n),Ct=(t,e,n)=>(pd(t,e,"read from private field"),n?n.call(t):e.get(t)),Ai=(t,e,n)=>e.has(t)?ig("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),ps=(t,e,n,r)=>(pd(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),Zh=(t,e,n)=>(pd(t,e,"access private method"),n);function ag(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var og={exports:{}},rc={},sg={exports:{}},Y={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eo=Symbol.for("react.element"),_1=Symbol.for("react.portal"),O1=Symbol.for("react.fragment"),N1=Symbol.for("react.strict_mode"),M1=Symbol.for("react.profiler"),L1=Symbol.for("react.provider"),D1=Symbol.for("react.context"),j1=Symbol.for("react.forward_ref"),A1=Symbol.for("react.suspense"),U1=Symbol.for("react.memo"),F1=Symbol.for("react.lazy"),Jh=Symbol.iterator;function B1(t){return t===null||typeof t!="object"?null:(t=Jh&&t[Jh]||t["@@iterator"],typeof t=="function"?t:null)}var cg={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},lg=Object.assign,ug={};function Oi(t,e,n){this.props=t,this.context=e,this.refs=ug,this.updater=n||cg}Oi.prototype.isReactComponent={};Oi.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Oi.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function dg(){}dg.prototype=Oi.prototype;function fd(t,e,n){this.props=t,this.context=e,this.refs=ug,this.updater=n||cg}var md=fd.prototype=new dg;md.constructor=fd;lg(md,Oi.prototype);md.isPureReactComponent=!0;var Qh=Array.isArray,hg=Object.prototype.hasOwnProperty,gd={current:null},pg={key:!0,ref:!0,__self:!0,__source:!0};function fg(t,e,n){var r,i={},a=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(a=""+e.key),e)hg.call(e,r)&&!pg.hasOwnProperty(r)&&(i[r]=e[r]);var s=arguments.length-2;if(s===1)i.children=n;else if(1<s){for(var c=Array(s),l=0;l<s;l++)c[l]=arguments[l+2];i.children=c}if(t&&t.defaultProps)for(r in s=t.defaultProps,s)i[r]===void 0&&(i[r]=s[r]);return{$$typeof:eo,type:t,key:a,ref:o,props:i,_owner:gd.current}}function z1(t,e){return{$$typeof:eo,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function vd(t){return typeof t=="object"&&t!==null&&t.$$typeof===eo}function V1(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Yh=/\/+/g;function Ic(t,e){return typeof t=="object"&&t!==null&&t.key!=null?V1(""+t.key):e.toString(36)}function Ao(t,e,n,r,i){var a=typeof t;(a==="undefined"||a==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case eo:case _1:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+Ic(o,0):r,Qh(i)?(n="",t!=null&&(n=t.replace(Yh,"$&/")+"/"),Ao(i,e,n,"",function(l){return l})):i!=null&&(vd(i)&&(i=z1(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Yh,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",Qh(t))for(var s=0;s<t.length;s++){a=t[s];var c=r+Ic(a,s);o+=Ao(a,e,n,c,i)}else if(c=B1(t),typeof c=="function")for(t=c.call(t),s=0;!(a=t.next()).done;)a=a.value,c=r+Ic(a,s++),o+=Ao(a,e,n,c,i);else if(a==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function oo(t,e,n){if(t==null)return t;var r=[],i=0;return Ao(t,r,"","",function(a){return e.call(n,a,i++)}),r}function H1(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var rt={current:null},Uo={transition:null},q1={ReactCurrentDispatcher:rt,ReactCurrentBatchConfig:Uo,ReactCurrentOwner:gd};function mg(){throw Error("act(...) is not supported in production builds of React.")}Y.Children={map:oo,forEach:function(t,e,n){oo(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return oo(t,function(){e++}),e},toArray:function(t){return oo(t,function(e){return e})||[]},only:function(t){if(!vd(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Y.Component=Oi;Y.Fragment=O1;Y.Profiler=M1;Y.PureComponent=fd;Y.StrictMode=N1;Y.Suspense=A1;Y.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=q1;Y.act=mg;Y.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=lg({},t.props),i=t.key,a=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,o=gd.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var s=t.type.defaultProps;for(c in e)hg.call(e,c)&&!pg.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&s!==void 0?s[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){s=Array(c);for(var l=0;l<c;l++)s[l]=arguments[l+2];r.children=s}return{$$typeof:eo,type:t.type,key:i,ref:a,props:r,_owner:o}};Y.createContext=function(t){return t={$$typeof:D1,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:L1,_context:t},t.Consumer=t};Y.createElement=fg;Y.createFactory=function(t){var e=fg.bind(null,t);return e.type=t,e};Y.createRef=function(){return{current:null}};Y.forwardRef=function(t){return{$$typeof:j1,render:t}};Y.isValidElement=vd;Y.lazy=function(t){return{$$typeof:F1,_payload:{_status:-1,_result:t},_init:H1}};Y.memo=function(t,e){return{$$typeof:U1,type:t,compare:e===void 0?null:e}};Y.startTransition=function(t){var e=Uo.transition;Uo.transition={};try{t()}finally{Uo.transition=e}};Y.unstable_act=mg;Y.useCallback=function(t,e){return rt.current.useCallback(t,e)};Y.useContext=function(t){return rt.current.useContext(t)};Y.useDebugValue=function(){};Y.useDeferredValue=function(t){return rt.current.useDeferredValue(t)};Y.useEffect=function(t,e){return rt.current.useEffect(t,e)};Y.useId=function(){return rt.current.useId()};Y.useImperativeHandle=function(t,e,n){return rt.current.useImperativeHandle(t,e,n)};Y.useInsertionEffect=function(t,e){return rt.current.useInsertionEffect(t,e)};Y.useLayoutEffect=function(t,e){return rt.current.useLayoutEffect(t,e)};Y.useMemo=function(t,e){return rt.current.useMemo(t,e)};Y.useReducer=function(t,e,n){return rt.current.useReducer(t,e,n)};Y.useRef=function(t){return rt.current.useRef(t)};Y.useState=function(t){return rt.current.useState(t)};Y.useSyncExternalStore=function(t,e,n){return rt.current.useSyncExternalStore(t,e,n)};Y.useTransition=function(){return rt.current.useTransition()};Y.version="18.3.1";sg.exports=Y;var L=sg.exports;const Cr=ag(L);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $1=L,W1=Symbol.for("react.element"),K1=Symbol.for("react.fragment"),G1=Object.prototype.hasOwnProperty,Z1=$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,J1={key:!0,ref:!0,__self:!0,__source:!0};function gg(t,e,n){var r,i={},a=null,o=null;n!==void 0&&(a=""+n),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)G1.call(e,r)&&!J1.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:W1,type:t,key:a,ref:o,props:i,_owner:Z1.current}}rc.Fragment=K1;rc.jsx=gg;rc.jsxs=gg;og.exports=rc;var k=og.exports,vg={exports:{}},kt={},bg={exports:{}},yg={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(R,F){var q=R.length;R.push(F);e:for(;0<q;){var Z=q-1>>>1,ue=R[Z];if(0<i(ue,F))R[Z]=F,R[q]=ue,q=Z;else break e}}function n(R){return R.length===0?null:R[0]}function r(R){if(R.length===0)return null;var F=R[0],q=R.pop();if(q!==F){R[0]=q;e:for(var Z=0,ue=R.length,or=ue>>>1;Z<or;){var ln=2*(Z+1)-1,sr=R[ln],Zt=ln+1,Nt=R[Zt];if(0>i(sr,q))Zt<ue&&0>i(Nt,sr)?(R[Z]=Nt,R[Zt]=q,Z=Zt):(R[Z]=sr,R[ln]=q,Z=ln);else if(Zt<ue&&0>i(Nt,q))R[Z]=Nt,R[Zt]=q,Z=Zt;else break e}}return F}function i(R,F){var q=R.sortIndex-F.sortIndex;return q!==0?q:R.id-F.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();t.unstable_now=function(){return o.now()-s}}var c=[],l=[],u=1,d=null,h=3,p=!1,b=!1,y=!1,w=typeof setTimeout=="function"?setTimeout:null,f=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(R){for(var F=n(l);F!==null;){if(F.callback===null)r(l);else if(F.startTime<=R)r(l),F.sortIndex=F.expirationTime,e(c,F);else break;F=n(l)}}function v(R){if(y=!1,m(R),!b)if(n(c)!==null)b=!0,$(C);else{var F=n(l);F!==null&&J(v,F.startTime-R)}}function C(R,F){b=!1,y&&(y=!1,f(x),x=-1),p=!0;var q=h;try{for(m(F),d=n(c);d!==null&&(!(d.expirationTime>F)||R&&!A());){var Z=d.callback;if(typeof Z=="function"){d.callback=null,h=d.priorityLevel;var ue=Z(d.expirationTime<=F);F=t.unstable_now(),typeof ue=="function"?d.callback=ue:d===n(c)&&r(c),m(F)}else r(c);d=n(c)}if(d!==null)var or=!0;else{var ln=n(l);ln!==null&&J(v,ln.startTime-F),or=!1}return or}finally{d=null,h=q,p=!1}}var T=!1,E=null,x=-1,N=5,M=-1;function A(){return!(t.unstable_now()-M<N)}function W(){if(E!==null){var R=t.unstable_now();M=R;var F=!0;try{F=E(!0,R)}finally{F?Q():(T=!1,E=null)}}else T=!1}var Q;if(typeof g=="function")Q=function(){g(W)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,V=O.port2;O.port1.onmessage=W,Q=function(){V.postMessage(null)}}else Q=function(){w(W,0)};function $(R){E=R,T||(T=!0,Q())}function J(R,F){x=w(function(){R(t.unstable_now())},F)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(R){R.callback=null},t.unstable_continueExecution=function(){b||p||(b=!0,$(C))},t.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<R?Math.floor(1e3/R):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(R){switch(h){case 1:case 2:case 3:var F=3;break;default:F=h}var q=h;h=F;try{return R()}finally{h=q}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(R,F){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var q=h;h=R;try{return F()}finally{h=q}},t.unstable_scheduleCallback=function(R,F,q){var Z=t.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?Z+q:Z):q=Z,R){case 1:var ue=-1;break;case 2:ue=250;break;case 5:ue=1073741823;break;case 4:ue=1e4;break;default:ue=5e3}return ue=q+ue,R={id:u++,callback:F,priorityLevel:R,startTime:q,expirationTime:ue,sortIndex:-1},q>Z?(R.sortIndex=q,e(l,R),n(c)===null&&R===n(l)&&(y?(f(x),x=-1):y=!0,J(v,q-Z))):(R.sortIndex=ue,e(c,R),b||p||(b=!0,$(C))),R},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(R){var F=h;return function(){var q=h;h=F;try{return R.apply(this,arguments)}finally{h=q}}}})(yg);bg.exports=yg;var Q1=bg.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y1=L,yt=Q1;function D(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var kg=new Set,xa={};function Mr(t,e){ki(t,e),ki(t+"Capture",e)}function ki(t,e){for(xa[t]=e,t=0;t<e.length;t++)kg.add(e[t])}var yn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),xl=Object.prototype.hasOwnProperty,X1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Xh={},ep={};function ek(t){return xl.call(ep,t)?!0:xl.call(Xh,t)?!1:X1.test(t)?ep[t]=!0:(Xh[t]=!0,!1)}function tk(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function nk(t,e,n,r){if(e===null||typeof e>"u"||tk(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function it(t,e,n,r,i,a,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=o}var $e={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){$e[t]=new it(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];$e[e]=new it(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){$e[t]=new it(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){$e[t]=new it(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){$e[t]=new it(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){$e[t]=new it(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){$e[t]=new it(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){$e[t]=new it(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){$e[t]=new it(t,5,!1,t.toLowerCase(),null,!1,!1)});var bd=/[\-:]([a-z])/g;function yd(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(bd,yd);$e[e]=new it(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(bd,yd);$e[e]=new it(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(bd,yd);$e[e]=new it(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){$e[t]=new it(t,1,!1,t.toLowerCase(),null,!1,!1)});$e.xlinkHref=new it("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){$e[t]=new it(t,1,!1,t.toLowerCase(),null,!0,!0)});function kd(t,e,n,r){var i=$e.hasOwnProperty(e)?$e[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(nk(e,n,i,r)&&(n=null),r||i===null?ek(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var xn=Y1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,so=Symbol.for("react.element"),Wr=Symbol.for("react.portal"),Kr=Symbol.for("react.fragment"),wd=Symbol.for("react.strict_mode"),El=Symbol.for("react.profiler"),wg=Symbol.for("react.provider"),Cg=Symbol.for("react.context"),Cd=Symbol.for("react.forward_ref"),Pl=Symbol.for("react.suspense"),Rl=Symbol.for("react.suspense_list"),Sd=Symbol.for("react.memo"),_n=Symbol.for("react.lazy"),Sg=Symbol.for("react.offscreen"),tp=Symbol.iterator;function Ui(t){return t===null||typeof t!="object"?null:(t=tp&&t[tp]||t["@@iterator"],typeof t=="function"?t:null)}var Ce=Object.assign,_c;function ea(t){if(_c===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);_c=e&&e[1]||""}return`
`+_c+t}var Oc=!1;function Nc(t,e){if(!t||Oc)return"";Oc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){r=l}t.call(e.prototype)}else{try{throw Error()}catch(l){r=l}t()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),a=r.stack.split(`
`),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(o!==1||s!==1)do if(o--,s--,0>s||i[o]!==a[s]){var c=`
`+i[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=s);break}}}finally{Oc=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ea(t):""}function rk(t){switch(t.tag){case 5:return ea(t.type);case 16:return ea("Lazy");case 13:return ea("Suspense");case 19:return ea("SuspenseList");case 0:case 2:case 15:return t=Nc(t.type,!1),t;case 11:return t=Nc(t.type.render,!1),t;case 1:return t=Nc(t.type,!0),t;default:return""}}function Il(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Kr:return"Fragment";case Wr:return"Portal";case El:return"Profiler";case wd:return"StrictMode";case Pl:return"Suspense";case Rl:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Cg:return(t.displayName||"Context")+".Consumer";case wg:return(t._context.displayName||"Context")+".Provider";case Cd:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Sd:return e=t.displayName||null,e!==null?e:Il(t.type)||"Memo";case _n:e=t._payload,t=t._init;try{return Il(t(e))}catch{}}return null}function ik(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Il(e);case 8:return e===wd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Qn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Tg(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function ak(t){var e=Tg(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,a=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,a.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function co(t){t._valueTracker||(t._valueTracker=ak(t))}function xg(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Tg(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function fs(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function _l(t,e){var n=e.checked;return Ce({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function np(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Qn(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Eg(t,e){e=e.checked,e!=null&&kd(t,"checked",e,!1)}function Ol(t,e){Eg(t,e);var n=Qn(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Nl(t,e.type,n):e.hasOwnProperty("defaultValue")&&Nl(t,e.type,Qn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function rp(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Nl(t,e,n){(e!=="number"||fs(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var ta=Array.isArray;function si(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Qn(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Ml(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(D(91));return Ce({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function ip(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(D(92));if(ta(n)){if(1<n.length)throw Error(D(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Qn(n)}}function Pg(t,e){var n=Qn(e.value),r=Qn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function ap(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Rg(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ll(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Rg(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var lo,Ig=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(lo=lo||document.createElement("div"),lo.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=lo.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Ea(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var oa={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ok=["Webkit","ms","Moz","O"];Object.keys(oa).forEach(function(t){ok.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),oa[e]=oa[t]})});function _g(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||oa.hasOwnProperty(t)&&oa[t]?(""+e).trim():e+"px"}function Og(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=_g(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var sk=Ce({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Dl(t,e){if(e){if(sk[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(D(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(D(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(D(61))}if(e.style!=null&&typeof e.style!="object")throw Error(D(62))}}function jl(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Al=null;function Td(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ul=null,ci=null,li=null;function op(t){if(t=ro(t)){if(typeof Ul!="function")throw Error(D(280));var e=t.stateNode;e&&(e=cc(e),Ul(t.stateNode,t.type,e))}}function Ng(t){ci?li?li.push(t):li=[t]:ci=t}function Mg(){if(ci){var t=ci,e=li;if(li=ci=null,op(t),e)for(t=0;t<e.length;t++)op(e[t])}}function Lg(t,e){return t(e)}function Dg(){}var Mc=!1;function jg(t,e,n){if(Mc)return t(e,n);Mc=!0;try{return Lg(t,e,n)}finally{Mc=!1,(ci!==null||li!==null)&&(Dg(),Mg())}}function Pa(t,e){var n=t.stateNode;if(n===null)return null;var r=cc(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(D(231,e,typeof n));return n}var Fl=!1;if(yn)try{var Fi={};Object.defineProperty(Fi,"passive",{get:function(){Fl=!0}}),window.addEventListener("test",Fi,Fi),window.removeEventListener("test",Fi,Fi)}catch{Fl=!1}function ck(t,e,n,r,i,a,o,s,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(u){this.onError(u)}}var sa=!1,ms=null,gs=!1,Bl=null,lk={onError:function(t){sa=!0,ms=t}};function uk(t,e,n,r,i,a,o,s,c){sa=!1,ms=null,ck.apply(lk,arguments)}function dk(t,e,n,r,i,a,o,s,c){if(uk.apply(this,arguments),sa){if(sa){var l=ms;sa=!1,ms=null}else throw Error(D(198));gs||(gs=!0,Bl=l)}}function Lr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Ag(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function sp(t){if(Lr(t)!==t)throw Error(D(188))}function hk(t){var e=t.alternate;if(!e){if(e=Lr(t),e===null)throw Error(D(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var a=i.alternate;if(a===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return sp(i),t;if(a===r)return sp(i),e;a=a.sibling}throw Error(D(188))}if(n.return!==r.return)n=i,r=a;else{for(var o=!1,s=i.child;s;){if(s===n){o=!0,n=i,r=a;break}if(s===r){o=!0,r=i,n=a;break}s=s.sibling}if(!o){for(s=a.child;s;){if(s===n){o=!0,n=a,r=i;break}if(s===r){o=!0,r=a,n=i;break}s=s.sibling}if(!o)throw Error(D(189))}}if(n.alternate!==r)throw Error(D(190))}if(n.tag!==3)throw Error(D(188));return n.stateNode.current===n?t:e}function Ug(t){return t=hk(t),t!==null?Fg(t):null}function Fg(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Fg(t);if(e!==null)return e;t=t.sibling}return null}var Bg=yt.unstable_scheduleCallback,cp=yt.unstable_cancelCallback,pk=yt.unstable_shouldYield,fk=yt.unstable_requestPaint,Pe=yt.unstable_now,mk=yt.unstable_getCurrentPriorityLevel,xd=yt.unstable_ImmediatePriority,zg=yt.unstable_UserBlockingPriority,vs=yt.unstable_NormalPriority,gk=yt.unstable_LowPriority,Vg=yt.unstable_IdlePriority,ic=null,rn=null;function vk(t){if(rn&&typeof rn.onCommitFiberRoot=="function")try{rn.onCommitFiberRoot(ic,t,void 0,(t.current.flags&128)===128)}catch{}}var qt=Math.clz32?Math.clz32:kk,bk=Math.log,yk=Math.LN2;function kk(t){return t>>>=0,t===0?32:31-(bk(t)/yk|0)|0}var uo=64,ho=4194304;function na(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function bs(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,a=t.pingedLanes,o=n&268435455;if(o!==0){var s=o&~i;s!==0?r=na(s):(a&=o,a!==0&&(r=na(a)))}else o=n&~i,o!==0?r=na(o):a!==0&&(r=na(a));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,a=e&-e,i>=a||i===16&&(a&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-qt(e),i=1<<n,r|=t[n],e&=~i;return r}function wk(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ck(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,a=t.pendingLanes;0<a;){var o=31-qt(a),s=1<<o,c=i[o];c===-1?(!(s&n)||s&r)&&(i[o]=wk(s,e)):c<=e&&(t.expiredLanes|=s),a&=~s}}function zl(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Hg(){var t=uo;return uo<<=1,!(uo&4194240)&&(uo=64),t}function Lc(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function to(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-qt(e),t[e]=n}function Sk(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-qt(n),a=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~a}}function Ed(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-qt(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var se=0;function qg(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var $g,Pd,Wg,Kg,Gg,Vl=!1,po=[],zn=null,Vn=null,Hn=null,Ra=new Map,Ia=new Map,Mn=[],Tk="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function lp(t,e){switch(t){case"focusin":case"focusout":zn=null;break;case"dragenter":case"dragleave":Vn=null;break;case"mouseover":case"mouseout":Hn=null;break;case"pointerover":case"pointerout":Ra.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ia.delete(e.pointerId)}}function Bi(t,e,n,r,i,a){return t===null||t.nativeEvent!==a?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},e!==null&&(e=ro(e),e!==null&&Pd(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function xk(t,e,n,r,i){switch(e){case"focusin":return zn=Bi(zn,t,e,n,r,i),!0;case"dragenter":return Vn=Bi(Vn,t,e,n,r,i),!0;case"mouseover":return Hn=Bi(Hn,t,e,n,r,i),!0;case"pointerover":var a=i.pointerId;return Ra.set(a,Bi(Ra.get(a)||null,t,e,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Ia.set(a,Bi(Ia.get(a)||null,t,e,n,r,i)),!0}return!1}function Zg(t){var e=fr(t.target);if(e!==null){var n=Lr(e);if(n!==null){if(e=n.tag,e===13){if(e=Ag(n),e!==null){t.blockedOn=e,Gg(t.priority,function(){Wg(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Fo(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Hl(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Al=r,n.target.dispatchEvent(r),Al=null}else return e=ro(n),e!==null&&Pd(e),t.blockedOn=n,!1;e.shift()}return!0}function up(t,e,n){Fo(t)&&n.delete(e)}function Ek(){Vl=!1,zn!==null&&Fo(zn)&&(zn=null),Vn!==null&&Fo(Vn)&&(Vn=null),Hn!==null&&Fo(Hn)&&(Hn=null),Ra.forEach(up),Ia.forEach(up)}function zi(t,e){t.blockedOn===e&&(t.blockedOn=null,Vl||(Vl=!0,yt.unstable_scheduleCallback(yt.unstable_NormalPriority,Ek)))}function _a(t){function e(i){return zi(i,t)}if(0<po.length){zi(po[0],t);for(var n=1;n<po.length;n++){var r=po[n];r.blockedOn===t&&(r.blockedOn=null)}}for(zn!==null&&zi(zn,t),Vn!==null&&zi(Vn,t),Hn!==null&&zi(Hn,t),Ra.forEach(e),Ia.forEach(e),n=0;n<Mn.length;n++)r=Mn[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Mn.length&&(n=Mn[0],n.blockedOn===null);)Zg(n),n.blockedOn===null&&Mn.shift()}var ui=xn.ReactCurrentBatchConfig,ys=!0;function Pk(t,e,n,r){var i=se,a=ui.transition;ui.transition=null;try{se=1,Rd(t,e,n,r)}finally{se=i,ui.transition=a}}function Rk(t,e,n,r){var i=se,a=ui.transition;ui.transition=null;try{se=4,Rd(t,e,n,r)}finally{se=i,ui.transition=a}}function Rd(t,e,n,r){if(ys){var i=Hl(t,e,n,r);if(i===null)qc(t,e,r,ks,n),lp(t,r);else if(xk(i,t,e,n,r))r.stopPropagation();else if(lp(t,r),e&4&&-1<Tk.indexOf(t)){for(;i!==null;){var a=ro(i);if(a!==null&&$g(a),a=Hl(t,e,n,r),a===null&&qc(t,e,r,ks,n),a===i)break;i=a}i!==null&&r.stopPropagation()}else qc(t,e,r,null,n)}}var ks=null;function Hl(t,e,n,r){if(ks=null,t=Td(r),t=fr(t),t!==null)if(e=Lr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Ag(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return ks=t,null}function Jg(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(mk()){case xd:return 1;case zg:return 4;case vs:case gk:return 16;case Vg:return 536870912;default:return 16}default:return 16}}var Un=null,Id=null,Bo=null;function Qg(){if(Bo)return Bo;var t,e=Id,n=e.length,r,i="value"in Un?Un.value:Un.textContent,a=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[a-r];r++);return Bo=i.slice(t,1<r?1-r:void 0)}function zo(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function fo(){return!0}function dp(){return!1}function wt(t){function e(n,r,i,a,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(n=t[s],this[s]=n?n(a):a[s]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?fo:dp,this.isPropagationStopped=dp,this}return Ce(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=fo)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=fo)},persist:function(){},isPersistent:fo}),e}var Ni={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_d=wt(Ni),no=Ce({},Ni,{view:0,detail:0}),Ik=wt(no),Dc,jc,Vi,ac=Ce({},no,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Od,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Vi&&(Vi&&t.type==="mousemove"?(Dc=t.screenX-Vi.screenX,jc=t.screenY-Vi.screenY):jc=Dc=0,Vi=t),Dc)},movementY:function(t){return"movementY"in t?t.movementY:jc}}),hp=wt(ac),_k=Ce({},ac,{dataTransfer:0}),Ok=wt(_k),Nk=Ce({},no,{relatedTarget:0}),Ac=wt(Nk),Mk=Ce({},Ni,{animationName:0,elapsedTime:0,pseudoElement:0}),Lk=wt(Mk),Dk=Ce({},Ni,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),jk=wt(Dk),Ak=Ce({},Ni,{data:0}),pp=wt(Ak),Uk={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Fk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Bk={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zk(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Bk[t])?!!e[t]:!1}function Od(){return zk}var Vk=Ce({},no,{key:function(t){if(t.key){var e=Uk[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=zo(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Fk[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Od,charCode:function(t){return t.type==="keypress"?zo(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?zo(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Hk=wt(Vk),qk=Ce({},ac,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fp=wt(qk),$k=Ce({},no,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Od}),Wk=wt($k),Kk=Ce({},Ni,{propertyName:0,elapsedTime:0,pseudoElement:0}),Gk=wt(Kk),Zk=Ce({},ac,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Jk=wt(Zk),Qk=[9,13,27,32],Nd=yn&&"CompositionEvent"in window,ca=null;yn&&"documentMode"in document&&(ca=document.documentMode);var Yk=yn&&"TextEvent"in window&&!ca,Yg=yn&&(!Nd||ca&&8<ca&&11>=ca),mp=" ",gp=!1;function Xg(t,e){switch(t){case"keyup":return Qk.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ev(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Gr=!1;function Xk(t,e){switch(t){case"compositionend":return ev(e);case"keypress":return e.which!==32?null:(gp=!0,mp);case"textInput":return t=e.data,t===mp&&gp?null:t;default:return null}}function ew(t,e){if(Gr)return t==="compositionend"||!Nd&&Xg(t,e)?(t=Qg(),Bo=Id=Un=null,Gr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Yg&&e.locale!=="ko"?null:e.data;default:return null}}var tw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!tw[t.type]:e==="textarea"}function tv(t,e,n,r){Ng(r),e=ws(e,"onChange"),0<e.length&&(n=new _d("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var la=null,Oa=null;function nw(t){hv(t,0)}function oc(t){var e=Qr(t);if(xg(e))return t}function rw(t,e){if(t==="change")return e}var nv=!1;if(yn){var Uc;if(yn){var Fc="oninput"in document;if(!Fc){var bp=document.createElement("div");bp.setAttribute("oninput","return;"),Fc=typeof bp.oninput=="function"}Uc=Fc}else Uc=!1;nv=Uc&&(!document.documentMode||9<document.documentMode)}function yp(){la&&(la.detachEvent("onpropertychange",rv),Oa=la=null)}function rv(t){if(t.propertyName==="value"&&oc(Oa)){var e=[];tv(e,Oa,t,Td(t)),jg(nw,e)}}function iw(t,e,n){t==="focusin"?(yp(),la=e,Oa=n,la.attachEvent("onpropertychange",rv)):t==="focusout"&&yp()}function aw(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return oc(Oa)}function ow(t,e){if(t==="click")return oc(e)}function sw(t,e){if(t==="input"||t==="change")return oc(e)}function cw(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Wt=typeof Object.is=="function"?Object.is:cw;function Na(t,e){if(Wt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!xl.call(e,i)||!Wt(t[i],e[i]))return!1}return!0}function kp(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function wp(t,e){var n=kp(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=kp(n)}}function iv(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?iv(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function av(){for(var t=window,e=fs();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=fs(t.document)}return e}function Md(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function lw(t){var e=av(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&iv(n.ownerDocument.documentElement,n)){if(r!==null&&Md(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=r.end===void 0?a:Math.min(r.end,i),!t.extend&&a>r&&(i=r,r=a,a=i),i=wp(n,a);var o=wp(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),a>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var uw=yn&&"documentMode"in document&&11>=document.documentMode,Zr=null,ql=null,ua=null,$l=!1;function Cp(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;$l||Zr==null||Zr!==fs(r)||(r=Zr,"selectionStart"in r&&Md(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ua&&Na(ua,r)||(ua=r,r=ws(ql,"onSelect"),0<r.length&&(e=new _d("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Zr)))}function mo(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Jr={animationend:mo("Animation","AnimationEnd"),animationiteration:mo("Animation","AnimationIteration"),animationstart:mo("Animation","AnimationStart"),transitionend:mo("Transition","TransitionEnd")},Bc={},ov={};yn&&(ov=document.createElement("div").style,"AnimationEvent"in window||(delete Jr.animationend.animation,delete Jr.animationiteration.animation,delete Jr.animationstart.animation),"TransitionEvent"in window||delete Jr.transitionend.transition);function sc(t){if(Bc[t])return Bc[t];if(!Jr[t])return t;var e=Jr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in ov)return Bc[t]=e[n];return t}var sv=sc("animationend"),cv=sc("animationiteration"),lv=sc("animationstart"),uv=sc("transitionend"),dv=new Map,Sp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function tr(t,e){dv.set(t,e),Mr(e,[t])}for(var zc=0;zc<Sp.length;zc++){var Vc=Sp[zc],dw=Vc.toLowerCase(),hw=Vc[0].toUpperCase()+Vc.slice(1);tr(dw,"on"+hw)}tr(sv,"onAnimationEnd");tr(cv,"onAnimationIteration");tr(lv,"onAnimationStart");tr("dblclick","onDoubleClick");tr("focusin","onFocus");tr("focusout","onBlur");tr(uv,"onTransitionEnd");ki("onMouseEnter",["mouseout","mouseover"]);ki("onMouseLeave",["mouseout","mouseover"]);ki("onPointerEnter",["pointerout","pointerover"]);ki("onPointerLeave",["pointerout","pointerover"]);Mr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Mr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Mr("onBeforeInput",["compositionend","keypress","textInput","paste"]);Mr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Mr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Mr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ra="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),pw=new Set("cancel close invalid load scroll toggle".split(" ").concat(ra));function Tp(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,dk(r,e,void 0,t),t.currentTarget=null}function hv(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var a=void 0;if(e)for(var o=r.length-1;0<=o;o--){var s=r[o],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==a&&i.isPropagationStopped())break e;Tp(i,s,l),a=c}else for(o=0;o<r.length;o++){if(s=r[o],c=s.instance,l=s.currentTarget,s=s.listener,c!==a&&i.isPropagationStopped())break e;Tp(i,s,l),a=c}}}if(gs)throw t=Bl,gs=!1,Bl=null,t}function pe(t,e){var n=e[Jl];n===void 0&&(n=e[Jl]=new Set);var r=t+"__bubble";n.has(r)||(pv(e,t,2,!1),n.add(r))}function Hc(t,e,n){var r=0;e&&(r|=4),pv(n,t,r,e)}var go="_reactListening"+Math.random().toString(36).slice(2);function Ma(t){if(!t[go]){t[go]=!0,kg.forEach(function(n){n!=="selectionchange"&&(pw.has(n)||Hc(n,!1,t),Hc(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[go]||(e[go]=!0,Hc("selectionchange",!1,e))}}function pv(t,e,n,r){switch(Jg(e)){case 1:var i=Pk;break;case 4:i=Rk;break;default:i=Rd}n=i.bind(null,e,n,t),i=void 0,!Fl||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function qc(t,e,n,r,i){var a=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var s=r.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;s!==null;){if(o=fr(s),o===null)return;if(c=o.tag,c===5||c===6){r=a=o;continue e}s=s.parentNode}}r=r.return}jg(function(){var l=a,u=Td(n),d=[];e:{var h=dv.get(t);if(h!==void 0){var p=_d,b=t;switch(t){case"keypress":if(zo(n)===0)break e;case"keydown":case"keyup":p=Hk;break;case"focusin":b="focus",p=Ac;break;case"focusout":b="blur",p=Ac;break;case"beforeblur":case"afterblur":p=Ac;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=hp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=Ok;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=Wk;break;case sv:case cv:case lv:p=Lk;break;case uv:p=Gk;break;case"scroll":p=Ik;break;case"wheel":p=Jk;break;case"copy":case"cut":case"paste":p=jk;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=fp}var y=(e&4)!==0,w=!y&&t==="scroll",f=y?h!==null?h+"Capture":null:h;y=[];for(var g=l,m;g!==null;){m=g;var v=m.stateNode;if(m.tag===5&&v!==null&&(m=v,f!==null&&(v=Pa(g,f),v!=null&&y.push(La(g,v,m)))),w)break;g=g.return}0<y.length&&(h=new p(h,b,null,n,u),d.push({event:h,listeners:y}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",h&&n!==Al&&(b=n.relatedTarget||n.fromElement)&&(fr(b)||b[kn]))break e;if((p||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,p?(b=n.relatedTarget||n.toElement,p=l,b=b?fr(b):null,b!==null&&(w=Lr(b),b!==w||b.tag!==5&&b.tag!==6)&&(b=null)):(p=null,b=l),p!==b)){if(y=hp,v="onMouseLeave",f="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(y=fp,v="onPointerLeave",f="onPointerEnter",g="pointer"),w=p==null?h:Qr(p),m=b==null?h:Qr(b),h=new y(v,g+"leave",p,n,u),h.target=w,h.relatedTarget=m,v=null,fr(u)===l&&(y=new y(f,g+"enter",b,n,u),y.target=m,y.relatedTarget=w,v=y),w=v,p&&b)t:{for(y=p,f=b,g=0,m=y;m;m=Ur(m))g++;for(m=0,v=f;v;v=Ur(v))m++;for(;0<g-m;)y=Ur(y),g--;for(;0<m-g;)f=Ur(f),m--;for(;g--;){if(y===f||f!==null&&y===f.alternate)break t;y=Ur(y),f=Ur(f)}y=null}else y=null;p!==null&&xp(d,h,p,y,!1),b!==null&&w!==null&&xp(d,w,b,y,!0)}}e:{if(h=l?Qr(l):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var C=rw;else if(vp(h))if(nv)C=sw;else{C=aw;var T=iw}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(C=ow);if(C&&(C=C(t,l))){tv(d,C,n,u);break e}T&&T(t,h,l),t==="focusout"&&(T=h._wrapperState)&&T.controlled&&h.type==="number"&&Nl(h,"number",h.value)}switch(T=l?Qr(l):window,t){case"focusin":(vp(T)||T.contentEditable==="true")&&(Zr=T,ql=l,ua=null);break;case"focusout":ua=ql=Zr=null;break;case"mousedown":$l=!0;break;case"contextmenu":case"mouseup":case"dragend":$l=!1,Cp(d,n,u);break;case"selectionchange":if(uw)break;case"keydown":case"keyup":Cp(d,n,u)}var E;if(Nd)e:{switch(t){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Gr?Xg(t,n)&&(x="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(x="onCompositionStart");x&&(Yg&&n.locale!=="ko"&&(Gr||x!=="onCompositionStart"?x==="onCompositionEnd"&&Gr&&(E=Qg()):(Un=u,Id="value"in Un?Un.value:Un.textContent,Gr=!0)),T=ws(l,x),0<T.length&&(x=new pp(x,t,null,n,u),d.push({event:x,listeners:T}),E?x.data=E:(E=ev(n),E!==null&&(x.data=E)))),(E=Yk?Xk(t,n):ew(t,n))&&(l=ws(l,"onBeforeInput"),0<l.length&&(u=new pp("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:l}),u.data=E))}hv(d,e)})}function La(t,e,n){return{instance:t,listener:e,currentTarget:n}}function ws(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=Pa(t,n),a!=null&&r.unshift(La(t,a,i)),a=Pa(t,e),a!=null&&r.push(La(t,a,i))),t=t.return}return r}function Ur(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function xp(t,e,n,r,i){for(var a=e._reactName,o=[];n!==null&&n!==r;){var s=n,c=s.alternate,l=s.stateNode;if(c!==null&&c===r)break;s.tag===5&&l!==null&&(s=l,i?(c=Pa(n,a),c!=null&&o.unshift(La(n,c,s))):i||(c=Pa(n,a),c!=null&&o.push(La(n,c,s)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var fw=/\r\n?/g,mw=/\u0000|\uFFFD/g;function Ep(t){return(typeof t=="string"?t:""+t).replace(fw,`
`).replace(mw,"")}function vo(t,e,n){if(e=Ep(e),Ep(t)!==e&&n)throw Error(D(425))}function Cs(){}var Wl=null,Kl=null;function Gl(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Zl=typeof setTimeout=="function"?setTimeout:void 0,gw=typeof clearTimeout=="function"?clearTimeout:void 0,Pp=typeof Promise=="function"?Promise:void 0,vw=typeof queueMicrotask=="function"?queueMicrotask:typeof Pp<"u"?function(t){return Pp.resolve(null).then(t).catch(bw)}:Zl;function bw(t){setTimeout(function(){throw t})}function $c(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),_a(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);_a(e)}function qn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Rp(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Mi=Math.random().toString(36).slice(2),nn="__reactFiber$"+Mi,Da="__reactProps$"+Mi,kn="__reactContainer$"+Mi,Jl="__reactEvents$"+Mi,yw="__reactListeners$"+Mi,kw="__reactHandles$"+Mi;function fr(t){var e=t[nn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[kn]||n[nn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Rp(t);t!==null;){if(n=t[nn])return n;t=Rp(t)}return e}t=n,n=t.parentNode}return null}function ro(t){return t=t[nn]||t[kn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Qr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(D(33))}function cc(t){return t[Da]||null}var Ql=[],Yr=-1;function nr(t){return{current:t}}function fe(t){0>Yr||(t.current=Ql[Yr],Ql[Yr]=null,Yr--)}function he(t,e){Yr++,Ql[Yr]=t.current,t.current=e}var Yn={},Ze=nr(Yn),ut=nr(!1),Sr=Yn;function wi(t,e){var n=t.type.contextTypes;if(!n)return Yn;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in n)i[a]=e[a];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function dt(t){return t=t.childContextTypes,t!=null}function Ss(){fe(ut),fe(Ze)}function Ip(t,e,n){if(Ze.current!==Yn)throw Error(D(168));he(Ze,e),he(ut,n)}function fv(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(D(108,ik(t)||"Unknown",i));return Ce({},n,r)}function Ts(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Yn,Sr=Ze.current,he(Ze,t),he(ut,ut.current),!0}function _p(t,e,n){var r=t.stateNode;if(!r)throw Error(D(169));n?(t=fv(t,e,Sr),r.__reactInternalMemoizedMergedChildContext=t,fe(ut),fe(Ze),he(Ze,t)):fe(ut),he(ut,n)}var dn=null,lc=!1,Wc=!1;function mv(t){dn===null?dn=[t]:dn.push(t)}function ww(t){lc=!0,mv(t)}function rr(){if(!Wc&&dn!==null){Wc=!0;var t=0,e=se;try{var n=dn;for(se=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}dn=null,lc=!1}catch(i){throw dn!==null&&(dn=dn.slice(t+1)),Bg(xd,rr),i}finally{se=e,Wc=!1}}return null}var Xr=[],ei=0,xs=null,Es=0,St=[],Tt=0,Tr=null,mn=1,gn="";function lr(t,e){Xr[ei++]=Es,Xr[ei++]=xs,xs=t,Es=e}function gv(t,e,n){St[Tt++]=mn,St[Tt++]=gn,St[Tt++]=Tr,Tr=t;var r=mn;t=gn;var i=32-qt(r)-1;r&=~(1<<i),n+=1;var a=32-qt(e)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,mn=1<<32-qt(e)+i|n<<i|r,gn=a+t}else mn=1<<a|n<<i|r,gn=t}function Ld(t){t.return!==null&&(lr(t,1),gv(t,1,0))}function Dd(t){for(;t===xs;)xs=Xr[--ei],Xr[ei]=null,Es=Xr[--ei],Xr[ei]=null;for(;t===Tr;)Tr=St[--Tt],St[Tt]=null,gn=St[--Tt],St[Tt]=null,mn=St[--Tt],St[Tt]=null}var bt=null,gt=null,ve=!1,Ft=null;function vv(t,e){var n=xt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Op(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,bt=t,gt=qn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,bt=t,gt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Tr!==null?{id:mn,overflow:gn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=xt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,bt=t,gt=null,!0):!1;default:return!1}}function Yl(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Xl(t){if(ve){var e=gt;if(e){var n=e;if(!Op(t,e)){if(Yl(t))throw Error(D(418));e=qn(n.nextSibling);var r=bt;e&&Op(t,e)?vv(r,n):(t.flags=t.flags&-4097|2,ve=!1,bt=t)}}else{if(Yl(t))throw Error(D(418));t.flags=t.flags&-4097|2,ve=!1,bt=t}}}function Np(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;bt=t}function bo(t){if(t!==bt)return!1;if(!ve)return Np(t),ve=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Gl(t.type,t.memoizedProps)),e&&(e=gt)){if(Yl(t))throw bv(),Error(D(418));for(;e;)vv(t,e),e=qn(e.nextSibling)}if(Np(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(D(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){gt=qn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}gt=null}}else gt=bt?qn(t.stateNode.nextSibling):null;return!0}function bv(){for(var t=gt;t;)t=qn(t.nextSibling)}function Ci(){gt=bt=null,ve=!1}function jd(t){Ft===null?Ft=[t]:Ft.push(t)}var Cw=xn.ReactCurrentBatchConfig;function Hi(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(D(309));var r=n.stateNode}if(!r)throw Error(D(147,t));var i=r,a=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(o){var s=i.refs;o===null?delete s[a]:s[a]=o},e._stringRef=a,e)}if(typeof t!="string")throw Error(D(284));if(!n._owner)throw Error(D(290,t))}return t}function yo(t,e){throw t=Object.prototype.toString.call(e),Error(D(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Mp(t){var e=t._init;return e(t._payload)}function yv(t){function e(f,g){if(t){var m=f.deletions;m===null?(f.deletions=[g],f.flags|=16):m.push(g)}}function n(f,g){if(!t)return null;for(;g!==null;)e(f,g),g=g.sibling;return null}function r(f,g){for(f=new Map;g!==null;)g.key!==null?f.set(g.key,g):f.set(g.index,g),g=g.sibling;return f}function i(f,g){return f=Gn(f,g),f.index=0,f.sibling=null,f}function a(f,g,m){return f.index=m,t?(m=f.alternate,m!==null?(m=m.index,m<g?(f.flags|=2,g):m):(f.flags|=2,g)):(f.flags|=1048576,g)}function o(f){return t&&f.alternate===null&&(f.flags|=2),f}function s(f,g,m,v){return g===null||g.tag!==6?(g=Xc(m,f.mode,v),g.return=f,g):(g=i(g,m),g.return=f,g)}function c(f,g,m,v){var C=m.type;return C===Kr?u(f,g,m.props.children,v,m.key):g!==null&&(g.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===_n&&Mp(C)===g.type)?(v=i(g,m.props),v.ref=Hi(f,g,m),v.return=f,v):(v=Go(m.type,m.key,m.props,null,f.mode,v),v.ref=Hi(f,g,m),v.return=f,v)}function l(f,g,m,v){return g===null||g.tag!==4||g.stateNode.containerInfo!==m.containerInfo||g.stateNode.implementation!==m.implementation?(g=el(m,f.mode,v),g.return=f,g):(g=i(g,m.children||[]),g.return=f,g)}function u(f,g,m,v,C){return g===null||g.tag!==7?(g=yr(m,f.mode,v,C),g.return=f,g):(g=i(g,m),g.return=f,g)}function d(f,g,m){if(typeof g=="string"&&g!==""||typeof g=="number")return g=Xc(""+g,f.mode,m),g.return=f,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case so:return m=Go(g.type,g.key,g.props,null,f.mode,m),m.ref=Hi(f,null,g),m.return=f,m;case Wr:return g=el(g,f.mode,m),g.return=f,g;case _n:var v=g._init;return d(f,v(g._payload),m)}if(ta(g)||Ui(g))return g=yr(g,f.mode,m,null),g.return=f,g;yo(f,g)}return null}function h(f,g,m,v){var C=g!==null?g.key:null;if(typeof m=="string"&&m!==""||typeof m=="number")return C!==null?null:s(f,g,""+m,v);if(typeof m=="object"&&m!==null){switch(m.$$typeof){case so:return m.key===C?c(f,g,m,v):null;case Wr:return m.key===C?l(f,g,m,v):null;case _n:return C=m._init,h(f,g,C(m._payload),v)}if(ta(m)||Ui(m))return C!==null?null:u(f,g,m,v,null);yo(f,m)}return null}function p(f,g,m,v,C){if(typeof v=="string"&&v!==""||typeof v=="number")return f=f.get(m)||null,s(g,f,""+v,C);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case so:return f=f.get(v.key===null?m:v.key)||null,c(g,f,v,C);case Wr:return f=f.get(v.key===null?m:v.key)||null,l(g,f,v,C);case _n:var T=v._init;return p(f,g,m,T(v._payload),C)}if(ta(v)||Ui(v))return f=f.get(m)||null,u(g,f,v,C,null);yo(g,v)}return null}function b(f,g,m,v){for(var C=null,T=null,E=g,x=g=0,N=null;E!==null&&x<m.length;x++){E.index>x?(N=E,E=null):N=E.sibling;var M=h(f,E,m[x],v);if(M===null){E===null&&(E=N);break}t&&E&&M.alternate===null&&e(f,E),g=a(M,g,x),T===null?C=M:T.sibling=M,T=M,E=N}if(x===m.length)return n(f,E),ve&&lr(f,x),C;if(E===null){for(;x<m.length;x++)E=d(f,m[x],v),E!==null&&(g=a(E,g,x),T===null?C=E:T.sibling=E,T=E);return ve&&lr(f,x),C}for(E=r(f,E);x<m.length;x++)N=p(E,f,x,m[x],v),N!==null&&(t&&N.alternate!==null&&E.delete(N.key===null?x:N.key),g=a(N,g,x),T===null?C=N:T.sibling=N,T=N);return t&&E.forEach(function(A){return e(f,A)}),ve&&lr(f,x),C}function y(f,g,m,v){var C=Ui(m);if(typeof C!="function")throw Error(D(150));if(m=C.call(m),m==null)throw Error(D(151));for(var T=C=null,E=g,x=g=0,N=null,M=m.next();E!==null&&!M.done;x++,M=m.next()){E.index>x?(N=E,E=null):N=E.sibling;var A=h(f,E,M.value,v);if(A===null){E===null&&(E=N);break}t&&E&&A.alternate===null&&e(f,E),g=a(A,g,x),T===null?C=A:T.sibling=A,T=A,E=N}if(M.done)return n(f,E),ve&&lr(f,x),C;if(E===null){for(;!M.done;x++,M=m.next())M=d(f,M.value,v),M!==null&&(g=a(M,g,x),T===null?C=M:T.sibling=M,T=M);return ve&&lr(f,x),C}for(E=r(f,E);!M.done;x++,M=m.next())M=p(E,f,x,M.value,v),M!==null&&(t&&M.alternate!==null&&E.delete(M.key===null?x:M.key),g=a(M,g,x),T===null?C=M:T.sibling=M,T=M);return t&&E.forEach(function(W){return e(f,W)}),ve&&lr(f,x),C}function w(f,g,m,v){if(typeof m=="object"&&m!==null&&m.type===Kr&&m.key===null&&(m=m.props.children),typeof m=="object"&&m!==null){switch(m.$$typeof){case so:e:{for(var C=m.key,T=g;T!==null;){if(T.key===C){if(C=m.type,C===Kr){if(T.tag===7){n(f,T.sibling),g=i(T,m.props.children),g.return=f,f=g;break e}}else if(T.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===_n&&Mp(C)===T.type){n(f,T.sibling),g=i(T,m.props),g.ref=Hi(f,T,m),g.return=f,f=g;break e}n(f,T);break}else e(f,T);T=T.sibling}m.type===Kr?(g=yr(m.props.children,f.mode,v,m.key),g.return=f,f=g):(v=Go(m.type,m.key,m.props,null,f.mode,v),v.ref=Hi(f,g,m),v.return=f,f=v)}return o(f);case Wr:e:{for(T=m.key;g!==null;){if(g.key===T)if(g.tag===4&&g.stateNode.containerInfo===m.containerInfo&&g.stateNode.implementation===m.implementation){n(f,g.sibling),g=i(g,m.children||[]),g.return=f,f=g;break e}else{n(f,g);break}else e(f,g);g=g.sibling}g=el(m,f.mode,v),g.return=f,f=g}return o(f);case _n:return T=m._init,w(f,g,T(m._payload),v)}if(ta(m))return b(f,g,m,v);if(Ui(m))return y(f,g,m,v);yo(f,m)}return typeof m=="string"&&m!==""||typeof m=="number"?(m=""+m,g!==null&&g.tag===6?(n(f,g.sibling),g=i(g,m),g.return=f,f=g):(n(f,g),g=Xc(m,f.mode,v),g.return=f,f=g),o(f)):n(f,g)}return w}var Si=yv(!0),kv=yv(!1),Ps=nr(null),Rs=null,ti=null,Ad=null;function Ud(){Ad=ti=Rs=null}function Fd(t){var e=Ps.current;fe(Ps),t._currentValue=e}function eu(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function di(t,e){Rs=t,Ad=ti=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(ct=!0),t.firstContext=null)}function _t(t){var e=t._currentValue;if(Ad!==t)if(t={context:t,memoizedValue:e,next:null},ti===null){if(Rs===null)throw Error(D(308));ti=t,Rs.dependencies={lanes:0,firstContext:t}}else ti=ti.next=t;return e}var mr=null;function Bd(t){mr===null?mr=[t]:mr.push(t)}function wv(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,Bd(e)):(n.next=i.next,i.next=n),e.interleaved=n,wn(t,r)}function wn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var On=!1;function zd(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Cv(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function bn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function $n(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ne&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,wn(t,n)}return i=r.interleaved,i===null?(e.next=e,Bd(r)):(e.next=i.next,i.next=e),r.interleaved=e,wn(t,n)}function Vo(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Ed(t,n)}}function Lp(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?i=a=o:a=a.next=o,n=n.next}while(n!==null);a===null?i=a=e:a=a.next=e}else i=a=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Is(t,e,n,r){var i=t.updateQueue;On=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var c=s,l=c.next;c.next=null,o===null?a=l:o.next=l,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,s=u.lastBaseUpdate,s!==o&&(s===null?u.firstBaseUpdate=l:s.next=l,u.lastBaseUpdate=c))}if(a!==null){var d=i.baseState;o=0,u=l=c=null,s=a;do{var h=s.lane,p=s.eventTime;if((r&h)===h){u!==null&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var b=t,y=s;switch(h=e,p=n,y.tag){case 1:if(b=y.payload,typeof b=="function"){d=b.call(p,d,h);break e}d=b;break e;case 3:b.flags=b.flags&-65537|128;case 0:if(b=y.payload,h=typeof b=="function"?b.call(p,d,h):b,h==null)break e;d=Ce({},d,h);break e;case 2:On=!0}}s.callback!==null&&s.lane!==0&&(t.flags|=64,h=i.effects,h===null?i.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},u===null?(l=u=p,c=d):u=u.next=p,o|=h;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;h=s,s=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(!0);if(u===null&&(c=d),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else a===null&&(i.shared.lanes=0);Er|=o,t.lanes=o,t.memoizedState=d}}function Dp(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(D(191,i));i.call(r)}}}var io={},an=nr(io),ja=nr(io),Aa=nr(io);function gr(t){if(t===io)throw Error(D(174));return t}function Vd(t,e){switch(he(Aa,e),he(ja,t),he(an,io),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ll(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Ll(e,t)}fe(an),he(an,e)}function Ti(){fe(an),fe(ja),fe(Aa)}function Sv(t){gr(Aa.current);var e=gr(an.current),n=Ll(e,t.type);e!==n&&(he(ja,t),he(an,n))}function Hd(t){ja.current===t&&(fe(an),fe(ja))}var ke=nr(0);function _s(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Kc=[];function qd(){for(var t=0;t<Kc.length;t++)Kc[t]._workInProgressVersionPrimary=null;Kc.length=0}var Ho=xn.ReactCurrentDispatcher,Gc=xn.ReactCurrentBatchConfig,xr=0,we=null,Me=null,je=null,Os=!1,da=!1,Ua=0,Sw=0;function We(){throw Error(D(321))}function $d(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Wt(t[n],e[n]))return!1;return!0}function Wd(t,e,n,r,i,a){if(xr=a,we=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ho.current=t===null||t.memoizedState===null?Pw:Rw,t=n(r,i),da){a=0;do{if(da=!1,Ua=0,25<=a)throw Error(D(301));a+=1,je=Me=null,e.updateQueue=null,Ho.current=Iw,t=n(r,i)}while(da)}if(Ho.current=Ns,e=Me!==null&&Me.next!==null,xr=0,je=Me=we=null,Os=!1,e)throw Error(D(300));return t}function Kd(){var t=Ua!==0;return Ua=0,t}function Xt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return je===null?we.memoizedState=je=t:je=je.next=t,je}function Ot(){if(Me===null){var t=we.alternate;t=t!==null?t.memoizedState:null}else t=Me.next;var e=je===null?we.memoizedState:je.next;if(e!==null)je=e,Me=t;else{if(t===null)throw Error(D(310));Me=t,t={memoizedState:Me.memoizedState,baseState:Me.baseState,baseQueue:Me.baseQueue,queue:Me.queue,next:null},je===null?we.memoizedState=je=t:je=je.next=t}return je}function Fa(t,e){return typeof e=="function"?e(t):e}function Zc(t){var e=Ot(),n=e.queue;if(n===null)throw Error(D(311));n.lastRenderedReducer=t;var r=Me,i=r.baseQueue,a=n.pending;if(a!==null){if(i!==null){var o=i.next;i.next=a.next,a.next=o}r.baseQueue=i=a,n.pending=null}if(i!==null){a=i.next,r=r.baseState;var s=o=null,c=null,l=a;do{var u=l.lane;if((xr&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:t(r,l.action);else{var d={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(s=c=d,o=r):c=c.next=d,we.lanes|=u,Er|=u}l=l.next}while(l!==null&&l!==a);c===null?o=r:c.next=s,Wt(r,e.memoizedState)||(ct=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do a=i.lane,we.lanes|=a,Er|=a,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Jc(t){var e=Ot(),n=e.queue;if(n===null)throw Error(D(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,a=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do a=t(a,o.action),o=o.next;while(o!==i);Wt(a,e.memoizedState)||(ct=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),n.lastRenderedState=a}return[a,r]}function Tv(){}function xv(t,e){var n=we,r=Ot(),i=e(),a=!Wt(r.memoizedState,i);if(a&&(r.memoizedState=i,ct=!0),r=r.queue,Gd(Rv.bind(null,n,r,t),[t]),r.getSnapshot!==e||a||je!==null&&je.memoizedState.tag&1){if(n.flags|=2048,Ba(9,Pv.bind(null,n,r,i,e),void 0,null),Ue===null)throw Error(D(349));xr&30||Ev(n,e,i)}return i}function Ev(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=we.updateQueue,e===null?(e={lastEffect:null,stores:null},we.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Pv(t,e,n,r){e.value=n,e.getSnapshot=r,Iv(e)&&_v(t)}function Rv(t,e,n){return n(function(){Iv(e)&&_v(t)})}function Iv(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Wt(t,n)}catch{return!0}}function _v(t){var e=wn(t,1);e!==null&&$t(e,t,1,-1)}function jp(t){var e=Xt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Fa,lastRenderedState:t},e.queue=t,t=t.dispatch=Ew.bind(null,we,t),[e.memoizedState,t]}function Ba(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=we.updateQueue,e===null?(e={lastEffect:null,stores:null},we.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Ov(){return Ot().memoizedState}function qo(t,e,n,r){var i=Xt();we.flags|=t,i.memoizedState=Ba(1|e,n,void 0,r===void 0?null:r)}function uc(t,e,n,r){var i=Ot();r=r===void 0?null:r;var a=void 0;if(Me!==null){var o=Me.memoizedState;if(a=o.destroy,r!==null&&$d(r,o.deps)){i.memoizedState=Ba(e,n,a,r);return}}we.flags|=t,i.memoizedState=Ba(1|e,n,a,r)}function Ap(t,e){return qo(8390656,8,t,e)}function Gd(t,e){return uc(2048,8,t,e)}function Nv(t,e){return uc(4,2,t,e)}function Mv(t,e){return uc(4,4,t,e)}function Lv(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Dv(t,e,n){return n=n!=null?n.concat([t]):null,uc(4,4,Lv.bind(null,e,t),n)}function Zd(){}function jv(t,e){var n=Ot();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&$d(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Av(t,e){var n=Ot();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&$d(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Uv(t,e,n){return xr&21?(Wt(n,e)||(n=Hg(),we.lanes|=n,Er|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,ct=!0),t.memoizedState=n)}function Tw(t,e){var n=se;se=n!==0&&4>n?n:4,t(!0);var r=Gc.transition;Gc.transition={};try{t(!1),e()}finally{se=n,Gc.transition=r}}function Fv(){return Ot().memoizedState}function xw(t,e,n){var r=Kn(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Bv(t))zv(e,n);else if(n=wv(t,e,n,r),n!==null){var i=nt();$t(n,t,r,i),Vv(n,e,r)}}function Ew(t,e,n){var r=Kn(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Bv(t))zv(e,i);else{var a=t.alternate;if(t.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var o=e.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,Wt(s,o)){var c=e.interleaved;c===null?(i.next=i,Bd(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}n=wv(t,e,i,r),n!==null&&(i=nt(),$t(n,t,r,i),Vv(n,e,r))}}function Bv(t){var e=t.alternate;return t===we||e!==null&&e===we}function zv(t,e){da=Os=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Vv(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Ed(t,n)}}var Ns={readContext:_t,useCallback:We,useContext:We,useEffect:We,useImperativeHandle:We,useInsertionEffect:We,useLayoutEffect:We,useMemo:We,useReducer:We,useRef:We,useState:We,useDebugValue:We,useDeferredValue:We,useTransition:We,useMutableSource:We,useSyncExternalStore:We,useId:We,unstable_isNewReconciler:!1},Pw={readContext:_t,useCallback:function(t,e){return Xt().memoizedState=[t,e===void 0?null:e],t},useContext:_t,useEffect:Ap,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,qo(4194308,4,Lv.bind(null,e,t),n)},useLayoutEffect:function(t,e){return qo(4194308,4,t,e)},useInsertionEffect:function(t,e){return qo(4,2,t,e)},useMemo:function(t,e){var n=Xt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Xt();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=xw.bind(null,we,t),[r.memoizedState,t]},useRef:function(t){var e=Xt();return t={current:t},e.memoizedState=t},useState:jp,useDebugValue:Zd,useDeferredValue:function(t){return Xt().memoizedState=t},useTransition:function(){var t=jp(!1),e=t[0];return t=Tw.bind(null,t[1]),Xt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=we,i=Xt();if(ve){if(n===void 0)throw Error(D(407));n=n()}else{if(n=e(),Ue===null)throw Error(D(349));xr&30||Ev(r,e,n)}i.memoizedState=n;var a={value:n,getSnapshot:e};return i.queue=a,Ap(Rv.bind(null,r,a,t),[t]),r.flags|=2048,Ba(9,Pv.bind(null,r,a,n,e),void 0,null),n},useId:function(){var t=Xt(),e=Ue.identifierPrefix;if(ve){var n=gn,r=mn;n=(r&~(1<<32-qt(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Ua++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Sw++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Rw={readContext:_t,useCallback:jv,useContext:_t,useEffect:Gd,useImperativeHandle:Dv,useInsertionEffect:Nv,useLayoutEffect:Mv,useMemo:Av,useReducer:Zc,useRef:Ov,useState:function(){return Zc(Fa)},useDebugValue:Zd,useDeferredValue:function(t){var e=Ot();return Uv(e,Me.memoizedState,t)},useTransition:function(){var t=Zc(Fa)[0],e=Ot().memoizedState;return[t,e]},useMutableSource:Tv,useSyncExternalStore:xv,useId:Fv,unstable_isNewReconciler:!1},Iw={readContext:_t,useCallback:jv,useContext:_t,useEffect:Gd,useImperativeHandle:Dv,useInsertionEffect:Nv,useLayoutEffect:Mv,useMemo:Av,useReducer:Jc,useRef:Ov,useState:function(){return Jc(Fa)},useDebugValue:Zd,useDeferredValue:function(t){var e=Ot();return Me===null?e.memoizedState=t:Uv(e,Me.memoizedState,t)},useTransition:function(){var t=Jc(Fa)[0],e=Ot().memoizedState;return[t,e]},useMutableSource:Tv,useSyncExternalStore:xv,useId:Fv,unstable_isNewReconciler:!1};function jt(t,e){if(t&&t.defaultProps){e=Ce({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function tu(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Ce({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var dc={isMounted:function(t){return(t=t._reactInternals)?Lr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=nt(),i=Kn(t),a=bn(r,i);a.payload=e,n!=null&&(a.callback=n),e=$n(t,a,i),e!==null&&($t(e,t,i,r),Vo(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=nt(),i=Kn(t),a=bn(r,i);a.tag=1,a.payload=e,n!=null&&(a.callback=n),e=$n(t,a,i),e!==null&&($t(e,t,i,r),Vo(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=nt(),r=Kn(t),i=bn(n,r);i.tag=2,e!=null&&(i.callback=e),e=$n(t,i,r),e!==null&&($t(e,t,r,n),Vo(e,t,r))}};function Up(t,e,n,r,i,a,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,a,o):e.prototype&&e.prototype.isPureReactComponent?!Na(n,r)||!Na(i,a):!0}function Hv(t,e,n){var r=!1,i=Yn,a=e.contextType;return typeof a=="object"&&a!==null?a=_t(a):(i=dt(e)?Sr:Ze.current,r=e.contextTypes,a=(r=r!=null)?wi(t,i):Yn),e=new e(n,a),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=dc,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=a),e}function Fp(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&dc.enqueueReplaceState(e,e.state,null)}function nu(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},zd(t);var a=e.contextType;typeof a=="object"&&a!==null?i.context=_t(a):(a=dt(e)?Sr:Ze.current,i.context=wi(t,a)),i.state=t.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(tu(t,e,a,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&dc.enqueueReplaceState(i,i.state,null),Is(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function xi(t,e){try{var n="",r=e;do n+=rk(r),r=r.return;while(r);var i=n}catch(a){i=`
Error generating stack: `+a.message+`
`+a.stack}return{value:t,source:e,stack:i,digest:null}}function Qc(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function ru(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var _w=typeof WeakMap=="function"?WeakMap:Map;function qv(t,e,n){n=bn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Ls||(Ls=!0,hu=r),ru(t,e)},n}function $v(t,e,n){n=bn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){ru(t,e)}}var a=t.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){ru(t,e),typeof r!="function"&&(Wn===null?Wn=new Set([this]):Wn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Bp(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new _w;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=qw.bind(null,t,e,n),e.then(t,t))}function zp(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Vp(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=bn(-1,1),e.tag=2,$n(n,e,1))),n.lanes|=1),t)}var Ow=xn.ReactCurrentOwner,ct=!1;function Xe(t,e,n,r){e.child=t===null?kv(e,null,n,r):Si(e,t.child,n,r)}function Hp(t,e,n,r,i){n=n.render;var a=e.ref;return di(e,i),r=Wd(t,e,n,r,a,i),n=Kd(),t!==null&&!ct?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Cn(t,e,i)):(ve&&n&&Ld(e),e.flags|=1,Xe(t,e,r,i),e.child)}function qp(t,e,n,r,i){if(t===null){var a=n.type;return typeof a=="function"&&!rh(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=a,Wv(t,e,a,r,i)):(t=Go(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(a=t.child,!(t.lanes&i)){var o=a.memoizedProps;if(n=n.compare,n=n!==null?n:Na,n(o,r)&&t.ref===e.ref)return Cn(t,e,i)}return e.flags|=1,t=Gn(a,r),t.ref=e.ref,t.return=e,e.child=t}function Wv(t,e,n,r,i){if(t!==null){var a=t.memoizedProps;if(Na(a,r)&&t.ref===e.ref)if(ct=!1,e.pendingProps=r=a,(t.lanes&i)!==0)t.flags&131072&&(ct=!0);else return e.lanes=t.lanes,Cn(t,e,i)}return iu(t,e,n,r,i)}function Kv(t,e,n){var r=e.pendingProps,i=r.children,a=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},he(ri,ft),ft|=n;else{if(!(n&1073741824))return t=a!==null?a.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,he(ri,ft),ft|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:n,he(ri,ft),ft|=r}else a!==null?(r=a.baseLanes|n,e.memoizedState=null):r=n,he(ri,ft),ft|=r;return Xe(t,e,i,n),e.child}function Gv(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function iu(t,e,n,r,i){var a=dt(n)?Sr:Ze.current;return a=wi(e,a),di(e,i),n=Wd(t,e,n,r,a,i),r=Kd(),t!==null&&!ct?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Cn(t,e,i)):(ve&&r&&Ld(e),e.flags|=1,Xe(t,e,n,i),e.child)}function $p(t,e,n,r,i){if(dt(n)){var a=!0;Ts(e)}else a=!1;if(di(e,i),e.stateNode===null)$o(t,e),Hv(e,n,r),nu(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,s=e.memoizedProps;o.props=s;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=_t(l):(l=dt(n)?Sr:Ze.current,l=wi(e,l));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==r||c!==l)&&Fp(e,o,r,l),On=!1;var h=e.memoizedState;o.state=h,Is(e,r,o,i),c=e.memoizedState,s!==r||h!==c||ut.current||On?(typeof u=="function"&&(tu(e,n,u,r),c=e.memoizedState),(s=On||Up(e,n,s,r,h,c,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=l,r=s):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Cv(t,e),s=e.memoizedProps,l=e.type===e.elementType?s:jt(e.type,s),o.props=l,d=e.pendingProps,h=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=_t(c):(c=dt(n)?Sr:Ze.current,c=wi(e,c));var p=n.getDerivedStateFromProps;(u=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==d||h!==c)&&Fp(e,o,r,c),On=!1,h=e.memoizedState,o.state=h,Is(e,r,o,i);var b=e.memoizedState;s!==d||h!==b||ut.current||On?(typeof p=="function"&&(tu(e,n,p,r),b=e.memoizedState),(l=On||Up(e,n,l,r,h,b,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,b,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,b,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||s===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=b),o.props=r,o.state=b,o.context=c,r=l):(typeof o.componentDidUpdate!="function"||s===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return au(t,e,n,r,a,i)}function au(t,e,n,r,i,a){Gv(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&_p(e,n,!1),Cn(t,e,a);r=e.stateNode,Ow.current=e;var s=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Si(e,t.child,null,a),e.child=Si(e,null,s,a)):Xe(t,e,s,a),e.memoizedState=r.state,i&&_p(e,n,!0),e.child}function Zv(t){var e=t.stateNode;e.pendingContext?Ip(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Ip(t,e.context,!1),Vd(t,e.containerInfo)}function Wp(t,e,n,r,i){return Ci(),jd(i),e.flags|=256,Xe(t,e,n,r),e.child}var ou={dehydrated:null,treeContext:null,retryLane:0};function su(t){return{baseLanes:t,cachePool:null,transitions:null}}function Jv(t,e,n){var r=e.pendingProps,i=ke.current,a=!1,o=(e.flags&128)!==0,s;if((s=o)||(s=t!==null&&t.memoizedState===null?!1:(i&2)!==0),s?(a=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),he(ke,i&1),t===null)return Xl(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,a?(r=e.mode,a=e.child,o={mode:"hidden",children:o},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=fc(o,r,0,null),t=yr(t,r,n,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=su(n),e.memoizedState=ou,t):Jd(e,o));if(i=t.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return Nw(t,e,o,r,s,i,n);if(a){a=r.fallback,o=e.mode,i=t.child,s=i.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=Gn(i,c),r.subtreeFlags=i.subtreeFlags&14680064),s!==null?a=Gn(s,a):(a=yr(a,o,n,null),a.flags|=2),a.return=e,r.return=e,r.sibling=a,e.child=r,r=a,a=e.child,o=t.child.memoizedState,o=o===null?su(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=t.childLanes&~n,e.memoizedState=ou,r}return a=t.child,t=a.sibling,r=Gn(a,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Jd(t,e){return e=fc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ko(t,e,n,r){return r!==null&&jd(r),Si(e,t.child,null,n),t=Jd(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Nw(t,e,n,r,i,a,o){if(n)return e.flags&256?(e.flags&=-257,r=Qc(Error(D(422))),ko(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(a=r.fallback,i=e.mode,r=fc({mode:"visible",children:r.children},i,0,null),a=yr(a,i,o,null),a.flags|=2,r.return=e,a.return=e,r.sibling=a,e.child=r,e.mode&1&&Si(e,t.child,null,o),e.child.memoizedState=su(o),e.memoizedState=ou,a);if(!(e.mode&1))return ko(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var s=r.dgst;return r=s,a=Error(D(419)),r=Qc(a,r,void 0),ko(t,e,o,r)}if(s=(o&t.childLanes)!==0,ct||s){if(r=Ue,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==a.retryLane&&(a.retryLane=i,wn(t,i),$t(r,t,i,-1))}return nh(),r=Qc(Error(D(421))),ko(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=$w.bind(null,t),i._reactRetry=e,null):(t=a.treeContext,gt=qn(i.nextSibling),bt=e,ve=!0,Ft=null,t!==null&&(St[Tt++]=mn,St[Tt++]=gn,St[Tt++]=Tr,mn=t.id,gn=t.overflow,Tr=e),e=Jd(e,r.children),e.flags|=4096,e)}function Kp(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),eu(t.return,e,n)}function Yc(t,e,n,r,i){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function Qv(t,e,n){var r=e.pendingProps,i=r.revealOrder,a=r.tail;if(Xe(t,e,r.children,n),r=ke.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Kp(t,n,e);else if(t.tag===19)Kp(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(he(ke,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&_s(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Yc(e,!1,i,n,a);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&_s(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Yc(e,!0,n,null,a);break;case"together":Yc(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function $o(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Cn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Er|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(D(153));if(e.child!==null){for(t=e.child,n=Gn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Gn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Mw(t,e,n){switch(e.tag){case 3:Zv(e),Ci();break;case 5:Sv(e);break;case 1:dt(e.type)&&Ts(e);break;case 4:Vd(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;he(Ps,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(he(ke,ke.current&1),e.flags|=128,null):n&e.child.childLanes?Jv(t,e,n):(he(ke,ke.current&1),t=Cn(t,e,n),t!==null?t.sibling:null);he(ke,ke.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return Qv(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),he(ke,ke.current),r)break;return null;case 22:case 23:return e.lanes=0,Kv(t,e,n)}return Cn(t,e,n)}var Yv,cu,Xv,e0;Yv=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};cu=function(){};Xv=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,gr(an.current);var a=null;switch(n){case"input":i=_l(t,i),r=_l(t,r),a=[];break;case"select":i=Ce({},i,{value:void 0}),r=Ce({},r,{value:void 0}),a=[];break;case"textarea":i=Ml(t,i),r=Ml(t,r),a=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Cs)}Dl(n,r);var o;n=null;for(l in i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var s=i[l];for(o in s)s.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(xa.hasOwnProperty(l)?a||(a=[]):(a=a||[]).push(l,null));for(l in r){var c=r[l];if(s=i!=null?i[l]:void 0,r.hasOwnProperty(l)&&c!==s&&(c!=null||s!=null))if(l==="style")if(s){for(o in s)!s.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&s[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(a||(a=[]),a.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,s=s?s.__html:void 0,c!=null&&s!==c&&(a=a||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(a=a||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(xa.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&pe("scroll",t),a||s===c||(a=[])):(a=a||[]).push(l,c))}n&&(a=a||[]).push("style",n);var l=a;(e.updateQueue=l)&&(e.flags|=4)}};e0=function(t,e,n,r){n!==r&&(e.flags|=4)};function qi(t,e){if(!ve)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ke(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function Lw(t,e,n){var r=e.pendingProps;switch(Dd(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ke(e),null;case 1:return dt(e.type)&&Ss(),Ke(e),null;case 3:return r=e.stateNode,Ti(),fe(ut),fe(Ze),qd(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(bo(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ft!==null&&(mu(Ft),Ft=null))),cu(t,e),Ke(e),null;case 5:Hd(e);var i=gr(Aa.current);if(n=e.type,t!==null&&e.stateNode!=null)Xv(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(D(166));return Ke(e),null}if(t=gr(an.current),bo(e)){r=e.stateNode,n=e.type;var a=e.memoizedProps;switch(r[nn]=e,r[Da]=a,t=(e.mode&1)!==0,n){case"dialog":pe("cancel",r),pe("close",r);break;case"iframe":case"object":case"embed":pe("load",r);break;case"video":case"audio":for(i=0;i<ra.length;i++)pe(ra[i],r);break;case"source":pe("error",r);break;case"img":case"image":case"link":pe("error",r),pe("load",r);break;case"details":pe("toggle",r);break;case"input":np(r,a),pe("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},pe("invalid",r);break;case"textarea":ip(r,a),pe("invalid",r)}Dl(n,a),i=null;for(var o in a)if(a.hasOwnProperty(o)){var s=a[o];o==="children"?typeof s=="string"?r.textContent!==s&&(a.suppressHydrationWarning!==!0&&vo(r.textContent,s,t),i=["children",s]):typeof s=="number"&&r.textContent!==""+s&&(a.suppressHydrationWarning!==!0&&vo(r.textContent,s,t),i=["children",""+s]):xa.hasOwnProperty(o)&&s!=null&&o==="onScroll"&&pe("scroll",r)}switch(n){case"input":co(r),rp(r,a,!0);break;case"textarea":co(r),ap(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=Cs)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Rg(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[nn]=e,t[Da]=r,Yv(t,e,!1,!1),e.stateNode=t;e:{switch(o=jl(n,r),n){case"dialog":pe("cancel",t),pe("close",t),i=r;break;case"iframe":case"object":case"embed":pe("load",t),i=r;break;case"video":case"audio":for(i=0;i<ra.length;i++)pe(ra[i],t);i=r;break;case"source":pe("error",t),i=r;break;case"img":case"image":case"link":pe("error",t),pe("load",t),i=r;break;case"details":pe("toggle",t),i=r;break;case"input":np(t,r),i=_l(t,r),pe("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=Ce({},r,{value:void 0}),pe("invalid",t);break;case"textarea":ip(t,r),i=Ml(t,r),pe("invalid",t);break;default:i=r}Dl(n,i),s=i;for(a in s)if(s.hasOwnProperty(a)){var c=s[a];a==="style"?Og(t,c):a==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Ig(t,c)):a==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Ea(t,c):typeof c=="number"&&Ea(t,""+c):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(xa.hasOwnProperty(a)?c!=null&&a==="onScroll"&&pe("scroll",t):c!=null&&kd(t,a,c,o))}switch(n){case"input":co(t),rp(t,r,!1);break;case"textarea":co(t),ap(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Qn(r.value));break;case"select":t.multiple=!!r.multiple,a=r.value,a!=null?si(t,!!r.multiple,a,!1):r.defaultValue!=null&&si(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Cs)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ke(e),null;case 6:if(t&&e.stateNode!=null)e0(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(D(166));if(n=gr(Aa.current),gr(an.current),bo(e)){if(r=e.stateNode,n=e.memoizedProps,r[nn]=e,(a=r.nodeValue!==n)&&(t=bt,t!==null))switch(t.tag){case 3:vo(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&vo(r.nodeValue,n,(t.mode&1)!==0)}a&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[nn]=e,e.stateNode=r}return Ke(e),null;case 13:if(fe(ke),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ve&&gt!==null&&e.mode&1&&!(e.flags&128))bv(),Ci(),e.flags|=98560,a=!1;else if(a=bo(e),r!==null&&r.dehydrated!==null){if(t===null){if(!a)throw Error(D(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(D(317));a[nn]=e}else Ci(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ke(e),a=!1}else Ft!==null&&(mu(Ft),Ft=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||ke.current&1?Le===0&&(Le=3):nh())),e.updateQueue!==null&&(e.flags|=4),Ke(e),null);case 4:return Ti(),cu(t,e),t===null&&Ma(e.stateNode.containerInfo),Ke(e),null;case 10:return Fd(e.type._context),Ke(e),null;case 17:return dt(e.type)&&Ss(),Ke(e),null;case 19:if(fe(ke),a=e.memoizedState,a===null)return Ke(e),null;if(r=(e.flags&128)!==0,o=a.rendering,o===null)if(r)qi(a,!1);else{if(Le!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=_s(t),o!==null){for(e.flags|=128,qi(a,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)a=n,t=r,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,t=o.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return he(ke,ke.current&1|2),e.child}t=t.sibling}a.tail!==null&&Pe()>Ei&&(e.flags|=128,r=!0,qi(a,!1),e.lanes=4194304)}else{if(!r)if(t=_s(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),qi(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!ve)return Ke(e),null}else 2*Pe()-a.renderingStartTime>Ei&&n!==1073741824&&(e.flags|=128,r=!0,qi(a,!1),e.lanes=4194304);a.isBackwards?(o.sibling=e.child,e.child=o):(n=a.last,n!==null?n.sibling=o:e.child=o,a.last=o)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=Pe(),e.sibling=null,n=ke.current,he(ke,r?n&1|2:n&1),e):(Ke(e),null);case 22:case 23:return th(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ft&1073741824&&(Ke(e),e.subtreeFlags&6&&(e.flags|=8192)):Ke(e),null;case 24:return null;case 25:return null}throw Error(D(156,e.tag))}function Dw(t,e){switch(Dd(e),e.tag){case 1:return dt(e.type)&&Ss(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ti(),fe(ut),fe(Ze),qd(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Hd(e),null;case 13:if(fe(ke),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(D(340));Ci()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return fe(ke),null;case 4:return Ti(),null;case 10:return Fd(e.type._context),null;case 22:case 23:return th(),null;case 24:return null;default:return null}}var wo=!1,Ge=!1,jw=typeof WeakSet=="function"?WeakSet:Set,H=null;function ni(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Te(t,e,r)}else n.current=null}function t0(t,e,n){try{n()}catch(r){Te(t,e,r)}}var Gp=!1;function Aw(t,e){if(Wl=ys,t=av(),Md(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var o=0,s=-1,c=-1,l=0,u=0,d=t,h=null;t:for(;;){for(var p;d!==n||i!==0&&d.nodeType!==3||(s=o+i),d!==a||r!==0&&d.nodeType!==3||(c=o+r),d.nodeType===3&&(o+=d.nodeValue.length),(p=d.firstChild)!==null;)h=d,d=p;for(;;){if(d===t)break t;if(h===n&&++l===i&&(s=o),h===a&&++u===r&&(c=o),(p=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=p}n=s===-1||c===-1?null:{start:s,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Kl={focusedElem:t,selectionRange:n},ys=!1,H=e;H!==null;)if(e=H,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,H=t;else for(;H!==null;){e=H;try{var b=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(b!==null){var y=b.memoizedProps,w=b.memoizedState,f=e.stateNode,g=f.getSnapshotBeforeUpdate(e.elementType===e.type?y:jt(e.type,y),w);f.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var m=e.stateNode.containerInfo;m.nodeType===1?m.textContent="":m.nodeType===9&&m.documentElement&&m.removeChild(m.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(D(163))}}catch(v){Te(e,e.return,v)}if(t=e.sibling,t!==null){t.return=e.return,H=t;break}H=e.return}return b=Gp,Gp=!1,b}function ha(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var a=i.destroy;i.destroy=void 0,a!==void 0&&t0(e,n,a)}i=i.next}while(i!==r)}}function hc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function lu(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function n0(t){var e=t.alternate;e!==null&&(t.alternate=null,n0(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[nn],delete e[Da],delete e[Jl],delete e[yw],delete e[kw])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function r0(t){return t.tag===5||t.tag===3||t.tag===4}function Zp(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||r0(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function uu(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Cs));else if(r!==4&&(t=t.child,t!==null))for(uu(t,e,n),t=t.sibling;t!==null;)uu(t,e,n),t=t.sibling}function du(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(du(t,e,n),t=t.sibling;t!==null;)du(t,e,n),t=t.sibling}var Be=null,At=!1;function En(t,e,n){for(n=n.child;n!==null;)i0(t,e,n),n=n.sibling}function i0(t,e,n){if(rn&&typeof rn.onCommitFiberUnmount=="function")try{rn.onCommitFiberUnmount(ic,n)}catch{}switch(n.tag){case 5:Ge||ni(n,e);case 6:var r=Be,i=At;Be=null,En(t,e,n),Be=r,At=i,Be!==null&&(At?(t=Be,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Be.removeChild(n.stateNode));break;case 18:Be!==null&&(At?(t=Be,n=n.stateNode,t.nodeType===8?$c(t.parentNode,n):t.nodeType===1&&$c(t,n),_a(t)):$c(Be,n.stateNode));break;case 4:r=Be,i=At,Be=n.stateNode.containerInfo,At=!0,En(t,e,n),Be=r,At=i;break;case 0:case 11:case 14:case 15:if(!Ge&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&t0(n,e,o),i=i.next}while(i!==r)}En(t,e,n);break;case 1:if(!Ge&&(ni(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Te(n,e,s)}En(t,e,n);break;case 21:En(t,e,n);break;case 22:n.mode&1?(Ge=(r=Ge)||n.memoizedState!==null,En(t,e,n),Ge=r):En(t,e,n);break;default:En(t,e,n)}}function Jp(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new jw),e.forEach(function(r){var i=Ww.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Mt(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var a=t,o=e,s=o;e:for(;s!==null;){switch(s.tag){case 5:Be=s.stateNode,At=!1;break e;case 3:Be=s.stateNode.containerInfo,At=!0;break e;case 4:Be=s.stateNode.containerInfo,At=!0;break e}s=s.return}if(Be===null)throw Error(D(160));i0(a,o,i),Be=null,At=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(l){Te(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)a0(e,t),e=e.sibling}function a0(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Mt(e,t),Jt(t),r&4){try{ha(3,t,t.return),hc(3,t)}catch(y){Te(t,t.return,y)}try{ha(5,t,t.return)}catch(y){Te(t,t.return,y)}}break;case 1:Mt(e,t),Jt(t),r&512&&n!==null&&ni(n,n.return);break;case 5:if(Mt(e,t),Jt(t),r&512&&n!==null&&ni(n,n.return),t.flags&32){var i=t.stateNode;try{Ea(i,"")}catch(y){Te(t,t.return,y)}}if(r&4&&(i=t.stateNode,i!=null)){var a=t.memoizedProps,o=n!==null?n.memoizedProps:a,s=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{s==="input"&&a.type==="radio"&&a.name!=null&&Eg(i,a),jl(s,o);var l=jl(s,a);for(o=0;o<c.length;o+=2){var u=c[o],d=c[o+1];u==="style"?Og(i,d):u==="dangerouslySetInnerHTML"?Ig(i,d):u==="children"?Ea(i,d):kd(i,u,d,l)}switch(s){case"input":Ol(i,a);break;case"textarea":Pg(i,a);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var p=a.value;p!=null?si(i,!!a.multiple,p,!1):h!==!!a.multiple&&(a.defaultValue!=null?si(i,!!a.multiple,a.defaultValue,!0):si(i,!!a.multiple,a.multiple?[]:"",!1))}i[Da]=a}catch(y){Te(t,t.return,y)}}break;case 6:if(Mt(e,t),Jt(t),r&4){if(t.stateNode===null)throw Error(D(162));i=t.stateNode,a=t.memoizedProps;try{i.nodeValue=a}catch(y){Te(t,t.return,y)}}break;case 3:if(Mt(e,t),Jt(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{_a(e.containerInfo)}catch(y){Te(t,t.return,y)}break;case 4:Mt(e,t),Jt(t);break;case 13:Mt(e,t),Jt(t),i=t.child,i.flags&8192&&(a=i.memoizedState!==null,i.stateNode.isHidden=a,!a||i.alternate!==null&&i.alternate.memoizedState!==null||(Xd=Pe())),r&4&&Jp(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Ge=(l=Ge)||u,Mt(e,t),Ge=l):Mt(e,t),Jt(t),r&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!u&&t.mode&1)for(H=t,u=t.child;u!==null;){for(d=H=u;H!==null;){switch(h=H,p=h.child,h.tag){case 0:case 11:case 14:case 15:ha(4,h,h.return);break;case 1:ni(h,h.return);var b=h.stateNode;if(typeof b.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,b.props=e.memoizedProps,b.state=e.memoizedState,b.componentWillUnmount()}catch(y){Te(r,n,y)}}break;case 5:ni(h,h.return);break;case 22:if(h.memoizedState!==null){Yp(d);continue}}p!==null?(p.return=h,H=p):Yp(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{i=d.stateNode,l?(a=i.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(s=d.stateNode,c=d.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,s.style.display=_g("display",o))}catch(y){Te(t,t.return,y)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(y){Te(t,t.return,y)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Mt(e,t),Jt(t),r&4&&Jp(t);break;case 21:break;default:Mt(e,t),Jt(t)}}function Jt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(r0(n)){var r=n;break e}n=n.return}throw Error(D(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Ea(i,""),r.flags&=-33);var a=Zp(t);du(t,a,i);break;case 3:case 4:var o=r.stateNode.containerInfo,s=Zp(t);uu(t,s,o);break;default:throw Error(D(161))}}catch(c){Te(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Uw(t,e,n){H=t,o0(t)}function o0(t,e,n){for(var r=(t.mode&1)!==0;H!==null;){var i=H,a=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||wo;if(!o){var s=i.alternate,c=s!==null&&s.memoizedState!==null||Ge;s=wo;var l=Ge;if(wo=o,(Ge=c)&&!l)for(H=i;H!==null;)o=H,c=o.child,o.tag===22&&o.memoizedState!==null?Xp(i):c!==null?(c.return=o,H=c):Xp(i);for(;a!==null;)H=a,o0(a),a=a.sibling;H=i,wo=s,Ge=l}Qp(t)}else i.subtreeFlags&8772&&a!==null?(a.return=i,H=a):Qp(t)}}function Qp(t){for(;H!==null;){var e=H;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ge||hc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Ge)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:jt(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&Dp(e,a,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Dp(e,o,n)}break;case 5:var s=e.stateNode;if(n===null&&e.flags&4){n=s;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&_a(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(D(163))}Ge||e.flags&512&&lu(e)}catch(h){Te(e,e.return,h)}}if(e===t){H=null;break}if(n=e.sibling,n!==null){n.return=e.return,H=n;break}H=e.return}}function Yp(t){for(;H!==null;){var e=H;if(e===t){H=null;break}var n=e.sibling;if(n!==null){n.return=e.return,H=n;break}H=e.return}}function Xp(t){for(;H!==null;){var e=H;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{hc(4,e)}catch(c){Te(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(c){Te(e,i,c)}}var a=e.return;try{lu(e)}catch(c){Te(e,a,c)}break;case 5:var o=e.return;try{lu(e)}catch(c){Te(e,o,c)}}}catch(c){Te(e,e.return,c)}if(e===t){H=null;break}var s=e.sibling;if(s!==null){s.return=e.return,H=s;break}H=e.return}}var Fw=Math.ceil,Ms=xn.ReactCurrentDispatcher,Qd=xn.ReactCurrentOwner,It=xn.ReactCurrentBatchConfig,ne=0,Ue=null,_e=null,qe=0,ft=0,ri=nr(0),Le=0,za=null,Er=0,pc=0,Yd=0,pa=null,ot=null,Xd=0,Ei=1/0,un=null,Ls=!1,hu=null,Wn=null,Co=!1,Fn=null,Ds=0,fa=0,pu=null,Wo=-1,Ko=0;function nt(){return ne&6?Pe():Wo!==-1?Wo:Wo=Pe()}function Kn(t){return t.mode&1?ne&2&&qe!==0?qe&-qe:Cw.transition!==null?(Ko===0&&(Ko=Hg()),Ko):(t=se,t!==0||(t=window.event,t=t===void 0?16:Jg(t.type)),t):1}function $t(t,e,n,r){if(50<fa)throw fa=0,pu=null,Error(D(185));to(t,n,r),(!(ne&2)||t!==Ue)&&(t===Ue&&(!(ne&2)&&(pc|=n),Le===4&&Ln(t,qe)),ht(t,r),n===1&&ne===0&&!(e.mode&1)&&(Ei=Pe()+500,lc&&rr()))}function ht(t,e){var n=t.callbackNode;Ck(t,e);var r=bs(t,t===Ue?qe:0);if(r===0)n!==null&&cp(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&cp(n),e===1)t.tag===0?ww(ef.bind(null,t)):mv(ef.bind(null,t)),vw(function(){!(ne&6)&&rr()}),n=null;else{switch(qg(r)){case 1:n=xd;break;case 4:n=zg;break;case 16:n=vs;break;case 536870912:n=Vg;break;default:n=vs}n=f0(n,s0.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function s0(t,e){if(Wo=-1,Ko=0,ne&6)throw Error(D(327));var n=t.callbackNode;if(hi()&&t.callbackNode!==n)return null;var r=bs(t,t===Ue?qe:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=js(t,r);else{e=r;var i=ne;ne|=2;var a=l0();(Ue!==t||qe!==e)&&(un=null,Ei=Pe()+500,br(t,e));do try{Vw();break}catch(s){c0(t,s)}while(!0);Ud(),Ms.current=a,ne=i,_e!==null?e=0:(Ue=null,qe=0,e=Le)}if(e!==0){if(e===2&&(i=zl(t),i!==0&&(r=i,e=fu(t,i))),e===1)throw n=za,br(t,0),Ln(t,r),ht(t,Pe()),n;if(e===6)Ln(t,r);else{if(i=t.current.alternate,!(r&30)&&!Bw(i)&&(e=js(t,r),e===2&&(a=zl(t),a!==0&&(r=a,e=fu(t,a))),e===1))throw n=za,br(t,0),Ln(t,r),ht(t,Pe()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(D(345));case 2:ur(t,ot,un);break;case 3:if(Ln(t,r),(r&130023424)===r&&(e=Xd+500-Pe(),10<e)){if(bs(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){nt(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Zl(ur.bind(null,t,ot,un),e);break}ur(t,ot,un);break;case 4:if(Ln(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-qt(r);a=1<<o,o=e[o],o>i&&(i=o),r&=~a}if(r=i,r=Pe()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Fw(r/1960))-r,10<r){t.timeoutHandle=Zl(ur.bind(null,t,ot,un),r);break}ur(t,ot,un);break;case 5:ur(t,ot,un);break;default:throw Error(D(329))}}}return ht(t,Pe()),t.callbackNode===n?s0.bind(null,t):null}function fu(t,e){var n=pa;return t.current.memoizedState.isDehydrated&&(br(t,e).flags|=256),t=js(t,e),t!==2&&(e=ot,ot=n,e!==null&&mu(e)),t}function mu(t){ot===null?ot=t:ot.push.apply(ot,t)}function Bw(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!Wt(a(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ln(t,e){for(e&=~Yd,e&=~pc,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-qt(e),r=1<<n;t[n]=-1,e&=~r}}function ef(t){if(ne&6)throw Error(D(327));hi();var e=bs(t,0);if(!(e&1))return ht(t,Pe()),null;var n=js(t,e);if(t.tag!==0&&n===2){var r=zl(t);r!==0&&(e=r,n=fu(t,r))}if(n===1)throw n=za,br(t,0),Ln(t,e),ht(t,Pe()),n;if(n===6)throw Error(D(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ur(t,ot,un),ht(t,Pe()),null}function eh(t,e){var n=ne;ne|=1;try{return t(e)}finally{ne=n,ne===0&&(Ei=Pe()+500,lc&&rr())}}function Pr(t){Fn!==null&&Fn.tag===0&&!(ne&6)&&hi();var e=ne;ne|=1;var n=It.transition,r=se;try{if(It.transition=null,se=1,t)return t()}finally{se=r,It.transition=n,ne=e,!(ne&6)&&rr()}}function th(){ft=ri.current,fe(ri)}function br(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,gw(n)),_e!==null)for(n=_e.return;n!==null;){var r=n;switch(Dd(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ss();break;case 3:Ti(),fe(ut),fe(Ze),qd();break;case 5:Hd(r);break;case 4:Ti();break;case 13:fe(ke);break;case 19:fe(ke);break;case 10:Fd(r.type._context);break;case 22:case 23:th()}n=n.return}if(Ue=t,_e=t=Gn(t.current,null),qe=ft=e,Le=0,za=null,Yd=pc=Er=0,ot=pa=null,mr!==null){for(e=0;e<mr.length;e++)if(n=mr[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,a=n.pending;if(a!==null){var o=a.next;a.next=i,r.next=o}n.pending=r}mr=null}return t}function c0(t,e){do{var n=_e;try{if(Ud(),Ho.current=Ns,Os){for(var r=we.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Os=!1}if(xr=0,je=Me=we=null,da=!1,Ua=0,Qd.current=null,n===null||n.return===null){Le=1,za=e,_e=null;break}e:{var a=t,o=n.return,s=n,c=e;if(e=qe,s.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=s,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=zp(o);if(p!==null){p.flags&=-257,Vp(p,o,s,a,e),p.mode&1&&Bp(a,l,e),e=p,c=l;var b=e.updateQueue;if(b===null){var y=new Set;y.add(c),e.updateQueue=y}else b.add(c);break e}else{if(!(e&1)){Bp(a,l,e),nh();break e}c=Error(D(426))}}else if(ve&&s.mode&1){var w=zp(o);if(w!==null){!(w.flags&65536)&&(w.flags|=256),Vp(w,o,s,a,e),jd(xi(c,s));break e}}a=c=xi(c,s),Le!==4&&(Le=2),pa===null?pa=[a]:pa.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var f=qv(a,c,e);Lp(a,f);break e;case 1:s=c;var g=a.type,m=a.stateNode;if(!(a.flags&128)&&(typeof g.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Wn===null||!Wn.has(m)))){a.flags|=65536,e&=-e,a.lanes|=e;var v=$v(a,s,e);Lp(a,v);break e}}a=a.return}while(a!==null)}d0(n)}catch(C){e=C,_e===n&&n!==null&&(_e=n=n.return);continue}break}while(!0)}function l0(){var t=Ms.current;return Ms.current=Ns,t===null?Ns:t}function nh(){(Le===0||Le===3||Le===2)&&(Le=4),Ue===null||!(Er&268435455)&&!(pc&268435455)||Ln(Ue,qe)}function js(t,e){var n=ne;ne|=2;var r=l0();(Ue!==t||qe!==e)&&(un=null,br(t,e));do try{zw();break}catch(i){c0(t,i)}while(!0);if(Ud(),ne=n,Ms.current=r,_e!==null)throw Error(D(261));return Ue=null,qe=0,Le}function zw(){for(;_e!==null;)u0(_e)}function Vw(){for(;_e!==null&&!pk();)u0(_e)}function u0(t){var e=p0(t.alternate,t,ft);t.memoizedProps=t.pendingProps,e===null?d0(t):_e=e,Qd.current=null}function d0(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Dw(n,e),n!==null){n.flags&=32767,_e=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Le=6,_e=null;return}}else if(n=Lw(n,e,ft),n!==null){_e=n;return}if(e=e.sibling,e!==null){_e=e;return}_e=e=t}while(e!==null);Le===0&&(Le=5)}function ur(t,e,n){var r=se,i=It.transition;try{It.transition=null,se=1,Hw(t,e,n,r)}finally{It.transition=i,se=r}return null}function Hw(t,e,n,r){do hi();while(Fn!==null);if(ne&6)throw Error(D(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(D(177));t.callbackNode=null,t.callbackPriority=0;var a=n.lanes|n.childLanes;if(Sk(t,a),t===Ue&&(_e=Ue=null,qe=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Co||(Co=!0,f0(vs,function(){return hi(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=It.transition,It.transition=null;var o=se;se=1;var s=ne;ne|=4,Qd.current=null,Aw(t,n),a0(n,t),lw(Kl),ys=!!Wl,Kl=Wl=null,t.current=n,Uw(n),fk(),ne=s,se=o,It.transition=a}else t.current=n;if(Co&&(Co=!1,Fn=t,Ds=i),a=t.pendingLanes,a===0&&(Wn=null),vk(n.stateNode),ht(t,Pe()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Ls)throw Ls=!1,t=hu,hu=null,t;return Ds&1&&t.tag!==0&&hi(),a=t.pendingLanes,a&1?t===pu?fa++:(fa=0,pu=t):fa=0,rr(),null}function hi(){if(Fn!==null){var t=qg(Ds),e=It.transition,n=se;try{if(It.transition=null,se=16>t?16:t,Fn===null)var r=!1;else{if(t=Fn,Fn=null,Ds=0,ne&6)throw Error(D(331));var i=ne;for(ne|=4,H=t.current;H!==null;){var a=H,o=a.child;if(H.flags&16){var s=a.deletions;if(s!==null){for(var c=0;c<s.length;c++){var l=s[c];for(H=l;H!==null;){var u=H;switch(u.tag){case 0:case 11:case 15:ha(8,u,a)}var d=u.child;if(d!==null)d.return=u,H=d;else for(;H!==null;){u=H;var h=u.sibling,p=u.return;if(n0(u),u===l){H=null;break}if(h!==null){h.return=p,H=h;break}H=p}}}var b=a.alternate;if(b!==null){var y=b.child;if(y!==null){b.child=null;do{var w=y.sibling;y.sibling=null,y=w}while(y!==null)}}H=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,H=o;else e:for(;H!==null;){if(a=H,a.flags&2048)switch(a.tag){case 0:case 11:case 15:ha(9,a,a.return)}var f=a.sibling;if(f!==null){f.return=a.return,H=f;break e}H=a.return}}var g=t.current;for(H=g;H!==null;){o=H;var m=o.child;if(o.subtreeFlags&2064&&m!==null)m.return=o,H=m;else e:for(o=g;H!==null;){if(s=H,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:hc(9,s)}}catch(C){Te(s,s.return,C)}if(s===o){H=null;break e}var v=s.sibling;if(v!==null){v.return=s.return,H=v;break e}H=s.return}}if(ne=i,rr(),rn&&typeof rn.onPostCommitFiberRoot=="function")try{rn.onPostCommitFiberRoot(ic,t)}catch{}r=!0}return r}finally{se=n,It.transition=e}}return!1}function tf(t,e,n){e=xi(n,e),e=qv(t,e,1),t=$n(t,e,1),e=nt(),t!==null&&(to(t,1,e),ht(t,e))}function Te(t,e,n){if(t.tag===3)tf(t,t,n);else for(;e!==null;){if(e.tag===3){tf(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Wn===null||!Wn.has(r))){t=xi(n,t),t=$v(e,t,1),e=$n(e,t,1),t=nt(),e!==null&&(to(e,1,t),ht(e,t));break}}e=e.return}}function qw(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=nt(),t.pingedLanes|=t.suspendedLanes&n,Ue===t&&(qe&n)===n&&(Le===4||Le===3&&(qe&130023424)===qe&&500>Pe()-Xd?br(t,0):Yd|=n),ht(t,e)}function h0(t,e){e===0&&(t.mode&1?(e=ho,ho<<=1,!(ho&130023424)&&(ho=4194304)):e=1);var n=nt();t=wn(t,e),t!==null&&(to(t,e,n),ht(t,n))}function $w(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),h0(t,n)}function Ww(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(D(314))}r!==null&&r.delete(e),h0(t,n)}var p0;p0=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||ut.current)ct=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return ct=!1,Mw(t,e,n);ct=!!(t.flags&131072)}else ct=!1,ve&&e.flags&1048576&&gv(e,Es,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;$o(t,e),t=e.pendingProps;var i=wi(e,Ze.current);di(e,n),i=Wd(null,e,r,t,i,n);var a=Kd();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,dt(r)?(a=!0,Ts(e)):a=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,zd(e),i.updater=dc,e.stateNode=i,i._reactInternals=e,nu(e,r,t,n),e=au(null,e,r,!0,a,n)):(e.tag=0,ve&&a&&Ld(e),Xe(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch($o(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=Gw(r),t=jt(r,t),i){case 0:e=iu(null,e,r,t,n);break e;case 1:e=$p(null,e,r,t,n);break e;case 11:e=Hp(null,e,r,t,n);break e;case 14:e=qp(null,e,r,jt(r.type,t),n);break e}throw Error(D(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:jt(r,i),iu(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:jt(r,i),$p(t,e,r,i,n);case 3:e:{if(Zv(e),t===null)throw Error(D(387));r=e.pendingProps,a=e.memoizedState,i=a.element,Cv(t,e),Is(e,r,null,n);var o=e.memoizedState;if(r=o.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){i=xi(Error(D(423)),e),e=Wp(t,e,r,n,i);break e}else if(r!==i){i=xi(Error(D(424)),e),e=Wp(t,e,r,n,i);break e}else for(gt=qn(e.stateNode.containerInfo.firstChild),bt=e,ve=!0,Ft=null,n=kv(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ci(),r===i){e=Cn(t,e,n);break e}Xe(t,e,r,n)}e=e.child}return e;case 5:return Sv(e),t===null&&Xl(e),r=e.type,i=e.pendingProps,a=t!==null?t.memoizedProps:null,o=i.children,Gl(r,i)?o=null:a!==null&&Gl(r,a)&&(e.flags|=32),Gv(t,e),Xe(t,e,o,n),e.child;case 6:return t===null&&Xl(e),null;case 13:return Jv(t,e,n);case 4:return Vd(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Si(e,null,r,n):Xe(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:jt(r,i),Hp(t,e,r,i,n);case 7:return Xe(t,e,e.pendingProps,n),e.child;case 8:return Xe(t,e,e.pendingProps.children,n),e.child;case 12:return Xe(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,a=e.memoizedProps,o=i.value,he(Ps,r._currentValue),r._currentValue=o,a!==null)if(Wt(a.value,o)){if(a.children===i.children&&!ut.current){e=Cn(t,e,n);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var s=a.dependencies;if(s!==null){o=a.child;for(var c=s.firstContext;c!==null;){if(c.context===r){if(a.tag===1){c=bn(-1,n&-n),c.tag=2;var l=a.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}a.lanes|=n,c=a.alternate,c!==null&&(c.lanes|=n),eu(a.return,n,e),s.lanes|=n;break}c=c.next}}else if(a.tag===10)o=a.type===e.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(D(341));o.lanes|=n,s=o.alternate,s!==null&&(s.lanes|=n),eu(o,n,e),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===e){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}Xe(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,di(e,n),i=_t(i),r=r(i),e.flags|=1,Xe(t,e,r,n),e.child;case 14:return r=e.type,i=jt(r,e.pendingProps),i=jt(r.type,i),qp(t,e,r,i,n);case 15:return Wv(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:jt(r,i),$o(t,e),e.tag=1,dt(r)?(t=!0,Ts(e)):t=!1,di(e,n),Hv(e,r,i),nu(e,r,i,n),au(null,e,r,!0,t,n);case 19:return Qv(t,e,n);case 22:return Kv(t,e,n)}throw Error(D(156,e.tag))};function f0(t,e){return Bg(t,e)}function Kw(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xt(t,e,n,r){return new Kw(t,e,n,r)}function rh(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Gw(t){if(typeof t=="function")return rh(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Cd)return 11;if(t===Sd)return 14}return 2}function Gn(t,e){var n=t.alternate;return n===null?(n=xt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Go(t,e,n,r,i,a){var o=2;if(r=t,typeof t=="function")rh(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Kr:return yr(n.children,i,a,e);case wd:o=8,i|=8;break;case El:return t=xt(12,n,e,i|2),t.elementType=El,t.lanes=a,t;case Pl:return t=xt(13,n,e,i),t.elementType=Pl,t.lanes=a,t;case Rl:return t=xt(19,n,e,i),t.elementType=Rl,t.lanes=a,t;case Sg:return fc(n,i,a,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case wg:o=10;break e;case Cg:o=9;break e;case Cd:o=11;break e;case Sd:o=14;break e;case _n:o=16,r=null;break e}throw Error(D(130,t==null?t:typeof t,""))}return e=xt(o,n,e,i),e.elementType=t,e.type=r,e.lanes=a,e}function yr(t,e,n,r){return t=xt(7,t,r,e),t.lanes=n,t}function fc(t,e,n,r){return t=xt(22,t,r,e),t.elementType=Sg,t.lanes=n,t.stateNode={isHidden:!1},t}function Xc(t,e,n){return t=xt(6,t,null,e),t.lanes=n,t}function el(t,e,n){return e=xt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Zw(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Lc(0),this.expirationTimes=Lc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Lc(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function ih(t,e,n,r,i,a,o,s,c){return t=new Zw(t,e,n,s,c),e===1?(e=1,a===!0&&(e|=8)):e=0,a=xt(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},zd(a),t}function Jw(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Wr,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function m0(t){if(!t)return Yn;t=t._reactInternals;e:{if(Lr(t)!==t||t.tag!==1)throw Error(D(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(dt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(D(171))}if(t.tag===1){var n=t.type;if(dt(n))return fv(t,n,e)}return e}function g0(t,e,n,r,i,a,o,s,c){return t=ih(n,r,!0,t,i,a,o,s,c),t.context=m0(null),n=t.current,r=nt(),i=Kn(n),a=bn(r,i),a.callback=e??null,$n(n,a,i),t.current.lanes=i,to(t,i,r),ht(t,r),t}function mc(t,e,n,r){var i=e.current,a=nt(),o=Kn(i);return n=m0(n),e.context===null?e.context=n:e.pendingContext=n,e=bn(a,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=$n(i,e,o),t!==null&&($t(t,i,o,a),Vo(t,i,o)),o}function As(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function nf(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function ah(t,e){nf(t,e),(t=t.alternate)&&nf(t,e)}function Qw(){return null}var v0=typeof reportError=="function"?reportError:function(t){console.error(t)};function oh(t){this._internalRoot=t}gc.prototype.render=oh.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(D(409));mc(t,e,null,null)};gc.prototype.unmount=oh.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Pr(function(){mc(null,t,null,null)}),e[kn]=null}};function gc(t){this._internalRoot=t}gc.prototype.unstable_scheduleHydration=function(t){if(t){var e=Kg();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Mn.length&&e!==0&&e<Mn[n].priority;n++);Mn.splice(n,0,t),n===0&&Zg(t)}};function sh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function vc(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function rf(){}function Yw(t,e,n,r,i){if(i){if(typeof r=="function"){var a=r;r=function(){var l=As(o);a.call(l)}}var o=g0(e,r,t,0,null,!1,!1,"",rf);return t._reactRootContainer=o,t[kn]=o.current,Ma(t.nodeType===8?t.parentNode:t),Pr(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var s=r;r=function(){var l=As(c);s.call(l)}}var c=ih(t,0,!1,null,null,!1,!1,"",rf);return t._reactRootContainer=c,t[kn]=c.current,Ma(t.nodeType===8?t.parentNode:t),Pr(function(){mc(e,c,n,r)}),c}function bc(t,e,n,r,i){var a=n._reactRootContainer;if(a){var o=a;if(typeof i=="function"){var s=i;i=function(){var c=As(o);s.call(c)}}mc(e,o,t,i)}else o=Yw(n,e,t,i,r);return As(o)}$g=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=na(e.pendingLanes);n!==0&&(Ed(e,n|1),ht(e,Pe()),!(ne&6)&&(Ei=Pe()+500,rr()))}break;case 13:Pr(function(){var r=wn(t,1);if(r!==null){var i=nt();$t(r,t,1,i)}}),ah(t,1)}};Pd=function(t){if(t.tag===13){var e=wn(t,134217728);if(e!==null){var n=nt();$t(e,t,134217728,n)}ah(t,134217728)}};Wg=function(t){if(t.tag===13){var e=Kn(t),n=wn(t,e);if(n!==null){var r=nt();$t(n,t,e,r)}ah(t,e)}};Kg=function(){return se};Gg=function(t,e){var n=se;try{return se=t,e()}finally{se=n}};Ul=function(t,e,n){switch(e){case"input":if(Ol(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=cc(r);if(!i)throw Error(D(90));xg(r),Ol(r,i)}}}break;case"textarea":Pg(t,n);break;case"select":e=n.value,e!=null&&si(t,!!n.multiple,e,!1)}};Lg=eh;Dg=Pr;var Xw={usingClientEntryPoint:!1,Events:[ro,Qr,cc,Ng,Mg,eh]},$i={findFiberByHostInstance:fr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},eC={bundleType:$i.bundleType,version:$i.version,rendererPackageName:$i.rendererPackageName,rendererConfig:$i.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:xn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Ug(t),t===null?null:t.stateNode},findFiberByHostInstance:$i.findFiberByHostInstance||Qw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var So=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!So.isDisabled&&So.supportsFiber)try{ic=So.inject(eC),rn=So}catch{}}kt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Xw;kt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!sh(e))throw Error(D(200));return Jw(t,e,null,n)};kt.createRoot=function(t,e){if(!sh(t))throw Error(D(299));var n=!1,r="",i=v0;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=ih(t,1,!1,null,null,n,!1,r,i),t[kn]=e.current,Ma(t.nodeType===8?t.parentNode:t),new oh(e)};kt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(D(188)):(t=Object.keys(t).join(","),Error(D(268,t)));return t=Ug(e),t=t===null?null:t.stateNode,t};kt.flushSync=function(t){return Pr(t)};kt.hydrate=function(t,e,n){if(!vc(e))throw Error(D(200));return bc(null,t,e,!0,n)};kt.hydrateRoot=function(t,e,n){if(!sh(t))throw Error(D(405));var r=n!=null&&n.hydratedSources||null,i=!1,a="",o=v0;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=g0(e,null,t,1,n??null,i,!1,a,o),t[kn]=e.current,Ma(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new gc(e)};kt.render=function(t,e,n){if(!vc(e))throw Error(D(200));return bc(null,t,e,!1,n)};kt.unmountComponentAtNode=function(t){if(!vc(t))throw Error(D(40));return t._reactRootContainer?(Pr(function(){bc(null,null,t,!1,function(){t._reactRootContainer=null,t[kn]=null})}),!0):!1};kt.unstable_batchedUpdates=eh;kt.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!vc(n))throw Error(D(200));if(t==null||t._reactInternals===void 0)throw Error(D(38));return bc(t,e,n,!1,r)};kt.version="18.3.1-next-f1338f8080-20240426";function b0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(b0)}catch(t){console.error(t)}}b0(),vg.exports=kt;var tC=vg.exports,y0,af=tC;y0=af.createRoot,af.hydrateRoot;var k0=function(t,e,n,r){var i;e[0]=0;for(var a=1;a<e.length;a++){var o=e[a++],s=e[a]?(e[0]|=o?1:2,n[e[a++]]):e[++a];o===3?r[0]=s:o===4?r[1]=Object.assign(r[1]||{},s):o===5?(r[1]=r[1]||{})[e[++a]]=s:o===6?r[1][e[++a]]+=s+"":o?(i=t.apply(s,k0(t,s,n,["",null])),r.push(i),s[0]?e[0]|=2:(e[a-2]=0,e[a]=i)):r.push(s)}return r},of=new Map;function nC(t){var e=of.get(this);return e||(e=new Map,of.set(this,e)),(e=k0(this,e.get(t)||(e.set(t,e=function(n){for(var r,i,a=1,o="",s="",c=[0],l=function(h){a===1&&(h||(o=o.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?c.push(0,h,o):a===3&&(h||o)?(c.push(3,h,o),a=2):a===2&&o==="..."&&h?c.push(4,h,0):a===2&&o&&!h?c.push(5,0,!0,o):a>=5&&((o||!h&&a===5)&&(c.push(a,0,o,i),a=6),h&&(c.push(a,h,0,i),a=6)),o=""},u=0;u<n.length;u++){u&&(a===1&&l(),l(u));for(var d=0;d<n[u].length;d++)r=n[u][d],a===1?r==="<"?(l(),c=[c],a=3):o+=r:a===4?o==="--"&&r===">"?(a=1,o=""):o=r+o[0]:s?r===s?s="":o+=r:r==='"'||r==="'"?s=r:r===">"?(l(),a=1):a&&(r==="="?(a=5,i=o,o=""):r==="/"&&(a<5||n[u][d+1]===">")?(l(),a===3&&(c=c[0]),a=c,(c=c[0]).push(2,0,a),a=0):r===" "||r==="	"||r===`
`||r==="\r"?(l(),a=2):o+=r),a===3&&o==="!--"&&(a=4,c=c[0])}return l(),c}(t)),e),arguments,[])).length>1?e:e[0]}function $r(t){return t!=null&&typeof t=="object"&&t["@@functional/placeholder"]===!0}function pi(t){return function e(n){return arguments.length===0||$r(n)?e:t.apply(this,arguments)}}function ch(t){return function e(n,r){switch(arguments.length){case 0:return e;case 1:return $r(n)?e:pi(function(i){return t(n,i)});default:return $r(n)&&$r(r)?e:$r(n)?pi(function(i){return t(i,r)}):$r(r)?pi(function(i){return t(n,i)}):t(n,r)}}}const rC=Array.isArray||function(t){return t!=null&&t.length>=0&&Object.prototype.toString.call(t)==="[object Array]"};function iC(t){return t!=null&&typeof t["@@transducer/step"]=="function"}function w0(t,e,n){return function(){if(arguments.length===0)return n();var r=arguments[arguments.length-1];if(!rC(r)){for(var i=0;i<t.length;){if(typeof r[t[i]]=="function")return r[t[i]].apply(r,Array.prototype.slice.call(arguments,0,-1));i+=1}if(iC(r)){var a=e.apply(null,Array.prototype.slice.call(arguments,0,-1));return a(r)}}return n.apply(this,arguments)}}const gu={init:function(){return this.xf["@@transducer/init"]()},result:function(t){return this.xf["@@transducer/result"](t)}};function sf(t){for(var e=[],n;!(n=t.next()).done;)e.push(n.value);return e}function cf(t,e,n){for(var r=0,i=n.length;r<i;){if(t(e,n[r]))return!0;r+=1}return!1}function aC(t){var e=String(t).match(/^function (\w*)/);return e==null?"":e[1]}function Us(t,e){return Object.prototype.hasOwnProperty.call(e,t)}function oC(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}const tl=typeof Object.is=="function"?Object.is:oC;var lf=Object.prototype.toString,sC=function(){return lf.call(arguments)==="[object Arguments]"?function(t){return lf.call(t)==="[object Arguments]"}:function(t){return Us("callee",t)}}(),cC=!{toString:null}.propertyIsEnumerable("toString"),uf=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],df=function(){return arguments.propertyIsEnumerable("length")}(),lC=function(t,e){for(var n=0;n<t.length;){if(t[n]===e)return!0;n+=1}return!1},hf=pi(typeof Object.keys=="function"&&!df?function(t){return Object(t)!==t?[]:Object.keys(t)}:function(t){if(Object(t)!==t)return[];var e,n,r=[],i=df&&sC(t);for(e in t)Us(e,t)&&(!i||e!=="length")&&(r[r.length]=e);if(cC)for(n=uf.length-1;n>=0;)e=uf[n],Us(e,t)&&!lC(r,e)&&(r[r.length]=e),n-=1;return r}),pf=pi(function(t){return t===null?"Null":t===void 0?"Undefined":Object.prototype.toString.call(t).slice(8,-1)});function ff(t,e,n,r){var i=sf(t),a=sf(e);function o(s,c){return lh(s,c,n.slice(),r.slice())}return!cf(function(s,c){return!cf(o,c,s)},a,i)}function lh(t,e,n,r){if(tl(t,e))return!0;var i=pf(t);if(i!==pf(e))return!1;if(typeof t["fantasy-land/equals"]=="function"||typeof e["fantasy-land/equals"]=="function")return typeof t["fantasy-land/equals"]=="function"&&t["fantasy-land/equals"](e)&&typeof e["fantasy-land/equals"]=="function"&&e["fantasy-land/equals"](t);if(typeof t.equals=="function"||typeof e.equals=="function")return typeof t.equals=="function"&&t.equals(e)&&typeof e.equals=="function"&&e.equals(t);switch(i){case"Arguments":case"Array":case"Object":if(typeof t.constructor=="function"&&aC(t.constructor)==="Promise")return t===e;break;case"Boolean":case"Number":case"String":if(!(typeof t==typeof e&&tl(t.valueOf(),e.valueOf())))return!1;break;case"Date":if(!tl(t.valueOf(),e.valueOf()))return!1;break;case"Error":return t.name===e.name&&t.message===e.message;case"RegExp":if(!(t.source===e.source&&t.global===e.global&&t.ignoreCase===e.ignoreCase&&t.multiline===e.multiline&&t.sticky===e.sticky&&t.unicode===e.unicode))return!1;break}for(var a=n.length-1;a>=0;){if(n[a]===t)return r[a]===e;a-=1}switch(i){case"Map":return t.size!==e.size?!1:ff(t.entries(),e.entries(),n.concat([t]),r.concat([e]));case"Set":return t.size!==e.size?!1:ff(t.values(),e.values(),n.concat([t]),r.concat([e]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var o=hf(t);if(o.length!==hf(e).length)return!1;var s=n.concat([t]),c=r.concat([e]);for(a=o.length-1;a>=0;){var l=o[a];if(!(Us(l,e)&&lh(e[l],t[l],s,c)))return!1;a-=1}return!0}var uh=ch(function(t,e){return lh(t,e,[],[])});function uC(t,e,n){var r,i;if(typeof t.indexOf=="function")switch(typeof e){case"number":if(e===0){for(r=1/e;n<t.length;){if(i=t[n],i===0&&1/i===r)return n;n+=1}return-1}else if(e!==e){for(;n<t.length;){if(i=t[n],typeof i=="number"&&i!==i)return n;n+=1}return-1}return t.indexOf(e,n);case"string":case"boolean":case"function":case"undefined":return t.indexOf(e,n);case"object":if(e===null)return t.indexOf(e,n)}for(;n<t.length;){if(uh(t[n],e))return n;n+=1}return-1}function mf(t,e){return uC(e,t,0)>=0}function dC(t){return t}var hC=pi(dC),C0=function(){function t(){this._nativeSet=typeof Set=="function"?new Set:null,this._items={}}return t.prototype.add=function(e){return!gf(e,!0,this)},t.prototype.has=function(e){return gf(e,!1,this)},t}();function gf(t,e,n){var r=typeof t,i,a;switch(r){case"string":case"number":return t===0&&1/t===-1/0?n._items["-0"]?!0:(e&&(n._items["-0"]=!0),!1):n._nativeSet!==null?e?(i=n._nativeSet.size,n._nativeSet.add(t),a=n._nativeSet.size,a===i):n._nativeSet.has(t):r in n._items?t in n._items[r]?!0:(e&&(n._items[r][t]=!0),!1):(e&&(n._items[r]={},n._items[r][t]=!0),!1);case"boolean":if(r in n._items){var o=t?1:0;return n._items[r][o]?!0:(e&&(n._items[r][o]=!0),!1)}else return e&&(n._items[r]=t?[!1,!0]:[!0,!1]),!1;case"function":return n._nativeSet!==null?e?(i=n._nativeSet.size,n._nativeSet.add(t),a=n._nativeSet.size,a===i):n._nativeSet.has(t):r in n._items?mf(t,n._items[r])?!0:(e&&n._items[r].push(t),!1):(e&&(n._items[r]=[t]),!1);case"undefined":return n._items[r]?!0:(e&&(n._items[r]=!0),!1);case"object":if(t===null)return n._items.null?!0:(e&&(n._items.null=!0),!1);default:return r=Object.prototype.toString.call(t),r in n._items?mf(t,n._items[r])?!0:(e&&n._items[r].push(t),!1):(e&&(n._items[r]=[t]),!1)}}var pC=function(){function t(e,n){this.xf=n,this.f=e,this.idx=-1,this.lastIdx=-1}return t.prototype["@@transducer/init"]=gu.init,t.prototype["@@transducer/result"]=function(e){return this.xf["@@transducer/result"](this.xf["@@transducer/step"](e,this.lastIdx))},t.prototype["@@transducer/step"]=function(e,n){return this.idx+=1,this.f(n)&&(this.lastIdx=this.idx),e},t}();function fC(t){return function(e){return new pC(t,e)}}var vf=ch(w0([],fC,function(t,e){for(var n=e.length-1;n>=0;){if(t(e[n]))return n;n-=1}return-1})),mC=function(){function t(e,n){this.xf=n,this.f=e,this.set=new C0}return t.prototype["@@transducer/init"]=gu.init,t.prototype["@@transducer/result"]=gu.result,t.prototype["@@transducer/step"]=function(e,n){return this.set.add(this.f(n))?this.xf["@@transducer/step"](e,n):e},t}();function gC(t){return function(e){return new mC(t,e)}}var vC=ch(w0([],gC,function(t,e){for(var n=new C0,r=[],i=0,a,o;i<e.length;)o=e[i],a=t(o),n.add(a)&&r.push(o),i+=1;return r})),bC=vC(hC);const yC="1.1.8-alpha.1",kC={version:yC};var ze=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},Ye={searchParams:"URLSearchParams"in ze,iterable:"Symbol"in ze&&"iterator"in Symbol,blob:"FileReader"in ze&&"Blob"in ze&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in ze,arrayBuffer:"ArrayBuffer"in ze};function wC(t){return t&&DataView.prototype.isPrototypeOf(t)}if(Ye.arrayBuffer)var CC=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],SC=ArrayBuffer.isView||function(t){return t&&CC.indexOf(Object.prototype.toString.call(t))>-1};function Li(t){if(typeof t!="string"&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||t==="")throw new TypeError('Invalid character in header field name: "'+t+'"');return t.toLowerCase()}function dh(t){return typeof t!="string"&&(t=String(t)),t}function hh(t){var e={next:function(){var n=t.shift();return{done:n===void 0,value:n}}};return Ye.iterable&&(e[Symbol.iterator]=function(){return e}),e}function De(t){this.map={},t instanceof De?t.forEach(function(e,n){this.append(n,e)},this):Array.isArray(t)?t.forEach(function(e){if(e.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}De.prototype.append=function(t,e){t=Li(t),e=dh(e);var n=this.map[t];this.map[t]=n?n+", "+e:e};De.prototype.delete=function(t){delete this.map[Li(t)]};De.prototype.get=function(t){return t=Li(t),this.has(t)?this.map[t]:null};De.prototype.has=function(t){return this.map.hasOwnProperty(Li(t))};De.prototype.set=function(t,e){this.map[Li(t)]=dh(e)};De.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)};De.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),hh(t)};De.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),hh(t)};De.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),hh(t)};Ye.iterable&&(De.prototype[Symbol.iterator]=De.prototype.entries);function nl(t){if(!t._noBody){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}}function S0(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function TC(t){var e=new FileReader,n=S0(e);return e.readAsArrayBuffer(t),n}function xC(t){var e=new FileReader,n=S0(e),r=/charset=([A-Za-z0-9_-]+)/.exec(t.type),i=r?r[1]:"utf-8";return e.readAsText(t,i),n}function EC(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}function bf(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function T0(){return this.bodyUsed=!1,this._initBody=function(t){this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?typeof t=="string"?this._bodyText=t:Ye.blob&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:Ye.formData&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:Ye.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():Ye.arrayBuffer&&Ye.blob&&wC(t)?(this._bodyArrayBuffer=bf(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):Ye.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(t)||SC(t))?this._bodyArrayBuffer=bf(t):this._bodyText=t=Object.prototype.toString.call(t):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof t=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Ye.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},Ye.blob&&(this.blob=function(){var t=nl(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var t=nl(this);return t||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(Ye.blob)return this.blob().then(TC);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var t=nl(this);if(t)return t;if(this._bodyBlob)return xC(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(EC(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},Ye.formData&&(this.formData=function(){return this.text().then(IC)}),this.json=function(){return this.text().then(JSON.parse)},this}var PC=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function RC(t){var e=t.toUpperCase();return PC.indexOf(e)>-1?e:t}function Rr(t,e){if(!(this instanceof Rr))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var n=e.body;if(t instanceof Rr){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new De(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,!n&&t._bodyInit!=null&&(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new De(e.headers)),this.method=RC(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal||function(){if("AbortController"in ze){var a=new AbortController;return a.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&n)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(n),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var r=/([?&])_=[^&]*/;if(r.test(this.url))this.url=this.url.replace(r,"$1_="+new Date().getTime());else{var i=/\?/;this.url+=(i.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}Rr.prototype.clone=function(){return new Rr(this,{body:this._bodyInit})};function IC(t){var e=new FormData;return t.trim().split("&").forEach(function(n){if(n){var r=n.split("="),i=r.shift().replace(/\+/g," "),a=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(i),decodeURIComponent(a))}}),e}function _C(t){var e=new De,n=t.replace(/\r?\n[\t ]+/g," ");return n.split("\r").map(function(r){return r.indexOf(`
`)===0?r.substr(1,r.length):r}).forEach(function(r){var i=r.split(":"),a=i.shift().trim();if(a){var o=i.join(":").trim();try{e.append(a,o)}catch(s){console.warn("Response "+s.message)}}}),e}T0.call(Rr.prototype);function on(t,e){if(!(this instanceof on))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new De(e.headers),this.url=e.url||"",this._initBody(t)}T0.call(on.prototype);on.prototype.clone=function(){return new on(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new De(this.headers),url:this.url})};on.error=function(){var t=new on(null,{status:200,statusText:""});return t.ok=!1,t.status=0,t.type="error",t};var OC=[301,302,303,307,308];on.redirect=function(t,e){if(OC.indexOf(e)===-1)throw new RangeError("Invalid status code");return new on(null,{status:e,headers:{location:t}})};var pr=ze.DOMException;try{new pr}catch{pr=function(t,e){this.message=t,this.name=e;var n=Error(t);this.stack=n.stack},pr.prototype=Object.create(Error.prototype),pr.prototype.constructor=pr}function x0(t,e){return new Promise(function(n,r){var i=new Rr(t,e);if(i.signal&&i.signal.aborted)return r(new pr("Aborted","AbortError"));var a=new XMLHttpRequest;function o(){a.abort()}a.onload=function(){var l={statusText:a.statusText,headers:_C(a.getAllResponseHeaders()||"")};i.url.indexOf("file://")===0&&(a.status<200||a.status>599)?l.status=200:l.status=a.status,l.url="responseURL"in a?a.responseURL:l.headers.get("X-Request-URL");var u="response"in a?a.response:a.responseText;setTimeout(function(){n(new on(u,l))},0)},a.onerror=function(){setTimeout(function(){r(new TypeError("Network request failed"))},0)},a.ontimeout=function(){setTimeout(function(){r(new TypeError("Network request timed out"))},0)},a.onabort=function(){setTimeout(function(){r(new pr("Aborted","AbortError"))},0)};function s(l){try{return l===""&&ze.location.href?ze.location.href:l}catch{return l}}if(a.open(i.method,s(i.url),!0),i.credentials==="include"?a.withCredentials=!0:i.credentials==="omit"&&(a.withCredentials=!1),"responseType"in a&&(Ye.blob?a.responseType="blob":Ye.arrayBuffer&&(a.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof De||ze.Headers&&e.headers instanceof ze.Headers)){var c=[];Object.getOwnPropertyNames(e.headers).forEach(function(l){c.push(Li(l)),a.setRequestHeader(l,dh(e.headers[l]))}),i.headers.forEach(function(l,u){c.indexOf(u)===-1&&a.setRequestHeader(u,l)})}else i.headers.forEach(function(l,u){a.setRequestHeader(u,l)});i.signal&&(i.signal.addEventListener("abort",o),a.onreadystatechange=function(){a.readyState===4&&i.signal.removeEventListener("abort",o)}),a.send(typeof i._bodyInit>"u"?null:i._bodyInit)})}x0.polyfill=!0;ze.fetch||(ze.fetch=x0,ze.Headers=De,ze.Request=Rr,ze.Response=on);var NC=self.fetch.bind(self);const rl=ag(NC);function ye(t){return t!=null&&typeof t=="object"&&t["@@functional/placeholder"]===!0}function vr(t){return function e(n){return arguments.length===0||ye(n)?e:t.apply(this,arguments)}}function Fr(t){return function e(n,r){switch(arguments.length){case 0:return e;case 1:return ye(n)?e:vr(function(i){return t(n,i)});default:return ye(n)&&ye(r)?e:ye(n)?vr(function(i){return t(i,r)}):ye(r)?vr(function(i){return t(n,i)}):t(n,r)}}}function MC(t,e){t=t||[],e=e||[];var n,r=t.length,i=e.length,a=[];for(n=0;n<r;)a[a.length]=t[n],n+=1;for(n=0;n<i;)a[a.length]=e[n],n+=1;return a}function LC(t){return function e(n,r,i){switch(arguments.length){case 0:return e;case 1:return ye(n)?e:Fr(function(a,o){return t(n,a,o)});case 2:return ye(n)&&ye(r)?e:ye(n)?Fr(function(a,o){return t(a,r,o)}):ye(r)?Fr(function(a,o){return t(n,a,o)}):vr(function(a){return t(n,r,a)});default:return ye(n)&&ye(r)&&ye(i)?e:ye(n)&&ye(r)?Fr(function(a,o){return t(a,o,i)}):ye(n)&&ye(i)?Fr(function(a,o){return t(a,r,o)}):ye(r)&&ye(i)?Fr(function(a,o){return t(n,a,o)}):ye(n)?vr(function(a){return t(a,r,i)}):ye(r)?vr(function(a){return t(n,a,i)}):ye(i)?vr(function(a){return t(n,r,a)}):t(n,r,i)}}}var yf=LC(function(t,e,n){var r=n.length;if(t>=r||t<-r)return n;var i=(r+t)%r,a=MC(n);return a[i]=e(n[i]),a});/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var vu=function(t,e){return vu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},vu(t,e)};function E0(t,e){vu(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function DC(t){var e=typeof Symbol=="function"&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function jC(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,a=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(s){o={error:s}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a}function AC(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(jC(arguments[e]));return t}var P0=function(){function t(e,n){this.target=n,this.type=e}return t}(),UC=function(t){E0(e,t);function e(n,r){var i=t.call(this,"error",r)||this;return i.message=n.message,i.error=n,i}return e}(P0),FC=function(t){E0(e,t);function e(n,r,i){n===void 0&&(n=1e3),r===void 0&&(r="");var a=t.call(this,"close",i)||this;return a.wasClean=!0,a.code=n,a.reason=r,a}return e}(P0);/*!
 * Reconnecting WebSocket
 * by Pedro Ladaria <pedro.ladaria@gmail.com>
 * https://github.com/pladaria/reconnecting-websocket
 * License MIT
 */var BC=function(){if(typeof WebSocket<"u")return WebSocket},zC=function(t){return typeof t<"u"&&!!t&&t.CLOSING===2},cr={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0},il=function(){function t(e,n,r){var i=this;r===void 0&&(r={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(a){i._debug("open event");var o=i._options.minUptime,s=o===void 0?cr.minUptime:o;clearTimeout(i._connectTimeout),i._uptimeTimeout=setTimeout(function(){return i._acceptOpen()},s),i._ws.binaryType=i._binaryType,i._messageQueue.forEach(function(c){return i._ws.send(c)}),i._messageQueue=[],i.onopen&&i.onopen(a),i._listeners.open.forEach(function(c){return i._callEventListener(a,c)})},this._handleMessage=function(a){i._debug("message event"),i.onmessage&&i.onmessage(a),i._listeners.message.forEach(function(o){return i._callEventListener(a,o)})},this._handleError=function(a){i._debug("error event",a.message),i._disconnect(void 0,a.message==="TIMEOUT"?"timeout":void 0),i.onerror&&i.onerror(a),i._debug("exec error listeners"),i._listeners.error.forEach(function(o){return i._callEventListener(a,o)}),i._connect()},this._handleClose=function(a){i._debug("close event"),i._clearTimeouts(),i._shouldReconnect&&i._connect(),i.onclose&&i.onclose(a),i._listeners.close.forEach(function(o){return i._callEventListener(a,o)})},this._url=e,this._protocols=n,this._options=r,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(t,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CONNECTING",{get:function(){return t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"OPEN",{get:function(){return t.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSING",{get:function(){return t.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSED",{get:function(){return t.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferedAmount",{get:function(){var e=this._messageQueue.reduce(function(n,r){return typeof r=="string"?n+=r.length:r instanceof Blob?n+=r.size:n+=r.byteLength,n},0);return e+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?t.CLOSED:t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),t.prototype.close=function(e,n){if(e===void 0&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(e,n)},t.prototype.reconnect=function(e,n){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(e,n),this._connect())},t.prototype.send=function(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{var n=this._options.maxEnqueuedMessages,r=n===void 0?cr.maxEnqueuedMessages:n;this._messageQueue.length<r&&(this._debug("enqueue",e),this._messageQueue.push(e))}},t.prototype.addEventListener=function(e,n){this._listeners[e]&&this._listeners[e].push(n)},t.prototype.dispatchEvent=function(e){var n,r,i=this._listeners[e.type];if(i)try{for(var a=DC(i),o=a.next();!o.done;o=a.next()){var s=o.value;this._callEventListener(e,s)}}catch(c){n={error:c}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return!0},t.prototype.removeEventListener=function(e,n){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(function(r){return r!==n}))},t.prototype._debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._options.debug&&console.log.apply(console,AC(["RWS>"],e))},t.prototype._getNextDelay=function(){var e=this._options,n=e.reconnectionDelayGrowFactor,r=n===void 0?cr.reconnectionDelayGrowFactor:n,i=e.minReconnectionDelay,a=i===void 0?cr.minReconnectionDelay:i,o=e.maxReconnectionDelay,s=o===void 0?cr.maxReconnectionDelay:o,c=0;return this._retryCount>0&&(c=a*Math.pow(r,this._retryCount-1),c>s&&(c=s)),this._debug("next delay",c),c},t.prototype._wait=function(){var e=this;return new Promise(function(n){setTimeout(n,e._getNextDelay())})},t.prototype._getNextUrl=function(e){if(typeof e=="string")return Promise.resolve(e);if(typeof e=="function"){var n=e();if(typeof n=="string")return Promise.resolve(n);if(n.then)return n}throw Error("Invalid URL")},t.prototype._connect=function(){var e=this;if(!(this._connectLock||!this._shouldReconnect)){this._connectLock=!0;var n=this._options,r=n.maxRetries,i=r===void 0?cr.maxRetries:r,a=n.connectionTimeout,o=a===void 0?cr.connectionTimeout:a,s=n.WebSocket,c=s===void 0?BC():s;if(this._retryCount>=i){this._debug("max retries reached",this._retryCount,">=",i);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!zC(c))throw Error("No valid WebSocket class provided");this._wait().then(function(){return e._getNextUrl(e._url)}).then(function(l){e._closeCalled||(e._debug("connect",{url:l,protocols:e._protocols}),e._ws=e._protocols?new c(l,e._protocols):new c(l),e._ws.binaryType=e._binaryType,e._connectLock=!1,e._addListeners(),e._connectTimeout=setTimeout(function(){return e._handleTimeout()},o))})}},t.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new UC(Error("TIMEOUT"),this))},t.prototype._disconnect=function(e,n){if(e===void 0&&(e=1e3),this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(e,n),this._handleClose(new FC(e,n,this))}catch{}}},t.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},t.prototype._callEventListener=function(e,n){"handleEvent"in n?n.handleEvent(e):n(e)},t.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},t.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},t.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},t}();let To;const VC=new Uint8Array(16);function HC(){if(!To&&(To=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!To))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return To(VC)}const Fe=[];for(let t=0;t<256;++t)Fe.push((t+256).toString(16).slice(1));function qC(t,e=0){return Fe[t[e+0]]+Fe[t[e+1]]+Fe[t[e+2]]+Fe[t[e+3]]+"-"+Fe[t[e+4]]+Fe[t[e+5]]+"-"+Fe[t[e+6]]+Fe[t[e+7]]+"-"+Fe[t[e+8]]+Fe[t[e+9]]+"-"+Fe[t[e+10]]+Fe[t[e+11]]+Fe[t[e+12]]+Fe[t[e+13]]+Fe[t[e+14]]+Fe[t[e+15]]}const $C=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),kf={randomUUID:$C};function wf(t,e,n){if(kf.randomUUID&&!t)return kf.randomUUID();t=t||{};const r=t.random||(t.rng||HC)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,qC(r)}var WC="@nlxai/core",KC="1.1.8-alpha.0",GC="Low-level SDK for building NLX experiences",ZC="module",JC="lib/index.cjs",QC="lib/index.esm.js",YC="lib/index.umd.js",XC="lib/index.d.ts",eS={".":{types:"./lib/index.d.ts",import:"./lib/index.esm.js",require:"./lib/index.cjs"}},tS={build:"rm -rf lib && rollup -c --configPlugin typescript --configImportAttributesKey with",docs:"rm -rf docs/ && typedoc && concat-md --decrease-title-levels --dir-name-as-title docs/ > docs/index.md","lint:check":"eslint src/ --ext .ts,.tsx,.js,.jsx --max-warnings 0",lint:"eslint src/ --ext .ts,.tsx,.js,.jsx --fix",prepublish:"npm run build","preview-docs":"npm run docs && comrak --unsafe --gfm -o docs/index.html docs/index.md && open docs/index.html","publish-docs":"npm run docs && mv docs/index.md ../website/src/content/headless-api-reference.md",test:"typedoc --emit none",tsc:"tsc"},nS="Peter Szerzo <peter@nlx.ai>",rS="MIT",iS={"@types/isomorphic-fetch":"^0.0.36","@types/node":"^22.10.1","@types/ramda":"0.29.1","@types/uuid":"^9.0.7","concat-md":"^0.5.1","eslint-config-nlx":"*",prettier:"^3.1.0","rollup-config-nlx":"*",typedoc:"^0.25.13","typedoc-plugin-markdown":"^3.17.1",typescript:"^5.5.4"},aS={"isomorphic-fetch":"^3.0.0",ramda:"^0.29.1","reconnecting-websocket":"^4.4.0",uuid:"^9.0.1"},oS={access:"public"},sS="c701b502f0398e9956a8b35b711a45f264fa7603",al={name:WC,version:KC,description:GC,type:ZC,main:JC,module:QC,browser:YC,types:XC,exports:eS,scripts:tS,author:nS,license:rS,devDependencies:iS,dependencies:aS,publishConfig:oS,gitHead:sS};const Br=console;var et;(function(t){t.Application="bot",t.User="user",t.Failure="failure"})(et||(et={}));const Cf="NLX.Welcome",cS="We encountered an issue. Please try again soon.",R0=t=>Array.isArray(t)?t:Object.entries(t).map(([e,n])=>({slotId:e,value:n})),Sf=t=>({...t,intentId:t.flowId??t.intentId,slots:t.slots!=null?R0(t.slots):t.slots}),Tf=t=>t.responses,ol=t=>{try{return JSON.parse(t)}catch{return null}},I0=t=>{var e;return((e=t.match(/(bots\.dev\.studio\.nlx\.ai|bots\.studio\.nlx\.ai|apps\.nlx\.ai|dev\.apps\.nlx\.ai)/g))==null?void 0:e[0])??"apps.nlx.ai"},lS=t=>{if(Nn(t))return t;const e=I0(t),n=new URL(t).pathname.split("/"),r=n[2],i=n[3];return`wss://us-east-1-ws.${e}?deploymentKey=${r}&channelKey=${i}`},xf=t=>{if(!Nn(t))return t;const e=I0(t),n=new URL(t),r=new URLSearchParams(n.search),i=r.get("channelKey"),a=r.get("deploymentKey");return`https://${e}/c/${a}/${i}`},Nn=t=>t.indexOf("wss://")===0,uS=t=>(t.applicationUrl??"").length>0;function dS(t){let e,n=[],r=null,i,a=[],o=null;const s=t.applicationUrl??"";/[-|_][a-z]{2,}[-|_][A-Z]{2,}$/.test(s)&&Br.warn("Since v1.0.0, the language code is no longer added at the end of the application URL. Please remove the modifier (e.g. '-en-US') from the URL, and specify it in the `languageCode` parameter instead.");const c={voicePlusCommand:[]},l=t.conversationId??wf();let u={responses:t.responses??[],languageCode:t.languageCode,userId:t.userId,conversationId:l};const d=()=>{var O;return`${xf(s)}${((O=t.experimental)==null?void 0:O.completeApplicationUrl)===!0?"":`-${u.languageCode}`}`},h=(O,V)=>{u={...u,...O},g.forEach($=>{$(Tf(u),V)})},p=()=>{const O={type:et.Failure,receivedAt:new Date().getTime(),payload:{text:t.failureMessage??cS}};h({responses:[...u.responses,O]},O)},b=O=>{if((O==null?void 0:O.messages.length)>0){const V={type:et.Application,receivedAt:new Date().getTime(),payload:{...O,messages:O.messages.map($=>({nodeId:$.nodeId,messageId:$.messageId,text:$.text,choices:$.choices??[]}))}};h({responses:[...u.responses,V]},V),O.metadata.hasPendingDataRequest&&(N({poll:!0}),setTimeout(()=>{f({request:{structured:{poll:!0}}})},1500))}else Br.warn("Invalid message structure, expected object with field 'messages'."),p()};let y;const w=O=>{(i==null?void 0:i.readyState)===1?i.send(JSON.stringify(O)):a=[...a,O]},f=async O=>{var V;if(y!=null){y(O,J=>{const R={type:et.Application,receivedAt:new Date().getTime(),payload:J};h({responses:[...u.responses,R]},R)});return}const $={userId:u.userId,conversationId:u.conversationId,...O,languageCode:u.languageCode,channelType:(V=t.experimental)==null?void 0:V.channelType,environment:t.environment};if(Nn(s))(e==null?void 0:e.readyState)===1?e.send(JSON.stringify($)):n=[...n,$];else try{const J=await rl(d(),{method:"POST",headers:{...t.headers??{},Accept:"application/json","Content-Type":"application/json","nlx-sdk-version":al.version},body:JSON.stringify($)});if(J.status>=400)throw new Error(`Responded with ${J.status}`);const R=await J.json();b(R)}catch(J){Br.warn(J),p()}};let g=[];const m=async()=>{(e==null?void 0:e.readyState)===1&&n[0]!=null&&(await f(n[0]),n=n.slice(1))},v=()=>{(i==null?void 0:i.readyState)===1&&a[0]!=null&&(w(a[0]),a=a.slice(1))},C=()=>{var O;E();const V=new URL(s);((O=t.experimental)==null?void 0:O.completeApplicationUrl)!==!0&&(V.searchParams.set("languageCode",u.languageCode),V.searchParams.set("channelKey",`${V.searchParams.get("channelKey")??""}-${u.languageCode}`)),V.searchParams.set("conversationId",u.conversationId),e=new il(V.href),r=setInterval(()=>{m()},500),e.onmessage=function($){typeof($==null?void 0:$.data)=="string"&&b(ol($.data))},V.searchParams.set("voice-plus","true"),i=new il(V.href),o=setInterval(()=>{v()},500),i.onmessage=$=>{if(typeof($==null?void 0:$.data)=="string"){const J=ol($.data);J!=null&&c.voicePlusCommand.forEach(R=>{R(J)})}}},T=()=>{var O;if(x(),t.bidirectional!==!0)return;const V=new URL(lS(s));((O=t.experimental)==null?void 0:O.completeApplicationUrl)!==!0&&(V.searchParams.set("languageCode",u.languageCode),V.searchParams.set("channelKey",`${V.searchParams.get("channelKey")??""}-${u.languageCode}`)),V.searchParams.set("conversationId",u.conversationId),V.searchParams.set("type","voice-plus");const $=t.headers["nlx-api-key"];!Nn(s)&&$!=null&&V.searchParams.set("apiKey",$),i=new il(V.href),o=setInterval(()=>{v()},500),i.onmessage=J=>{if(typeof(J==null?void 0:J.data)=="string"){const R=ol(J.data);R!=null&&c.voicePlusCommand.forEach(F=>{F(R)})}}},E=()=>{r!=null&&clearInterval(r),e!=null&&(e.onmessage=null,e.close(),e=void 0)},x=()=>{o!=null&&clearInterval(o),i!=null&&(i.onmessage=null,i.close(),i=void 0)};Nn(s)&&C(),T();const N=(O,V)=>{const $={type:et.User,receivedAt:new Date().getTime(),payload:{type:"structured",...Sf(O),context:V}};h({responses:[...u.responses,$]},$)},M=(O,V)=>{N({intentId:O},V),f({context:V,request:{structured:{intentId:O}}})},A=(O,V)=>{const $={type:et.User,receivedAt:new Date().getTime(),payload:{type:"text",text:O,context:V}};h({responses:[...u.responses,$]},$),f({context:V,request:{unstructured:{text:O}}})},W=(O,V,$)=>{let J=[...u.responses];const R={type:et.User,receivedAt:new Date().getTime(),payload:{type:"choice",choiceId:O}},F=($==null?void 0:$.responseIndex)??-1,q=($==null?void 0:$.messageIndex)??-1;F>-1&&q>-1&&(J=yf(F,Z=>Z.type===et.Application?{...Z,payload:{...Z.payload,messages:yf(q,ue=>({...ue,selectedChoiceId:O}),Z.payload.messages)}}:Z,J)),J=[...J,R],h({responses:J},R),f({context:V,request:{structured:{nodeId:$==null?void 0:$.nodeId,intentId:$==null?void 0:$.intentId,choiceId:O}}})},Q=O=>{g=g.filter(V=>V!==O)};return{sendText:A,sendContext:async O=>{const V=await rl(`${d()}/context`,{method:"POST",headers:{...t.headers??{},Accept:"application/json","Content-Type":"application/json","nlx-conversation-id":u.conversationId,"nlx-sdk-version":al.version},body:JSON.stringify({languageCode:u.languageCode,conversationId:u.conversationId,userId:u.userId,context:O})});if(V.status>=400)throw new Error(`Responded with ${V.status}`)},sendStructured:(O,V)=>{N(O,V),f({context:V,request:{structured:Sf(O)}})},sendSlots:(O,V)=>{N({slots:O},V),f({context:V,request:{structured:{slots:R0(O)}}})},sendFlow:M,sendIntent:(O,V)=>{Br.warn("Calling `sendIntent` is deprecated and will be removed in a future version of the SDK. Use `sendFlow` instead."),M(O,V)},sendWelcomeFlow:O=>{M(Cf,O)},sendWelcomeIntent:O=>{Br.warn("Calling `sendWelcomeIntent` is deprecated and will be removed in a future version of the SDK. Use `sendWelcomeFlow` instead."),M(Cf,O)},sendChoice:W,currentConversationId:()=>u.conversationId,setLanguageCode:O=>{if(O===u.languageCode){Br.warn("Attempted to set language code to the one already active.");return}Nn(s)&&C(),T(),h({languageCode:O})},currentLanguageCode:()=>u.languageCode,getVoiceCredentials:async O=>{const V=xf(s),$=await rl(`${V}-${u.languageCode}/requestToken`,{method:"POST",headers:{...t.headers??{},Accept:"application/json","Content-Type":"application/json","nlx-conversation-id":u.conversationId,"nlx-sdk-version":al.version},body:JSON.stringify({languageCode:u.languageCode,conversationId:u.conversationId,userId:u.userId,requestToken:!0,context:O})});if($.status>=400)throw new Error(`Responded with ${$.status}`);const J=await $.json();if((J==null?void 0:J.url)==null)throw new Error("Invalid response");return J},subscribe:O=>(g=[...g,O],O(Tf(u)),()=>{Q(O)}),unsubscribe:Q,unsubscribeAll:()=>{g=[]},reset:O=>{h({conversationId:wf(),responses:(O==null?void 0:O.clearResponses)===!0?[]:u.responses}),Nn(s)&&C(),T()},destroy:()=>{g=[],Nn(s)&&E(),x()},setRequestOverride:O=>{y=O},addEventListener:(O,V)=>{c[O]=[...c[O],V]},removeEventListener:(O,V)=>{c[O]=c[O].filter($=>$!==V)},sendVoicePlusContext:O=>{w({context:O})}}}function _0(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=_0(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function K(){for(var t,e,n=0,r="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=_0(t))&&(r&&(r+=" "),r+=e);return r}const G=t=>({width:t.size!=null?`${t.size}px`:"100%",height:t.size!=null?`${t.size}px`:"100%",className:t.className}),hS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M11 21H10L11 14H7.5C6.92 14 6.93 13.68 7.12 13.34C7.31 13 7.17 13.26 7.19 13.22C8.48 10.94 10.42 7.54 13 3H14L13 10H16.5C16.99 10 17.06 10.33 16.97 10.51L16.9 10.66C12.96 17.55 11 21 11 21Z",fill:"currentColor"})}),Va=t=>k.jsxs("svg",{viewBox:"0 0 24 24",...G(t),children:[k.jsx("path",{d:"M13.5562 5.34835C12.2796 6.62498 12.4866 8.90179 14.0186 10.4337C14.3377 10.7529 14.5571 11.134 14.6767 11.5383C14.8007 11.9572 14.8177 12.4011 14.7277 12.8268C14.6656 13.1203 14.5526 13.4051 14.3887 13.6672C14.3259 13.7677 14.2557 13.865 14.1778 13.9581C14.1279 14.018 14.0747 14.0761 14.0186 14.1322C13.3341 14.8166 12.3641 15.0421 11.4917 14.8092L11.4728 14.8042C9.38654 14.2543 7.32235 15.2129 6.85652 16.9516C6.5761 17.9979 5.50065 18.6188 4.45431 18.3385C3.40798 18.0581 2.787 16.9826 3.06729 15.9363C3.34209 14.9111 4.38012 14.2942 5.40615 14.5335L5.40666 14.5317C5.42748 14.5378 5.44842 14.5437 5.46962 14.5493C7.21342 15.0166 9.08173 13.699 9.64244 11.6062C9.64857 11.5835 9.65521 11.5608 9.66185 11.5383C9.7815 11.134 10.0009 10.7529 10.32 10.4337L10.332 10.4214C10.339 10.4142 10.346 10.407 10.3533 10.4C11.8549 8.86865 12.0496 6.61566 10.7824 5.34835C10.0163 4.58237 10.0163 3.34047 10.7824 2.57449C11.5483 1.8085 12.7903 1.8085 13.5562 2.57449C14.3066 3.32501 14.3218 4.53237 13.6016 5.30135L13.6029 5.30263C13.5872 5.3177 13.5716 5.33289 13.5562 5.34835Z",fill:"currentColor"}),k.jsx("path",{d:"M19.327 6.83185C20.0311 6.83185 20.6019 7.40264 20.6019 8.10675C20.6019 8.81087 20.0311 9.38166 19.327 9.38166C18.6229 9.38166 18.0521 8.81087 18.0521 8.10675C18.0521 7.40264 18.6229 6.83185 19.327 6.83185Z",fill:"currentColor"}),k.jsx("path",{d:"M21.3237 16.4754C21.3237 15.3741 20.4309 14.4813 19.3297 14.4813C18.2284 14.4813 17.3356 15.3741 17.3356 16.4754C17.3356 17.5767 18.2284 18.4695 19.3297 18.4695C20.4309 18.4695 21.3237 17.5767 21.3237 16.4754Z",fill:"currentColor"}),k.jsx("path",{d:"M12.1025 19.3194C12.8246 19.3194 13.4101 19.9195 13.4101 20.6597C13.4101 21.4 12.8246 22 12.1025 22C11.3804 22 10.7949 21.4 10.7949 20.6597C10.7949 19.9195 11.3804 19.3194 12.1025 19.3194Z",fill:"currentColor"}),k.jsx("path",{d:"M6.28367 8.13944C6.28367 7.41726 5.68363 6.83185 4.94339 6.83185C4.20314 6.83185 3.6031 7.41726 3.6031 8.13944C3.6031 8.86163 4.20314 9.44704 4.94339 9.44704C5.68363 9.44704 6.28367 8.86163 6.28367 8.13944Z",fill:"currentColor"})]}),pS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M6 13C5.45 13 5 13.45 5 14C5 14.55 5.45 15 6 15C6.55 15 7 14.55 7 14C7 13.45 6.55 13 6 13ZM6 17C5.45 17 5 17.45 5 18C5 18.55 5.45 19 6 19C6.55 19 7 18.55 7 18C7 17.45 6.55 17 6 17ZM6 9C5.45 9 5 9.45 5 10C5 10.55 5.45 11 6 11C6.55 11 7 10.55 7 10C7 9.45 6.55 9 6 9ZM3 9.5C2.72 9.5 2.5 9.72 2.5 10C2.5 10.28 2.72 10.5 3 10.5C3.28 10.5 3.5 10.28 3.5 10C3.5 9.72 3.28 9.5 3 9.5ZM6 5C5.45 5 5 5.45 5 6C5 6.55 5.45 7 6 7C6.55 7 7 6.55 7 6C7 5.45 6.55 5 6 5ZM21 10.5C21.28 10.5 21.5 10.28 21.5 10C21.5 9.72 21.28 9.5 21 9.5C20.72 9.5 20.5 9.72 20.5 10C20.5 10.28 20.72 10.5 21 10.5ZM14 7C14.55 7 15 6.55 15 6C15 5.45 14.55 5 14 5C13.45 5 13 5.45 13 6C13 6.55 13.45 7 14 7ZM14 3.5C14.28 3.5 14.5 3.28 14.5 3C14.5 2.72 14.28 2.5 14 2.5C13.72 2.5 13.5 2.72 13.5 3C13.5 3.28 13.72 3.5 14 3.5ZM3 13.5C2.72 13.5 2.5 13.72 2.5 14C2.5 14.28 2.72 14.5 3 14.5C3.28 14.5 3.5 14.28 3.5 14C3.5 13.72 3.28 13.5 3 13.5ZM10 20.5C9.72 20.5 9.5 20.72 9.5 21C9.5 21.28 9.72 21.5 10 21.5C10.28 21.5 10.5 21.28 10.5 21C10.5 20.72 10.28 20.5 10 20.5ZM10 3.5C10.28 3.5 10.5 3.28 10.5 3C10.5 2.72 10.28 2.5 10 2.5C9.72 2.5 9.5 2.72 9.5 3C9.5 3.28 9.72 3.5 10 3.5ZM10 7C10.55 7 11 6.55 11 6C11 5.45 10.55 5 10 5C9.45 5 9 5.45 9 6C9 6.55 9.45 7 10 7ZM10 12.5C9.17 12.5 8.5 13.17 8.5 14C8.5 14.83 9.17 15.5 10 15.5C10.83 15.5 11.5 14.83 11.5 14C11.5 13.17 10.83 12.5 10 12.5ZM18 13C17.45 13 17 13.45 17 14C17 14.55 17.45 15 18 15C18.55 15 19 14.55 19 14C19 13.45 18.55 13 18 13ZM18 17C17.45 17 17 17.45 17 18C17 18.55 17.45 19 18 19C18.55 19 19 18.55 19 18C19 17.45 18.55 17 18 17ZM18 9C17.45 9 17 9.45 17 10C17 10.55 17.45 11 18 11C18.55 11 19 10.55 19 10C19 9.45 18.55 9 18 9ZM18 5C17.45 5 17 5.45 17 6C17 6.55 17.45 7 18 7C18.55 7 19 6.55 19 6C19 5.45 18.55 5 18 5ZM21 13.5C20.72 13.5 20.5 13.72 20.5 14C20.5 14.28 20.72 14.5 21 14.5C21.28 14.5 21.5 14.28 21.5 14C21.5 13.72 21.28 13.5 21 13.5ZM14 17C13.45 17 13 17.45 13 18C13 18.55 13.45 19 14 19C14.55 19 15 18.55 15 18C15 17.45 14.55 17 14 17ZM14 20.5C13.72 20.5 13.5 20.72 13.5 21C13.5 21.28 13.72 21.5 14 21.5C14.28 21.5 14.5 21.28 14.5 21C14.5 20.72 14.28 20.5 14 20.5ZM10 8.5C9.17 8.5 8.5 9.17 8.5 10C8.5 10.83 9.17 11.5 10 11.5C10.83 11.5 11.5 10.83 11.5 10C11.5 9.17 10.83 8.5 10 8.5ZM10 17C9.45 17 9 17.45 9 18C9 18.55 9.45 19 10 19C10.55 19 11 18.55 11 18C11 17.45 10.55 17 10 17ZM14 12.5C13.17 12.5 12.5 13.17 12.5 14C12.5 14.83 13.17 15.5 14 15.5C14.83 15.5 15.5 14.83 15.5 14C15.5 13.17 14.83 12.5 14 12.5ZM14 8.5C13.17 8.5 12.5 9.17 12.5 10C12.5 10.83 13.17 11.5 14 11.5C14.83 11.5 15.5 10.83 15.5 10C15.5 9.17 14.83 8.5 14 8.5Z",fill:"currentColor"})}),fS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M19 13H13V19H11V13H5V11H11V5H13V11H19V13Z",fill:"currentColor"})}),O0=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M12 15.41L6 9.40997L7.41 7.99997L12 12.58L16.59 7.99997L18 9.40997L12 15.41Z",fill:"currentColor"})}),mS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M7.59001 12L13.59 18L15 16.59L10.42 12L15 7.41002L13.59 6.00002L7.59001 12Z",fill:"currentColor"})}),N0=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M15 12L9.00005 18L7.59005 16.59L12.17 12L7.59005 7.41002L9.00005 6.00002L15 12Z",fill:"currentColor"})}),gS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M12 8L6 14L7.41 15.41L12 10.83L16.59 15.41L18 14L12 8Z",fill:"currentColor"})}),yc=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M12 4L10.59 5.41L16.17 11H4V13H16.17L10.59 18.59L12 20L20 12L12 4Z",fill:"currentColor"})}),bu=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M18.5 16H7C4.79 16 3 14.21 3 12C3 9.79 4.79 8 7 8H19.5C20.88 8 22 9.12 22 10.5C22 11.88 20.88 13 19.5 13H9C8.45 13 8 12.55 8 12C8 11.45 8.45 11 9 11H18.5V9.5H9C7.62 9.5 6.5 10.62 6.5 12C6.5 13.38 7.62 14.5 9 14.5H19.5C21.71 14.5 23.5 12.71 23.5 10.5C23.5 8.29 21.71 6.5 19.5 6.5H7C3.96 6.5 1.5 8.96 1.5 12C1.5 15.04 3.96 17.5 7 17.5H18.5V16Z",fill:"currentColor"})}),vS=t=>k.jsxs("svg",{viewBox:"0 0 24 24",...G(t),children:[k.jsx("path",{d:"M12 15.2C13.7673 15.2 15.2 13.7673 15.2 12C15.2 10.2327 13.7673 8.8 12 8.8C10.2327 8.8 8.8 10.2327 8.8 12C8.8 13.7673 10.2327 15.2 12 15.2Z",fill:"currentColor"}),k.jsx("path",{d:"M9 2L7.17 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4H16.83L15 2H9ZM12 17C9.24 17 7 14.76 7 12C7 9.24 9.24 7 12 7C14.76 7 17 9.24 17 12C17 14.76 14.76 17 12 17Z",fill:"currentColor"})]}),M0=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M8.99991 16.17L4.82991 12L3.40991 13.41L8.99991 19L20.9999 7L19.5899 5.59L8.99991 16.17Z",fill:"currentColor"})}),Ha=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z",fill:"currentColor"})}),bS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM19 5H8C6.9 5 6 5.9 6 7V21C6 22.1 6.9 23 8 23H19C20.1 23 21 22.1 21 21V7C21 5.9 20.1 5 19 5ZM19 21H8V7H19V21Z",fill:"currentColor"})}),L0=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M19 4H18V2H16V4H8V2H6V4H5C3.89 4 3.01 4.9 3.01 6L3 20C3 21.1 3.89 22 5 22H19C20.1 22 21 21.1 21 20V6C21 4.9 20.1 4 19 4ZM19 20H5V9H19V20Z",fill:"currentColor"})}),D0=t=>k.jsxs("svg",{viewBox:"0 0 24 24",...G(t),children:[k.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 21C6.9 21 6 20.1 6 19V7H18V19C18 20.1 17.1 21 16 21H8ZM9.33337 9H8V19H9.33337V9ZM11.3334 9V19H12.6666V9H11.3334ZM16 19H14.6666V9H16V19Z",fill:"currentColor"}),k.jsx("path",{d:"M15.5 4H19V6H5V4H8.5L9.5 3H14.5L15.5 4Z",fill:"currentColor"})]}),j0=t=>k.jsxs("svg",{viewBox:"0 0 24 24",...G(t),children:[k.jsx("path",{d:"M21 12.22C21 6.73 16.74 3 12 3C7.31 3 3 6.65 3 12.28C2.4 12.62 2 13.26 2 14V16C2 17.1 2.9 18 4 18H5V11.9C5 8.03 8.13 4.9 12 4.9C15.87 4.9 19 8.03 19 11.9V19H11V21H19C20.1 21 21 20.1 21 19V17.78C21.59 17.47 22 16.86 22 16.14V13.84C22 13.14 21.59 12.53 21 12.22Z",fill:"currentColor"}),k.jsx("path",{d:"M9 14C9.55228 14 10 13.5523 10 13C10 12.4477 9.55228 12 9 12C8.44772 12 8 12.4477 8 13C8 13.5523 8.44772 14 9 14Z",fill:"currentColor"}),k.jsx("path",{d:"M15 14C15.5523 14 16 13.5523 16 13C16 12.4477 15.5523 12 15 12C14.4477 12 14 12.4477 14 13C14 13.5523 14.4477 14 15 14Z",fill:"currentColor"}),k.jsx("path",{d:"M18 11.03C17.52 8.18 15.04 6 12.05 6C9.02 6 5.76 8.51 6.02 12.45C8.49 11.44 10.35 9.24 10.88 6.56C12.19 9.19 14.88 11 18 11.03Z",fill:"currentColor"})]}),yu=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z",fill:"currentColor"})}),yS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M7 14H5V19H10V17H7V14ZM5 10H7V7H10V5H5V10ZM17 17H14V19H19V14H17V17ZM14 5V7H17V10H19V5H14Z",fill:"currentColor"})}),Fs=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M12 15C13.66 15 14.99 13.66 14.99 12L15 6C15 4.34 13.66 3 12 3C10.34 3 9 4.34 9 6V12C9 13.66 10.34 15 12 15ZM17.3 12C17.3 15 14.76 17.1 12 17.1C9.24 17.1 6.7 15 6.7 12H5C5 15.42 7.72 18.23 11 18.72V22H13V18.72C16.28 18.24 19 15.42 19 12H17.3Z",fill:"currentColor"})}),ph=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M19 11H17.3C17.3 11.74 17.14 12.43 16.87 13.05L18.1 14.28C18.66 13.3 19 12.19 19 11ZM14.98 11.17C14.98 11.11 15 11.06 15 11V5C15 3.34 13.66 2 12 2C10.34 2 9 3.34 9 5V5.18L14.98 11.17ZM4.27 3L3 4.27L9.01 10.28V11C9.01 12.66 10.34 14 12 14C12.22 14 12.44 13.97 12.65 13.92L14.31 15.58C13.6 15.91 12.81 16.1 12 16.1C9.24 16.1 6.7 14 6.7 11H5C5 14.41 7.72 17.23 11 17.72V21H13V17.72C13.91 17.59 14.77 17.27 15.54 16.82L19.73 21L21 19.73L4.27 3Z",fill:"currentColor"})}),kS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z",fill:"currentColor"})}),Bs=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M3 9.99999V14C3 14.55 3.45 15 4 15H7L10.29 18.29C10.92 18.92 12 18.47 12 17.58V6.40999C12 5.51999 10.92 5.06999 10.29 5.69999L7 8.99999H4C3.45 8.99999 3 9.44999 3 9.99999ZM16.5 12C16.5 10.23 15.48 8.70999 14 7.96999V16.02C15.48 15.29 16.5 13.77 16.5 12ZM14 4.44999V4.64999C14 5.02999 14.25 5.35999 14.6 5.49999C17.18 6.52999 19 9.05999 19 12C19 14.94 17.18 17.47 14.6 18.5C14.24 18.64 14 18.97 14 19.35V19.55C14 20.18 14.63 20.62 15.21 20.4C18.6 19.11 21 15.84 21 12C21 8.15999 18.6 4.88999 15.21 3.59999C14.63 3.36999 14 3.81999 14 4.44999Z",fill:"currentColor"})}),fh=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M16.5 12C16.5 10.23 15.48 8.71 14 7.97V10.18L16.45 12.63C16.48 12.43 16.5 12.22 16.5 12ZM19 12C19 12.94 18.8 13.82 18.46 14.64L19.97 16.15C20.63 14.91 21 13.5 21 12C21 7.72 18.01 4.14 14 3.23V5.29C16.89 6.15 19 8.83 19 12ZM4.27 3L3 4.27L7.73 9H3V15H7L12 20V13.27L16.25 17.52C15.58 18.04 14.83 18.45 14 18.7V20.76C15.38 20.45 16.63 19.81 17.69 18.95L19.73 21L21 19.73L12 10.73L4.27 3ZM12 4L9.91 6.09L12 8.18V4Z",fill:"currentColor"})}),wS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M12.87 15.07L10.33 12.56L10.36 12.53C12.1 10.59 13.34 8.36 14.07 6H17V4H10V2H8V4H1V5.99H12.17C11.5 7.92 10.44 9.75 9 11.35C8.07 10.32 7.3 9.19 6.69 8H4.69C5.42 9.63 6.42 11.17 7.67 12.56L2.58 17.58L4 19L9 14L12.11 17.11L12.87 15.07ZM18.5 10H16.5L12 22H14L15.12 19H19.87L21 22H23L18.5 10ZM15.88 17L17.5 12.67L19.12 17H15.88Z",fill:"currentColor"})}),CS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M19 19H5V5H12V3H5C3.89 3 3 3.9 3 5V19C3 20.1 3.89 21 5 21H19C20.1 21 21 20.1 21 19V12H19V19ZM14 3V5H17.59L7.76 14.83L9.17 16.24L19 6.41V10H21V3H14Z",fill:"currentColor"})}),SS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M8 5V19L19 12L8 5Z",fill:"currentColor"})}),TS=t=>k.jsxs("svg",{viewBox:"0 0 24 24",...G(t),children:[k.jsx("path",{d:"M13 14.5C13 15.3284 12.3284 16 11.5 16C10.6716 16 10 15.3284 10 14.5C10 13.6716 10.6716 13 11.5 13C12.3284 13 13 13.6716 13 14.5Z",fill:"currentColor"}),k.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 2H14L20 8V20C20 21.1 19.1 22 18 22H5.99C4.89 22 4 21.1 4 20V4C4 2.9 4.9 2 6 2ZM13.16 17.57L15.04 19.45L16.45 18.04L14.57 16.16C15.29 14.83 15.1 13.15 13.98 12.03C12.61 10.66 10.4 10.66 9.03 12.03C7.66 13.4 7.66 15.61 9.03 16.98C10.15 18.1 11.83 18.28 13.16 17.57ZM13 3.5V9H18.5L13 3.5Z",fill:"currentColor"})]}),xS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M3 15H21V13H3V15ZM3 19H21V17H3V19ZM3 11H21V9H3V11ZM3 5V7H21V5H3Z",fill:"currentColor"})}),qa=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M10 3C14.97 3 19 7.03 19 12H22L18.11 15.89L18.04 16.03L14 12H17C17 8.13 13.87 5 10 5C6.13 5 3 8.13 3 12C3 15.87 6.13 19 10 19V21C5.03 21 1 16.97 1 12C1 7.03 5.03 3 10 3Z",fill:"currentColor"})}),A0=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M19.1064 12.9302C19.1459 12.6333 19.1657 12.3266 19.1657 12C19.1657 11.6833 19.1459 11.3667 19.0965 11.0698L21.1053 9.50625C21.2834 9.36771 21.3329 9.10052 21.2241 8.9026L19.3241 5.61719C19.2053 5.39948 18.9579 5.33021 18.7402 5.39948L16.3751 6.34948C15.8803 5.97344 15.3558 5.65677 14.772 5.41927L14.4157 2.90573C14.3761 2.66823 14.1782 2.5 13.9407 2.5H10.1407C9.90323 2.5 9.71521 2.66823 9.67563 2.90573L9.31938 5.41927C8.73552 5.65677 8.20115 5.98333 7.71625 6.34948L5.35115 5.39948C5.13344 5.32031 4.88604 5.39948 4.7673 5.61719L2.87719 8.9026C2.75844 9.11042 2.79802 9.36771 2.99594 9.50625L5.00479 11.0698C4.95532 11.3667 4.91573 11.6932 4.91573 12C4.91573 12.3068 4.93552 12.6333 4.985 12.9302L2.97615 14.4938C2.79802 14.6323 2.74855 14.8995 2.8574 15.0974L4.7574 18.3828C4.87615 18.6005 5.12354 18.6698 5.34125 18.6005L7.70636 17.6505C8.20115 18.0266 8.72563 18.3432 9.30948 18.5807L9.66573 21.0943C9.71521 21.3318 9.90323 21.5 10.1407 21.5H13.9407C14.1782 21.5 14.3761 21.3318 14.4058 21.0943L14.7621 18.5807C15.3459 18.3432 15.8803 18.0266 16.3652 17.6505L18.7303 18.6005C18.948 18.6797 19.1954 18.6005 19.3142 18.3828L21.2142 15.0974C21.3329 14.8797 21.2834 14.6323 21.0954 14.4938L19.1064 12.9302ZM12.0407 15.5625C10.0814 15.5625 8.47823 13.9594 8.47823 12C8.47823 10.0406 10.0814 8.4375 12.0407 8.4375C14.0001 8.4375 15.6032 10.0406 15.6032 12C15.6032 13.9594 14.0001 15.5625 12.0407 15.5625Z",fill:"currentColor"})}),ES=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M15.5 14H14.71L14.43 13.73C15.41 12.59 16 11.11 16 9.5C16 5.91 13.09 3 9.5 3C5.91 3 3 5.91 3 9.5C3 13.09 5.91 16 9.5 16C11.11 16 12.59 15.41 13.73 14.43L14 14.71V15.5L19 20.49L20.49 19L15.5 14ZM9.5 14C7.01 14 5 11.99 5 9.5C5 7.01 7.01 5 9.5 5C11.99 5 14 7.01 14 9.5C14 11.99 11.99 14 9.5 14Z",fill:"currentColor"})}),PS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M18 16.08C17.24 16.08 16.56 16.38 16.04 16.85L8.91 12.7C8.96 12.47 9 12.24 9 12C9 11.76 8.96 11.53 8.91 11.3L15.96 7.19C16.5 7.69 17.21 8 18 8C19.66 8 21 6.66 21 5C21 3.34 19.66 2 18 2C16.34 2 15 3.34 15 5C15 5.24 15.04 5.47 15.09 5.7L8.04 9.81C7.5 9.31 6.79 9 6 9C4.34 9 3 10.34 3 12C3 13.66 4.34 15 6 15C6.79 15 7.5 14.69 8.04 14.19L15.16 18.35C15.11 18.56 15.08 18.78 15.08 19C15.08 20.61 16.39 21.92 18 21.92C19.61 21.92 20.92 20.61 20.92 19C20.92 17.39 19.61 16.08 18 16.08Z",fill:"currentColor"})}),U0=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M1 21H23L12 2L1 21ZM13 18H11V16H13V18ZM13 14H11V10H13V14Z",fill:"currentColor"})}),RS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M15 3H6C5.17 3 4.46 3.5 4.16 4.22L1.14 11.27C1.05 11.5 1 11.74 1 12V14C1 15.1 1.9 16 3 16H9.31L8.36 20.57L8.33 20.89C8.33 21.3 8.5 21.68 8.77 21.95L9.83 23L16.42 16.41C16.78 16.05 17 15.55 17 15V5C17 3.9 16.1 3 15 3ZM19 3V15H23V3H19Z",fill:"currentColor"})}),IS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M1 21H5V9H1V21ZM23 10C23 8.9 22.1 8 21 8H14.69L15.64 3.43L15.67 3.11C15.67 2.7 15.5 2.32 15.23 2.05L14.17 1L7.59 7.59C7.22 7.95 7 8.45 7 9V19C7 20.1 7.9 21 9 21H18C18.83 21 19.54 20.5 19.84 19.78L22.86 12.73C22.95 12.5 23 12.26 23 12V10Z",fill:"currentColor"})}),_S=t=>k.jsxs("svg",{viewBox:"0 0 24 24",...G(t),children:[k.jsx("path",{d:"M11 7H12.5V12.25L17 14.92L16.25 16.15L11 13V7Z",fill:"currentColor"}),k.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47997 6.47 1.99997 11.99 1.99997C17.52 1.99997 22 6.47997 22 12C22 17.52 17.52 22 11.99 22C6.47 22 2 17.52 2 12ZM4 12C4 16.42 7.58 20 12 20C16.42 20 20 16.42 20 12C20 7.57997 16.42 3.99997 12 3.99997C7.58 3.99997 4 7.57997 4 12Z",fill:"currentColor"})]}),F0=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M13 3C8.03 3 4 7.03 4 12H1L4.89 15.89L4.96 16.03L9 12H6C6 8.13 9.13 5 13 5C16.87 5 20 8.13 20 12C20 15.87 16.87 19 13 19V21C17.97 21 22 16.97 22 12C22 7.03 17.97 3 13 3Z",fill:"currentColor"})}),OS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M12 4V1L8 5L12 9V6C15.31 6 18 8.69 18 12C18 13.01 17.75 13.97 17.3 14.8L18.76 16.26C19.54 15.03 20 13.57 20 12C20 7.58 16.42 4 12 4ZM12 18C8.69 18 6 15.31 6 12C6 10.99 6.25 10.03 6.7 9.2L5.24 7.74C4.46 8.97 4 10.43 4 12C4 16.42 7.58 20 12 20V23L16 19L12 15V18Z",fill:"currentColor"})}),NS=t=>k.jsx("svg",{viewBox:"0 0 24 24",...G(t),children:k.jsx("path",{d:"M11 18H13V16H11V18ZM12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20ZM12 6C9.79 6 8 7.79 8 10H10C10 8.9 10.9 8 12 8C13.1 8 14 8.9 14 10C14 12 11 11.75 11 15H13C13 12.75 16 12.5 16 10C16 7.79 14.21 6 12 6Z",fill:"currentColor"})}),B0=t=>k.jsxs("svg",{viewBox:"0 0 16 16",...G(t),fill:"currentColor",children:[k.jsx("path",{d:"M12.6667 7.33326V12.6666H3.33333V3.33326H8.66667V1.99992H3.33333C2.6 1.99992 2 2.59992 2 3.33326V12.6666C2 13.3999 2.6 13.9999 3.33333 13.9999H12.6667C13.4 13.9999 14 13.3999 14 12.6666V7.33326H12.6667Z"}),k.jsx("path",{d:"M14.0183 1.97412L10.0699 1.97412L11.5506 3.45477L7.66668 7.33327L8.65378 8.32037L12.5377 4.44188L14.0183 5.92253V1.97412Z"})]}),MS=Object.freeze(Object.defineProperty({__proto__:null,Action:hS,Add:fS,ArrowDown:O0,ArrowForward:yc,ArrowLeft:mS,ArrowRight:N0,ArrowUp:gS,AssistantOld:pS,Attachment:bu,Camera:vS,Check:M0,Close:Ha,Copy:bS,Date:L0,Delete:D0,Error:yu,Escalate:j0,FullScreen:yS,Help:NS,Location:kS,Mic:Fs,MicOff:ph,OpenInNew:CS,OpenLink:B0,Play:SS,Preview:TS,Refresh:OS,Reorder:xS,Restart:qa,Search:ES,Settings:A0,Share:PS,ThumbDown:RS,ThumbUp:IS,Time:_S,Touchpoint:Va,Translate:wS,Undo:F0,Volume:Bs,VolumeOff:fh,Warning:U0},Symbol.toStringTag,{value:"Module"})),LS=t=>{const{Custom:e}=t;return e!=null?k.jsx(e,{className:t.className,onClick:t.onClick}):k.jsxs("button",{className:K("p-3 w-fit bg-background text-primary-80 rounded-outer","after:content-[''] after:rounded-outer after:absolute after:inset-0 after:pointer-events-none","hover:after:bg-primary-10",t.className),disabled:t.onClick==null,onClick:t.onClick,children:[k.jsx("span",{className:"block flex-none w-8 h-8",children:t.iconUrl==null?k.jsx(Va,{}):k.jsx("img",{src:t.iconUrl,className:"w-8 h-8"})}),t.showLabel??!1?k.jsx("span",{children:t.label}):null]})},z0="p-3 w-10 h-10 transition-colors rounded-inner relative z-10 overflow-hidden before:content-[''] before:absolute before:transition-colors before:-z-10 before:inset-0 before:bg-transparent focus:outline-0",V0="bg-primary-80 text-secondary-80 enabled:hover:before:bg-primary-80 focus:before:bg-primary-80 enabled:active:before:bg-secondary-10 disabled:bg-primary-10 disabled:text-secondary-40",H0="bg-primary-5 text-primary-80 enabled:hover:before:bg-primary-10 focus:before:bg-primary-10 enabled:active:before:bg-secondary-10 disabled:bg-primary-5 disabled:text-primary-20",q0="bg-accent text-secondary-80 enabled:hover:before:bg-primary-40 focus:before:bg-primary-40 enabled:active:before:bg-secondary-10 disabled:bg-accent-20",$0="bg-secondary-60 backdrop-blur text-primary-80 enabled:hover:before:bg-primary-10 focus:before:bg-primary-10 enabled:active:before:bg-secondary-10 disabled:bg-secondary-20 disabled:text-primary-20",W0="bg-background backdrop-blur text-primary-80 enabled:hover:before:bg-primary-10 focus:before:bg-primary-10 enabled:active:before:bg-secondary-10 disabled:bg-secondary-20 disabled:text-primary-20",K0="bg-error-primary text-secondary-80 enabled:hover:before:bg-primary-10",DS=({type:t,Icon:e})=>k.jsx("span",{className:K(z0,"block",t==="main"?V0:null,t==="ghost"?H0:null,t==="activated"?q0:null,t==="coverup"?$0:null,t==="overlay"?W0:null,t==="error"?K0:null),children:k.jsx(e,{})}),Ve=({onClick:t,type:e,label:n,className:r,Icon:i})=>{const a=t==null;return k.jsx("button",{onClick:a?void 0:t,disabled:a,"aria-label":n,className:K(z0,e==="main"?V0:null,e==="ghost"?H0:null,e==="activated"?q0:null,e==="coverup"?$0:null,e==="overlay"?W0:null,e==="error"?K0:null,r),children:k.jsx(i,{})})};function jS(t){const e=L.useRef(t);return e.current=t,L.useMemo(()=>Object.freeze({get current(){return e.current}}),[])}function AS(t){const e=jS(t);L.useEffect(()=>()=>{e.current()},[])}function US(t,e,n,r=0){const i=L.useRef(),a=L.useRef(),o=L.useRef(t),s=L.useRef(),c=()=>{i.current&&(clearTimeout(i.current),i.current=void 0),a.current&&(clearTimeout(a.current),a.current=void 0)};return AS(c),L.useEffect(()=>{o.current=t},e),L.useMemo(()=>{const l=()=>{if(c(),!s.current)return;const d=s.current;s.current=void 0,o.current.apply(d.this,d.args)},u=function(...d){i.current&&clearTimeout(i.current),s.current={args:d,this:this},i.current=setTimeout(l,n),r>0&&!a.current&&(a.current=setTimeout(l,r))};return Object.defineProperties(u,{length:{value:t.length},name:{value:`${t.name||"anonymous"}__debounced__${n}`}}),u},[n,r,...e])}const FS=typeof globalThis<"u"&&typeof navigator<"u"&&typeof document<"u";function Ef(t,e,n=0){const[r,i]=L.useState(t);return[r,US(i,[],e,n)]}const Pi=new Map,G0=t=>{const e=matchMedia(t),n=new Set,r=()=>{for(const i of n)i(e.matches)};return e.addEventListener("change",r,{passive:!0}),{mql:e,dispatchers:n,listener:r}},BS=(t,e)=>{let n=Pi.get(t);n||(n=G0(t),Pi.set(t,n)),n.dispatchers.add(e),e(n.mql.matches)},zS=(t,e)=>{const n=Pi.get(t);if(n){const{mql:r,dispatchers:i,listener:a}=n;i.delete(e),i.size===0&&(Pi.delete(t),r.removeEventListener?r.removeEventListener("change",a):r.removeListener(a))}};function VS(t,e={}){let{initializeWithValue:n=!0}=e;FS||(n=!1);const[r,i]=L.useState(()=>{if(n){let a=Pi.get(t);return a||(a=G0(t),Pi.set(t,a)),a.mql.matches}});return L.useEffect(()=>(BS(t,i),()=>{zS(t,i)}),[t]),r}const Z0=t=>VS("(min-width: 768px)"),HS=({windowSize:t,renderCollapse:e,errorThemedCloseButton:n,speakerControls:r,collapse:i,toggleSettings:a,isSettingsOpen:o,brandIcon:s,reset:c,enabled:l})=>{const u=t==="half",d=Z0(),h=u&&d?"overlay":"ghost";return k.jsxs("div",{className:K("flex","p-2 md:p-3 items-center justify-between gap-2",{"md:absolute md:w-fit md:flex-col md:left-0 md:-translate-x-full":t==="half","md:absolute md:left-0 md:right-0 md:top-0":t==="full"||t==="embedded"}),children:[s!=null?k.jsx("img",{className:"w-10 h-10 block",src:s,role:"presentation"}):null,k.jsx(Ve,{label:"Reset",type:h,className:s==null?"":"ml-auto",onClick:l?()=>{c()}:void 0,Icon:F0}),a!=null?k.jsx(Ve,{className:s!=null?"":"ml-auto",Icon:A0,label:"Settings",type:o?"activated":h,onClick:l?a:void 0}):null,r!=null?k.jsx(Ve,{Icon:r.enabled?Bs:fh,label:"Speakers",type:r.enabled?"activated":h,onClick:()=>{r.setEnabled(p=>!p)}}):null,e?k.jsx(Ve,{label:"Collapse",type:n??!1?"error":h,className:K(a==null?"ml-auto":"",u?"md:-order-1":""),onClick:l?()=>{i(new Event("collapse"))}:void 0,Icon:Ha}):null]})},J0=()=>k.jsxs("div",{className:K("flex-grow flex flex-col items-center justify-center gap-6 text-primary-80","fullscreen-error"),children:[k.jsx(Va,{className:"w-20 h-20 text-primary-20"}),k.jsxs("div",{className:"text-center",children:[k.jsx("h3",{className:"text-xl mb-2",children:"Oops!"}),k.jsx("p",{children:"Something went wrong."}),k.jsx("p",{children:"Try again later."})]})]}),xo=({k:t,className:e,style:n})=>{const r=i=>`${i}s`;return k.jsx("div",{className:K("bg-current animate-ping absolute inset-0",e),style:{animationDelay:r(-1.5*t),animationDuration:r(1.5),...n??{}}})},$a=({className:t,style:e})=>{const n=K("text-accent-20",t);return k.jsxs(k.Fragment,{children:[k.jsx(xo,{k:.12,className:n,style:e}),k.jsx(xo,{k:.24,className:n,style:e}),k.jsx(xo,{k:.36,className:n,style:e}),k.jsx(xo,{k:.48,className:n,style:e})]})},qS=30,Wi=17,$S=t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,ku=990,WS=300,Eo=ku+WS,KS=({d:t})=>{const e=Math.PI/2,n=t/Wi/2.8,r=e*Math.min(n,1),i=n<1?(t-Math.sin(r))/Math.cos(r)*.5:0,a=-t,o=t,s=t-Wi*Math.sin(r),c=Wi*Math.cos(r),l=s-i*Math.cos(r),u=c-i*Math.sin(r);return k.jsxs(k.Fragment,{children:[k.jsx("circle",{cx:a,cy:"0",r:Wi}),k.jsx("circle",{cx:o,cy:"0",r:Wi}),n<.45?k.jsx("path",{d:`
            M${-s},${c} 
            C${-l},${u} ${l},${u} ${s},${c} L${s},${-c}
            C${l},${-u} ${-l},${-u} ${-s},${-c} Z
          `}):null]})},GS=t=>t<1/3?t*3:t<2/3?1:3-t*3,Pf=t=>t<1/3?0:t<2/3?(t-1/3)*3:1,mh=()=>{const[t,e]=L.useState(null),n=L.useRef(!1);if(L.useEffect(()=>{const d=h=>{e(p=>p==null?{start:h,current:h}:{...p,current:h}),n.current||requestAnimationFrame(d)};n.current||requestAnimationFrame(d)},[n,e]),t==null)return null;let r,i;const a=t.current-t.start,o=a%Eo,s=Math.floor(a/Eo);if(o<ku){const d=a/Eo,h=Math.floor(d),p=$S((d-h)*(Eo/ku));r=GS(p),i=s%2?Pf(p):1+Pf(p)}else r=0,i=0;const c=r>.2?0:5*(.2-r)/.2,l=.3,u=r>l?1-.25*(r-l)/(1-l):1;return k.jsx("svg",{viewBox:"0 0 100 100",stroke:"none",fill:"currentColor",style:{filter:`drop-shadow(0 0 ${c}px var(--accent))`},children:k.jsx("g",{transform:`translate(50 50) rotate(${i*90})`,opacity:u,children:k.jsx(KS,{d:qS*r})})})},Q0=({label:t,className:e})=>k.jsx("div",{className:K("h-full w-full flex items-center justify-center",e),children:k.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[k.jsx("div",{className:K("w-8 h-8 block text-accent"),children:k.jsx(mh,{})}),t!=null?k.jsx("p",{className:"text-primary-60",children:t}):null]})}),Ir=({onClick:t,label:e,type:n="ghost",Icon:r,className:i})=>k.jsxs("button",{onClick:t,disabled:t==null,className:K("relative z-10 w-full px-5 py-4 transition-colors rounded-outer flex justify-between items-center focus:outline-0 overflow-hidden before:content-[''] before:absolute before:transition-colors before:-z-10 before:inset-0 before:bg-transparent",{"bg-primary-80 text-secondary-80 enabled:hover:before:bg-primary-80 focus:before:bg-primary-80 enabled:active:before:bg-secondary-10 disabled:bg-primary-10 disabled:text-secondary-40":n==="main","bg-primary-5 text-primary-80 enabled:hover:before:bg-primary-5 focus:before:bg-primary-5 enabled:active:before:bg-secondary-10 disabled:bg-primary-5 disabled:text-primary-20":n==="ghost"},i),children:[e,k.jsx(r,{size:16})]});function ZS(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}var JS=Object.defineProperty,QS=(t,e,n)=>e in t?JS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Rf=(t,e,n)=>QS(t,typeof e!="symbol"?e+"":e,n);class vt{constructor(){Rf(this,"_locking"),Rf(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(i=>e=()=>{this._locks-=1,i()}),r=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),r}}function xe(t,e){if(!t)throw new Error(e)}const YS=34028234663852886e22,XS=-34028234663852886e22,eT=4294967295,tT=2147483647,nT=-2147483648;function Zo(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>tT||t<nT)throw new Error("invalid int 32: "+t)}function wu(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>eT||t<0)throw new Error("invalid uint 32: "+t)}function Y0(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>YS||t<XS))throw new Error("invalid float 32: "+t)}const X0=Symbol("@bufbuild/protobuf/enum-type");function rT(t){const e=t[X0];return xe(e,"missing enum type on enum object"),e}function eb(t,e,n,r){t[X0]=tb(e,n.map(i=>({no:i.no,name:i.name,localName:t[i.no]})))}function tb(t,e,n){const r=Object.create(null),i=Object.create(null),a=[];for(const o of e){const s=nb(o);a.push(s),r[o.name]=s,i[o.no]=s}return{typeName:t,values:a,findName(o){return r[o]},findNumber(o){return i[o]}}}function iT(t,e,n){const r={};for(const i of e){const a=nb(i);r[a.localName]=a.no,r[a.no]=a.localName}return eb(r,t,e),r}function nb(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class gh{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const r=this.getType(),i=r.runtime.bin,a=i.makeReadOptions(n);return i.readMessage(this,a.readerFactory(e),e.byteLength,a),this}fromJson(e,n){const r=this.getType(),i=r.runtime.json,a=i.makeReadOptions(n);return i.readMessage(r,e,a,this),this}fromJsonString(e,n){let r;try{r=JSON.parse(e)}catch(i){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(i instanceof Error?i.message:String(i)))}return this.fromJson(r,n)}toBinary(e){const n=this.getType(),r=n.runtime.bin,i=r.makeWriteOptions(e),a=i.writerFactory();return r.writeMessage(this,a,i),a.finish()}toJson(e){const n=this.getType(),r=n.runtime.json,i=r.makeWriteOptions(e);return r.writeMessage(this,i)}toJsonString(e){var n;const r=this.toJson(e);return JSON.stringify(r,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function aT(t,e,n,r){var i;const a=(i=r==null?void 0:r.localName)!==null&&i!==void 0?i:e.substring(e.lastIndexOf(".")+1),o={[a]:function(s){t.util.initFields(this),t.util.initPartial(s,this)}}[a];return Object.setPrototypeOf(o.prototype,new gh),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(s,c){return new o().fromBinary(s,c)},fromJson(s,c){return new o().fromJson(s,c)},fromJsonString(s,c){return new o().fromJsonString(s,c)},equals(s,c){return t.util.equals(o,s,c)}}),o}function oT(){let t=0,e=0;for(let r=0;r<28;r+=7){let i=this.buf[this.pos++];if(t|=(i&127)<<r,!(i&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let r=3;r<=31;r+=7){let i=this.buf[this.pos++];if(e|=(i&127)<<r,!(i&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function sl(t,e,n){for(let a=0;a<28;a=a+7){const o=t>>>a,s=!(!(o>>>7)&&e==0),c=(s?o|128:o)&255;if(n.push(c),!s)return}const r=t>>>28&15|(e&7)<<4,i=!!(e>>3);if(n.push((i?r|128:r)&255),!!i){for(let a=3;a<31;a=a+7){const o=e>>>a,s=!!(o>>>7),c=(s?o|128:o)&255;if(n.push(c),!s)return}n.push(e>>>31&1)}}const Jo=4294967296;function If(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let r=0,i=0;function a(o,s){const c=Number(t.slice(o,s));i*=n,r=r*n+c,r>=Jo&&(i=i+(r/Jo|0),r=r%Jo)}return a(-24,-18),a(-18,-12),a(-12,-6),a(-6),e?ib(r,i):vh(r,i)}function sT(t,e){let n=vh(t,e);const r=n.hi&2147483648;r&&(n=ib(n.lo,n.hi));const i=rb(n.lo,n.hi);return r?"-"+i:i}function rb(t,e){if({lo:t,hi:e}=cT(t,e),e<=2097151)return String(Jo*e+t);const n=t&16777215,r=(t>>>24|e<<8)&16777215,i=e>>16&65535;let a=n+r*6777216+i*6710656,o=r+i*8147497,s=i*2;const c=1e7;return a>=c&&(o+=Math.floor(a/c),a%=c),o>=c&&(s+=Math.floor(o/c),o%=c),s.toString()+_f(o)+_f(a)}function cT(t,e){return{lo:t>>>0,hi:e>>>0}}function vh(t,e){return{lo:t|0,hi:e|0}}function ib(t,e){return e=~e,t?t=~t+1:e+=1,vh(t,e)}const _f=t=>{const e=String(t);return"0000000".slice(e.length)+e};function Of(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function lT(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function uT(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof process.env!="object"||{}.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),i=BigInt("9223372036854775807"),a=BigInt("0"),o=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(s){const c=typeof s=="bigint"?s:BigInt(s);if(c>i||c<r)throw new Error("int64 invalid: ".concat(s));return c},uParse(s){const c=typeof s=="bigint"?s:BigInt(s);if(c>o||c<a)throw new Error("uint64 invalid: ".concat(s));return c},enc(s){return t.setBigInt64(0,this.parse(s),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(s){return t.setBigInt64(0,this.uParse(s),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(s,c){return t.setInt32(0,s,!0),t.setInt32(4,c,!0),t.getBigInt64(0,!0)},uDec(s,c){return t.setInt32(0,s,!0),t.setInt32(4,c,!0),t.getBigUint64(0,!0)}}}const e=r=>xe(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),n=r=>xe(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),e(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),e(r),If(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),n(r),If(r)},dec(r,i){return sT(r,i)},uDec(r,i){return rb(r,i)}}}const be=uT();var I;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(I||(I={}));var Xn;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(Xn||(Xn={}));function Pn(t,e,n){if(e===n)return!0;if(t==I.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}switch(t){case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return e==n}return!1}function Ri(t,e){switch(t){case I.BOOL:return!1;case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return e==0?be.zero:"0";case I.DOUBLE:case I.FLOAT:return 0;case I.BYTES:return new Uint8Array(0);case I.STRING:return"";default:return 0}}function ab(t,e){switch(t){case I.BOOL:return e===!1;case I.STRING:return e==="";case I.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Re;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Re||(Re={}));class dT{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let n=new Uint8Array(e),r=0;for(let i=0;i<this.chunks.length;i++)n.set(this.chunks[i],r),r+=this.chunks[i].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(wu(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Zo(e),Of(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){Y0(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){wu(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Zo(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Zo(e),e=(e<<1^e>>31)>>>0,Of(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),i=be.enc(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),i=be.uEnc(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(n)}int64(e){let n=be.enc(e);return sl(n.lo,n.hi,this.buf),this}sint64(e){let n=be.enc(e),r=n.hi>>31,i=n.lo<<1^r,a=(n.hi<<1|n.lo>>>31)^r;return sl(i,a,this.buf),this}uint64(e){let n=be.uEnc(e);return sl(n.lo,n.hi,this.buf),this}}class hT{constructor(e,n){this.varint64=oT,this.uint32=lT,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,r=e&7;if(n<=0||r<0||r>5)throw new Error("illegal tag: field no "+n+" wire type "+r);return[n,r]}skip(e,n){let r=this.pos;switch(e){case Re.Varint:for(;this.buf[this.pos++]&128;);break;case Re.Bit64:this.pos+=4;case Re.Bit32:this.pos+=4;break;case Re.LengthDelimited:let i=this.uint32();this.pos+=i;break;case Re.StartGroup:for(;;){const[a,o]=this.tag();if(o===Re.EndGroup){if(n!==void 0&&a!==n)throw new Error("invalid end group tag");break}this.skip(o,a)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return be.dec(...this.varint64())}uint64(){return be.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),r=-(e&1);return e=(e>>>1|(n&1)<<31)^r,n=n>>>1^r,be.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return be.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return be.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function pT(t,e,n,r){let i;return{typeName:e,extendee:n,get field(){if(!i){const a=typeof r=="function"?r():r;a.name=e.split(".").pop(),a.jsonName="[".concat(e,"]"),i=t.util.newFieldList([a]).list()[0]}return i},runtime:t}}function ob(t){const e=t.field.localName,n=Object.create(null);return n[e]=fT(t),[n,()=>n[e]]}function fT(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Ri(e.T,e.L);case"message":const n=e.T,r=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(r):r;case"map":throw"map fields are not allowed to be extensions"}}function mT(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let pn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),kc=[];for(let t=0;t<pn.length;t++)kc[pn[t].charCodeAt(0)]=t;kc[45]=pn.indexOf("+");kc[95]=pn.indexOf("/");const sb={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),r=0,i=0,a,o=0;for(let s=0;s<t.length;s++){if(a=kc[t.charCodeAt(s)],a===void 0)switch(t[s]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(i){case 0:o=a,i=1;break;case 1:n[r++]=o<<2|(a&48)>>4,o=a,i=2;break;case 2:n[r++]=(o&15)<<4|(a&60)>>2,o=a,i=3;break;case 3:n[r++]=(o&3)<<6|a,i=0;break}}if(i==1)throw Error("invalid base64 string.");return n.subarray(0,r)},enc(t){let e="",n=0,r,i=0;for(let a=0;a<t.length;a++)switch(r=t[a],n){case 0:e+=pn[r>>2],i=(r&3)<<4,n=1;break;case 1:e+=pn[i|r>>4],i=(r&15)<<2,n=2;break;case 2:e+=pn[i|r>>6],e+=pn[r&63],n=0;break}return n&&(e+=pn[i],e+="=",n==1&&(e+="=")),e}};function gT(t,e,n){lb(e,t);const r=e.runtime.bin.makeReadOptions(n),i=mT(t.getType().runtime.bin.listUnknownFields(t),e.field),[a,o]=ob(e);for(const s of i)e.runtime.bin.readField(a,r.readerFactory(s.data),e.field,s.wireType,r);return o()}function vT(t,e,n,r){lb(e,t);const i=e.runtime.bin.makeReadOptions(r),a=e.runtime.bin.makeWriteOptions(r);if(cb(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of l)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const o=a.writerFactory();let s=e.field;!s.opt&&!s.repeated&&(s.kind=="enum"||s.kind=="scalar")&&(s=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(s,n,o,a);const c=i.readerFactory(o.finish());for(;c.pos<c.len;){const[l,u]=c.tag(),d=c.skip(u,l);t.getType().runtime.bin.onUnknownField(t,l,u,d)}}function cb(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(r=>r.no==e.field.no)}function lb(t,e){xe(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function ub(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!ab(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function Nf(t,e){const n=t.localName,r=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=r?t.T.values[0].no:void 0;break;case"scalar":e[n]=r?Ri(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function kr(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(gh.prototype).every(r=>r in t&&typeof t[r]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function db(t,e){return kr(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}I.DOUBLE,I.FLOAT,I.INT64,I.UINT64,I.INT32,I.UINT32,I.BOOL,I.STRING,I.BYTES;const Mf={ignoreUnknownFields:!1},Lf={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function bT(t){return t?Object.assign(Object.assign({},Mf),t):Mf}function yT(t){return t?Object.assign(Object.assign({},Lf),t):Lf}const zs=Symbol(),Qo=Symbol();function kT(){return{makeReadOptions:bT,makeWriteOptions:yT,readMessage(t,e,n,r){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(en(e)));r=r??new t;const i=new Map,a=n.typeRegistry;for(const[o,s]of Object.entries(e)){const c=t.fields.findJsonName(o);if(c){if(c.oneof){if(s===null&&c.kind=="scalar")continue;const l=i.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(o,'"'));i.set(c.oneof,o)}Df(r,s,c,n,t)}else{let l=!1;if(a!=null&&a.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=a.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==t.typeName){l=!0;const[d,h]=ob(u);Df(d,s,u.field,n,u),vT(r,u,h(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return r},writeMessage(t,e){const n=t.getType(),r={};let i;try{for(i of n.fields.byNumber()){if(!ub(i,t)){if(i.req)throw"required field not set";if(!e.emitDefaultValues||!CT(i))continue}const o=i.oneof?t[i.oneof.localName].value:t[i.localName],s=jf(i,o,e);s!==void 0&&(r[e.useProtoFieldName?i.name:i.jsonName]=s)}const a=e.typeRegistry;if(a!=null&&a.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const s=a.findExtensionFor(n.typeName,o.no);if(s&&cb(t,s)){const c=gT(t,s,e),l=jf(s.field,c,e);l!==void 0&&(r[s.field.jsonName]=l)}}}catch(a){const o=i?"cannot encode field ".concat(n.typeName,".").concat(i.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),s=a instanceof Error?a.message:String(a);throw new Error(o+(s.length>0?": ".concat(s):""))}return r},readScalar(t,e,n){return ma(t,e,n??Xn.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||ab(t,e)))return Yo(t,e)},debug:en}}function en(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Df(t,e,n,r,i){let a=n.localName;if(n.repeated){if(xe(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(en(e)));const o=t[a];for(const s of e){if(s===null)throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(en(s)));switch(n.kind){case"message":o.push(n.T.fromJson(s,r));break;case"enum":const c=cl(n.T,s,r.ignoreUnknownFields,!0);c!==Qo&&o.push(c);break;case"scalar":try{o.push(ma(n.T,s,n.L,!0))}catch(l){let u="cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(en(s));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(en(e)));const o=t[a];for(const[s,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: map value null"));let l;try{l=wT(n.K,s)}catch(u){let d="cannot decode map key for field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(en(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(n.V.kind){case"message":o[l]=n.V.T.fromJson(c,r);break;case"enum":const u=cl(n.V.T,c,r.ignoreUnknownFields,!0);u!==Qo&&(o[l]=u);break;case"scalar":try{o[l]=ma(n.V.T,c,Xn.BIGINT,!0)}catch(d){let h="cannot decode map value for field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(en(e));throw d instanceof Error&&d.message.length>0&&(h+=": ".concat(d.message)),new Error(h)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:a},a="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let s=t[a];kr(s)?s.fromJson(e,r):(t[a]=s=o.fromJson(e,r),o.fieldWrapper&&!n.oneof&&(t[a]=o.fieldWrapper.unwrapField(s)));break;case"enum":const c=cl(n.T,e,r.ignoreUnknownFields,!1);switch(c){case zs:Nf(n,t);break;case Qo:break;default:t[a]=c;break}break;case"scalar":try{const l=ma(n.T,e,n.L,!1);switch(l){case zs:Nf(n,t);break;default:t[a]=l;break}}catch(l){let u="cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(en(e));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}function wT(t,e){if(t===I.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return ma(t,e,Xn.BIGINT,!0).toString()}function ma(t,e,n,r){if(e===null)return r?Ri(t,n):zs;switch(t){case I.DOUBLE:case I.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const i=Number(e);if(Number.isNaN(i)||!Number.isFinite(i))break;return t==I.FLOAT&&Y0(i),i;case I.INT32:case I.FIXED32:case I.SFIXED32:case I.SINT32:case I.UINT32:let a;if(typeof e=="number"?a=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(a=Number(e)),a===void 0)break;return t==I.UINT32||t==I.FIXED32?wu(a):Zo(a),a;case I.INT64:case I.SFIXED64:case I.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=be.parse(e);return n?o.toString():o;case I.FIXED64:case I.UINT64:if(typeof e!="number"&&typeof e!="string")break;const s=be.uParse(e);return n?s.toString():s;case I.BOOL:if(typeof e!="boolean")break;return e;case I.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case I.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return sb.dec(e)}throw new Error}function cl(t,e,n,r){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:r?t.values[0].no:zs;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const i=t.findName(e);if(i!==void 0)return i.no;if(n)return Qo;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(en(e)))}function CT(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function jf(t,e,n){if(t.kind=="map"){xe(typeof e=="object"&&e!=null);const r={},i=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,s]of i)r[o.toString()]=Yo(t.V.T,s);break;case"message":for(const[o,s]of i)r[o.toString()]=s.toJson(n);break;case"enum":const a=t.V.T;for(const[o,s]of i)r[o.toString()]=ll(a,s,n.enumAsInteger);break}return n.emitDefaultValues||i.length>0?r:void 0}if(t.repeated){xe(Array.isArray(e));const r=[];switch(t.kind){case"scalar":for(let i=0;i<e.length;i++)r.push(Yo(t.T,e[i]));break;case"enum":for(let i=0;i<e.length;i++)r.push(ll(t.T,e[i],n.enumAsInteger));break;case"message":for(let i=0;i<e.length;i++)r.push(e[i].toJson(n));break}return n.emitDefaultValues||r.length>0?r:void 0}switch(t.kind){case"scalar":return Yo(t.T,e);case"enum":return ll(t.T,e,n.enumAsInteger);case"message":return db(t.T,e).toJson(n)}}function ll(t,e,n){var r;if(xe(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const i=t.findNumber(e);return(r=i==null?void 0:i.name)!==null&&r!==void 0?r:e}function Yo(t,e){switch(t){case I.INT32:case I.SFIXED32:case I.SINT32:case I.FIXED32:case I.UINT32:return xe(typeof e=="number"),e;case I.FLOAT:case I.DOUBLE:return xe(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case I.STRING:return xe(typeof e=="string"),e;case I.BOOL:return xe(typeof e=="boolean"),e;case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return xe(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case I.BYTES:return xe(e instanceof Uint8Array),sb.enc(e)}}const zr=Symbol("@bufbuild/protobuf/unknown-fields"),Af={readUnknownFields:!0,readerFactory:t=>new hT(t)},Uf={writeUnknownFields:!0,writerFactory:()=>new dT};function ST(t){return t?Object.assign(Object.assign({},Af),t):Af}function TT(t){return t?Object.assign(Object.assign({},Uf),t):Uf}function xT(){return{makeReadOptions:ST,makeWriteOptions:TT,listUnknownFields(t){var e;return(e=t[zr])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[zr]},writeUnknownFields(t,e){const n=t[zr];if(n)for(const r of n)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,r){const i=t;Array.isArray(i[zr])||(i[zr]=[]),i[zr].push({no:e,wireType:n,data:r})},readMessage(t,e,n,r,i){const a=t.getType(),o=i?e.len:e.pos+n;let s,c;for(;e.pos<o&&([s,c]=e.tag(),!(i===!0&&c==Re.EndGroup));){const l=a.fields.find(s);if(!l){const u=e.skip(c,s);r.readUnknownFields&&this.onUnknownField(t,s,c,u);continue}Ff(t,e,l,c,r)}if(i&&(c!=Re.EndGroup||s!==n))throw new Error("invalid end group tag")},readField:Ff,writeMessage(t,e,n){const r=t.getType();for(const i of r.fields.byNumber()){if(!ub(i,t)){if(i.req)throw new Error("cannot encode field ".concat(r.typeName,".").concat(i.name," to binary: required field not set"));continue}const a=i.oneof?t[i.oneof.localName].value:t[i.localName];Bf(i,a,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,r){e!==void 0&&Bf(t,e,n,r)}}}function Ff(t,e,n,r,i){let{repeated:a,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const s=n.kind=="enum"?I.INT32:n.T;let c=Vs;if(n.kind=="scalar"&&n.L>0&&(c=PT),a){let h=t[o];if(r==Re.LengthDelimited&&s!=I.STRING&&s!=I.BYTES){let p=e.uint32()+e.pos;for(;e.pos<p;)h.push(c(e,s))}else h.push(c(e,s))}else t[o]=c(e,s);break;case"message":const l=n.T;a?t[o].push(Xo(e,new l,i,n)):kr(t[o])?Xo(e,t[o],i,n):(t[o]=Xo(e,new l,i,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=l.fieldWrapper.unwrapField(t[o])));break;case"map":let[u,d]=ET(n,e,i);t[o][u]=d;break}}function Xo(t,e,n,r){const i=e.getType().runtime.bin,a=r==null?void 0:r.delimited;return i.readMessage(e,t,a?r.no:t.uint32(),n,a),e}function ET(t,e,n){const r=e.uint32(),i=e.pos+r;let a,o;for(;e.pos<i;){const[s]=e.tag();switch(s){case 1:a=Vs(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=Vs(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=Xo(e,new t.V.T,n,void 0);break}break}}if(a===void 0&&(a=Ri(t.K,Xn.BIGINT)),typeof a!="string"&&typeof a!="number"&&(a=a.toString()),o===void 0)switch(t.V.kind){case"scalar":o=Ri(t.V.T,Xn.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[a,o]}function PT(t,e){const n=Vs(t,e);return typeof n=="bigint"?n.toString():n}function Vs(t,e){switch(e){case I.STRING:return t.string();case I.BOOL:return t.bool();case I.DOUBLE:return t.double();case I.FLOAT:return t.float();case I.INT32:return t.int32();case I.INT64:return t.int64();case I.UINT64:return t.uint64();case I.FIXED64:return t.fixed64();case I.BYTES:return t.bytes();case I.FIXED32:return t.fixed32();case I.SFIXED32:return t.sfixed32();case I.SFIXED64:return t.sfixed64();case I.SINT64:return t.sint64();case I.UINT32:return t.uint32();case I.SINT32:return t.sint32()}}function Bf(t,e,n,r){xe(e!==void 0);const i=t.repeated;switch(t.kind){case"scalar":case"enum":let a=t.kind=="enum"?I.INT32:t.T;if(i)if(xe(Array.isArray(e)),t.packed)IT(n,a,t.no,e);else for(const o of e)ga(n,a,t.no,o);else ga(n,a,t.no,e);break;case"message":if(i){xe(Array.isArray(e));for(const o of e)zf(n,r,t,o)}else zf(n,r,t,e);break;case"map":xe(typeof e=="object"&&e!=null);for(const[o,s]of Object.entries(e))RT(n,r,t,o,s);break}}function RT(t,e,n,r,i){t.tag(n.no,Re.LengthDelimited),t.fork();let a=r;switch(n.K){case I.INT32:case I.FIXED32:case I.UINT32:case I.SFIXED32:case I.SINT32:a=Number.parseInt(r);break;case I.BOOL:xe(r=="true"||r=="false"),a=r=="true";break}switch(ga(t,n.K,1,a),n.V.kind){case"scalar":ga(t,n.V.T,2,i);break;case"enum":ga(t,I.INT32,2,i);break;case"message":xe(i!==void 0),t.tag(2,Re.LengthDelimited).bytes(i.toBinary(e));break}t.join()}function zf(t,e,n,r){const i=db(n.T,r);n.delimited?t.tag(n.no,Re.StartGroup).raw(i.toBinary(e)).tag(n.no,Re.EndGroup):t.tag(n.no,Re.LengthDelimited).bytes(i.toBinary(e))}function ga(t,e,n,r){xe(r!==void 0);let[i,a]=hb(e);t.tag(n,i)[a](r)}function IT(t,e,n,r){if(!r.length)return;t.tag(n,Re.LengthDelimited).fork();let[,i]=hb(e);for(let a=0;a<r.length;a++)t[i](r[a]);t.join()}function hb(t){let e=Re.Varint;switch(t){case I.BYTES:case I.STRING:e=Re.LengthDelimited;break;case I.DOUBLE:case I.FIXED64:case I.SFIXED64:e=Re.Bit64;break;case I.FIXED32:case I.SFIXED32:case I.FLOAT:e=Re.Bit32;break}const n=I[t].toLowerCase();return[e,n]}function _T(){return{setEnumType:eb,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const r of n.fields.byMember()){const i=r.localName,a=e,o=t;if(o[i]!=null)switch(r.kind){case"oneof":const s=o[i].case;if(s===void 0)continue;const c=r.findField(s);let l=o[i].value;c&&c.kind=="message"&&!kr(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===I.BYTES&&(l=Ki(l)),a[i]={case:s,value:l};break;case"scalar":case"enum":let u=o[i];r.T===I.BYTES&&(u=r.repeated?u.map(Ki):Ki(u)),a[i]=u;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===I.BYTES)for(const[p,b]of Object.entries(o[i]))a[i][p]=Ki(b);else Object.assign(a[i],o[i]);break;case"message":const h=r.V.T;for(const p of Object.keys(o[i])){let b=o[i][p];h.fieldWrapper||(b=new h(b)),a[i][p]=b}break}break;case"message":const d=r.T;if(r.repeated)a[i]=o[i].map(h=>kr(h,d)?h:new d(h));else{const h=o[i];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?a[i]=Ki(h):a[i]=h:a[i]=kr(h,d)?h:new d(h)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(r=>{const i=e[r.localName],a=n[r.localName];if(r.repeated){if(i.length!==a.length)return!1;switch(r.kind){case"message":return i.every((o,s)=>r.T.equals(o,a[s]));case"scalar":return i.every((o,s)=>Pn(r.T,o,a[s]));case"enum":return i.every((o,s)=>Pn(I.INT32,o,a[s]))}throw new Error("repeated cannot contain ".concat(r.kind))}switch(r.kind){case"message":return r.T.equals(i,a);case"enum":return Pn(I.INT32,i,a);case"scalar":return Pn(r.T,i,a);case"oneof":if(i.case!==a.case)return!1;const o=r.findField(i.case);if(o===void 0)return!0;switch(o.kind){case"message":return o.T.equals(i.value,a.value);case"enum":return Pn(I.INT32,i.value,a.value);case"scalar":return Pn(o.T,i.value,a.value)}throw new Error("oneof cannot contain ".concat(o.kind));case"map":const s=Object.keys(i).concat(Object.keys(a));switch(r.V.kind){case"message":const c=r.V.T;return s.every(u=>c.equals(i[u],a[u]));case"enum":return s.every(u=>Pn(I.INT32,i[u],a[u]));case"scalar":const l=r.V.T;return s.every(u=>Pn(l,i[u],a[u]))}break}})},clone(t){const e=t.getType(),n=new e,r=n;for(const i of e.fields.byMember()){const a=t[i.localName];let o;if(i.repeated)o=a.map(Po);else if(i.kind=="map"){o=r[i.localName];for(const[s,c]of Object.entries(a))o[s]=Po(c)}else i.kind=="oneof"?o=i.findField(a.case)?{case:a.case,value:Po(a.value)}:{case:void 0}:o=Po(a);r[i.localName]=o}for(const i of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(r,i.no,i.wireType,i.data);return n}}}function Po(t){if(t===void 0)return t;if(kr(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Ki(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function OT(t,e,n){return{syntax:t,json:kT(),bin:xT(),util:Object.assign(Object.assign({},_T()),{newFieldList:e,initFields:n}),makeMessageType(r,i,a){return aT(this,r,i,a)},makeEnum:iT,makeEnumType:tb,getEnumType:rT,makeExtension(r,i,a){return pT(this,r,i,a)}}}class NT{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const r of this.list())n[r.jsonName]=n[r.name]=r;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const r of this.list())n[r.no]=r;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const r of this.list())r.oneof?r.oneof!==n&&(n=r.oneof,e.push(n)):e.push(r)}return this.members}}function pb(t,e){const n=fb(t);return e?n:UT(AT(n))}function MT(t){return pb(t,!1)}const LT=fb;function fb(t){let e=!1;const n=[];for(let r=0;r<t.length;r++){let i=t.charAt(r);switch(i){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(i),e=!1;break;default:e&&(e=!1,i=i.toUpperCase()),n.push(i);break}}return n.join("")}const DT=new Set(["constructor","toString","toJSON","valueOf"]),jT=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),mb=t=>"".concat(t,"$"),AT=t=>jT.has(t)?mb(t):t,UT=t=>DT.has(t)?mb(t):t;class FT{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=MT(e)}addField(e){xe(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function BT(t,e){var n,r,i,a,o,s;const c=[];let l;for(const u of typeof t=="function"?t():t){const d=u;if(d.localName=pb(u.name,u.oneof!==void 0),d.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:LT(u.name),d.repeated=(r=u.repeated)!==null&&r!==void 0?r:!1,u.kind=="scalar"&&(d.L=(i=u.L)!==null&&i!==void 0?i:Xn.BIGINT),d.delimited=(a=u.delimited)!==null&&a!==void 0?a:!1,d.req=(o=u.req)!==null&&o!==void 0?o:!1,d.opt=(s=u.opt)!==null&&s!==void 0?s:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=I.BYTES&&u.T!=I.STRING),u.oneof!==void 0){const h=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!l||l.name!=h)&&(l=new FT(h)),d.oneof=l,l.addField(d)}c.push(d)}return c}const P=OT("proto3",t=>new NT(t,e=>BT(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,r=t;if(e.repeated){r[n]=[];continue}switch(e.kind){case"oneof":r[n]={case:void 0};break;case"enum":r[n]=0;break;case"map":r[n]={};break;case"scalar":r[n]=Ri(e.T,e.L);break}}});class st extends gh{constructor(e){super(),this.seconds=be.zero,this.nanos=0,P.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(P.json.debug(e)));const r=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!r)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(r[1]+"-"+r[2]+"-"+r[3]+"T"+r[4]+":"+r[5]+":"+r[6]+(r[8]?r[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=be.parse(i/1e3),this.nanos=0,r[7]&&(this.nanos=parseInt("1"+r[7]+"0".repeat(9-r[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let r="Z";if(this.nanos>0){const i=(this.nanos+1e9).toString().substring(1);i.substring(3)==="000000"?r="."+i.substring(0,3)+"Z":i.substring(6)==="000"?r="."+i.substring(0,6)+"Z":r="."+i+"Z"}return new Date(n).toISOString().replace(".000Z",r)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return st.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new st({seconds:be.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new st().fromBinary(e,n)}static fromJson(e,n){return new st().fromJson(e,n)}static fromJsonString(e,n){return new st().fromJsonString(e,n)}static equals(e,n){return P.util.equals(st,e,n)}}st.runtime=P;st.typeName="google.protobuf.Timestamp";st.fields=P.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const zT=P.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:st},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:VT,repeated:!0},{no:5,name:"events",kind:"message",T:qT,repeated:!0}]),VT=P.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:HT,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),HT=P.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:st},{no:3,name:"value",kind:"scalar",T:2}]),qT=P.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:st},{no:7,name:"normalized_end_timestamp",kind:"message",T:st,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),gb=P.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),zt=P.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Ie=P.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),fi=P.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),ia=P.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Wa=P.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Ht=P.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"}]),Vr=P.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),$T=P.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),tn=P.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),bh=P.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Hs,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Rb}]),Hs=P.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),WT=P.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:P.getEnumType(Ie),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Ka=P.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:P.getEnumType(Cu)},{no:4,name:"tracks",kind:"message",T:ii,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:WT},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:P.getEnumType(qs)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:P.getEnumType(Ht)},{no:18,name:"kind_details",kind:"enum",T:P.getEnumType(KT),repeated:!0}]),Cu=P.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),qs=P.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),KT=P.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),mt=P.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),GT=P.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:wr,repeated:!0}]),ii=P.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:P.getEnumType(zt)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:P.getEnumType(Ie)},{no:10,name:"layers",kind:"message",T:wr,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:GT,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:P.getEnumType(mt)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Rb},{no:19,name:"audio_features",kind:"enum",T:P.getEnumType(tn),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:P.getEnumType(gb)}]),wr=P.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:P.getEnumType(fi)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),at=P.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:P.getEnumType(te)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:bb,oneof:"value"},{no:3,name:"speaker",kind:"message",T:ZT,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:yb,oneof:"value"},{no:7,name:"transcription",kind:"message",T:JT,oneof:"value"},{no:8,name:"metrics",kind:"message",T:zT,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Su,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:kb,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:wb,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Cb,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:xu,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Eu,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Pu,oneof:"value"}]),te=P.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),ZT=P.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:vb,repeated:!0}]),vb=P.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),bb=P.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),yb=P.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),JT=P.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:QT,repeated:!0}]),QT=P.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Su=P.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),kb=P.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),wb=P.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Cb=P.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:Sb,oneof:"value"}]),Sb=P.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),Tb=P.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),YT=P.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:P.getEnumType(xb)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),xb=P.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),XT=P.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:P.getEnumType(Eb)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),Eb=P.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"}]),Pb=P.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Vf},{no:2,name:"screen",kind:"message",T:Vf},{no:3,name:"resume_connection",kind:"enum",T:P.getEnumType(Wa)},{no:4,name:"disabled_codecs",kind:"message",T:ex},{no:5,name:"force_relay",kind:"enum",T:P.getEnumType(Wa)}]),Vf=P.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:P.getEnumType(Wa)}]),ex=P.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Hs,repeated:!0},{no:2,name:"publish",kind:"message",T:Hs,repeated:!0}]),Rb=P.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Tu=P.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Ib=P.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:P.getEnumType(Tu)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),_b=P.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),xu=P.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:P.getEnumType(mt)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Ib,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:_b,oneof:"content_header"}],{localName:"DataStream_Header"}),Eu=P.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Pu=P.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),Vt=P.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Ru=P.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),tx=P.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),nx=P.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:_r,oneof:"message"},{no:2,name:"answer",kind:"message",T:_r,oneof:"message"},{no:3,name:"trickle",kind:"message",T:yh,oneof:"message"},{no:4,name:"add_track",kind:"message",T:_u,oneof:"message"},{no:5,name:"mute",kind:"message",T:kh,oneof:"message"},{no:6,name:"subscription",kind:"message",T:wc,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Ob,oneof:"message"},{no:8,name:"leave",kind:"message",T:Cc,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Mb,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Ab,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Ub,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Qt,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Lb,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Bb,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Nb,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:sx,oneof:"message"}]),Hf=P.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:rx,oneof:"message"},{no:2,name:"answer",kind:"message",T:_r,oneof:"message"},{no:3,name:"offer",kind:"message",T:_r,oneof:"message"},{no:4,name:"trickle",kind:"message",T:yh,oneof:"message"},{no:5,name:"update",kind:"message",T:ox,oneof:"message"},{no:6,name:"track_published",kind:"message",T:wh,oneof:"message"},{no:8,name:"leave",kind:"message",T:Cc,oneof:"message"},{no:9,name:"mute",kind:"message",T:kh,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:cx,oneof:"message"},{no:11,name:"room_update",kind:"message",T:lx,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:dx,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:px,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:mx,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:gx,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:ax,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:ix,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:vx,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:kx,oneof:"message"},{no:22,name:"request_response",kind:"message",T:wx,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Cx,oneof:"message"}]),Iu=P.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),_u=P.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:P.getEnumType(zt)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:P.getEnumType(Ie)},{no:9,name:"layers",kind:"message",T:wr,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Iu,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:P.getEnumType(mt)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:P.getEnumType(gb)}]),yh=P.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:P.getEnumType(Vt)},{no:3,name:"final",kind:"scalar",T:8}]),kh=P.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),rx=P.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:bh},{no:2,name:"participant",kind:"message",T:Ka},{no:3,name:"other_participants",kind:"message",T:Ka,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Db,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Pb},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:YT},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Hs,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),ix=P.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:Db,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Pb}]),wh=P.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:ii}]),ax=P.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),_r=P.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]),ox=P.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Ka,repeated:!0}]),wc=P.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Tb,repeated:!0}]),Ob=P.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:P.getEnumType(fi)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Nb=P.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:P.getEnumType(tn),repeated:!0}]),sx=P.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Cc=P.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:P.getEnumType(Ht)},{no:3,name:"action",kind:"enum",T:P.getEnumType(mi)},{no:4,name:"regions",kind:"message",T:bx}]),mi=P.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),Mb=P.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:wr,repeated:!0}]),Lb=P.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),Db=P.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),cx=P.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:vb,repeated:!0}]),lx=P.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:bh}]),ux=P.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:P.getEnumType(ia)},{no:3,name:"score",kind:"scalar",T:2}]),dx=P.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:ux,repeated:!0}]),hx=P.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:P.getEnumType(Ru)}]),px=P.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:hx,repeated:!0}]),Ch=P.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:P.getEnumType(fi)},{no:2,name:"enabled",kind:"scalar",T:8}]),fx=P.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Ch,repeated:!0}]),mx=P.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Ch,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:fx,repeated:!0}]),jb=P.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),Ab=P.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:jb,repeated:!0}]),gx=P.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),Ub=P.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:_r},{no:2,name:"subscription",kind:"message",T:wc},{no:3,name:"publish_tracks",kind:"message",T:wh,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Fb,repeated:!0},{no:5,name:"offer",kind:"message",T:_r},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}]),Fb=P.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:P.getEnumType(Vt)}]),Qt=P.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:P.getEnumType(tx),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Bb=P.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),vx=P.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),bx=P.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:yx,repeated:!0}]),yx=P.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),kx=P.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:P.getEnumType($T)}]),wx=P.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:P.getEnumType(Sh)},{no:3,name:"message",kind:"scalar",T:9}]),Sh=P.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),Cx=P.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function Sx(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ou={exports:{}},Tx=Ou.exports,qf;function xx(){return qf||(qf=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(Tx,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],a={},o=null;function s(y,w){var f=y[w];if(typeof f.bind=="function")return f.bind(y);try{return Function.prototype.bind.call(f,y)}catch{return function(){return Function.prototype.apply.apply(f,[y,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(y){return y==="debug"&&(y="log"),typeof console===n?!1:y==="trace"&&r?c:console[y]!==void 0?s(console,y):console.log!==void 0?s(console,"log"):e}function u(){for(var y=this.getLevel(),w=0;w<i.length;w++){var f=i[w];this[f]=w<y?e:this.methodFactory(f,y,this.name)}if(this.log=this.debug,typeof console===n&&y<this.levels.SILENT)return"No console available for logging"}function d(y){return function(){typeof console!==n&&(u.call(this),this[y].apply(this,arguments))}}function h(y,w,f){return l(y)||d.apply(this,arguments)}function p(y,w){var f=this,g,m,v,C="loglevel";typeof y=="string"?C+=":"+y:typeof y=="symbol"&&(C=void 0);function T(A){var W=(i[A]||"silent").toUpperCase();if(!(typeof window===n||!C)){try{window.localStorage[C]=W;return}catch{}try{window.document.cookie=encodeURIComponent(C)+"="+W+";"}catch{}}}function E(){var A;if(!(typeof window===n||!C)){try{A=window.localStorage[C]}catch{}if(typeof A===n)try{var W=window.document.cookie,Q=encodeURIComponent(C),O=W.indexOf(Q+"=");O!==-1&&(A=/^([^;]+)/.exec(W.slice(O+Q.length+1))[1])}catch{}return f.levels[A]===void 0&&(A=void 0),A}}function x(){if(!(typeof window===n||!C)){try{window.localStorage.removeItem(C)}catch{}try{window.document.cookie=encodeURIComponent(C)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function N(A){var W=A;if(typeof W=="string"&&f.levels[W.toUpperCase()]!==void 0&&(W=f.levels[W.toUpperCase()]),typeof W=="number"&&W>=0&&W<=f.levels.SILENT)return W;throw new TypeError("log.setLevel() called with invalid level: "+A)}f.name=y,f.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},f.methodFactory=w||h,f.getLevel=function(){return v??m??g},f.setLevel=function(A,W){return v=N(A),W!==!1&&T(v),u.call(f)},f.setDefaultLevel=function(A){m=N(A),E()||f.setLevel(A,!1)},f.resetLevel=function(){v=null,x(),u.call(f)},f.enableAll=function(A){f.setLevel(f.levels.TRACE,A)},f.disableAll=function(A){f.setLevel(f.levels.SILENT,A)},f.rebuild=function(){if(o!==f&&(g=N(o.getLevel())),u.call(f),o===f)for(var A in a)a[A].rebuild()},g=N(o?o.getLevel():"WARN");var M=E();M!=null&&(v=N(M)),u.call(f)}o=new p,o.getLogger=function(y){if(typeof y!="symbol"&&typeof y!="string"||y==="")throw new TypeError("You must supply a name when creating a logger.");var w=a[y];return w||(w=a[y]=new p(y,o.methodFactory)),w};var b=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=b),o},o.getLoggers=function(){return a},o.default=o,o})}(Ou)),Ou.exports}var Sc=xx(),Nu;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(Nu||(Nu={}));var Kt;(function(t){t.Default="livekit",t.Room="livekit-room",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(Kt||(Kt={}));let X=Sc.getLogger("livekit");const Ex=Object.values(Kt).map(t=>Sc.getLogger(t));X.setDefaultLevel(Nu.info);function Sn(t){const e=Sc.getLogger(t);return e.setDefaultLevel(X.getLevel()),e}function Px(t,e){for(const n of Ex)n.setLevel(t)}const Rx=Sc.getLogger("lk-e2ee"),Gi=7e3,Ix=[0,300,2*2*300,3*3*300,4*4*300,Gi,Gi,Gi,Gi,Gi];class _x{constructor(e){this._retryDelays=e!==void 0?[...e]:Ix}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function Ox(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function S(t,e,n,r){function i(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function s(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?a(u.value):i(u.value).then(s,c)}l((r=r.apply(t,e||[])).next())})}function $f(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Dn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof $f=="function"?$f(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(a){n[a]=t[a]&&function(o){return new Promise(function(s,c){o=t[a](o),i(s,c,o.done,o.value)})}}function i(a,o,s,c){Promise.resolve(c).then(function(l){a({value:l,done:s})},o)}}var Ro={exports:{}},Wf;function Nx(){if(Wf)return Ro.exports;Wf=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(v,C,T){return Function.prototype.apply.call(v,C,T)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:n=function(v){return Object.getOwnPropertyNames(v)};function r(v){console&&console.warn&&console.warn(v)}var i=Number.isNaN||function(v){return v!==v};function a(){a.init.call(this)}Ro.exports=a,Ro.exports.once=f,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var o=10;function s(v){if(typeof v!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof v)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(v){if(typeof v!="number"||v<0||i(v))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+v+".");o=v}}),a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(v){if(typeof v!="number"||v<0||i(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this};function c(v){return v._maxListeners===void 0?a.defaultMaxListeners:v._maxListeners}a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(v){for(var C=[],T=1;T<arguments.length;T++)C.push(arguments[T]);var E=v==="error",x=this._events;if(x!==void 0)E=E&&x.error===void 0;else if(!E)return!1;if(E){var N;if(C.length>0&&(N=C[0]),N instanceof Error)throw N;var M=new Error("Unhandled error."+(N?" ("+N.message+")":""));throw M.context=N,M}var A=x[v];if(A===void 0)return!1;if(typeof A=="function")e(A,this,C);else for(var W=A.length,Q=b(A,W),T=0;T<W;++T)e(Q[T],this,C);return!0};function l(v,C,T,E){var x,N,M;if(s(T),N=v._events,N===void 0?(N=v._events=Object.create(null),v._eventsCount=0):(N.newListener!==void 0&&(v.emit("newListener",C,T.listener?T.listener:T),N=v._events),M=N[C]),M===void 0)M=N[C]=T,++v._eventsCount;else if(typeof M=="function"?M=N[C]=E?[T,M]:[M,T]:E?M.unshift(T):M.push(T),x=c(v),x>0&&M.length>x&&!M.warned){M.warned=!0;var A=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(C)+" listeners added. Use emitter.setMaxListeners() to increase limit");A.name="MaxListenersExceededWarning",A.emitter=v,A.type=C,A.count=M.length,r(A)}return v}a.prototype.addListener=function(v,C){return l(this,v,C,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(v,C){return l(this,v,C,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(v,C,T){var E={fired:!1,wrapFn:void 0,target:v,type:C,listener:T},x=u.bind(E);return x.listener=T,E.wrapFn=x,x}a.prototype.once=function(v,C){return s(C),this.on(v,d(this,v,C)),this},a.prototype.prependOnceListener=function(v,C){return s(C),this.prependListener(v,d(this,v,C)),this},a.prototype.removeListener=function(v,C){var T,E,x,N,M;if(s(C),E=this._events,E===void 0)return this;if(T=E[v],T===void 0)return this;if(T===C||T.listener===C)--this._eventsCount===0?this._events=Object.create(null):(delete E[v],E.removeListener&&this.emit("removeListener",v,T.listener||C));else if(typeof T!="function"){for(x=-1,N=T.length-1;N>=0;N--)if(T[N]===C||T[N].listener===C){M=T[N].listener,x=N;break}if(x<0)return this;x===0?T.shift():y(T,x),T.length===1&&(E[v]=T[0]),E.removeListener!==void 0&&this.emit("removeListener",v,M||C)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(v){var C,T,E;if(T=this._events,T===void 0)return this;if(T.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):T[v]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete T[v]),this;if(arguments.length===0){var x=Object.keys(T),N;for(E=0;E<x.length;++E)N=x[E],N!=="removeListener"&&this.removeAllListeners(N);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(C=T[v],typeof C=="function")this.removeListener(v,C);else if(C!==void 0)for(E=C.length-1;E>=0;E--)this.removeListener(v,C[E]);return this};function h(v,C,T){var E=v._events;if(E===void 0)return[];var x=E[C];return x===void 0?[]:typeof x=="function"?T?[x.listener||x]:[x]:T?w(x):b(x,x.length)}a.prototype.listeners=function(v){return h(this,v,!0)},a.prototype.rawListeners=function(v){return h(this,v,!1)},a.listenerCount=function(v,C){return typeof v.listenerCount=="function"?v.listenerCount(C):p.call(v,C)},a.prototype.listenerCount=p;function p(v){var C=this._events;if(C!==void 0){var T=C[v];if(typeof T=="function")return 1;if(T!==void 0)return T.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function b(v,C){for(var T=new Array(C),E=0;E<C;++E)T[E]=v[E];return T}function y(v,C){for(;C+1<v.length;C++)v[C]=v[C+1];v.pop()}function w(v){for(var C=new Array(v.length),T=0;T<C.length;++T)C[T]=v[T].listener||v[T];return C}function f(v,C){return new Promise(function(T,E){function x(M){v.removeListener(C,N),E(M)}function N(){typeof v.removeListener=="function"&&v.removeListener("error",x),T([].slice.call(arguments))}m(v,C,N,{once:!0}),C!=="error"&&g(v,x,{once:!0})})}function g(v,C,T){typeof v.on=="function"&&m(v,"error",C,T)}function m(v,C,T,E){if(typeof v.on=="function")E.once?v.once(C,T):v.on(C,T);else if(typeof v.addEventListener=="function")v.addEventListener(C,function x(N){E.once&&v.removeEventListener(C,x),T(N)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof v)}return Ro.exports}var cn=Nx();let zb=!0,Vb=!0;function es(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseInt(r[n],10)}function Dr(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,s){if(o!==e)return i.apply(this,arguments);const c=l=>{const u=n(l);u&&(s.handleEvent?s.handleEvent(u):s(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(s,c),i.apply(this,[o,c])};const a=r.removeEventListener;r.removeEventListener=function(o,s){if(o!==e||!this._eventMap||!this._eventMap[e])return a.apply(this,arguments);if(!this._eventMap[e].has(s))return a.apply(this,arguments);const c=this._eventMap[e].get(s);return this._eventMap[e].delete(s),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function Mx(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(zb=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Lx(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Vb=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Hb(){if(typeof window=="object"){if(zb)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Th(t,e){Vb&&console.warn(t+" is deprecated, please use "+e+" instead.")}function Dx(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(i=>i.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=es(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=es(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=es(n.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function Kf(t){return Object.prototype.toString.call(t)==="[object Object]"}function qb(t){return Kf(t)?Object.keys(t).reduce(function(e,n){const r=Kf(t[n]),i=r?qb(t[n]):t[n],a=r&&!Object.keys(i).length;return i===void 0||a?e:Object.assign(e,{[n]:i})},{}):t}function Mu(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?Mu(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(i=>{Mu(t,t.get(i),n)})}))}function Gf(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const a=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&a.push(o)}),a.forEach(o=>{t.forEach(s=>{s.type===r&&s.trackId===o.id&&Mu(t,s,i)})}),i}const Zf=Hb;function $b(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(s){if(typeof s!="object"||s.mandatory||s.optional)return s;const c={};return Object.keys(s).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof s[l]=="object"?s[l]:{ideal:s[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(h,p){return h?h+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(u.ideal!==void 0){c.optional=c.optional||[];let h={};typeof u.ideal=="number"?(h[d("min",l)]=u.ideal,c.optional.push(h),h={},h[d("max",l)]=u.ideal,c.optional.push(h)):(h[d("",l)]=u.ideal,c.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",l)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(h,l)]=u[h])})}),s.advanced&&(c.optional=(c.optional||[]).concat(s.advanced)),c},i=function(s,c){if(e.version>=61)return c(s);if(s=JSON.parse(JSON.stringify(s)),s&&typeof s.audio=="object"){const l=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])};s=JSON.parse(JSON.stringify(s)),l(s.audio,"autoGainControl","googAutoGainControl"),l(s.audio,"noiseSuppression","googNoiseSuppression"),s.audio=r(s.audio)}if(s&&typeof s.video=="object"){let l=s.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete s.video.facingMode;let d;if(l.exact==="environment"||l.ideal==="environment"?d=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(b=>b.kind==="videoinput");let p=h.find(b=>d.some(y=>b.label.toLowerCase().includes(y)));return!p&&h.length&&d.includes("back")&&(p=h[h.length-1]),p&&(s.video.deviceId=l.exact?{exact:p.deviceId}:{ideal:p.deviceId}),s.video=r(s.video),Zf("chrome: "+JSON.stringify(s)),c(s)})}s.video=r(s.video)}return Zf("chrome: "+JSON.stringify(s)),c(s)},a=function(s){return e.version>=64?s:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s.name]||s.name,message:s.message,constraint:s.constraint||s.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(s,c,l){i(s,u=>{n.webkitGetUserMedia(u,c,d=>{l&&l(a(d))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return i(c,l=>s(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(a(u))))}}}function Wb(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Kb(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(o=>o.track&&o.track.id===r.track.id):i={track:r.track};const a=new Event("track");a.track=r.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[n.stream],this.dispatchEvent(a)}),n.stream.getTracks().forEach(r=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(o=>o.track&&o.track.id===r.id):i={track:r};const a=new Event("track");a.track=r,a.receiver=i,a.transceiver={receiver:i},a.streams=[n.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Dr(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Gb(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=i.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,s){let c=i.apply(this,arguments);return c||(c=e(this,o),this._senders.push(c)),c};const a=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){a.apply(this,arguments);const s=this._senders.indexOf(o);s!==-1&&this._senders.splice(s,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(a=>{const o=this._senders.find(s=>s.track===a);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Zb(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(a=>a._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(a=>Gf(a,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Dr(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(i=>Gf(i,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let r,i,a;return this.getSenders().forEach(o=>{o.track===n&&(r?a=!0:r=o)}),this.getReceivers().forEach(o=>(o.track===n&&(i?a=!0:i=o),o.track===n)),a||r&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Jb(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,o){if(!o)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const s=e.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(s)===-1&&this._shimmedLocalStreams[o.id].push(s):this._shimmedLocalStreams[o.id]=[o,s],s};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(c=>{if(this.getSenders().find(l=>l.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();n.apply(this,arguments);const s=this.getSenders().filter(c=>o.indexOf(c)===-1);this._shimmedLocalStreams[a.id]=[a].concat(s)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],r.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const s=this._shimmedLocalStreams[o].indexOf(a);s!==-1&&this._shimmedLocalStreams[o].splice(s,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),i.apply(this,arguments)}}function Qb(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Jb(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const l=n.apply(this);return this._reverseStreams=this._reverseStreams||{},l.map(u=>this._reverseStreams[u.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(l){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(u=>{if(this.getSenders().find(d=>d.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){const u=new t.MediaStream(l.getTracks());this._streams[l.id]=u,this._reverseStreams[u.id]=l,l=u}r.apply(this,[l])};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},t.RTCPeerConnection.prototype.addTrack=function(l,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(p=>p===l))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(p=>p.track===l))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const h=this._streams[u.id];if(h)h.addTrack(l),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const p=new t.MediaStream([l]);this._streams[u.id]=p,this._reverseStreams[p.id]=u,this.addStream(p)}return this.getSenders().find(p=>p.track===l)};function a(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const p=l._reverseStreams[h],b=l._streams[p.id];d=d.replace(new RegExp(b.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const p=l._reverseStreams[h],b=l._streams[p.id];d=d.replace(new RegExp(p.id,"g"),b.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(l){const u=t.RTCPeerConnection.prototype[l],d={[l](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[p=>{const b=a(this,p);h[0].apply(null,[b])},p=>{h[1]&&h[1].apply(null,p)},arguments[2]]):u.apply(this,arguments).then(p=>a(this,p))}};t.RTCPeerConnection.prototype[l]=d[l]});const s=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?s.apply(this,arguments):(arguments[0]=o(this,arguments[0]),s.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:a(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(l._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let u;Object.keys(this._streams).forEach(d=>{this._streams[d].getTracks().find(h=>l.track===h)&&(u=this._streams[d])}),u&&(u.getTracks().length===1?this.removeStream(this._reverseStreams[u.id]):u.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Lu(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=i[n]})}function Yb(t,e){Dr(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}var Jf=Object.freeze({__proto__:null,fixNegotiationNeeded:Yb,shimAddTrackRemoveTrack:Qb,shimAddTrackRemoveTrackWithNative:Jb,shimGetSendersWithDtmf:Gb,shimGetUserMedia:$b,shimMediaStream:Wb,shimOnTrack:Kb,shimPeerConnection:Lu,shimSenderReceiverGetStats:Zb});function Xb(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(i,a,o){Th("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(a,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(o,s,c){s in o&&!(c in o)&&(o[c]=o[s],delete o[s])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),a(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const s=o.apply(this,arguments);return i(s,"mozAutoGainControl","autoGainControl"),i(s,"mozNoiseSuppression","noiseSuppression"),s}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(s){return this.kind==="audio"&&typeof s=="object"&&(s=JSON.parse(JSON.stringify(s)),i(s,"autoGainControl","mozAutoGainControl"),i(s,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[s])}}}}function jx(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!(n&&n.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})}function ey(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Du(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const a=t.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=o[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,a,o]=arguments;return r.apply(this,[i||null]).then(s=>{if(e.version<53&&!a)try{s.forEach(c=>{c.type=n[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;s.forEach((l,u)=>{s.set(u,Object.assign({},l,{type:n[l.type]||l.type}))})}return s}).then(a,o)}}function ty(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ny(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n}),Dr(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ry(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){Th("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&e.getTracks().includes(n.track)&&this.removeTrack(n)})})}function iy(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function ay(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(r){const{sender:a}=i,o=a.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=n,a.sendEncodings=n,this.setParametersPromises.push(a.setParameters(o).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return i})}function oy(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function sy(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function cy(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Qf=Object.freeze({__proto__:null,shimAddTransceiver:ay,shimCreateAnswer:cy,shimCreateOffer:sy,shimGetDisplayMedia:jx,shimGetParameters:oy,shimGetUserMedia:Xb,shimOnTrack:ey,shimPeerConnection:Du,shimRTCDataChannel:iy,shimReceiverGetStats:ny,shimRemoveStream:ry,shimSenderGetStats:ty});function ly(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>e.call(this,r,n)),n.getVideoTracks().forEach(r=>e.call(this,r,n))},t.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return i&&i.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const r=e.getTracks();this.getSenders().forEach(i=>{r.includes(i.track)&&this.removeTrack(i)})})}}function uy(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const a=new Event("addstream");a.stream=i,this.dispatchEvent(a)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);const a=new Event("addstream");a.stream=i,n.dispatchEvent(a)})}),e.apply(n,arguments)}}}function dy(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,a=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(c,l){const u=arguments.length>=2?arguments[2]:arguments[0],d=n.apply(this,[u]);return l?(d.then(c,l),Promise.resolve()):d},e.createAnswer=function(c,l){const u=arguments.length>=2?arguments[2]:arguments[0],d=r.apply(this,[u]);return l?(d.then(c,l),Promise.resolve()):d};let s=function(c,l,u){const d=i.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d};e.setLocalDescription=s,s=function(c,l,u){const d=a.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.setRemoteDescription=s,s=function(c,l,u){const d=o.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.addIceCandidate=s}function hy(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=i=>r(py(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,r,i){e.mediaDevices.getUserMedia(n).then(r,i)}).bind(e))}function py(t){return t&&t.video!==void 0?Object.assign({},t,{video:qb(t.video)}):t}function fy(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const i=[];for(let a=0;a<n.iceServers.length;a++){let o=n.iceServers[a];o.urls===void 0&&o.url?(Th("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,i.push(o)):i.push(n.iceServers[a])}n.iceServers=i}return new e(n,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function my(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function gy(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){typeof n.offerToReceiveAudio<"u"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof n.offerToReceiveVideo<"u"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function vy(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Yf=Object.freeze({__proto__:null,shimAudioContext:vy,shimCallbacksAPI:dy,shimConstraints:py,shimCreateOfferLegacy:gy,shimGetUserMedia:hy,shimLocalStreamsAPI:ly,shimRTCIceServerUrls:fy,shimRemoteStreamsAPI:uy,shimTrackEventTransceiver:my}),Xf={exports:{}},em;function Ax(){return em||(em=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let a=8;a<r.length;a+=2)switch(r[a]){case"raddr":i.relatedAddress=r[a+1];break;case"rport":i.relatedPort=parseInt(r[a+1],10);break;case"tcptype":i.tcpType=r[a+1];break;case"ufrag":i.ufrag=r[a+1],i.usernameFragment=r[a+1];break;default:i[r[a]]===void 0&&(i[r[a]]=r[a+1]);break}return i},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const a=n.type;return r.push("typ"),r.push(a),a!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let i;const a=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<a.length;o++)i=a[o].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const a=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?a.push(o+"="+n.parameters[o]):a.push(o)}),r+="a=fmtp:"+i+" "+a.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(a=>{r+="a=rtcp-fb:"+i+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},a=n.indexOf(":",r);return a>-1?(i.attribute=n.substring(r+1,a),i.value=n.substring(a+1)):i.attribute=n.substring(r+1),i},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(a=>{i+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),i},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const i=e.matchPrefix(n+r,"a=ice-ufrag:")[0],a=e.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&a?{usernameFragment:i.substring(12),password:a.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(n)[0].split(" ");r.profile=i[2];for(let o=3;o<i.length;o++){const s=i[o],c=e.matchPrefix(n,"a=rtpmap:"+s+" ")[0];if(c){const l=e.parseRtpMap(c),u=e.matchPrefix(n,"a=fmtp:"+s+" ");switch(l.parameters=u.length?e.parseFmtp(u[0]):{},l.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+s+" ").map(e.parseRtcpFb),r.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(l.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(o=>{r.headerExtensions.push(e.parseExtmap(o))});const a=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(o=>{a.forEach(s=>{o.rtcpFeedback.find(c=>c.type===s.type&&c.parameter===s.parameter)||o.rtcpFeedback.push(s)})}),r},e.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{i+=e.writeRtpMap(o),i+=e.writeFmtp(o),i+=e.writeRtcpFb(o)});let a=0;return r.codecs.forEach(o=>{o.maxptime>a&&(a=o.maxptime)}),a>0&&(i+="a=maxptime:"+a+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{i+=e.writeExtmap(o)}),i},e.parseRtpEncodingParameters=function(n){const r=[],i=e.parseRtpParameters(n),a=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,s=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=s.length>0&&s[0].ssrc;let l;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(p=>parseInt(p,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),i.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let p={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&l&&(p.rtx={ssrc:l}),r.push(p),a&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(p))}}),r.length===0&&c&&r.push({ssrc:c});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,r.forEach(h=>{h.maxBitrate=d})),r},e.parseRtcpParameters=function(n){const r={},i=e.matchPrefix(n,"a=ssrc:").map(s=>e.parseSsrcMedia(s)).filter(s=>s.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const a=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=a.length>0,r.compound=a.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const i=e.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const a=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(a.length>0)return r=a[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),i=e.matchPrefix(n,"a=max-message-size:");let a;i.length>0&&(a=parseInt(i[0].substring(19),10)),isNaN(a)&&(a=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:a};const s=e.matchPrefix(n,"a=sctpmap:");if(s.length>0){const c=s[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:a}}},e.writeSctpDescription=function(n,r){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,i){let a;const o=r!==void 0?r:2;return n?a=n:a=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+a+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const i=e.splitLines(n);for(let a=0;a<i.length;a++)switch(i[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[a].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},t.exports=e}(Xf)),Xf.exports}var by=Ax(),gi=Sx(by),Ux=ZS({__proto__:null,default:gi},[by]);function ts(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substring(2)),n.candidate&&n.candidate.length){const r=new e(n),i=gi.parseCandidate(n.candidate);for(const a in i)a in r||Object.defineProperty(r,a,{value:i[a]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,Dr(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function ju(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Dr(t,"icecandidate",e=>{if(e.candidate){const n=gi.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function ns(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(s){if(!s||!s.sdp)return!1;const c=gi.splitSections(s.sdp);return c.shift(),c.some(l=>{const u=gi.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(s){const c=s.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},i=function(s){let c=65536;return e.browser==="firefox"&&(e.version<57?s===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},a=function(s,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=gi.matchPrefix(s.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:s}=this.getConfiguration();s==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const s=r(arguments[0]),c=i(s),l=a(arguments[0],s);let u;c===0&&l===0?u=Number.POSITIVE_INFINITY:c===0||l===0?u=Math.max(c,l):u=Math.min(c,l);const d={};Object.defineProperty(d,"maxMessageSize",{get(){return u}}),this._sctp=d}return o.apply(this,arguments)}}function rs(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,i){const a=r.send;r.send=function(){const o=arguments[0],s=o.length||o.size||o.byteLength;if(r.readyState==="open"&&i.sctp&&s>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return a.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Dr(t,"datachannel",r=>(e(r.channel,r.target),r))}function Au(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const a=i.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const o=new Event("connectionstatechange",i);a.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Uu(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return n.apply(this,arguments)}}function is(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function as(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>n.apply(this,[i]))})}var Fx=Object.freeze({__proto__:null,removeExtmapAllowMixed:Uu,shimAddIceCandidateNullOrEmpty:is,shimConnectionState:Au,shimMaxMessageSize:ns,shimParameterlessSetLocalDescription:as,shimRTCIceCandidate:ts,shimRTCIceCandidateRelayProtocol:ju,shimSendThrowTypeError:rs});function Bx(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Hb,r=Dx(t),i={browserDetails:r,commonShim:Fx,extractVersion:es,disableLog:Mx,disableWarnings:Lx,sdp:Ux};switch(r.browser){case"chrome":if(!Jf||!Lu||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=Jf,is(t,r),as(t),$b(t,r),Wb(t),Lu(t,r),Kb(t),Qb(t,r),Gb(t),Zb(t),Yb(t,r),ts(t),ju(t),Au(t),ns(t,r),rs(t),Uu(t,r);break;case"firefox":if(!Qf||!Du||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=Qf,is(t,r),as(t),Xb(t,r),Du(t,r),ey(t),ry(t),ty(t),ny(t),iy(t),ay(t),oy(t),sy(t),cy(t),ts(t),Au(t),ns(t,r),rs(t);break;case"safari":if(!Yf||!e.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=Yf,is(t,r),as(t),fy(t),gy(t),dy(t),ly(t),uy(t),my(t),hy(t),vy(t),ts(t),ju(t),ns(t,r),rs(t),Uu(t,r);break;default:n("Unsupported browser!");break}return i}Bx({window:typeof window>"u"?void 0:window});const zx=10,Io="lk_e2ee",Vx="LKFrameEncryptionKey",Hx={sharedKey:!1,ratchetSalt:Vx,ratchetWindowSize:8,failureTolerance:zx,keyringSize:16};var Zn;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(Zn||(Zn={}));var tm;(function(t){t.KeyRatcheted="keyRatcheted"})(tm||(tm={}));var Bn;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(Bn||(Bn={}));var nm;(function(t){t.Error="cryptorError"})(nm||(nm={}));function qx(){return $x()||Fu()}function Fu(){return typeof window.RTCRtpScriptTransform<"u"}function $x(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class _5 extends cn.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,r)=>{X.debug("key ratcheted event received",{material:n,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},Hx),e),this.on(Zn.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,r){const i={key:e,participantIdentity:n,keyIndex:r};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(r??0),i),this.emit(Zn.SetKey,i)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Zn.RatchetRequest,e,n)}}class ir extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var ee;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest"})(ee||(ee={}));class de extends ir{constructor(e,n,r,i){super(1,e),this.name="ConnectionError",this.status=r,this.reason=n,this.context=i,this.reasonName=ee[n]}}class xh extends ir{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class fn extends ir{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class Wx extends ir{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Ne extends ir{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class Bu extends ir{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class Kx extends ir{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class rm extends ir{constructor(e,n){super(15,e),this.reason=n,this.reasonName=typeof n=="string"?n:Sh[n]}}var $s;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})($s||($s={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})($s||($s={}));var im;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(im||(im={}));var j;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(j||(j={}));var z;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage"})(z||(z={}));var B;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse"})(B||(B={}));var U;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate"})(U||(U={}));function Gx(t){if(!(typeof t>"u"))return typeof structuredClone=="function"?structuredClone(t):JSON.parse(JSON.stringify(t))}const Zx=/version\/(\d+(\.?_?\d+)+)/i;let ul;function Gt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(ul===void 0||e){const r=Jx.find(i=>{let{test:a}=i;return a.test(n)});ul=r==null?void 0:r.describe(n)}return ul}const Jx=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:os(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:dl(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:os(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:dl(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:os(Zx,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:dl(t)}}}];function os(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=e.match(t);return r&&r.length>=n&&r[n]||""}function dl(t){return t.includes("mac os")?os(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var Qx="2.10.0";const Yx=Qx,Xx=15;class He{}He.setTimeout=function(){return setTimeout(...arguments)};He.setInterval=function(){return setInterval(...arguments)};He.clearTimeout=function(){return clearTimeout(...arguments)};He.clearInterval=function(){return clearInterval(...arguments)};const e2=5e3,Zi=[];var Et;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(Et||(Et={}));class _ extends cn.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=_.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=X,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),e2):this.handleAppVisibilityChanged()},this.log=Sn((i=r.loggerName)!==null&&i!==void 0?i:Kt.Track),this.loggerContextCb=r.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=_.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),ae(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===_.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===_.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Zi.forEach(a=>{a.parentElement===null&&!e&&(e=a)}),e&&Zi.splice(Zi.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),ai(this.mediaStreamTrack,e);const r=e.srcObject.getTracks(),i=r.some(a=>a.kind==="audio");return e.play().then(()=>{this.emit(i?U.AudioPlaybackStarted:U.VideoPlaybackStarted)}).catch(a=>{a.name==="NotAllowedError"?this.emit(i?U.AudioPlaybackFailed:U.VideoPlaybackFailed,a):a.name==="AbortError"?X.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):X.warn("could not playback ".concat(i?"audio":"video"),a),i&&e&&r.some(o=>o.kind==="video")&&a.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(U.ElementAttached,e),e}detach(e){try{if(e){vi(this.mediaStreamTrack,e);const r=this.attachedElements.indexOf(e);return r>=0&&(this.attachedElements.splice(r,1),this.recycleElement(e),this.emit(U.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(r=>{vi(this.mediaStreamTrack,r),n.push(r),this.recycleElement(r),this.emit(U.ElementDetached,r)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Sn(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Zi.forEach(r=>{r.parentElement||(n=!1)}),n&&Zi.push(e)}}handleAppVisibilityChanged(){return S(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===_.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){lt()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){lt()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function ai(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let r;t.kind==="audio"?r=n.getAudioTracks():r=n.getVideoTracks(),r.includes(t)||(r.forEach(i=>{n.removeTrack(i)}),n.addTrack(t)),(!er()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(er()||Ii())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function vi(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=t.Source||(t.Source={}));let r;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(r=t.StreamState||(t.StreamState={}));function i(l){switch(l){case e.Audio:return zt.AUDIO;case e.Video:return zt.VIDEO;default:return zt.DATA}}t.kindToProto=i;function a(l){switch(l){case zt.AUDIO:return e.Audio;case zt.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=a;function o(l){switch(l){case n.Camera:return Ie.CAMERA;case n.Microphone:return Ie.MICROPHONE;case n.ScreenShare:return Ie.SCREEN_SHARE;case n.ScreenShareAudio:return Ie.SCREEN_SHARE_AUDIO;default:return Ie.UNKNOWN}}t.sourceToProto=o;function s(l){switch(l){case Ie.CAMERA:return n.Camera;case Ie.MICROPHONE:return n.Microphone;case Ie.SCREEN_SHARE:return n.ScreenShare;case Ie.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=s;function c(l){switch(l){case Ru.ACTIVE:return r.Active;case Ru.PAUSED:return r.Paused;default:return r.Unknown}}t.streamStateFromProto=c})(_||(_={}));class ce{constructor(e,n,r,i,a){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&r!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:r,maxFramerate:i,priority:a};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const t2=["vp8","h264"],n2=["vp8","h264","vp9","av1"];function r2(t){return!!t2.find(e=>e===t)}var am;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(am||(am={}));var zu;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(zu||(zu={}));const Ga={h90:new ce(160,90,9e4,20),h180:new ce(320,180,16e4,20),h216:new ce(384,216,18e4,20),h360:new ce(640,360,45e4,20),h540:new ce(960,540,8e5,25),h720:new ce(1280,720,17e5,30),h1080:new ce(1920,1080,3e6,30),h1440:new ce(2560,1440,5e6,30),h2160:new ce(3840,2160,8e6,30)},Vu={h120:new ce(160,120,7e4,20),h180:new ce(240,180,125e3,20),h240:new ce(320,240,14e4,20),h360:new ce(480,360,33e4,20),h480:new ce(640,480,5e5,20),h540:new ce(720,540,6e5,25),h720:new ce(960,720,13e5,30),h1080:new ce(1440,1080,23e5,30),h1440:new ce(1920,1440,38e5,30)},Eh={h360fps3:new ce(640,360,2e5,3,"medium"),h360fps15:new ce(640,360,4e5,15,"medium"),h720fps5:new ce(1280,720,8e5,5,"medium"),h720fps15:new ce(1280,720,15e5,15,"medium"),h720fps30:new ce(1280,720,2e6,30,"medium"),h1080fps15:new ce(1920,1080,25e5,15,"medium"),h1080fps30:new ce(1920,1080,5e6,30,"medium"),original:new ce(0,0,7e6,30,"medium")},i2="|",om="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function a2(t){const e=t.split(i2);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function pt(t){return S(this,void 0,void 0,function*(){return new Promise(e=>He.setTimeout(e,t))})}function Hu(){return"addTransceiver"in RTCPeerConnection.prototype}function qu(){return"addTrack"in RTCPeerConnection.prototype}function o2(){if(!("getCapabilities"in RTCRtpSender)||er())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/AV1"){e=!0;break}}return e}function s2(){if(!("getCapabilities"in RTCRtpSender)||Ii())return!1;if(er()){const n=Gt();if(n!=null&&n.version&&Or(n.version,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/VP9"){e=!0;break}}return e}function va(t){return t==="av1"||t==="vp9"}function $u(t){return document?(t||(t=document.createElement("audio")),"setSinkId"in t):!1}function c2(){return typeof RTCPeerConnection>"u"?!1:Hu()||qu()}function Ii(){var t;return((t=Gt())===null||t===void 0?void 0:t.name)==="Firefox"}function er(){var t;return((t=Gt())===null||t===void 0?void 0:t.name)==="Safari"}function l2(){const t=Gt();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")}function yy(){var t,e;return lt()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function u2(){const t=Gt(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&Or(e,t.osVersion)>=0?!0:t.name==="Safari"&&Or(e,t.version)>=0}function lt(){return typeof document<"u"}function sn(){return navigator.product=="ReactNative"}function Wu(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function ky(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function wy(){if(!sn())return;let t=ky();if(t)return t.platform}function sm(){if(lt())return window.devicePixelRatio;if(sn()){let t=ky();if(t)return t.devicePixelRatio}return 1}function Or(t,e){const n=t.split("."),r=e.split("."),i=Math.min(n.length,r.length);for(let a=0;a<i;++a){const o=parseInt(n[a],10),s=parseInt(r[a],10);if(o>s)return 1;if(o<s)return-1;if(a===i-1&&o===s)return 0}return t===""&&e!==""?-1:e===""?1:n.length==r.length?0:n.length<r.length?-1:1}function d2(t){for(const e of t)e.target.handleResize(e)}function h2(t){for(const e of t)e.target.handleVisibilityChanged(e)}let hl=null;const cm=()=>(hl||(hl=new ResizeObserver(d2)),hl);let pl=null;const lm=()=>(pl||(pl=new IntersectionObserver(h2,{root:null,rootMargin:"0px"})),pl);function p2(){var t;const e=new XT({sdk:Eb.JS,protocol:Xx,version:Yx});return sn()&&(e.os=(t=wy())!==null&&t!==void 0?t:""),e}function um(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=document.createElement("canvas");i.width=t,i.height=e;const a=i.getContext("2d");a==null||a.fillRect(0,0,i.width,i.height),r&&a&&(a.beginPath(),a.arc(t/2,e/2,50,0,Math.PI*2,!0),a.closePath(),a.fillStyle="grey",a.fill());const o=i.captureStream(),[s]=o.getTracks();if(!s)throw Error("Could not get empty media stream video track");return s.enabled=n,s}let Ji;function fl(){if(!Ji){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const r=t.createMediaStreamDestination();if(e.connect(n),n.connect(r),e.start(),[Ji]=r.stream.getAudioTracks(),!Ji)throw Error("Could not get empty media stream audio track");Ji.enabled=!1}return Ji.clone()}class Cy{constructor(e,n){this.onFinally=n,this.promise=new Promise((r,i)=>S(this,void 0,void 0,function*(){this.resolve=r,this.reject=i,e&&(yield e(r,i))})).finally(()=>{var r;return(r=this.onFinally)===null||r===void 0?void 0:r.call(this)})}}function f2(t){return n2.includes(t)}function Jn(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function Ku(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function m2(t,e){return t.segments.map(n=>{let{id:r,text:i,language:a,startTime:o,endTime:s,final:c}=n;var l;const u=(l=e.get(r))!==null&&l!==void 0?l:Date.now(),d=Date.now();return c?e.delete(r):e.set(r,u),{id:r,text:i,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(s.toString()),final:c,language:a,firstReceivedTime:u,lastReceivedTime:d}})}function g2(t){const{id:e,timestamp:n,message:r,editTimestamp:i}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:i?Number.parseInt(i.toString()):void 0,message:r}}function dm(t){switch(t.reason){case ee.LeaveRequest:return t.context;case ee.Cancelled:return Ht.CLIENT_INITIATED;case ee.NotAllowed:return Ht.USER_REJECTED;case ee.ServerUnreachable:return Ht.JOIN_FAILURE;default:return Ht.UNKNOWN_REASON}}function ss(t){return t!==void 0?Number(t):void 0}function dr(t){return t!==void 0?BigInt(t):void 0}function bi(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function Tn(t){return!!t&&t.kind==_.Kind.Audio}function Di(t){return!!t&&t.kind==_.Kind.Video}function Rn(t){return bi(t)&&Di(t)}function hr(t){return bi(t)&&Tn(t)}function Gu(t){return!!t&&!t.isLocal}function v2(t){return!!t&&!t.isLocal}function ml(t){return Gu(t)&&Di(t)}function b2(t){return t.isLocal}function y2(t,e){const n=[];let r=new TextEncoder().encode(t);for(;r.length>e;){let i=e;for(;i>0;){const a=r[i];if(a!==void 0&&(a&192)!==128)break;i--}n.push(r.slice(0,i)),r=r.slice(i)}return r.length>0&&n.push(r),n}function Sy(t,e,n){var r,i,a,o,s;const{optionsWithoutProcessor:c,audioProcessor:l,videoProcessor:u}=Ph(t??{}),d=e==null?void 0:e.processor,h=n==null?void 0:n.processor,p=(r=Gx(c))!==null&&r!==void 0?r:{};return p.audio===!0&&(p.audio={}),p.video===!0&&(p.video={}),p.audio&&(Zu(p.audio,e),(i=(o=p.audio).deviceId)!==null&&i!==void 0||(o.deviceId="default"),(l||d)&&(p.audio.processor=l??d)),p.video&&(Zu(p.video,n),(a=(s=p.video).deviceId)!==null&&a!==void 0||(s.deviceId="default"),(u||h)&&(p.video.processor=u??h)),p}function Zu(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function Tc(t){var e,n,r,i;const a={};if(t.video)if(typeof t.video=="object"){const o={},s=o,c=t.video;Object.keys(c).forEach(l=>{switch(l){case"resolution":Zu(s,c.resolution);break;default:s[l]=c[l]}}),a.video=o,(e=(r=a.video).deviceId)!==null&&e!==void 0||(r.deviceId="default")}else a.video=t.video?{deviceId:"default"}:!1;else a.video=!1;return t.audio?typeof t.audio=="object"?(a.audio=t.audio,(n=(i=a.audio).deviceId)!==null&&n!==void 0||(i.deviceId="default")):a.audio={deviceId:"default"}:a.audio=!1,a}function Ty(t){return S(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const r=xy();if(r){const i=r.createAnalyser();i.fftSize=2048;const a=i.frequencyBinCount,o=new Uint8Array(a);r.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield pt(n),i.getByteTimeDomainData(o);const s=o.some(c=>c!==128&&c!==0);return r.close(),!s}return!1}()})}function xy(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&!((t=window.document)===null||t===void 0)&&t.body){const r=()=>S(this,void 0,void 0,function*(){var i;try{n.state==="suspended"&&(yield n.resume())}catch(a){console.warn("Error trying to auto-resume audio context",a)}(i=window.document.body)===null||i===void 0||i.removeEventListener("click",r)});window.document.body.addEventListener("click",r)}return n}}function hm(t){return t===_.Source.Microphone?"audioinput":t===_.Source.Camera?"videoinput":void 0}function k2(t){var e,n;let r=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(r=typeof r=="boolean"?{}:r,er()?r=Object.assign(Object.assign({},r),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):r=Object.assign(Object.assign({},r),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:r,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function cs(t){return t.split("/")[1].toLowerCase()}function w2(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new wh({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function ae(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?ae(t.track):{})}}function C2(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function S2(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const r=[...Object.keys(e),...Object.keys(t)],i={};for(const a of r)t[a]!==e[a]&&(i[a]=(n=e[a])!==null&&n!==void 0?n:"");return i}function Ph(t){const e=Object.assign({},t);let n,r;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(r=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:r,optionsWithoutProcessor:e}}function T2(t){switch(t){case Ie.CAMERA:return _.Source.Camera;case Ie.MICROPHONE:return _.Source.Microphone;case Ie.SCREEN_SHARE:return _.Source.ScreenShare;case Ie.SCREEN_SHARE_AUDIO:return _.Source.ScreenShareAudio;default:return _.Source.Unknown}}class x2 extends cn.EventEmitter{constructor(e){super(),this.onWorkerMessage=n=>{var r,i;const{kind:a,data:o}=n.data;switch(a){case"error":X.error(o.error.message),this.emit(Bn.EncryptionError,o.error);break;case"initAck":o.enabled&&this.keyProvider.getKeys().forEach(s=>{this.postKey(s)});break;case"enable":if(o.enabled&&this.keyProvider.getKeys().forEach(s=>{this.postKey(s)}),this.encryptionEnabled!==o.enabled&&o.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(Bn.ParticipantEncryptionStatusChanged,o.enabled,this.room.localParticipant),this.encryptionEnabled=o.enabled;else if(o.participantIdentity){const s=(i=this.room)===null||i===void 0?void 0:i.getParticipantByIdentity(o.participantIdentity);if(!s)throw TypeError("couldn't set encryption status, participant not found".concat(o.participantIdentity));this.emit(Bn.ParticipantEncryptionStatusChanged,o.enabled,s)}break;case"ratchetKey":this.keyProvider.emit(Zn.KeyRatcheted,o.material,o.keyIndex);break}},this.onWorkerError=n=>{X.error("e2ee worker encountered an error:",{error:n.error}),this.emit(Bn.EncryptionError,n.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!qx())throw new xh("tried to setup end-to-end encryption on an unsupported browser");if(X.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:Rx.getLevel()}};this.worker&&(X.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){X.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?X.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(B.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(j.TrackPublished,(r,i)=>this.setParticipantCryptorEnabled(r.trackInfo.encryption!==mt.NONE,i.identity)),e.on(j.ConnectionStateChanged,r=>{r===re.Connected&&e.remoteParticipants.forEach(i=>{i.trackPublications.forEach(a=>{this.setParticipantCryptorEnabled(a.trackInfo.encryption!==mt.NONE,i.identity)})})}).on(j.TrackUnsubscribed,(r,i,a)=>{var o;const s={kind:"removeTransform",data:{participantIdentity:a.identity,trackId:r.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(s)}).on(j.TrackSubscribed,(r,i,a)=>{this.setupE2EEReceiver(r,a.identity,i.trackInfo)}).on(j.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(r=>{this.postKey(r)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(z.LocalTrackPublished,r=>S(this,void 0,void 0,function*(){this.setupE2EESender(r.track,r.track.sender)})),n.on(Zn.SetKey,r=>this.postKey(r)).on(Zn.RatchetRequest,(r,i)=>this.postRatchetRequest(r,i))}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const r={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(r)}postKey(e){let{key:n,participantIdentity:r,keyIndex:i}=e;var a;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:r,isPublisher:r===((a=this.room)===null||a===void 0?void 0:a.localParticipant.identity),key:n,keyIndex:i}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const r={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(r)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const r={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,r){if(e.receiver){if(!(r!=null&&r.mimeType)||r.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?cs(r.mimeType):void 0)}}setupE2EESender(e,n){if(!bi(e)||!n){n||X.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,r,i){return S(this,void 0,void 0,function*(){if(this.worker){if(Fu()){const a={kind:"decode",participantIdentity:r,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,a)}else{if(Io in e&&i){const c={kind:"updateCodec",data:{trackId:n,codec:i,participantIdentity:r}};this.worker.postMessage(c);return}let a=e.writableStream,o=e.readableStream;if(!a||!o){const c=e.createEncodedStreams();e.writableStream=c.writable,a=c.writable,e.readableStream=c.readable,o=c.readable}const s={kind:"decode",data:{readableStream:o,writableStream:a,trackId:n,codec:i,participantIdentity:r}};this.worker.postMessage(s,[o,a])}e[Io]=!0}})}handleSender(e,n,r){var i;if(!(Io in e||!this.worker)){if(!(!((i=this.room)===null||i===void 0)&&i.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Fu()){X.info("initialize script transform");const a={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,a)}else{X.info("initialize encoded streams");const a=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:a.readable,writableStream:a.writable,codec:r,trackId:n,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(o,[a.readable,a.writable])}e[Io]=!0}}}const gl="default";class Ae{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Ae),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return S(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var a;if(((a=Ae.userMediaPromiseMap)===null||a===void 0?void 0:a.size)>0){X.debug("awaiting getUserMedia promise");try{n?yield Ae.userMediaPromiseMap.get(n):yield Promise.all(Ae.userMediaPromiseMap.values())}catch{X.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(i&&!(er()&&r.hasDeviceInUse(n))&&(o.filter(s=>s.kind===n).length===0||o.some(s=>{const c=s.label==="",l=n?s.kind===n:!0;return c&&l}))){const s={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:"default"}},c=yield navigator.mediaDevices.getUserMedia(s);o=yield navigator.mediaDevices.enumerateDevices(),c.getTracks().forEach(l=>{l.stop()})}return r._previousDevices=o,n&&(o=o.filter(s=>s.kind===n)),o}()})}normalizeDeviceId(e,n,r){return S(this,void 0,void 0,function*(){if(n!==gl)return n;const i=yield this.getDevices(e),a=i.find(s=>s.deviceId===gl);if(!a){X.warn("could not reliably determine default device");return}const o=i.find(s=>s.deviceId!==gl&&s.groupId===(r??a.groupId));if(!o){X.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?Ae.userMediaPromiseMap.has(e):Ae.userMediaPromiseMap.size>0}}Ae.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Ae.userMediaPromiseMap=new Map;var ba;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(ba||(ba={}));class E2{constructor(){this.pendingTasks=new Map,this.taskMutex=new vt,this.nextTaskIndex=0}run(e){return S(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:ba.WAITING};this.pendingTasks.set(n.id,n);const r=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=ba.RUNNING,yield e()}finally{n.status=ba.COMPLETED,this.pendingTasks.delete(n.id),r()}})}flush(){return S(this,void 0,void 0,function*(){return this.run(()=>S(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function P2(t,e){const n=new URL(t);return e.forEach((r,i)=>{n.searchParams.set(i,r)}),Ey(n,"rtc")}function R2(t){const e=new URL(Ku(t));return Ey(e,"validate")}function I2(t){return t.endsWith("/")?t:"".concat(t,"/")}function Ey(t,e){const n="".concat(t.protocol,"//").concat(t.host).concat(I2(t.pathname)).concat(e);return t.searchParams.size>0?"".concat(n,"?").concat(t.searchParams.toString()):n}const _2=["syncState","trickle","offer","answer","simulate","leave"];function O2(t){const e=_2.indexOf(t.case)>=0;return X.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var me;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(me||(me={}));class Rh{get currentState(){return this.state}get isDisconnected(){return this.state===me.DISCONNECTING||this.state===me.DISCONNECTED}get isEstablishingConnection(){return this.state===me.CONNECTING||this.state===me.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;this.rtt=0,this.state=me.DISCONNECTED,this.log=X,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=Sn((r=n.loggerName)!==null&&r!==void 0?r:Kt.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new E2,this.queuedRequests=[],this.closingLock=new vt,this.connectionLock=new vt,this.state=me.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,r,i){return S(this,void 0,void 0,function*(){return this.state=me.CONNECTING,this.options=r,yield this.connect(e,n,r,i)})}reconnect(e,n,r,i){return S(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=me.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:r,reconnectReason:i}))})}connect(e,n,r,i){this.connectOptions=r;const a=p2(),o=N2(n,a,r),s=P2(e,o),c=R2(s);return new Promise((l,u)=>S(this,void 0,void 0,function*(){const d=yield this.connectionLock.lock();try{const h=()=>S(this,void 0,void 0,function*(){this.close(),clearTimeout(p),u(new de("room connection has been cancelled (signal)",ee.Cancelled))}),p=setTimeout(()=>{this.close(),u(new de("room connection has timed out (signal)",ee.ServerUnreachable))},r.websocketTimeout);i!=null&&i.aborted&&h(),i==null||i.addEventListener("abort",h);const b=new URL(s);b.searchParams.has("access_token")&&b.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(b),Object.assign({reconnect:r.reconnect,reconnectReason:r.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(s),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(p)},this.ws.onerror=y=>S(this,void 0,void 0,function*(){if(this.state!==me.CONNECTED){this.state=me.DISCONNECTED,clearTimeout(p);try{const w=yield fetch(c);if(w.status.toFixed(0).startsWith("4")){const f=yield w.text();u(new de(f,ee.NotAllowed,w.status))}else u(new de("Encountered unknown websocket error during connection: ".concat(y.toString()),ee.InternalError,w.status))}catch(w){u(new de(w instanceof Error?w.message:"server was not reachable",ee.ServerUnreachable))}return}this.handleWSError(y)}),this.ws.onmessage=y=>S(this,void 0,void 0,function*(){var w,f,g;let m;if(typeof y.data=="string"){const v=JSON.parse(y.data);m=Hf.fromJson(v,{ignoreUnknownFields:!0})}else if(y.data instanceof ArrayBuffer)m=Hf.fromBinary(new Uint8Array(y.data));else{this.log.error("could not decode websocket message: ".concat(typeof y.data),this.logContext);return}if(this.state!==me.CONNECTED){let v=!1;if(((w=m.message)===null||w===void 0?void 0:w.case)==="join"?(this.state=me.CONNECTED,i==null||i.removeEventListener("abort",h),this.pingTimeoutDuration=m.message.value.pingTimeout,this.pingIntervalDuration=m.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),l(m.message.value)):this.state===me.RECONNECTING&&m.message.case!=="leave"?(this.state=me.CONNECTED,i==null||i.removeEventListener("abort",h),this.startPingInterval(),((f=m.message)===null||f===void 0?void 0:f.case)==="reconnect"?l(m.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),l(void 0),v=!0)):this.isEstablishingConnection&&m.message.case==="leave"?u(new de("Received leave request while trying to (re)connect",ee.LeaveRequest,void 0,m.message.value.reason)):r.reconnect||u(new de("did not receive join response, got ".concat((g=m.message)===null||g===void 0?void 0:g.case," instead"),ee.InternalError)),!v)return}this.signalLatency&&(yield pt(this.signalLatency)),this.handleSignalResponse(m)}),this.ws.onclose=y=>{this.isEstablishingConnection&&u(new de("Websocket got closed during a (re)connection attempt",ee.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:y.reason,code:y.code,wasClean:y.wasClean,state:this.state})),this.handleOnClose(y.reason)}}finally{d()}}))}close(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=me.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const i=new Promise(a=>{e.ws?e.ws.onclose=()=>{a()}:a()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([i,pt(250)])),e.ws=void 0}}finally{n&&(e.state=me.DISCONNECTED),r()}}()})}sendOffer(e){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Ws(e)})}sendAnswer(e){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Ws(e)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new yh({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new kh({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return S(this,arguments,void 0,function(r,i){var a=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const s=a.getNextRequestId();return yield a.sendRequest({case:"updateMetadata",value:new Lb({requestId:s,metadata:r,name:i,attributes:o})}),s}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new Mb({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new Ab({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:be.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Bb({timestamp:be.parse(Date.now()),rtt:be.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new Nb({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new Cc({reason:Ht.CLIENT_INITIATED,action:mi.DISCONNECT})})}sendRequest(e){return S(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!i&&!O2(n)&&r.state===me.RECONNECTING){r.queuedRequests.push(()=>S(r,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(i||(yield r.requestQueue.flush()),r.signalLatency&&(yield pt(r.signalLatency)),!r.ws||r.ws.readyState!==r.ws.OPEN){r.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),r.logContext);return}const a=new nx({message:n});try{r.useJSON?r.ws.send(a.toJsonString()):r.ws.send(a.toBinary())}catch(o){r.log.error("error sending signal message",Object.assign(Object.assign({},r.logContext),{error:o}))}}()})}handleSignalResponse(e){var n,r;const i=e.message;if(i==null){this.log.debug("received unsupported message",this.logContext);return}let a=!1;if(i.case==="answer"){const o=pm(i.value);this.onAnswer&&this.onAnswer(o)}else if(i.case==="offer"){const o=pm(i.value);this.onOffer&&this.onOffer(o)}else if(i.case==="trickle"){const o=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(o,i.value.target)}else i.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=i.value.participants)!==null&&n!==void 0?n:[]):i.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):i.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((r=i.value.speakers)!==null&&r!==void 0?r:[]):i.case==="leave"?this.onLeave&&this.onLeave(i.value):i.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):i.case==="roomUpdate"?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):i.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(i.value):i.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):i.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):i.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):i.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(i.value):i.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):i.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(i.value):i.case==="pong"||(i.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),a=!0):i.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(i.value):i.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));a||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return S(this,void 0,void 0,function*(){if(this.state===me.DISCONNECTED)return;const n=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=He.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&He.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=He.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&He.clearInterval(this.pingInterval)}}function pm(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function Ws(t){return new _r({sdp:t.sdp,type:t.type})}function N2(t,e,n){var r;const i=new URLSearchParams;return i.set("access_token",t),n.reconnect&&(i.set("reconnect","1"),n.sid&&i.set("sid",n.sid)),i.set("auto_subscribe",n.autoSubscribe?"1":"0"),i.set("sdk",sn()?"reactnative":"js"),i.set("version",e.version),i.set("protocol",e.protocol.toString()),e.deviceModel&&i.set("device_model",e.deviceModel),e.os&&i.set("os",e.os),e.osVersion&&i.set("os_version",e.osVersion),e.browser&&i.set("browser",e.browser),e.browserVersion&&i.set("browser_version",e.browserVersion),n.adaptiveStream&&i.set("adaptive_stream","1"),n.reconnectReason&&i.set("reconnect_reason",n.reconnectReason.toString()),!((r=navigator.connection)===null||r===void 0)&&r.type&&i.set("network",navigator.connection.type),i}var Lt={},fm={},vl={exports:{}},mm;function Ih(){if(mm)return vl.exports;mm=1;var t=vl.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(r){r.reg||(r.reg=/(.*)/),r.format||(r.format="%s")})}),vl.exports}var gm;function M2(){return gm||(gm=1,function(t){var e=function(s){return String(Number(s))===s?Number(s):s},n=function(s,c,l,u){if(u&&!l)c[u]=e(s[1]);else for(var d=0;d<l.length;d+=1)s[d+1]!=null&&(c[l[d]]=e(s[d+1]))},r=function(s,c,l){var u=s.name&&s.names;s.push&&!c[s.push]?c[s.push]=[]:u&&!c[s.name]&&(c[s.name]={});var d=s.push?{}:u?c[s.name]:c;n(l.match(s.reg),d,s.names,s.name),s.push&&c[s.push].push(d)},i=Ih(),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(s){var c={},l=[],u=c;return s.split(/(\r\n|\r|\n)/).filter(a).forEach(function(d){var h=d[0],p=d.slice(2);h==="m"&&(l.push({rtp:[],fmtp:[]}),u=l[l.length-1]);for(var b=0;b<(i[h]||[]).length;b+=1){var y=i[h][b];if(y.reg.test(p))return r(y,u,p)}}),c.media=l,c};var o=function(s,c){var l=c.split(/=(.+)/,2);return l.length===2?s[l[0]]=e(l[1]):l.length===1&&c.length>1&&(s[l[0]]=void 0),s};t.parseParams=function(s){return s.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(s){return s.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(s){for(var c=[],l=s.split(" ").map(e),u=0;u<l.length;u+=3)c.push({component:l[u],ip:l[u+1],port:l[u+2]});return c},t.parseImageAttributes=function(s){return s.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(s){return s.split(";").map(function(c){return c.split(",").map(function(l){var u,d=!1;return l[0]!=="~"?u=e(l):(u=e(l.substring(1,l.length)),d=!0),{scid:u,paused:d}})})}}(fm)),fm}var bl,vm;function L2(){if(vm)return bl;vm=1;var t=Ih(),e=/%[sdv%]/g,n=function(o){var s=1,c=arguments,l=c.length;return o.replace(e,function(u){if(s>=l)return u;var d=c[s];switch(s+=1,u){case"%%":return"%";case"%s":return String(d);case"%d":return Number(d);case"%v":return""}})},r=function(o,s,c){var l=s.format instanceof Function?s.format(s.push?c:c[s.name]):s.format,u=[o+"="+l];if(s.names)for(var d=0;d<s.names.length;d+=1){var h=s.names[d];s.name?u.push(c[s.name][h]):u.push(c[s.names[d]])}else u.push(c[s.name]);return n.apply(null,u)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],a=["i","c","b","a"];return bl=function(o,s){s=s||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(d){d.payloads==null&&(d.payloads="")});var c=s.outerOrder||i,l=s.innerOrder||a,u=[];return c.forEach(function(d){t[d].forEach(function(h){h.name in o&&o[h.name]!=null?u.push(r(d,h,o)):h.push in o&&o[h.push]!=null&&o[h.push].forEach(function(p){u.push(r(d,h,p))})})}),o.media.forEach(function(d){u.push(r("m",t.m[0],d)),l.forEach(function(h){t[h].forEach(function(p){p.name in d&&d[p.name]!=null?u.push(r(h,p,d)):p.push in d&&d[p.push]!=null&&d[p.push].forEach(function(b){u.push(r(h,p,b))})})})}),u.join(`\r
`)+`\r
`},bl}var bm;function D2(){if(bm)return Lt;bm=1;var t=M2(),e=L2(),n=Ih();return Lt.grammar=n,Lt.write=e,Lt.parse=t.parse,Lt.parseParams=t.parseParams,Lt.parseFmtpConfig=t.parseFmtpConfig,Lt.parsePayloads=t.parsePayloads,Lt.parseRemoteCandidates=t.parseRemoteCandidates,Lt.parseImageAttributes=t.parseImageAttributes,Lt.parseSimulcastStreamList=t.parseSimulcastStreamList,Lt}var In=D2();function _h(t,e,n){var r,i,a;e===void 0&&(e=50),n===void 0&&(n={});var o=(r=n.isImmediate)!=null&&r,s=(i=n.callback)!=null&&i,c=n.maxWait,l=Date.now(),u=[];function d(){if(c!==void 0){var p=Date.now()-l;if(p+e>=c)return c-p}return e}var h=function(){var p=[].slice.call(arguments),b=this;return new Promise(function(y,w){var f=o&&a===void 0;if(a!==void 0&&clearTimeout(a),a=setTimeout(function(){if(a=void 0,l=Date.now(),!o){var m=t.apply(b,p);s&&s(m),u.forEach(function(v){return(0,v.resolve)(m)}),u=[]}},d()),f){var g=t.apply(b,p);return s&&s(g),y(g)}u.push({resolve:y,reject:w})})};return h.cancel=function(p){a!==void 0&&clearTimeout(a),u.forEach(function(b){return(0,b.reject)(p)}),u=[]},h}const j2=.7,A2=20,yi={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class ym extends cn.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;super(),this.log=X,this.ddExtID=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=_h(i=>S(this,void 0,void 0,function*(){this.emit(yi.NegotiationStarted);try{yield this.createAndSendOffer()}catch(a){if(i)i(a);else throw a}}),A2),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Sn((r=n.loggerName)!==null&&r!==void 0?r:Kt.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC()}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var r;n.candidate&&((r=this.onIceCandidate)===null||r===void 0||r.call(this,n.candidate))},e.onicecandidateerror=n=>{var r;(r=this.onIceCandidateError)===null||r===void 0||r.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var r;(r=this.onDataChannel)===null||r===void 0||r.call(this,n)},e.ontrack=n=>{var r;(r=this.onTrack)===null||r===void 0||r.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return S(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e){return S(this,void 0,void 0,function*(){var n;let r;if(e.type==="offer"){let{stereoMids:i,nackMids:a}=U2(e);this.remoteStereoMids=i,this.remoteNackMids=a}else if(e.type==="answer"){const i=In.parse((n=e.sdp)!==null&&n!==void 0?n:"");i.media.forEach(a=>{a.type==="audio"&&this.trackBitrates.some(o=>{if(!o.transceiver||a.mid!=o.transceiver.mid)return!1;let s=0;if(a.rtp.some(l=>l.codec.toUpperCase()===o.codec.toUpperCase()?(s=l.payload,!0):!1),s===0)return!0;let c=!1;for(const l of a.fmtp)if(l.payload===s){l.config=l.config.split(";").filter(u=>!u.includes("maxaveragebitrate")).join(";"),o.maxbr>0&&(l.config+=";maxaveragebitrate=".concat(o.maxbr*1e3)),c=!0;break}return c||o.maxbr>0&&a.fmtp.push({payload:s,config:"maxaveragebitrate=".concat(o.maxbr*1e3)}),!0})}),r=In.write(i)}yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(i=>{this.pc.addIceCandidate(i)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(yi.NegotiationComplete),e.sdp&&In.parse(e.sdp).media.forEach(i=>{i.type==="video"&&this.emit(yi.RTPVideoPayloadTypes,i.rtp)}))})}createAndSendOffer(e){return S(this,void 0,void 0,function*(){var n;if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:r.sdp},this.logContext));const i=In.parse((n=r.sdp)!==null&&n!==void 0?n:"");i.media.forEach(a=>{wm(a),a.type==="audio"?km(a,[],[]):a.type==="video"&&this.trackBitrates.some(o=>{if(!a.msid||!o.cid||!a.msid.includes(o.cid))return!1;let s=0;if(a.rtp.some(l=>l.codec.toUpperCase()===o.codec.toUpperCase()?(s=l.payload,!0):!1),s===0||(va(o.codec)&&this.ensureVideoDDExtensionForSVC(a,i),o.codec!=="av1"))return!0;const c=Math.round(o.maxbr*j2);for(const l of a.fmtp)if(l.payload===s){l.config.includes("x-google-start-bitrate")||(l.config+=";x-google-start-bitrate=".concat(c));break}return!0})}),yield this.setMungedSDP(r,In.write(i)),this.onOffer(r)})}createAndSetAnswer(){return S(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),r=In.parse((e=n.sdp)!==null&&e!==void 0?e:"");return r.media.forEach(i=>{wm(i),i.type==="audio"&&km(i,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,In.write(r)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Ne("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Ne("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return S(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const r=new Map,i=new Map;if((yield this._pc.getStats()).forEach(o=>{switch(o.type){case"transport":n=o.selectedCandidatePairId;break;case"candidate-pair":n===""&&o.selected&&(n=o.id),r.set(o.id,o);break;case"remote-candidate":i.set(o.id,"".concat(o.address,":").concat(o.port));break}}),n==="")return;const a=(e=r.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(a!==void 0)return i.get(a)})}setMungedSDP(e,n,r){return S(this,void 0,void 0,function*(){if(n){const i=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(r?"remote":"local"," description"),this.logContext),r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(a){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:a,sdp:n})),e.sdp=i}}try{r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(i){let a="unknown error";i instanceof Error?a=i.message:typeof i=="string"&&(a=i);const o={error:a,sdp:e.sdp};throw!r&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new Bu(a)}})}ensureVideoDDExtensionForSVC(e,n){var r,i;if(!(!((r=e.ext)===null||r===void 0)&&r.some(a=>a.uri===om))){if(this.ddExtID===0){let a=0;n.media.forEach(o=>{var s;o.type==="video"&&((s=o.ext)===null||s===void 0||s.forEach(c=>{c.value>a&&(a=c.value)}))}),this.ddExtID=a+1}(i=e.ext)===null||i===void 0||i.push({value:this.ddExtID,uri:om})}}}function km(t,e,n){let r=0;t.rtp.some(i=>i.codec==="opus"?(r=i.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(t.mid)&&!t.rtcpFb.some(i=>i.payload===r&&i.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),e.includes(t.mid)&&t.fmtp.some(i=>i.payload===r?(i.config.includes("stereo=1")||(i.config+=";stereo=1"),!0):!1))}function U2(t){var e;const n=[],r=[],i=In.parse((e=t.sdp)!==null&&e!==void 0?e:"");let a=0;return i.media.forEach(o=>{var s;o.type==="audio"&&(o.rtp.some(c=>c.codec==="opus"?(a=c.payload,!0):!1),!((s=o.rtcpFb)===null||s===void 0)&&s.some(c=>c.payload===a&&c.type==="nack")&&r.push(o.mid),o.fmtp.some(c=>c.payload===a?(c.config.includes("sprop-stereo=1")&&n.push(o.mid),!0):!1))}),{stereoMids:n,nackMids:r}}function wm(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}const Ju="vp8",F2={audioPreset:zu.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Eh.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Ju,backupCodec:!0},Py={deviceId:"default",autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Ry={deviceId:"default",resolution:Ga.h720.resolution},B2={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new _x,disconnectOnPageLeave:!0,webAudioMix:!1},Oh={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Se;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(Se||(Se={}));class z2{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,r){var i;this.peerConnectionTimeout=Oh.peerConnectionTimeout,this.log=X,this.updateState=()=>{var a;const o=this.state,s=this.requiredTransports.map(c=>c.getConnectionState());s.every(c=>c==="connected")?this.state=Se.CONNECTED:s.some(c=>c==="failed")?this.state=Se.FAILED:s.some(c=>c==="connecting")?this.state=Se.CONNECTING:s.every(c=>c==="closed")?this.state=Se.CLOSED:s.some(c=>c==="closed")?this.state=Se.CLOSING:s.every(c=>c==="new")&&(this.state=Se.NEW),o!==this.state&&(this.log.debug("pc state change: from ".concat(Se[o]," to ").concat(Se[this.state]),this.logContext),(a=this.onStateChange)===null||a===void 0||a.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=Sn((i=r.loggerName)!==null&&i!==void 0?i:Kt.PCManager),this.loggerOptions=r,this.isPublisherConnectionRequired=!n,this.isSubscriberConnectionRequired=n,this.publisher=new ym(e,r),this.subscriber=new ym(e,r),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=a=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,a,Vt.PUBLISHER)},this.subscriber.onIceCandidate=a=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,a,Vt.SUBSCRIBER)},this.subscriber.onDataChannel=a=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,a)},this.subscriber.onTrack=a=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,a)},this.publisher.onOffer=a=>{var o;(o=this.onPublisherOffer)===null||o===void 0||o.call(this,a)},this.state=Se.NEW,this.connectionLock=new vt,this.remoteOfferLock=new vt}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e){return this.publisher.setRemoteDescription(e)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return S(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const n of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(n)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return S(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return S(this,void 0,void 0,function*(){n===Vt.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e){return S(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const n=yield this.remoteOfferLock.lock();try{return yield this.subscriber.setRemoteDescription(e),yield this.subscriber.createAndSetAnswer()}finally{n()}})}updateConfiguration(e,n){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return S(this,void 0,void 0,function*(){var r;const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((r=this.requiredTransports)===null||r===void 0?void 0:r.map(a=>this.ensureTransportConnected(a,e,n)))}finally{i()}})}negotiate(e){return S(this,void 0,void 0,function*(){return new Promise((n,r)=>S(this,void 0,void 0,function*(){const i=setTimeout(()=>{r("negotiation timed out")},this.peerConnectionTimeout),a=()=>{clearTimeout(i),r("negotiation aborted")};e.signal.addEventListener("abort",a),this.publisher.once(yi.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(yi.NegotiationComplete,()=>{clearTimeout(i),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(i),r(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===Vt.PUBLISHER?this.publisher.getConnectedAddress():e===Vt.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return S(this,arguments,void 0,function(r,i){var a=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(r.getConnectionState()!=="connected")return new Promise((s,c)=>S(a,void 0,void 0,function*(){const l=()=>{this.log.warn("abort transport connection",this.logContext),He.clearTimeout(u),c(new de("room connection has been cancelled",ee.Cancelled))};i!=null&&i.signal.aborted&&l(),i==null||i.signal.addEventListener("abort",l);const u=He.setTimeout(()=>{i==null||i.signal.removeEventListener("abort",l),c(new de("could not establish pc connection",ee.InternalError))},o);for(;this.state!==Se.CONNECTED;)if(yield pt(50),i!=null&&i.signal.aborted){c(new de("room connection has been cancelled",ee.Cancelled));return}He.clearTimeout(u),i==null||i.signal.removeEventListener("abort",l),s()}))}()})}}class Ee extends Error{constructor(e,n,r){super(n),this.code=e,this.message=Cm(n,Ee.MAX_MESSAGE_BYTES),this.data=r?Cm(r,Ee.MAX_DATA_BYTES):void 0}static fromProto(e){return new Ee(e.code,e.message,e.data)}toProto(){return new Sb({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Ee(Ee.ErrorCode[e],Ee.ErrorMessage[e],n)}}Ee.MAX_MESSAGE_BYTES=256;Ee.MAX_DATA_BYTES=15360;Ee.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Ee.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const Iy=15360;function Nh(t){return new TextEncoder().encode(t).length}function Cm(t,e){if(Nh(t)<=e)return t;let n=0,r=t.length;const i=new TextEncoder;for(;n<r;){const a=Math.floor((n+r+1)/2);i.encode(t.slice(0,a)).length<=e?n=a:r=a-1}return t.slice(0,n)}const Mh=2e3;function xc(t,e){if(!e)return 0;let n,r;return"bytesReceived"in t?(n=t.bytesReceived,r=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,r=e.bytesSent),n===void 0||r===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-r)*8*1e3/(t.timestamp-e.timestamp)}const V2=1e3;class _y extends _{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}constructor(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=arguments.length>4?arguments[4]:void 0;super(e,n,a),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=_h(()=>S(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>S(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(U.Ended,this)},this.reacquireTrack=!1,this.providedByUser=i,this.muteLock=new vt,this.pauseUpstreamLock=new vt,this.processorLock=new vt,this.restartLock=new vt,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),r&&(this._constraints=r)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==_.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return S(this,void 0,void 0,function*(){var r;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(a=>{vi(this._mediaStreamTrack,a)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let i;if(this.processor&&e){const a=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(ai(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),i=this.processor.processedTrack}finally{a()}}this.sender&&((r=this.sender.transport)===null||r===void 0?void 0:r.state)!=="closed"&&(yield this.sender.replaceTrack(i??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(a=>{ai(i??e,a)}))})}waitForDimensions(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:V2;return function*(){var r;if(e.kind===_.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((r=Gt())===null||r===void 0?void 0:r.os)==="iOS"&&(yield pt(10));const i=Date.now();for(;Date.now()-i<n;){const a=e.dimensions;if(a)return a;yield pt(50)}throw new fn("unable to get track dimensions after timeout")}()})}setDeviceId(e){return S(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Jn(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),Jn(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===_.Source.ScreenShare)return;const{deviceId:r,groupId:i}=e._mediaStreamTrack.getSettings(),a=e.kind===_.Kind.Audio?"audioinput":"videoinput";return n?Ae.getInstance().normalizeDeviceId(a,r,i):r}()})}mute(){return S(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return S(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return S(this,void 0,void 0,function*(){if(!this.sender)throw new fn("unable to replace an unpublished track");let r,i;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,i=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),i&&this.processor&&(yield this.stopProcessor()),this})}restart(e){return S(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.restartLock.lock();try{e||(e=this._constraints);const{deviceId:r,facingMode:i}=e,a=Ox(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===_.Kind.Video?o.video=r||i?{deviceId:r,facingMode:i}:!0:o.audio=r?{deviceId:r}:!0,this.attachedElements.forEach(c=>{vi(this.mediaStreamTrack,c)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const s=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return yield s.applyConstraints(a),s.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(s),this._constraints=e,this.emit(U.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?U.Muted:U.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return S(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),yy()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return S(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(U.UpstreamPaused,this);const r=Gt();if((r==null?void 0:r.name)==="Safari"&&Or(r.version,"12.0")<0)throw new xh("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return S(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(U.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return S(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return S(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var a;const o=yield r.processorLock.lock();try{r.log.debug("setting up processor",r.logContext);const s=document.createElement(r.kind),c={kind:r.kind,track:r._mediaStreamTrack,element:s,audioContext:r.audioContext};if(yield n.init(c),r.log.debug("processor initialized",r.logContext),r.processor&&(yield r.stopProcessor()),r.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(ai(r._mediaStreamTrack,s),s.muted=!0,s.play().catch(l=>r.log.error("failed to play processor element",Object.assign(Object.assign({},r.logContext),{error:l}))),r.processor=n,r.processorElement=s,r.processor.processedTrack){for(const l of r.attachedElements)l!==r.processorElement&&i&&(vi(r._mediaStreamTrack,l),ai(r.processor.processedTrack,l));yield(a=r.sender)===null||a===void 0?void 0:a.replaceTrack(r.processor.processedTrack)}r.emit(U.TrackProcessorUpdate,r.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var r,i;e.processor&&(e.log.debug("stopping processor",e.logContext),(r=e.processor.processedTrack)===null||r===void 0||r.stop(),yield e.processor.destroy(),e.processor=void 0,n||((i=e.processorElement)===null||i===void 0||i.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(U.TrackProcessorUpdate))}()})}}class Ks extends _y{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;super(e,_.Kind.Audio,n,r,a),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>S(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(s){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:s}));return}o&&this.prevStats&&(this._currentBitrate=xc(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(U.AudioTrackFeatureUpdate,this,tn.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(U.AudioTrackFeatureUpdate,this,tn.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=i,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return S(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===_.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return S(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const r=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Jn(this._constraints.deviceId);return this.source===_.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||r)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return S(this,void 0,void 0,function*(){let n;if(e){const r=Tc({audio:e});typeof r.audio!="boolean"&&(n=r.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return S(this,void 0,void 0,function*(){const r=yield n.restart.call(this,e);return this.checkForSilence(),r})}startMonitor(){lt()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Mh)))}setProcessor(e){return S(this,void 0,void 0,function*(){var n;const r=yield this.processorLock.lock();try{if(!sn()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const i={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(i),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(U.TrackProcessorUpdate,this.processor)}finally{r()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return S(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let r;return n.forEach(i=>{i.type==="outbound-rtp"&&(r={type:"audio",streamId:i.id,packetsSent:i.packetsSent,packetsLost:i.packetsLost,bytesSent:i.bytesSent,timestamp:i.timestamp,roundTripTime:i.roundTripTime,jitter:i.jitter})}),r})}checkForSilence(){return S(this,void 0,void 0,function*(){const e=yield Ty(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(U.AudioSilenceDetected)),e})}}function Oy(t,e,n){switch(t.kind){case"audio":return new Ks(t,e,!1,void 0,n);case"video":return new Zs(t,e,!1,n);default:throw new fn("unsupported track type: ".concat(t.kind))}}const H2=Object.values(Ga),q2=Object.values(Vu),$2=Object.values(Eh),W2=[Ga.h180,Ga.h360],K2=[Vu.h180,Vu.h360],G2=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(e=>{var n,r;return new ce(Math.floor(t.width/e.scaleResolutionDownBy),Math.floor(t.height/e.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(e.scaleResolutionDownBy,2)*(((n=t.encoding.maxFramerate)!==null&&n!==void 0?n:30)/((r=e.fps)!==null&&r!==void 0?r:30))))),e.fps,t.encoding.priority)}),Qu=["q","h","f"];function Yu(t,e,n,r){var i,a;let o=r==null?void 0:r.videoEncoding;t&&(o=r==null?void 0:r.screenShareEncoding);const s=r==null?void 0:r.simulcast,c=r==null?void 0:r.scalabilityMode,l=r==null?void 0:r.videoCodec;if(!o&&!s&&!c||!e||!n)return[{}];o||(o=J2(t,e,n,l),X.debug("using video encoding",o));const u=o.maxFramerate,d=new ce(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&va(l)){const b=new Gs(c),y=[];if(b.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const w=Gt();if(er()||sn()||(w==null?void 0:w.name)==="Chrome"&&Or(w==null?void 0:w.version,"113")<0){const f=b.suffix=="h"?2:3;for(let g=0;g<b.spatial;g+=1)y.push({rid:Qu[2-g],maxBitrate:o.maxBitrate/Math.pow(f,g),maxFramerate:d.encoding.maxFramerate});y[0].scalabilityMode=c}else y.push({maxBitrate:o.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:c});return d.encoding.priority&&(y[0].priority=d.encoding.priority,y[0].networkPriority=d.encoding.priority),X.debug("using svc encoding",{encodings:y}),y}if(!s)return[o];let h=[];t?h=(i=Tm(r==null?void 0:r.screenShareSimulcastLayers))!==null&&i!==void 0?i:Sm(t,d):h=(a=Tm(r==null?void 0:r.videoSimulcastLayers))!==null&&a!==void 0?a:Sm(t,d);let p;if(h.length>0){const b=h[0];h.length>1&&([,p]=h);const y=Math.max(e,n);if(y>=960&&p)return yl(e,n,[b,p,d],u);if(y>=480)return yl(e,n,[b,d],u)}return yl(e,n,[d])}function Z2(t,e,n){var r,i,a,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&X.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const s=t.mediaStreamTrack.getSettings(),c=(r=s.width)!==null&&r!==void 0?r:(i=t.dimensions)===null||i===void 0?void 0:i.width,l=(a=s.height)!==null&&a!==void 0?a:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===_.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Yu(t.source===_.Source.ScreenShare,c,l,n)}function J2(t,e,n,r){const i=Q2(t,e,n);let{encoding:a}=i[0];const o=Math.max(e,n);for(let s=0;s<i.length;s+=1){const c=i[s];if(a=c.encoding,c.width>=o)break}if(r)switch(r){case"av1":a=Object.assign({},a),a.maxBitrate=a.maxBitrate*.7;break;case"vp9":a=Object.assign({},a),a.maxBitrate=a.maxBitrate*.85;break}return a}function Q2(t,e,n){if(t)return $2;const r=e>n?e/n:n/e;return Math.abs(r-16/9)<Math.abs(r-4/3)?H2:q2}function Sm(t,e){if(t)return G2(e);const{width:n,height:r}=e,i=n>r?n/r:r/n;return Math.abs(i-16/9)<Math.abs(i-4/3)?W2:K2}function yl(t,e,n,r){const i=[];if(n.forEach((a,o)=>{if(o>=Qu.length)return;const s=Math.min(t,e),c={rid:Qu[o],scaleResolutionDownBy:Math.max(1,s/Math.min(a.width,a.height)),maxBitrate:a.encoding.maxBitrate},l=r&&a.encoding.maxFramerate?Math.min(r,a.encoding.maxFramerate):a.encoding.maxFramerate;l&&(c.maxFramerate=l);const u=Ii()||o===0;a.encoding.priority&&u&&(c.priority=a.encoding.priority,c.networkPriority=a.encoding.priority),i.push(c)}),sn()&&wy()==="ios"){let a;i.forEach(s=>{a?s.maxFramerate&&s.maxFramerate>a&&(a=s.maxFramerate):a=s.maxFramerate});let o=!0;i.forEach(s=>{var c;s.maxFramerate!=a&&(o&&(o=!1,X.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),X.info('Setting framerate of encoding "'.concat((c=s.rid)!==null&&c!==void 0?c:"",'" to ').concat(a)),s.maxFramerate=a)})}return i}function Tm(t){if(t)return t.sort((e,n)=>{const{encoding:r}=e,{encoding:i}=n;return r.maxBitrate>i.maxBitrate?1:r.maxBitrate<i.maxBitrate?-1:r.maxBitrate===i.maxBitrate&&r.maxFramerate&&i.maxFramerate?r.maxFramerate>i.maxFramerate?1:-1:0})}class Gs{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function Y2(t){return t.source===_.Source.ScreenShare||t.constraints.height&&Jn(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const X2=5e3;class Zs extends _y{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3?arguments[3]:void 0;super(e,_.Kind.Video,n,r,i),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.monitorSender=()=>S(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let a;try{a=yield this.getSenderStats()}catch(s){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:s}));return}const o=new Map(a.map(s=>[s.rid,s]));if(this.prevStats){let s=0;o.forEach((c,l)=>{var u;const d=(u=this.prevStats)===null||u===void 0?void 0:u.get(l);s+=xc(c,d)}),this._currentBitrate=s}this.prevStats=o}),this.senderLock=new vt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!lt())return;const r=(n=this.sender)===null||n===void 0?void 0:n.getParameters();r&&(this.encodings=r.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Mh))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return S(this,void 0,void 0,function*(){var n,r,i,a,o;yield e.pauseUpstream.call(this);try{for(var s=!0,c=Dn(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;s=!0)a=l.value,s=!1,yield(o=a.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(u){r={error:u}}finally{try{!s&&!n&&(i=c.return)&&(yield i.call(c))}finally{if(r)throw r.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return S(this,void 0,void 0,function*(){var n,r,i,a,o;yield e.resumeUpstream.call(this);try{for(var s=!0,c=Dn(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;s=!0){a=l.value,s=!1;const u=a;yield(o=u.sender)===null||o===void 0?void 0:o.replaceTrack(u.mediaStreamTrack)}}catch(u){r={error:u}}finally{try{!s&&!n&&(i=c.return)&&(yield i.call(c))}finally{if(r)throw r.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return S(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===_.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return S(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===_.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return S(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],r=yield this.sender.getStats();return r.forEach(i=>{var a;if(i.type==="outbound-rtp"){const o={type:"video",streamId:i.id,frameHeight:i.frameHeight,frameWidth:i.frameWidth,framesPerSecond:i.framesPerSecond,framesSent:i.framesSent,firCount:i.firCount,pliCount:i.pliCount,nackCount:i.nackCount,packetsSent:i.packetsSent,bytesSent:i.bytesSent,qualityLimitationReason:i.qualityLimitationReason,qualityLimitationDurations:i.qualityLimitationDurations,qualityLimitationResolutionChanges:i.qualityLimitationResolutionChanges,rid:(a=i.rid)!==null&&a!==void 0?a:i.id,retransmittedPacketsSent:i.retransmittedPacketsSent,targetBitrate:i.targetBitrate,timestamp:i.timestamp},s=r.get(i.remoteId);s&&(o.jitter=s.jitter,o.packetsLost=s.packetsLost,o.roundTripTime=s.roundTripTime),n.push(o)}}),n.sort((i,a)=>{var o,s;return((o=a.frameWidth)!==null&&o!==void 0?o:0)-((s=i.frameWidth)!==null&&s!==void 0?s:0)}),n})}setPublishingQuality(e){const n=[];for(let r=Et.LOW;r<=Et.HIGH;r+=1)n.push(new Ch({quality:r,enabled:r<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(n)}restartTrack(e){return S(this,void 0,void 0,function*(){var n,r,i,a,o;let s;if(e){const d=Tc({video:e});typeof d.video!="boolean"&&(s=d.video)}yield this.restart(s);try{for(var c=!0,l=Dn(this.simulcastCodecs.values()),u;u=yield l.next(),n=u.done,!n;c=!0){a=u.value,c=!1;const d=a;d.sender&&((o=d.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){r={error:d}}finally{try{!c&&!n&&(i=l.return)&&(yield i.call(l))}finally{if(r)throw r.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return S(this,arguments,void 0,function(r){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,s,c,l,u,d;if(yield n.setProcessor.call(i,r,a),!((u=i.processor)===null||u===void 0)&&u.processedTrack)try{for(var h=!0,p=Dn(i.simulcastCodecs.values()),b;b=yield p.next(),o=b.done,!o;h=!0)l=b.value,h=!1,yield(d=l.sender)===null||d===void 0?void 0:d.replaceTrack(i.processor.processedTrack)}catch(y){s={error:y}}finally{try{!h&&!o&&(c=p.return)&&(yield c.call(p))}finally{if(s)throw s.error}}}()})}setDegradationPreference(e){return S(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const r={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,r),r}setSimulcastTrackSender(e,n){const r=this.simulcastCodecs.get(e);r&&(r.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},X2))}setPublishingCodecs(e){return S(this,void 0,void 0,function*(){var n,r,i,a,o,s,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(n=!0,r=Dn(e);i=yield r.next(),a=i.done,!a;n=!0){c=i.value,n=!1;const u=c;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const h of u.qualities)if(h.enabled){l.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield xm(d.sender,d.encodings,u.qualities,this.senderLock,this.log,this.logContext))}}}catch(u){o={error:u}}finally{try{!n&&!a&&(s=r.return)&&(yield s.call(r))}finally{if(o)throw o.error}}return l})}setPublishingLayers(e){return S(this,void 0,void 0,function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),!(!this.sender||!this.encodings)&&(yield xm(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext))})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return S(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),yy()&&this.isInBackground&&this.source===_.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function xm(t,e,n,r,i,a){return S(this,void 0,void 0,function*(){const o=yield r.lock();i.debug("setPublishingLayersForSender",Object.assign(Object.assign({},a),{sender:t,qualities:n,senderEncodings:e}));try{const s=t.getParameters(),{encodings:c}=s;if(!c)return;if(c.length!==e.length){i.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},a),{encodings:c,senderEncodings:e}));return}let l=!1;const u=Gt();if((u==null?void 0:u.name)==="Chrome"&&Or(u==null?void 0:u.version,"133")>0&&c[0].scalabilityMode){const d=c[0],h=new Gs(d.scalabilityMode);let p=fi.OFF;if(n.forEach(b=>{b.enabled&&(p===fi.OFF||b.quality>p)&&(p=b.quality)}),p===fi.OFF)d.active&&(d.active=!1,l=!0);else if(!d.active||h.spatial!==p+1){l=!0,d.active=!0;const b=new Gs(e[0].scalabilityMode);h.spatial=p+1,h.suffix=b.suffix,h.spatial===1&&(h.suffix=void 0),d.scalabilityMode=h.toString(),d.scaleResolutionDownBy=Math.pow(2,2-p),e[0].maxBitrate&&(d.maxBitrate=e[0].maxBitrate/(d.scaleResolutionDownBy*d.scaleResolutionDownBy))}}else c.forEach((d,h)=>{var p;let b=(p=d.rid)!==null&&p!==void 0?p:"";b===""&&(b="q");const y=Ny(b),w=n.find(f=>f.quality===y);w&&d.active!==w.enabled&&(l=!0,d.active=w.enabled,i.debug("setting layer ".concat(w.quality," to ").concat(d.active?"enabled":"disabled"),a),Ii()&&(w.enabled?(d.scaleResolutionDownBy=e[h].scaleResolutionDownBy,d.maxBitrate=e[h].maxBitrate,d.maxFrameRate=e[h].maxFrameRate):(d.scaleResolutionDownBy=4,d.maxBitrate=10,d.maxFrameRate=2)))});l&&(s.encodings=c,i.debug("setting encodings",Object.assign(Object.assign({},a),{encodings:s.encodings})),yield t.setParameters(s))}finally{o()}})}function Ny(t){switch(t){case"f":return Et.HIGH;case"h":return Et.MEDIUM;case"q":return Et.LOW;default:return Et.HIGH}}function Em(t,e,n,r){if(!n)return[new wr({quality:Et.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(r){const i=n[0].scalabilityMode,a=new Gs(i),o=[],s=a.suffix=="h"?1.5:2,c=a.suffix=="h"?2:3;for(let l=0;l<a.spatial;l+=1)o.push(new wr({quality:Math.min(Et.HIGH,a.spatial-1)-l,width:Math.ceil(t/Math.pow(s,l)),height:Math.ceil(e/Math.pow(s,l)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return o}return n.map(i=>{var a,o,s;const c=(a=i.scaleResolutionDownBy)!==null&&a!==void 0?a:1;let l=Ny((o=i.rid)!==null&&o!==void 0?o:"");return new wr({quality:l,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(s=i.maxBitrate)!==null&&s!==void 0?s:0,ssrc:0})})}const Pm="_lossy",Rm="_reliable",eE=2*1e3,kl="leave-reconnect";var Dt;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(Dt||(Dt={}));class tE extends cn.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Oh.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=Dt.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=X,this.handleDataChannel=r=>S(this,[r],void 0,function(i){var a=this;let{channel:o}=i;return function*(){if(o){if(o.label===Rm)a.reliableDCSub=o;else if(o.label===Pm)a.lossyDCSub=o;else return;a.log.debug("on data channel ".concat(o.id,", ").concat(o.label),a.logContext),o.onmessage=a.handleDataMessage}}()}),this.handleDataMessage=r=>S(this,void 0,void 0,function*(){var i,a;const o=yield this.dataProcessLock.lock();try{let s;if(r.data instanceof ArrayBuffer)s=r.data;else if(r.data instanceof Blob)s=yield r.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:r.data}));return}const c=at.fromBinary(new Uint8Array(s));((i=c.value)===null||i===void 0?void 0:i.case)==="speaker"?this.emit(B.ActiveSpeakersUpdate,c.value.value.speakers):(((a=c.value)===null||a===void 0?void 0:a.case)==="user"&&rE(c,c.value.value),this.emit(B.DataPacketReceived,c))}finally{o()}}),this.handleDataError=r=>{const i=r.currentTarget.maxRetransmits===0?"lossy":"reliable";if(r instanceof ErrorEvent&&r.error){const{error:a}=r.error;this.log.error("DataChannel error on ".concat(i,": ").concat(r.message),Object.assign(Object.assign({},this.logContext),{error:a}))}else this.log.error("Unknown DataChannel error on ".concat(i),Object.assign(Object.assign({},this.logContext),{event:r}))},this.handleBufferedAmountLow=r=>{const i=r.currentTarget.maxRetransmits===0?te.LOSSY:te.RELIABLE;this.updateAndEmitDCBufferStatus(i)},this.handleDisconnect=(r,i)=>{if(this._isClosed)return;this.log.warn("".concat(r," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const a=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(B.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let s=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(s===null){a(o);return}r===kl&&(s=0),this.log.debug("reconnecting in ".concat(s,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=He.setTimeout(()=>this.attemptReconnect(i).finally(()=>this.reconnectTimeout=void 0),s)},this.waitForRestarted=()=>new Promise((r,i)=>{this.pcState===Dt.Connected&&r();const a=()=>{this.off(B.Disconnected,o),r()},o=()=>{this.off(B.Restarted,a),i()};this.once(B.Restarted,a),this.once(B.Disconnected,o)}),this.updateAndEmitDCBufferStatus=r=>{const i=this.isBufferStatusLow(r);typeof i<"u"&&i!==this.dcBufferStatus.get(r)&&(this.dcBufferStatus.set(r,i),this.emit(B.DCBufferStatusChanged,i,r))},this.isBufferStatusLow=r=>{const i=this.dataChannelForKind(r);if(i)return i.bufferedAmount<=i.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===me.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(Vr.RR_SIGNAL_DISCONNECTED))},this.log=Sn((n=e.loggerName)!==null&&n!==void 0?n:Kt.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Rh(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new vt,this.dataProcessLock=new vt,this.dcBufferStatus=new Map([[te.LOSSY,!0],[te.RELIABLE,!0]]),this.client.onParticipantUpdate=r=>this.emit(B.ParticipantUpdate,r),this.client.onConnectionQuality=r=>this.emit(B.ConnectionQualityUpdate,r),this.client.onRoomUpdate=r=>this.emit(B.RoomUpdate,r),this.client.onSubscriptionError=r=>this.emit(B.SubscriptionError,r),this.client.onSubscriptionPermissionUpdate=r=>this.emit(B.SubscriptionPermissionUpdate,r),this.client.onSpeakersChanged=r=>this.emit(B.SpeakersChanged,r),this.client.onStreamStateUpdate=r=>this.emit(B.StreamStateChanged,r),this.client.onRequestResponse=r=>this.emit(B.SignalRequestResponse,r)}get logContext(){var e,n,r,i,a,o,s,c;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(i=(r=this.latestJoinResponse)===null||r===void 0?void 0:r.room)===null||i===void 0?void 0:i.sid,participant:(o=(a=this.latestJoinResponse)===null||a===void 0?void 0:a.participant)===null||o===void 0?void 0:o.identity,pID:(c=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||c===void 0?void 0:c.sid}}join(e,n,r,i){return S(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=r,this.maxJoinAttempts=r.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const a=yield this.client.join(e,n,r,i);return this._isClosed=!1,this.latestJoinResponse=a,this.subscriberPrimary=a.subscriberPrimary,this.pcManager||(yield this.configure(a)),(!this.subscriberPrimary||a.fastPublish)&&this.negotiate(),this.clientConfiguration=a.clientConfiguration,a}catch(a){if(a instanceof de&&a.reason===ee.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,r,i);throw a}})}close(){return S(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(B.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return S(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=r=>{r&&(r.close(),r.onbufferedamountlow=null,r.onclose=null,r.onclosing=null,r.onerror=null,r.onmessage=null,r.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0})}cleanupClient(){return S(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new fn("a track with the same ID has already been published");return new Promise((n,r)=>{const i=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],r(new de("publication of local track timed out, no response from server",ee.InternalError))},1e4);this.pendingTrackResolvers[e.cid]={resolve:a=>{clearTimeout(i),n(a)},reject:()=>{clearTimeout(i),r(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return S(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return S(this,void 0,void 0,function*(){var n,r;if(this.pcManager&&this.pcManager.currentState!==Se.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const i=this.makeRTCConfiguration(e);this.pcManager=new z2(i,e.subscriberPrimary,this.loggerOptions),this.emit(B.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(a,o)=>{this.client.sendIceCandidate(a,o)},this.pcManager.onPublisherOffer=a=>{this.client.sendOffer(a)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(a,o,s)=>S(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(a),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),a===Se.CONNECTED){const u=this.pcState===Dt.New;this.pcState=Dt.Connected,u&&this.emit(B.Connected,e)}else a===Se.FAILED&&this.pcState===Dt.Connected&&(this.pcState=Dt.Disconnected,this.handleDisconnect("peerconnection failed",s==="failed"?Vr.RR_SUBSCRIBER_FAILED:Vr.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===me.RECONNECTING,l=[Se.FAILED,Se.CLOSING,Se.CLOSED].includes(a);c&&l&&!this._isClosed&&this.emit(B.Offline)}),this.pcManager.onTrack=a=>{this.emit(B.MediaTrackAdded,a.track,a.streams[0],a.receiver)},nE((r=e.serverInfo)===null||r===void 0?void 0:r.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=e=>S(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=e=>S(this,void 0,void 0,function*(){if(!this.pcManager)return;const n=yield this.pcManager.createSubscriberAnswerFromOffer(e);this.client.sendAnswer(n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:r}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],r(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(B.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(B.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(B.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(B.SubscribedQualityUpdate,e)},this.client.onClose=()=>{this.handleDisconnect("signal",Vr.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case mi.DISCONNECT:this.emit(B.Disconnected,e==null?void 0:e.reason),this.close();break;case mi.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(kl);break;case mi.RESUME:this.handleDisconnect(kl)}}}makeRTCConfiguration(e){var n;const r=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),r.encodedInsertableStreams=!0),e.iceServers&&!r.iceServers){const i=[];e.iceServers.forEach(a=>{const o={urls:a.urls};a.username&&(o.username=a.username),a.credential&&(o.credential=a.credential),i.push(o)}),r.iceServers=i}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Wa.ENABLED&&(r.iceTransportPolicy="relay"),r.sdpSemantics="unified-plan",r.continualGatheringPolicy="gather_continually",r}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Pm,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Rm,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,r){return S(this,void 0,void 0,function*(){if(Hu())return yield this.createTransceiverRTCRtpSender(e,n,r);if(qu())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Ne("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,r,i){return S(this,void 0,void 0,function*(){if(Hu())return this.createSimulcastTransceiverSender(e,n,r,i);if(qu())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Ne("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,r){return S(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ne("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream),Di(e)&&(e.codec=n.videoCodec);const a={direction:"sendonly",streams:i};return r&&(a.sendEncodings=r),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,a)).sender})}createSimulcastTransceiverSender(e,n,r,i){return S(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ne("publisher is closed");const a={direction:"sendonly"};i&&(a.sendEncodings=i);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,a);if(r.videoCodec)return e.setSimulcastTrackSender(r.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return S(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ne("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return S(this,void 0,void 0,function*(){var n,r,i;if(!this._isClosed){if(this.attemptingReconnect){X.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===Wa.DISABLED||((i=(r=this.pcManager)===null||r===void 0?void 0:r.currentState)!==null&&i!==void 0?i:Se.NEW)===Se.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(a){this.reconnectAttempts+=1;let o=!0;a instanceof Ne?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:a})),o=!1):a instanceof Hr||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",Vr.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(B.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return S(this,void 0,void 0,function*(){var n,r,i;try{if(!this.url||!this.token)throw new Ne("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(B.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let a;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Hr;a=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof de&&o.reason===ee.NotAllowed?new Ne("could not reconnect, token might be expired"):new Hr}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(B.SignalRestarted,a),yield this.waitForPCReconnected(),this.client.currentState!==me.CONNECTED)throw new Hr("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(B.Restarted)}catch(a){const o=yield(r=this.regionUrlProvider)===null||r===void 0?void 0:r.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(i=this.regionUrlProvider)===null||i===void 0||i.resetAttempts(),a}})}resumeConnection(e){return S(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Ne("could not reconnect, url or token not saved");if(!this.pcManager)throw new Ne("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(B.Resuming);let r;try{this.setupSignalClientCallbacks(),r=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(i){let a="";throw i instanceof Error&&(a=i.message,this.log.error(i.message,Object.assign(Object.assign({},this.logContext),{error:i}))),i instanceof de&&i.reason===ee.NotAllowed?new Ne("could not reconnect, token might be expired"):i instanceof de&&i.reason===ee.LeaveRequest?i:new Hr(a)}if(this.emit(B.SignalResumed),r){const i=this.makeRTCConfiguration(r);this.pcManager.updateConfiguration(i)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==me.CONNECTED)throw new Hr("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(B.Resumed)})}waitForPCInitialConnection(e,n){return S(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ne("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return S(this,void 0,void 0,function*(){this.pcState=Dt.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield pt(eE),!this.pcManager)throw new Ne("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Dt.Connected}catch(e){throw this.pcState=Dt.Disconnected,new de("could not establish PC connection, ".concat(e.message),ee.InternalError)}})}publishRpcResponse(e,n,r,i){return S(this,void 0,void 0,function*(){const a=new at({destinationIdentities:[e],kind:te.RELIABLE,value:{case:"rpcResponse",value:new Cb({requestId:n,value:i?{case:"error",value:i.toProto()}:{case:"payload",value:r??""}})}});yield this.sendDataPacket(a,te.RELIABLE)})}publishRpcAck(e,n){return S(this,void 0,void 0,function*(){const r=new at({destinationIdentities:[e],kind:te.RELIABLE,value:{case:"rpcAck",value:new wb({requestId:n})}});yield this.sendDataPacket(r,te.RELIABLE)})}sendDataPacket(e,n){return S(this,void 0,void 0,function*(){const r=e.toBinary();yield this.ensurePublisherConnected(n);const i=this.dataChannelForKind(n);i&&i.send(r),this.updateAndEmitDCBufferStatus(n)})}waitForBufferStatusLow(e){return new Promise((n,r)=>S(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const i=()=>r("Engine closed");for(this.once(B.Closing,i);!this.dcBufferStatus.get(e);)yield pt(10);this.off(B.Closing,i),n()}}))}ensureDataTransportConnected(e){return S(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var a;if(!r.pcManager)throw new Ne("PC manager is closed");const o=i?r.pcManager.subscriber:r.pcManager.publisher,s=i?"Subscriber":"Publisher";if(!o)throw new de("".concat(s," connection not set"),ee.InternalError);let c=!1;!i&&!r.dataChannelForKind(n,i)&&(r.createDataChannels(),c=!0),!c&&!i&&!r.pcManager.publisher.isICEConnected&&r.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&r.negotiate();const l=r.dataChannelForKind(n,i);if((l==null?void 0:l.readyState)==="open")return;const u=new Date().getTime()+r.peerConnectionTimeout;for(;new Date().getTime()<u;){if(o.isICEConnected&&((a=r.dataChannelForKind(n,i))===null||a===void 0?void 0:a.readyState)==="open")return;yield pt(50)}throw new de("could not establish ".concat(s," connection, state: ").concat(o.getICEConnectionState()),ee.InternalError)}()})}ensurePublisherConnected(e){return S(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==Se.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return S(this,void 0,void 0,function*(){return new Promise((e,n)=>S(this,void 0,void 0,function*(){if(!this.pcManager){n(new Bu("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const r=new AbortController,i=()=>{r.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(B.Closing,i),this.pcManager.publisher.once(yi.RTPVideoPayloadTypes,a=>{const o=new Map;a.forEach(s=>{const c=s.codec.toLowerCase();f2(c)&&o.set(s.payload,c)}),this.emit(B.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(r),e()}catch(a){a instanceof Bu&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Vr.RR_UNKNOWN),n(a)}finally{this.off(B.Closing,i)}}))})}dataChannelForKind(e,n){if(n){if(e===te.LOSSY)return this.lossyDCSub;if(e===te.RELIABLE)return this.reliableDCSub}else{if(e===te.LOSSY)return this.lossyDC;if(e===te.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var r,i;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const a=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),s=(i=(r=this.signalOpts)===null||r===void 0?void 0:r.autoSubscribe)!==null&&i!==void 0?i:!0,c=new Array,l=new Array;e.forEach(u=>{u.isDesired!==s&&c.push(u.trackSid),u.isEnabled||l.push(u.trackSid)}),this.client.sendSyncState(new Ub({answer:a?Ws({sdp:a.sdp,type:a.type}):void 0,offer:o?Ws({sdp:o.sdp,type:o.type}):void 0,subscription:new wc({trackSids:c,subscribe:!s,participantTracks:[]}),publishTracks:w2(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:l}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(r,i)=>{(r==null?void 0:r.id)!==void 0&&r.id!==null&&e.push(new Fb({label:r.label,id:r.id,target:i}))};return n(this.dataChannelForKind(te.LOSSY),Vt.PUBLISHER),n(this.dataChannelForKind(te.RELIABLE),Vt.PUBLISHER),n(this.dataChannelForKind(te.LOSSY,!0),Vt.SUBSCRIBER),n(this.dataChannelForKind(te.RELIABLE,!0),Vt.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&He.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){lt()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){lt()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class Hr extends Error{}function nE(t){return t!==void 0&&t>13}function rE(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const r=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=r,e.destinationIdentities=r}class Xu{constructor(e,n){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return Wu(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return S(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const n=this.regionSettings.regions.filter(r=>!this.attemptedRegions.find(i=>i.url===r.url));if(n.length>0){const r=n[0];return this.attemptedRegions.push(r),X.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return S(this,void 0,void 0,function*(){const n=yield fetch("".concat(iE(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(n.ok){const r=yield n.json();return this.lastUpdateAt=Date.now(),r}else throw new de("Could not fetch region settings: ".concat(n.statusText),n.status===401?ee.NotAllowed:ee.InternalError,n.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function iE(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class My{get info(){return this._info}constructor(e,n,r){this.reader=n,this.totalByteSize=r,this._info=e,this.bytesReceived=0}}class aE extends My{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength;const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,r)}[Symbol.asyncIterator](){const e=this.reader.getReader();return{next:()=>S(this,void 0,void 0,function*(){try{const{done:n,value:r}=yield e.read();return n?{done:!0,value:void 0}:(this.handleChunkReceived(r),{done:!1,value:r.content})}catch{return{done:!0,value:void 0}}}),return(){return S(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return S(this,void 0,void 0,function*(){var e,n,r,i;let a=new Set;try{for(var o=!0,s=Dn(this),c;c=yield s.next(),e=c.done,!e;o=!0){i=c.value,o=!1;const l=i;a.add(l)}}catch(l){n={error:l}}finally{try{!o&&!e&&(r=s.return)&&(yield r.call(s))}finally{if(n)throw n.error}}return Array.from(a)})}}class oE extends My{constructor(e,n,r){super(e,n,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const r=ss(e.chunkIndex),i=this.receivedChunks.get(r);if(i&&i.version>e.version)return;this.receivedChunks.set(r,e),this.bytesReceived+=e.content.byteLength;const a=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,a)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder;return{next:()=>S(this,void 0,void 0,function*(){try{const{done:r,value:i}=yield e.read();return r?{done:!0,value:void 0}:(this.handleChunkReceived(i),{done:!1,value:n.decode(i.content)})}catch{return{done:!0,value:void 0}}}),return(){return S(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return S(this,void 0,void 0,function*(){var e,n,r,i;let a="";try{for(var o=!0,s=Dn(this),c;c=yield s.next(),e=c.done,!e;o=!0)i=c.value,o=!1,a+=i}catch(l){n={error:l}}finally{try{!o&&!e&&(r=s.return)&&(yield r.call(s))}finally{if(n)throw n.error}}return a})}}class sE{constructor(e,n,r){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=r,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return S(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class cE extends sE{}class Ly extends _{constructor(e,n,r,i,a){super(e,r,a),this.sid=n,this.receiver=i}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?U.Muted:U.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=r=>{r.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(U.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return S(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Mh)),C2()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const r=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(r){const{timestamp:i,rtpTimestamp:a}=r;a&&this.rtpTimestamp!==a&&(this.emit(U.TimeSyncUpdate,{timestamp:i,rtpTimestamp:a}),this.rtpTimestamp=a)}};e()}}class lE extends Ly{constructor(e,n,r,i,a,o){super(e,n,_.Kind.Audio,r,o),this.monitorReceiver=()=>S(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const s=yield this.getReceiverStats();s&&this.prevStats&&this.receiver&&(this._currentBitrate=xc(s,this.prevStats)),this.prevStats=s}),this.audioContext=i,this.webAudioPluginNodes=[],a&&(this.sinkId=a.deviceId)}setVolume(e){var n;for(const r of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):r.volume=e;sn()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(sn())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return S(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if($u(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&$u(e)&&e.setSinkId(this.sinkId),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let r=this.sourceNode;this.webAudioPluginNodes.forEach(i=>{r.connect(i),r=i}),this.gainNode=e.createGain(),r.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(U.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(i=>{this.emit(U.AudioPlaybackFailed,i)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return S(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(r=>{r.type==="inbound-rtp"&&(n={type:"audio",streamId:r.id,timestamp:r.timestamp,jitter:r.jitter,bytesReceived:r.bytesReceived,concealedSamples:r.concealedSamples,concealmentEvents:r.concealmentEvents,silentConcealedSamples:r.silentConcealedSamples,silentConcealmentEvents:r.silentConcealmentEvents,totalAudioEnergy:r.totalAudioEnergy,totalSamplesDuration:r.totalSamplesDuration})}),n})}}const wl=100;class uE extends Ly{constructor(e,n,r,i,a){super(e,n,_.Kind.Video,r,a),this.elementInfos=[],this.monitorReceiver=()=>S(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=xc(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=_h(()=>{this.updateDimensions()},wl),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?vi(this._mediaStreamTrack,n):ai(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new dE(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(r=>r===e);for(const r of n)r.stopObserving();this.elementInfos=this.elementInfos.filter(r=>r!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const r of n)this.stopObservingElement(r);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return S(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,r="",i=new Map;return e.forEach(a=>{a.type==="inbound-rtp"?(r=a.codecId,n={type:"video",streamId:a.id,framesDecoded:a.framesDecoded,framesDropped:a.framesDropped,framesReceived:a.framesReceived,packetsReceived:a.packetsReceived,packetsLost:a.packetsLost,frameWidth:a.frameWidth,frameHeight:a.frameHeight,pliCount:a.pliCount,firCount:a.firCount,nackCount:a.nackCount,jitter:a.jitter,timestamp:a.timestamp,bytesReceived:a.bytesReceived,decoderImplementation:a.decoderImplementation}):a.type==="codec"&&i.set(a.id,a)}),n&&r!==""&&i.get(r)&&(n.mimeType=i.get(r).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(r=>r.element===e);for(const r of n)this.stopObservingElementInfo(r)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return S(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,n;const r=this.elementInfos.reduce((s,c)=>Math.max(s,c.visibilityChangedAt||0),0),i=!((n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&n!==void 0)||n?this.isInBackground:!1,a=this.elementInfos.some(s=>s.pictureInPicture),o=this.elementInfos.some(s=>s.visible)&&!i||a;if(this.lastVisible!==o){if(!o&&Date.now()-r<wl){He.setTimeout(()=>{this.updateVisibility()},wl);return}this.lastVisible=o,this.emit(U.VisibilityChanged,o,this)}}updateDimensions(){var e,n;let r=0,i=0;const a=this.getPixelDensity();for(const o of this.elementInfos){const s=o.width()*a,c=o.height()*a;s+c>r+i&&(r=s,i=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===r&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===i||(this.lastDimensions={width:r,height:i},this.emit(U.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?sm():n||(sm()>2?2:1)}}class dE{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=r=>{var i;const{target:a,isIntersecting:o}=r;a===this.element&&(this.isIntersecting=o,this.isPiP=Qi(this.element),this.visibilityChangedAt=Date.now(),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this))},this.onEnterPiP=()=>{var r,i,a;(i=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Qi(this.element),(a=this.handleVisibilityChanged)===null||a===void 0||a.call(this)},this.onLeavePiP=()=>{var r;this.isPiP=Qi(this.element),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.element=e,this.isIntersecting=n??ed(e),this.isPiP=lt()&&Qi(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,r;this.isIntersecting=ed(this.element),this.isPiP=Qi(this.element),this.element.handleResize=()=>{var i;(i=this.handleResize)===null||i===void 0||i.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,lm().observe(this.element),cm().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(r=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,r,i,a;(e=lm())===null||e===void 0||e.unobserve(this.element),(n=cm())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(r=window.documentPictureInPicture)===null||r===void 0||r.removeEventListener("enter",this.onEnterPiP),(a=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||a===void 0||a.removeEventListener("pagehide",this.onLeavePiP)}}function Qi(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?ed(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function ed(t,e){const n=e||window;let r=t.offsetTop,i=t.offsetLeft;const a=t.offsetWidth,o=t.offsetHeight,{hidden:s}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,r+=t.offsetTop,i+=t.offsetLeft;return r<n.pageYOffset+n.innerHeight&&i<n.pageXOffset+n.innerWidth&&r+o>n.pageYOffset&&i+a>n.pageXOffset&&!s&&c!=="none"}class hn extends cn.EventEmitter{constructor(e,n,r,i){var a;super(),this.metadataMuted=!1,this.encryption=mt.NONE,this.log=X,this.handleMuted=()=>{this.emit(U.Muted)},this.handleUnmuted=()=>{this.emit(U.Unmuted)},this.log=Sn((a=i==null?void 0:i.loggerName)!==null&&a!==void 0?a:Kt.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=r,this.source=_.Source.Unknown}setTrack(e){this.track&&(this.track.off(U.Muted,this.handleMuted),this.track.off(U.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(U.Muted,this.handleMuted),e.on(U.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),ae(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==mt.NONE}get audioTrack(){if(Tn(this.track))return this.track}get videoTrack(){if(Di(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=_.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===_.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(hn||(hn={}));class td extends hn{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,r,i){super(e,n.sid,n.name,i),this.track=void 0,this.handleTrackEnded=()=>{this.emit(U.Ended)},this.updateInfo(n),this.setTrack(r)}setTrack(e){this.track&&this.track.off(U.Ended,this.handleTrackEnded),super.setTrack(e),e&&e.on(U.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return S(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return S(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return S(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return S(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(Tn(this.track)){const n=this.track.getSourceTrackSettings(),r=new Set;return n.autoGainControl&&r.add(tn.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&r.add(tn.TF_ECHO_CANCELLATION),n.noiseSuppression&&r.add(tn.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&r.add(tn.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||r.add(tn.TF_NO_DTX),this.track.enhancedNoiseCancellation&&r.add(tn.TF_ENHANCED_NOISE_CANCELLATION),Array.from(r.values())}else return[]}}var jn;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(jn||(jn={}));function hE(t){switch(t){case ia.EXCELLENT:return jn.Excellent;case ia.GOOD:return jn.Good;case ia.POOR:return jn.Poor;case ia.LOST:return jn.Lost;default:return jn.Unknown}}class Dy extends cn.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===qs.AGENT}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,r,i,a,o){let s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:qs.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=jn.Unknown,this.log=X,this.log=Sn((c=o==null?void 0:o.loggerName)!==null&&c!==void 0?c:Kt.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=r,this.metadata=i,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=s,this._attributes=a??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(_.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(_.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(_.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}_setMetadata(e){const n=this.metadata!==e,r=this.metadata;this.metadata=e,n&&this.emit(z.ParticipantMetadataChanged,r)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(z.ParticipantNameChanged,e)}_setAttributes(e){const n=S2(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(z.AttributesChanged,n)}setPermissions(e){var n,r,i,a,o,s;const c=this.permissions,l=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((r=this.permissions)===null||r===void 0?void 0:r.canSubscribe)||e.canPublishData!==((i=this.permissions)===null||i===void 0?void 0:i.canPublishData)||e.hidden!==((a=this.permissions)===null||a===void 0?void 0:a.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,d)=>{var h;return u!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[d])})||e.canSubscribeMetrics!==((s=this.permissions)===null||s===void 0?void 0:s.canSubscribeMetrics);return this.permissions=e,l&&this.emit(z.ParticipantPermissionsChanged,c),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(z.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=hE(e),n!==this._connectionQuality&&this.emit(z.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>Tn(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(U.Muted,()=>{this.emit(z.TrackMuted,e)}),e.on(U.Unmuted,()=>{this.emit(z.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case _.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case _.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function pE(t){var e,n,r;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new jb({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(r=t.allowAll)!==null&&r!==void 0?r:!1,trackSids:t.allowedTrackSids||[]})}const _o=15e3;class fE extends Dy{constructor(e,n,r,i,a){super(e,n,void 0,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=mt.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Cy)},this.handleReconnected=()=>{var o,s;(s=(o=this.reconnectFuture)===null||o===void 0?void 0:o.resolve)===null||s===void 0||s.call(o),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var o,s;this.reconnectFuture&&(this.reconnectFuture.promise.catch(c=>this.log.warn(c.message,this.logContext)),(s=(o=this.reconnectFuture)===null||o===void 0?void 0:o.reject)===null||s===void 0||s.call(o,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.handleSignalRequestResponse=o=>{const{requestId:s,reason:c,message:l}=o,u=this.pendingSignalRequests.get(s);u&&(c!==Sh.OK&&u.reject(new rm(l,c)),this.pendingSignalRequests.delete(s))},this.handleDataPacket=o=>{switch(o.value.case){case"rpcResponse":let s=o.value.value,c=null,l=null;s.value.case==="payload"?c=s.value.value:s.value.case==="error"&&(l=Ee.fromProto(s.value.value)),this.handleIncomingRpcResponse(s.requestId,c,l);break;case"rpcAck":let u=o.value.value;this.handleIncomingRpcAck(u.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(o=>pE(o)))},this.onTrackUnmuted=o=>{this.onTrackMuted(o,o.isUpstreamPaused)},this.onTrackMuted=(o,s)=>{if(s===void 0&&(s=!0),!o.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),ae(o)));return}this.engine.updateMuteStatus(o.sid,s)},this.onTrackUpstreamPaused=o=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),ae(o))),this.onTrackMuted(o,!0)},this.onTrackUpstreamResumed=o=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),ae(o))),this.onTrackMuted(o,o.isMuted)},this.onTrackFeatureUpdate=o=>{const s=this.audioTrackPublications.get(o.sid);if(!s){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(o.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(s.trackSid,s.getTrackFeatures())},this.handleSubscribedQualityUpdate=o=>S(this,void 0,void 0,function*(){var s,c,l,u,d,h;if(!(!((d=this.roomOptions)===null||d===void 0)&&d.dynacast))return;const p=this.videoTrackPublications.get(o.trackSid);if(!p){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}if(o.subscribedCodecs.length>0){if(!p.videoTrack)return;const f=yield p.videoTrack.setPublishingCodecs(o.subscribedCodecs);try{for(var b=!0,y=Dn(f),w;w=yield y.next(),s=w.done,!s;b=!0){u=w.value,b=!1;const g=u;r2(g)&&(this.log.debug("publish ".concat(g," for ").concat(p.videoTrack.sid),Object.assign(Object.assign({},this.logContext),ae(p))),yield this.publishAdditionalCodecForTrack(p.videoTrack,g,p.options))}}catch(g){c={error:g}}finally{try{!b&&!s&&(l=y.return)&&(yield l.call(y))}finally{if(c)throw c.error}}}else o.subscribedQualities.length>0&&(yield(h=p.videoTrack)===null||h===void 0?void 0:h.setPublishingLayers(o.subscribedQualities))}),this.handleLocalTrackUnpublished=o=>{const s=this.trackPublications.get(o.trackSid);if(!s){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}this.unpublishTrack(s.track)},this.handleTrackEnded=o=>S(this,void 0,void 0,function*(){if(o.source===_.Source.ScreenShare||o.source===_.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),ae(o))),this.unpublishTrack(o);else if(o.isUserProvided)yield o.mute();else if(hr(o)||Rn(o))try{if(lt())try{const s=yield navigator==null?void 0:navigator.permissions.query({name:o.source===_.Source.Camera?"camera":"microphone"});if(s&&s.state==="denied")throw this.log.warn("user has revoked access to ".concat(o.source),Object.assign(Object.assign({},this.logContext),ae(o))),s.onchange=()=>{s.state!=="denied"&&(o.isMuted||o.restartTrack(),s.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}o.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),ae(o))),hr(o)?yield o.restartTrack({deviceId:"default"}):yield o.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),ae(o))),yield o.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=r,this.roomOptions=i,this.setupEngine(r),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=a}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==mt.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){this.engine=e,this.engine.on(B.RemoteMute,(n,r)=>{const i=this.trackPublications.get(n);!i||!i.track||(r?i.mute():i.unmute())}),this.engine.on(B.Connected,this.handleReconnected).on(B.SignalRestarted,this.handleReconnected).on(B.SignalResumed,this.handleReconnected).on(B.Restarting,this.handleReconnecting).on(B.Resuming,this.handleReconnecting).on(B.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(B.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(B.Disconnected,this.handleDisconnected).on(B.SignalRequestResponse,this.handleSignalRequestResponse).on(B.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return S(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return S(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return S(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return S(this,arguments,void 0,function(n){var r=this;let{metadata:i,name:a,attributes:o}=n;return function*(){return new Promise((s,c)=>S(r,void 0,void 0,function*(){var l,u;try{let d=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((l=i??this.metadata)!==null&&l!==void 0?l:"",(u=a??this.name)!==null&&u!==void 0?u:"",o),p=performance.now();for(this.pendingSignalRequests.set(h,{resolve:s,reject:b=>{c(b),d=!0},values:{name:a,metadata:i,attributes:o}});performance.now()-p<5e3&&!d;){if((!a||this.name===a)&&(!i||this.metadata===i)&&(!o||Object.entries(o).every(b=>{let[y,w]=b;return this.attributes[y]===w||w===""&&!this.attributes[y]}))){this.pendingSignalRequests.delete(h),s();return}yield pt(50)}c(new rm("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error&&c(d)}}))}()})}setCameraEnabled(e,n,r){return this.setTrackEnabled(_.Source.Camera,e,n,r)}setMicrophoneEnabled(e,n,r){return this.setTrackEnabled(_.Source.Microphone,e,n,r)}setScreenShareEnabled(e,n,r){return this.setTrackEnabled(_.Source.ScreenShare,e,n,r)}setPermissions(e){const n=this.permissions,r=super.setPermissions(e);return r&&n&&this.emit(z.ParticipantPermissionsChanged,n),r}setE2EEEnabled(e){return S(this,void 0,void 0,function*(){this.encryptionType=e?mt.GCM:mt.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,r,i){return S(this,void 0,void 0,function*(){var a,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let s=this.getTrackPublication(e);if(n)if(s)yield s.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield l==null?void 0:l.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case _.Source.Camera:c=yield this.createTracks({video:(a=r)!==null&&a!==void 0?a:!0});break;case _.Source.Microphone:c=yield this.createTracks({audio:(o=r)!==null&&o!==void 0?o:!0});break;case _.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},r));break;default:throw new fn(e)}}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l instanceof Error&&this.emit(z.MediaDevicesError,l),this.pendingPublishing.delete(e),l}try{const l=[];for(const u of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),ae(u))),l.push(this.publishTrack(u,i));[s]=yield Promise.all(l)}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l}finally{this.pendingPublishing.delete(e)}}else if(!(s!=null&&s.track)&&this.pendingPublishing.has(e)&&(s=yield this.waitForPendingPublicationOfSource(e),s||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),s&&s.track)if(e===_.Source.ScreenShare){s=yield this.unpublishTrack(s.track);const c=this.getTrackPublication(_.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield s.mute();return s})}enableCameraAndMicrophone(){return S(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(_.Source.Camera)||this.pendingPublishing.has(_.Source.Microphone))){this.pendingPublishing.add(_.Source.Camera),this.pendingPublishing.add(_.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(_.Source.Camera),this.pendingPublishing.delete(_.Source.Microphone)}}})}createTracks(e){return S(this,void 0,void 0,function*(){var n,r;e??(e={});const i=Sy(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(r=this.roomOptions)===null||r===void 0?void 0:r.videoCaptureDefaults),{audioProcessor:a,videoProcessor:o,optionsWithoutProcessor:s}=Ph(i),c=Tc(s);let l;try{l=yield navigator.mediaDevices.getUserMedia(c)}catch(u){throw u instanceof Error&&(c.audio&&(this.microphoneError=u),c.video&&(this.cameraError=u)),u}return c.audio&&(this.microphoneError=void 0,this.emit(z.AudioStreamAcquired)),c.video&&(this.cameraError=void 0),Promise.all(l.getTracks().map(u=>S(this,void 0,void 0,function*(){const d=u.kind==="audio";let h;const p=d?c.audio:c.video;typeof p!="boolean"&&(h=p);const b=Oy(u,h,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return b.kind===_.Kind.Video?b.source=_.Source.Camera:b.kind===_.Kind.Audio&&(b.source=_.Source.Microphone,b.setAudioContext(this.audioContext)),b.mediaStream=l,Tn(b)&&a?yield b.setProcessor(a):Di(b)&&o&&(yield b.setProcessor(o)),b})))})}createScreenTracks(e){return S(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new xh("getDisplayMedia not supported");e.resolution===void 0&&!l2()&&(e.resolution=Eh.h1080fps30.resolution);const n=k2(e),r=yield navigator.mediaDevices.getDisplayMedia(n),i=r.getVideoTracks();if(i.length===0)throw new fn("no video track found");const a=new Zs(i[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=_.Source.ScreenShare,e.contentHint&&(a.mediaStreamTrack.contentHint=e.contentHint);const o=[a];if(r.getAudioTracks().length>0){this.emit(z.AudioStreamAcquired);const s=new Ks(r.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=_.Source.ScreenShareAudio,o.push(s)}return o})}publishTrack(e,n){return S(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return S(this,arguments,void 0,function(r,i){var a=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var s,c,l,u;hr(r)&&r.setAudioContext(a.audioContext),yield(s=a.reconnectFuture)===null||s===void 0?void 0:s.promise,a.republishPromise&&!o&&(yield a.republishPromise),bi(r)&&a.pendingPublishPromises.has(r)&&(yield a.pendingPublishPromises.get(r));let d;if(r instanceof MediaStreamTrack)d=r.getConstraints();else{d=r.constraints;let f;switch(r.source){case _.Source.Microphone:f="audioinput";break;case _.Source.Camera:f="videoinput"}f&&a.activeDeviceMap.has(f)&&(d=Object.assign(Object.assign({},d),{deviceId:a.activeDeviceMap.get(f)}))}if(r instanceof MediaStreamTrack)switch(r.kind){case"audio":r=new Ks(r,d,!0,a.audioContext,{loggerName:a.roomOptions.loggerName,loggerContextCb:()=>a.logContext});break;case"video":r=new Zs(r,d,!0,{loggerName:a.roomOptions.loggerName,loggerContextCb:()=>a.logContext});break;default:throw new fn("unsupported MediaStreamTrack kind ".concat(r.kind))}else r.updateLoggerOptions({loggerName:a.roomOptions.loggerName,loggerContextCb:()=>a.logContext});let h;if(a.trackPublications.forEach(f=>{f.track&&f.track===r&&(h=f)}),h)return a.log.warn("track has already been published, skipping",Object.assign(Object.assign({},a.logContext),ae(h))),h;const p="channelCount"in r.mediaStreamTrack.getSettings()&&r.mediaStreamTrack.getSettings().channelCount===2||r.mediaStreamTrack.getConstraints().channelCount===2,b=(c=i==null?void 0:i.forceStereo)!==null&&c!==void 0?c:p;b&&(i||(i={}),i.dtx===void 0&&a.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},a.logContext),ae(r))),i.red===void 0&&a.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=i.dtx)!==null&&l!==void 0||(i.dtx=!1),(u=i.red)!==null&&u!==void 0||(i.red=!1));const y=Object.assign(Object.assign({},a.roomOptions.publishDefaults),i);!u2()&&a.roomOptions.e2ee&&(a.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},a.logContext)),y.simulcast=!1),y.source&&(r.source=y.source);const w=a.publish(r,y,b);a.pendingPublishPromises.set(r,w);try{return yield w}catch(f){throw f}finally{a.pendingPublishPromises.delete(r)}}()})}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),ae(e))),!1;const{canPublish:n,canPublishSources:r}=this.permissions;return n&&(r.length===0||r.map(i=>T2(i)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),ae(e))),!1)}publish(e,n,r){return S(this,void 0,void 0,function*(){var i,a,o,s,c,l,u,d,h,p;if(!this.hasPermissionsToPublish(e))throw new Kx("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(v=>bi(e)&&v.source===e.source)&&e.source!==_.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),ae(e))),n.stopMicTrackOnMute&&Tn(e)&&(e.stopOnMute=!0),e.source===_.Source.ScreenShare&&Ii()&&(n.simulcast=!1),n.videoCodec==="av1"&&!o2()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!s2()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=Ju),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(v=>n.videoCodec===cs(v.mime))||(n.videoCodec=cs(this.enabledPublishVideoCodecs[0].mime)));const b=n.videoCodec;e.on(U.Muted,this.onTrackMuted),e.on(U.Unmuted,this.onTrackUnmuted),e.on(U.Ended,this.handleTrackEnded),e.on(U.UpstreamPaused,this.onTrackUpstreamPaused),e.on(U.UpstreamResumed,this.onTrackUpstreamResumed),e.on(U.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const y=new _u({cid:e.mediaStreamTrack.id,name:n.name,type:_.kindToProto(e.kind),muted:e.isMuted,source:_.sourceToProto(e.source),disableDtx:!(!((i=n.dtx)!==null&&i!==void 0)||i),encryption:this.encryptionType,stereo:r,disableRed:this.isE2EEEnabled||!(!((a=n.red)!==null&&a!==void 0)||a),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy});let w;if(e.kind===_.Kind.Video){let v={width:0,height:0};try{v=yield e.waitForDimensions()}catch{const C=(s=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&s!==void 0?s:Ga.h720.resolution;v={width:C.width,height:C.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),ae(e)),{dims:v}))}y.width=v.width,y.height=v.height,Rn(e)&&(va(b)&&(e.source===_.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),ae(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),y.simulcastCodecs=[new Iu({codec:b,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:Ju}),n.backupCodec&&b!==n.backupCodec.codec&&y.encryption===mt.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),y.simulcastCodecs.push(new Iu({codec:n.backupCodec.codec,cid:""})))),w=Yu(e.source===_.Source.ScreenShare,y.width,y.height,n),y.layers=Em(y.width,y.height,w,va(n.videoCodec))}else e.kind===_.Kind.Audio&&(w=[{maxBitrate:(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(d=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(p=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&p!==void 0?p:"high"}]);if(!this.engine||this.engine.isClosed)throw new Ne("cannot publish track when not connected");const f=()=>S(this,void 0,void 0,function*(){var v,C,T;if(!this.engine.pcManager)throw new Ne("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,w),Rn(e)&&((v=n.degradationPreference)!==null&&v!==void 0||(n.degradationPreference=Y2(e)),e.setDegradationPreference(n.degradationPreference)),w)if(Ii()&&e.kind===_.Kind.Audio){let E;for(const x of this.engine.pcManager.publisher.getTransceivers())if(x.sender===e.sender){E=x;break}E&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:E,codec:"opus",maxbr:!((C=w[0])===null||C===void 0)&&C.maxBitrate?w[0].maxBitrate/1e3:0})}else e.codec&&va(e.codec)&&!((T=w[0])===null||T===void 0)&&T.maxBitrate&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:y.cid,codec:e.codec,maxbr:w[0].maxBitrate/1e3});yield this.engine.negotiate()});let g;if(this.enabledPublishVideoCodecs.length>0)g=(yield Promise.all([this.engine.addTrack(y),f()]))[0];else{g=yield this.engine.addTrack(y);let v;if(g.codecs.forEach(C=>{v===void 0&&(v=C.mimeType)}),v&&e.kind===_.Kind.Video){const C=cs(v);C!==b&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),ae(e)),{codec:C})),n.videoCodec=C,w=Yu(e.source===_.Source.ScreenShare,y.width,y.height,n))}yield f()}const m=new td(e.kind,g,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return m.options=n,e.sid=g.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:w,trackInfo:g})),Rn(e)?e.startMonitor(this.engine.client):hr(e)&&e.startMonitor(),this.addTrackPublication(m),this.emit(z.LocalTrackPublished,m),m})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,r){return S(this,void 0,void 0,function*(){var i;if(this.encryptionType!==mt.NONE)return;let a;if(this.trackPublications.forEach(h=>{h.track&&h.track===e&&(a=h)}),!a)throw new fn("track is not published");if(!Rn(e))throw new fn("track is not a video track");const o=Object.assign(Object.assign({},(i=this.roomOptions)===null||i===void 0?void 0:i.publishDefaults),r),s=Z2(e,n,o);if(!s){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),ae(e)));return}const c=e.addSimulcastTrack(n,s);if(!c)return;const l=new _u({cid:c.mediaStreamTrack.id,type:_.kindToProto(e.kind),muted:e.isMuted,source:_.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=Em(l.width,l.height,s),!this.engine||this.engine.isClosed)throw new Ne("cannot publish track when not connected");const u=()=>S(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,o,s),yield this.engine.negotiate()}),d=(yield Promise.all([this.engine.addTrack(l),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:s,trackInfo:d}))})}unpublishTrack(e,n){return S(this,void 0,void 0,function*(){var r,i;if(bi(e)){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),ae(e))),yield l)}const a=this.getPublicationForTrack(e),o=a?ae(a):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!a||!a.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=a.track,e.off(U.Muted,this.onTrackMuted),e.off(U.Unmuted,this.onTrackUnmuted),e.off(U.Ended,this.handleTrackEnded),e.off(U.UpstreamPaused,this.onTrackUpstreamPaused),e.off(U.UpstreamResumed,this.onTrackUpstreamResumed),e.off(U.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(i=(r=this.roomOptions)===null||r===void 0?void 0:r.stopLocalTrackOnUnpublish)!==null&&i!==void 0?i:!0),n?e.stop():e.stopMonitor();let s=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Se.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",s=!0);if(this.engine.removeTrack(c)&&(s=!0),Rn(e)){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(s=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:l}))}switch(this.trackPublications.delete(a.trackSid),a.kind){case _.Kind.Audio:this.audioTrackPublications.delete(a.trackSid);break;case _.Kind.Video:this.videoTrackPublications.delete(a.trackSid);break}return this.emit(z.LocalTrackUnpublished,a),a.setTrack(void 0),s&&(yield this.engine.negotiate()),a})}unpublishTracks(e){return S(this,void 0,void 0,function*(){return(yield Promise.all(e.map(n=>this.unpublishTrack(n)))).filter(n=>!!n)})}republishAllTracks(e){return S(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){r.republishPromise&&(yield r.republishPromise),r.republishPromise=new Promise((a,o)=>S(r,void 0,void 0,function*(){try{const s=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),s.push(c))}),yield Promise.all(s.map(c=>S(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),i&&!l.isMuted&&l.source!==_.Source.ScreenShare&&l.source!==_.Source.ScreenShareAudio&&(hr(l)||Rn(l))&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),a()}catch(s){o(s)}finally{this.republishPromise=void 0}})),yield r.republishPromise}()})}publishData(e){return S(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const a=i.reliable?te.RELIABLE:te.LOSSY,o=i.destinationIdentities,s=i.topic,c=new at({kind:a,value:{case:"user",value:new bb({participantIdentity:r.identity,payload:n,destinationIdentities:o,topic:s})}});yield r.engine.sendDataPacket(c,a)}()})}publishDtmf(e,n){return S(this,void 0,void 0,function*(){const r=new at({kind:te.RELIABLE,value:{case:"sipDtmf",value:new yb({code:e,digit:n})}});yield this.engine.sendDataPacket(r,te.RELIABLE)})}sendChatMessage(e,n){return S(this,void 0,void 0,function*(){const r={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},i=new at({value:{case:"chatMessage",value:new Su(Object.assign(Object.assign({},r),{timestamp:be.parse(r.timestamp)}))}});return yield this.engine.sendDataPacket(i,te.RELIABLE),this.emit(z.ChatMessage,r),r})}editChatMessage(e,n){return S(this,void 0,void 0,function*(){const r=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),i=new at({value:{case:"chatMessage",value:new Su(Object.assign(Object.assign({},r),{timestamp:be.parse(r.timestamp),editTimestamp:be.parse(r.editTimestamp)}))}});return yield this.engine.sendDataPacket(i,te.RELIABLE),this.emit(z.ChatMessage,r),r})}sendText(e,n){return S(this,void 0,void 0,function*(){var r;const i=crypto.randomUUID(),a=new TextEncoder().encode(e).byteLength,o=(r=n==null?void 0:n.attachments)===null||r===void 0?void 0:r.map(()=>crypto.randomUUID()),s=new Array(o?o.length+1:1).fill(0),c=(u,d)=>{var h;s[d]=u;const p=s.reduce((b,y)=>b+y,0);(h=n==null?void 0:n.onProgress)===null||h===void 0||h.call(n,p)},l=yield this.streamText({streamId:i,totalSize:a,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:o,attributes:n==null?void 0:n.attributes});return yield l.write(e),c(1,0),yield l.close(),n!=null&&n.attachments&&o&&(yield Promise.all(n.attachments.map((u,d)=>S(this,void 0,void 0,function*(){return this._sendFile(o[d],u,{topic:n.topic,mimeType:u.type,onProgress:h=>{c(h,d+1)}})})))),l.info})}streamText(e){return S(this,void 0,void 0,function*(){var n,r;const i=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),a={id:i,mimeType:"text/plain",timestamp:Date.now(),topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes},o=new xu({streamId:i,mimeType:a.mimeType,topic:a.topic,timestamp:dr(a.timestamp),totalLength:dr(e==null?void 0:e.totalSize),attributes:a.attributes,contentHeader:{case:"textHeader",value:new Ib({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?Tu.UPDATE:Tu.CREATE})}}),s=e==null?void 0:e.destinationIdentities,c=new at({destinationIdentities:s,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(c,te.RELIABLE);let l=0;const u=this,d=new WritableStream({write(b){return S(this,void 0,void 0,function*(){for(const y of y2(b,_o)){yield u.engine.waitForBufferStatusLow(te.RELIABLE);const w=new Eu({content:y,streamId:i,chunkIndex:dr(l)}),f=new at({destinationIdentities:s,value:{case:"streamChunk",value:w}});yield u.engine.sendDataPacket(f,te.RELIABLE),l+=1}})},close(){return S(this,void 0,void 0,function*(){const b=new Pu({streamId:i}),y=new at({destinationIdentities:s,value:{case:"streamTrailer",value:b}});yield u.engine.sendDataPacket(y,te.RELIABLE)})},abort(b){console.log("Sink error:",b)}});let h=()=>S(this,void 0,void 0,function*(){yield p.close()});u.engine.once(B.Closing,h);const p=new cE(d,a,()=>this.engine.off(B.Closing,h));return p})}sendFile(e,n){return S(this,void 0,void 0,function*(){const r=crypto.randomUUID();return yield this._sendFile(r,e,n),{id:r}})}_sendFile(e,n,r){return S(this,void 0,void 0,function*(){var i,a;const o=n.size,s=new xu({totalLength:dr(o),mimeType:(i=r==null?void 0:r.mimeType)!==null&&i!==void 0?i:n.type,streamId:e,topic:r==null?void 0:r.topic,encryptionType:r==null?void 0:r.encryptionType,timestamp:dr(Date.now()),contentHeader:{case:"byteHeader",value:new _b({name:n.name})}}),c=r==null?void 0:r.destinationIdentities,l=new at({destinationIdentities:c,value:{case:"streamHeader",value:s}});yield this.engine.sendDataPacket(l,te.RELIABLE);function u(b){return new Promise(y=>{const w=new FileReader;w.onload=()=>{y(new Uint8Array(w.result))},w.readAsArrayBuffer(b)})}const d=Math.ceil(o/_o);for(let b=0;b<d;b++){const y=yield u(n.slice(b*_o,Math.min((b+1)*_o,o)));yield this.engine.waitForBufferStatusLow(te.RELIABLE);const w=new Eu({content:y,streamId:e,chunkIndex:dr(b)}),f=new at({destinationIdentities:c,value:{case:"streamChunk",value:w}});yield this.engine.sendDataPacket(f,te.RELIABLE),(a=r==null?void 0:r.onProgress)===null||a===void 0||a.call(r,(b+1)/d)}const h=new Pu({streamId:e}),p=new at({destinationIdentities:c,value:{case:"streamTrailer",value:h}});yield this.engine.sendDataPacket(p,te.RELIABLE)})}performRpc(e){return S(this,arguments,void 0,function(n){var r=this;let{destinationIdentity:i,method:a,payload:o,responseTimeout:s=1e4}=n;return function*(){return new Promise((c,l)=>S(r,void 0,void 0,function*(){var u,d,h,p;if(Nh(o)>Iy){l(Ee.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((d=(u=this.engine.latestJoinResponse)===null||u===void 0?void 0:u.serverInfo)===null||d===void 0)&&d.version&&Or((p=(h=this.engine.latestJoinResponse)===null||h===void 0?void 0:h.serverInfo)===null||p===void 0?void 0:p.version,"1.8.0")<0){l(Ee.builtIn("UNSUPPORTED_SERVER"));return}const b=crypto.randomUUID();yield this.publishRpcRequest(i,b,a,o,s-2e3);const y=setTimeout(()=>{this.pendingAcks.delete(b),l(Ee.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(b),clearTimeout(w)},2e3);this.pendingAcks.set(b,{resolve:()=>{clearTimeout(y)},participantIdentity:i});const w=setTimeout(()=>{this.pendingResponses.delete(b),l(Ee.builtIn("RESPONSE_TIMEOUT"))},s);this.pendingResponses.set(b,{resolve:(f,g)=>{clearTimeout(w),this.pendingAcks.has(b)&&(console.warn("RPC response received before ack",b),this.pendingAcks.delete(b),clearTimeout(y)),g?l(g):c(f??"")},participantIdentity:i})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,r){const i=this.pendingResponses.get(e);i?(i.resolve(n,r),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,r,i,a){return S(this,void 0,void 0,function*(){const o=new at({destinationIdentities:[e],kind:te.RELIABLE,value:{case:"rpcRequest",value:new kb({id:n,method:r,payload:i,responseTimeoutMs:a,version:1})}});yield this.engine.sendDataPacket(o,te.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:r}]of this.pendingAcks)r===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:r,resolve:i}]of this.pendingResponses)r===e&&(i(null,Ee.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return e.sid!==this.sid||!super.updateInfo(e)?!1:(e.tracks.forEach(n=>{var r,i;const a=this.trackPublications.get(n.sid);if(a){const o=a.isMuted||((i=(r=a.track)===null||r===void 0?void 0:r.isUpstreamPaused)!==null&&i!==void 0?i:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),ae(a)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(r=>{const i=r.track;i&&(e instanceof MediaStreamTrack?(hr(i)||Rn(i))&&i.mediaStreamTrack===e&&(n=r):e===i&&(n=r))}),n}waitForPendingPublicationOfSource(e){return S(this,void 0,void 0,function*(){const n=Date.now();for(;Date.now()<n+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(i=>{let[a]=i;return a.source===e});if(r)return r[1];yield pt(20)}})}}class mE extends hn{constructor(e,n,r,i){super(e,n.sid,n.name,i),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=Et.HIGH,this.handleEnded=a=>{this.setTrack(void 0),this.emit(U.Ended,a)},this.handleVisibilityChange=a=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(a),this.logContext),this.disabled=!a,this.emitTrackUpdate()},this.handleVideoDimensionsChange=a=>{this.log.debug("adaptivestream video dimensions ".concat(a.width,"x").concat(a.height),this.logContext),this.videoDimensions=a,this.emitTrackUpdate()},this.subscribed=r,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,r=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const i=new wc({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Tb({participantSid:"",trackSids:[this.trackSid]})]});this.emit(U.UpdateSubscription,i),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(r)}get subscriptionStatus(){return this.subscribed===!1?hn.SubscriptionStatus.Unsubscribed:super.isSubscribed?hn.SubscriptionStatus.Subscribed:hn.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?hn.PermissionStatus.Allowed:hn.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.disabled===!e||(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.currentVideoQuality===e||(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,r;this.isManualOperationAllowed()&&(((n=this.videoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((r=this.videoDimensions)===null||r===void 0?void 0:r.height)===e.height||(ml(this.track)&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&ml(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const n=this.subscriptionStatus,r=this.permissionStatus,i=this.track;i!==e&&(i&&(i.off(U.VideoDimensionsChanged,this.handleVideoDimensionsChange),i.off(U.VisibilityChanged,this.handleVisibilityChange),i.off(U.Ended,this.handleEnded),i.detach(),i.stopMonitor(),this.emit(U.Unsubscribed,i)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(U.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(U.VisibilityChanged,this.handleVisibilityChange),e.on(U.Ended,this.handleEnded),this.emit(U.Subscribed,e)),this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,r=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(U.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?U.Muted:U.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(U.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(U.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===_.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return ml(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new Ob({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?e.quality=this.currentVideoQuality:e.quality=Et.HIGH,this.emit(U.UpdateSettings,e)}}class Js extends Dy{static fromParticipantInfo(e,n,r){return new Js(e,n.sid,n.identity,n.name,n.metadata,n.attributes,r,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,r,i,a,o,s){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:qs.STANDARD;super(n,r||"",i,a,o,s,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(U.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),ae(e))),this.signalClient.sendUpdateTrackSettings(n)}),e.on(U.UpdateSubscription,n=>{n.participantTracks.forEach(r=>{r.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(U.SubscriptionPermissionChanged,n=>{this.emit(z.TrackSubscriptionPermissionChanged,e,n)}),e.on(U.SubscriptionStatusChanged,n=>{this.emit(z.TrackSubscriptionStatusChanged,e,n)}),e.on(U.Subscribed,n=>{this.emit(z.TrackSubscribed,n,e)}),e.on(U.Unsubscribed,n=>{this.emit(z.TrackUnsubscribed,n,e)}),e.on(U.SubscriptionFailed,n=>{this.emit(z.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_.Source.Microphone;this.volumeMap.set(n,e);const r=this.getTrackPublication(n);r&&r.track&&r.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,r,i,a,o){let s=this.getTrackPublicationBySid(n);if(s||n.startsWith("TR")||this.trackPublications.forEach(u=>{!s&&e.kind===u.kind.toString()&&(s=u)}),!s){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(z.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,r,i,a,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),ae(s))),this.emit(z.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let l;return c?l=new uE(e,n,i,a):l=new lE(e,n,i,this.audioContext,this.audioOutput),l.source=s.source,l.isMuted=s.isMuted,l.setMediaStream(r),l.start(),s.setTrack(l),this.volumeMap.has(s.source)&&Gu(l)&&Tn(l)&&l.setVolume(this.volumeMap.get(s.source)),s}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,r=new Map;return e.tracks.forEach(i=>{var a,o;let s=this.getTrackPublicationBySid(i.sid);if(s)s.updateInfo(i);else{const c=_.kindFromProto(i.type);if(!c)return;s=new mE(c,i,(a=this.signalClient.connectOptions)===null||a===void 0?void 0:a.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),s.updateInfo(i),r.set(i.sid,s);const l=Array.from(this.trackPublications.values()).find(u=>u.source===(s==null?void 0:s.source));l&&s.source!==_.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(s.source),Object.assign(Object.assign({},this.logContext),{oldTrack:ae(l),newTrack:ae(s)})),this.addTrackPublication(s)}n.set(i.sid,s)}),this.trackPublications.forEach(i=>{n.has(i.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),ae(i))),this.unpublishTrack(i.trackSid,!0))}),r.forEach(i=>{this.emit(z.TrackPublished,i)}),!0}unpublishTrack(e,n){const r=this.trackPublications.get(e);if(!r)return;const{track:i}=r;switch(i&&(i.stop(),r.setTrack(void 0)),this.trackPublications.delete(e),r.kind){case _.Kind.Audio:this.audioTrackPublications.delete(e);break;case _.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(z.TrackUnpublished,r)}setAudioOutput(e){return S(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(r=>{var i;Tn(r.track)&&Gu(r.track)&&n.push(r.track.setSinkId((i=e.deviceId)!==null&&i!==void 0?i:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:r})),super.emit(e,...r)}}var re;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(re||(re={}));const gE=4*1e3;class _i extends cn.EventEmitter{constructor(e){var n,r,i,a;if(super(),n=this,this.state=re.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=X,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=(o,s,c)=>S(this,void 0,void 0,function*(){var l;if(!c2())throw sn()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===re.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(re.Connecting),((l=this.regionUrlProvider)===null||l===void 0?void 0:l.getServerUrl().toString())!==o&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Wu(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Xu(o,s):this.regionUrlProvider.updateToken(s),this.regionUrlProvider.fetchRegionSettings().then(p=>{var b;(b=this.regionUrlProvider)===null||b===void 0||b.setServerReportedRegions(p)}).catch(p=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:p}))}));const d=(p,b,y)=>S(this,void 0,void 0,function*(){var w,f;this.abortController&&this.abortController.abort();const g=new AbortController;this.abortController=g,u==null||u();try{yield this.attemptConnection(y??o,s,c,g),this.abortController=void 0,p()}catch(m){if(this.regionUrlProvider&&m instanceof de&&m.reason!==ee.Cancelled&&m.reason!==ee.NotAllowed){let v=null;try{v=yield this.regionUrlProvider.getNextBestRegionUrl((w=this.abortController)===null||w===void 0?void 0:w.signal)}catch(C){if(C instanceof de&&(C.status===401||C.reason===ee.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),b(C);return}}v&&!(!((f=this.abortController)===null||f===void 0)&&f.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(m.message,". Retrying with another region: ").concat(v),this.logContext),this.recreateEngine(),yield d(p,b,v)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,dm(m)),b(m))}else{let v=Ht.UNKNOWN_REASON;m instanceof de&&(v=dm(m)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,v),b(m)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Cy((p,b)=>{d(p,b,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,s,c,l,u,d)=>S(this,void 0,void 0,function*(){var h,p,b;const y=yield c.join(o,s,{autoSubscribe:l.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:l.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:l.websocketTimeout},d.signal);let w=y.serverInfo;if(w||(w={version:y.serverVersion,region:y.serverRegion}),this.serverInfo=w,this.log.debug("connected to Livekit Server ".concat(Object.entries(w).map(f=>{let[g,m]=f;return"".concat(g,": ").concat(m)}).join(", ")),{room:(h=y.room)===null||h===void 0?void 0:h.name,roomSid:(p=y.room)===null||p===void 0?void 0:p.sid,identity:(b=y.participant)===null||b===void 0?void 0:b.identity}),!w.version)throw new Wx("unknown server version");return w.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),y}),this.applyJoinResponse=o=>{const s=o.participant;if(this.localParticipant.sid=s.sid,this.localParticipant.identity=s.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([s,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,s,c,l)=>S(this,void 0,void 0,function*(){var u,d;this.state===re.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((d=this.regionUrlProvider)===null||d===void 0)&&d.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Oh),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(o,s,this.engine,this.connOptions,this.options,l);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(j.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const p=new de("could not establish signal connection",ee.ServerUnreachable);throw h instanceof Error&&(p.message="".concat(p.message,": ").concat(h.message)),h instanceof de&&(p.reason=h.reason,p.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),p}if(l.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new de("Connection attempt aborted",ee.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,l)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}lt()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),lt()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(re.Connected),this.emit(j.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];return S(n,[...s],void 0,function(){var l=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var d,h,p,b;const y=yield l.disconnectLock.lock();try{if(l.state===re.Disconnected){l.log.debug("already disconnected",l.logContext);return}l.log.info("disconnect from room",Object.assign({},l.logContext)),(l.state===re.Connecting||l.state===re.Reconnecting||l.isResuming)&&(l.log.warn("abort connection attempt",l.logContext),(d=l.abortController)===null||d===void 0||d.abort(),(p=(h=l.connectFuture)===null||h===void 0?void 0:h.reject)===null||p===void 0||p.call(h,new de("Client initiated disconnect",ee.Cancelled)),l.connectFuture=void 0),!((b=l.engine)===null||b===void 0)&&b.client.isDisconnected||(yield l.engine.client.sendLeave()),l.engine&&(yield l.engine.close()),l.handleDisconnect(u,Ht.CLIENT_INITIATED),l.engine=void 0}finally{y()}}()})},this.onPageLeave=()=>S(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>S(this,void 0,void 0,function*(){const o=[],s=Gt();if(s&&s.os==="iOS"){const c="livekit-dummy-audio-el";let l=document.getElementById(c);if(!l){l=document.createElement("audio"),l.id=c,l.autoplay=!0,l.hidden=!0;const u=fl();u.enabled=!0;const d=new MediaStream([u]);l.srcObject=d,document.addEventListener("visibilitychange",()=>{l&&(l.srcObject=document.hidden?null:d,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(l),this.once(j.Disconnected,()=>{l==null||l.remove(),l=null})}o.push(l)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(l=>{l.track&&l.track.attachedElements.forEach(u=>{o.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>S(this,void 0,void 0,function*(){const o=[];for(const s of this.remoteParticipants.values())s.videoTrackPublications.forEach(c=>{var l;(l=c.track)===null||l===void 0||l.attachedElements.forEach(u=>{o.includes(u)||o.push(u)})});yield Promise.all(o.map(s=>s.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(s=>{s.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(re.Reconnecting)&&this.emit(j.Reconnecting)},this.handleSignalRestarted=o=>S(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(s){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:s}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(re.Connected),this.emit(j.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(s=>{var c;if(s.identity===this.localParticipant.identity){this.localParticipant.updateInfo(s);return}s.identity===""&&(s.identity=(c=this.sidToIdentity.get(s.sid))!==null&&c!==void 0?c:"");let l=this.remoteParticipants.get(s.identity);s.state===Cu.DISCONNECTED?this.handleParticipantDisconnected(s.identity,l):l=this.getOrCreateParticipant(s.identity,s)})},this.handleActiveSpeakersUpdate=o=>{const s=[],c={};o.forEach(l=>{if(c[l.sid]=!0,l.sid===this.localParticipant.sid)this.localParticipant.audioLevel=l.level,this.localParticipant.setIsSpeaking(!0),s.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(l.sid);u&&(u.audioLevel=l.level,u.setIsSpeaking(!0),s.push(u))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(l=>{c[l.sid]||(l.audioLevel=0,l.setIsSpeaking(!1))}),this.activeSpeakers=s,this.emitWhenConnected(j.ActiveSpeakersChanged,s)},this.handleSpeakersChanged=o=>{const s=new Map;this.activeSpeakers.forEach(l=>{const u=this.remoteParticipants.get(l.identity);u&&u.sid!==l.sid||s.set(l.sid,l)}),o.forEach(l=>{let u=this.getRemoteParticipantBySid(l.sid);l.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=l.level,u.setIsSpeaking(l.active),l.active?s.set(l.sid,u):s.delete(l.sid))});const c=Array.from(s.values());c.sort((l,u)=>u.audioLevel-l.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(j.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(s=>{const c=this.getRemoteParticipantBySid(s.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(s.trackSid);if(!l||!l.track)return;const u=_.streamStateFromProto(s.state);u!==l.track.streamState&&(l.track.streamState=u,c.emit(z.TrackStreamStateChanged,l,l.track.streamState),this.emitWhenConnected(j.TrackStreamStateChanged,l,l.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=o=>{const s=this.getRemoteParticipantBySid(o.participantSid);if(!s)return;const c=s.getTrackPublicationBySid(o.trackSid);c&&c.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const s=Array.from(this.remoteParticipants.values()).find(l=>l.trackPublications.has(o.trackSid));if(!s)return;const c=s.getTrackPublicationBySid(o.trackSid);c&&c.setSubscriptionError(o.err)},this.handleDataPacket=o=>{const s=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(s,o.value.value,o.kind);else if(o.value.case==="transcription")this.handleTranscription(s,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(s,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(s,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,s);else if(o.value.case==="streamHeader")this.handleStreamHeader(o.value.value,o.participantIdentity);else if(o.value.case==="streamChunk")this.handleStreamChunk(o.value.value);else if(o.value.case==="streamTrailer")this.handleStreamTrailer(o.value.value);else if(o.value.case==="rpcRequest"){const c=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,c.id,c.method,c.payload,c.responseTimeoutMs,c.version)}},this.handleUserPacket=(o,s,c)=>{this.emit(j.DataReceived,s.payload,o,c,s.topic),o==null||o.emit(z.DataReceived,s.payload,c)},this.handleSipDtmf=(o,s)=>{this.emit(j.SipDTMFReceived,s,o),o==null||o.emit(z.SipDTMFReceived,s)},this.bufferedSegments=new Map,this.handleTranscription=(o,s)=>{const c=s.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(s.transcribedParticipantIdentity),l=c==null?void 0:c.trackPublications.get(s.trackId),u=m2(s,this.transcriptionReceivedTimes);l==null||l.emit(U.TranscriptionReceived,u),c==null||c.emit(z.TranscriptionReceived,u,l),this.emit(j.TranscriptionReceived,u,c,l)},this.handleChatMessage=(o,s)=>{const c=g2(s);this.emit(j.ChatMessage,c,o)},this.handleMetrics=(o,s)=>{this.emit(j.MetricsReceived,o,s)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(j.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(j.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(j.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(j.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>S(this,void 0,void 0,function*(){var o,s;const c=Ae.getInstance().previousDevices,l=yield Ae.getInstance().getDevices(void 0,!1),u=Gt();if((u==null?void 0:u.name)==="Chrome"&&u.os!=="iOS")for(let h of l){const p=c.find(b=>b.deviceId===h.deviceId);p&&p.label!==""&&p.kind===h.kind&&p.label!==h.label&&this.getActiveDevice(h.kind)==="default"&&this.emit(j.ActiveDeviceChanged,h.kind,h.deviceId)}const d=["audiooutput","audioinput","videoinput"];for(let h of d){const p=l.filter(y=>y.kind===h),b=this.getActiveDevice(h);if(b===((o=c.filter(y=>y.kind===h)[0])===null||o===void 0?void 0:o.deviceId)&&p.length>0&&((s=p[0])===null||s===void 0?void 0:s.deviceId)!==b){yield this.switchActiveDevice(h,p[0].deviceId);continue}h==="audioinput"&&!er()||h==="videoinput"||p.length>0&&!p.find(y=>y.deviceId===this.getActiveDevice(h))&&(yield this.switchActiveDevice(h,p[0].deviceId))}this.emit(j.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const s=this.roomInfo;this.roomInfo=o,s&&s.metadata!==o.metadata&&this.emitWhenConnected(j.RoomMetadataChanged,o.metadata),(s==null?void 0:s.activeRecording)!==o.activeRecording&&this.emitWhenConnected(j.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(s=>{if(s.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(s.quality);return}const c=this.getRemoteParticipantBySid(s.participantSid);c&&c.setConnectionQuality(s.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(j.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(j.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(j.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(j.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(j.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var s;(s=o==null?void 0:o.onPublish)===null||s===void 0||s.call(o,this)},this.onLocalTrackPublished=o=>S(this,void 0,void 0,function*(){var s,c,l,u,d,h;(s=o.track)===null||s===void 0||s.on(U.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.on(U.Restarted,this.onLocalTrackRestarted),(d=(u=(l=o.track)===null||l===void 0?void 0:l.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||d===void 0||d.call(u,this),this.emit(j.LocalTrackPublished,o,this.localParticipant),hr(o.track)&&(yield o.track.checkForSilence())&&this.emit(j.LocalAudioSilenceDetected,o);const p=yield(h=o.track)===null||h===void 0?void 0:h.getDeviceId(!1),b=hm(o.source);b&&p&&p!==this.localParticipant.activeDeviceMap.get(b)&&(this.localParticipant.activeDeviceMap.set(b,p),this.emit(j.ActiveDeviceChanged,b,p))}),this.onLocalTrackUnpublished=o=>{var s,c;(s=o.track)===null||s===void 0||s.off(U.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.off(U.Restarted,this.onLocalTrackRestarted),this.emit(j.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>S(this,void 0,void 0,function*(){const s=yield o.getDeviceId(!1),c=hm(o.source);c&&s&&s!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(s," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,s),this.emit(j.ActiveDeviceChanged,c,s))}),this.onLocalConnectionQualityChanged=o=>{this.emit(j.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=o=>{this.emit(j.MediaDevicesError,o)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(j.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(j.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},B2),e),this.log=Sn((r=this.options.loggerName)!==null&&r!==void 0?r:Kt.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},Py),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Ry),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},F2),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new vt,this.localParticipant=new fE("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Jn(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Jn(this.options.audioCaptureDefaults.deviceId)),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&this.switchActiveDevice("audiooutput",Jn(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),lt()){const o=new AbortController;(a=navigator.mediaDevices)===null||a===void 0||a.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),_i.cleanupRegistry&&_i.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new TypeError('A text stream handler for topic "'.concat(e,'" has already been set.'));this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new TypeError('A byte stream handler for topic "'.concat(e,'" has already been set.'));this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}handleIncomingRpcRequest(e,n,r,i,a,o){return S(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,Ee.builtIn("UNSUPPORTED_VERSION"));return}const s=this.rpcHandlers.get(r);if(!s){yield this.engine.publishRpcResponse(e,n,null,Ee.builtIn("UNSUPPORTED_METHOD"));return}let c=null,l=null;try{const u=yield s({requestId:n,callerIdentity:e,payload:i,responseTimeout:a});Nh(u)>Iy?(c=Ee.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(r))):l=u}catch(u){u instanceof Ee?c=u:(console.warn("Uncaught error returned by RPC handler for ".concat(r,". Returning APPLICATION_ERROR instead."),u),c=Ee.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,l,c)})}setE2EEEnabled(e){return S(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new x2(this.options.e2ee),this.e2eeManager.on(Bn.ParticipantEncryptionStatusChanged,(n,r)=>{b2(r)&&(this.isE2EEEnabled=n),this.emit(j.ParticipantEncryptionStatusChanged,n,r)}),this.e2eeManager.on(Bn.EncryptionError,n=>this.emit(j.EncryptionError,n)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return S(this,void 0,void 0,function*(){return this.state===re.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const r=i=>{i.sid!==""&&(this.engine.off(B.RoomUpdate,r),e(i.sid))};this.engine.on(B.RoomUpdate,r),this.once(j.Disconnected,()=>{this.engine.off(B.RoomUpdate,r),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new tE(this.options),this.engine.on(B.ParticipantUpdate,this.handleParticipantUpdates).on(B.RoomUpdate,this.handleRoomUpdate).on(B.SpeakersChanged,this.handleSpeakersChanged).on(B.StreamStateChanged,this.handleStreamStateUpdate).on(B.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(B.SubscriptionError,this.handleSubscriptionError).on(B.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(B.MediaTrackAdded,(e,n,r)=>{this.onTrackAdded(e,n,r)}).on(B.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(B.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(B.DataPacketReceived,this.handleDataPacket).on(B.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(re.SignalReconnecting)&&this.emit(j.SignalReconnecting)}).on(B.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(re.Connected)&&this.emit(j.Reconnected)}).on(B.SignalResumed,()=>{this.bufferedEvents=[],(this.state===re.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(B.Restarting,this.handleRestarting).on(B.SignalRestarted,this.handleSignalRestarted).on(B.Offline,()=>{this.setAndEmitConnectionState(re.Reconnecting)&&this.emit(j.Reconnecting)}).on(B.DCBufferStatusChanged,(e,n)=>{this.emit(j.DCBufferStatusChanged,e,n)}).on(B.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(r=>{let{trackSid:i}=r;return i===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(z.LocalTrackSubscribed,n),this.emitWhenConnected(j.LocalTrackSubscribed,n,this.localParticipant)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Ae.getInstance().getDevices(e,n)}prepareConnection(e,n){return S(this,void 0,void 0,function*(){if(this.state===re.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Wu(new URL(e))&&n){this.regionUrlProvider=new Xu(e,n);const r=yield this.regionUrlProvider.getNextBestRegionUrl();r&&this.state===re.Disconnected&&(this.regionUrl=r,yield fetch(Ku(r),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(r),this.logContext))}else yield fetch(Ku(e),{method:"HEAD"})}catch(r){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:r}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return S(this,void 0,void 0,function*(){let r=()=>{},i;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":i=new Qt({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":i=new Qt({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":i=new Qt({scenario:{case:"serverLeave",value:!0}});break;case"migration":i=new Qt({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":r=()=>S(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),i=new Qt({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":r=()=>S(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),i=new Qt({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":i=new Qt({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),r=()=>S(this,void 0,void 0,function*(){const a=this.engine.client.onLeave;a&&a(new Cc({reason:Ht.CLIENT_INITIATED,action:mi.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");i=new Qt({scenario:{case:"subscriberBandwidth",value:dr(n)}});break;case"leave-full-reconnect":i=new Qt({scenario:{case:"leaveRequestFullReconnect",value:!0}})}i&&(yield this.engine.client.sendSimulateScenario(i),yield r())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return S(this,arguments,void 0,function(r,i){var a=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var s,c,l,u,d,h,p,b;let y=!0,w=!1;const f=o?{exact:i}:i;if(r==="audioinput"){w=a.localParticipant.audioTrackPublications.size===0;const g=(s=a.getActiveDevice(r))!==null&&s!==void 0?s:a.options.audioCaptureDefaults.deviceId;a.options.audioCaptureDefaults.deviceId=f;const m=Array.from(a.localParticipant.audioTrackPublications.values()).filter(v=>v.source===_.Source.Microphone);try{y=(yield Promise.all(m.map(v=>{var C;return(C=v.audioTrack)===null||C===void 0?void 0:C.setDeviceId(f)}))).every(v=>v===!0)}catch(v){throw a.options.audioCaptureDefaults.deviceId=g,v}}else if(r==="videoinput"){w=a.localParticipant.videoTrackPublications.size===0;const g=(c=a.getActiveDevice(r))!==null&&c!==void 0?c:a.options.videoCaptureDefaults.deviceId;a.options.videoCaptureDefaults.deviceId=f;const m=Array.from(a.localParticipant.videoTrackPublications.values()).filter(v=>v.source===_.Source.Camera);try{y=(yield Promise.all(m.map(v=>{var C;return(C=v.videoTrack)===null||C===void 0?void 0:C.setDeviceId(f)}))).every(v=>v===!0)}catch(v){throw a.options.videoCaptureDefaults.deviceId=g,v}}else if(r==="audiooutput"){if(!$u()&&!a.options.webAudioMix||a.options.webAudioMix&&a.audioContext&&!("setSinkId"in a.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");a.options.webAudioMix&&(i=(l=yield Ae.getInstance().normalizeDeviceId("audiooutput",i))!==null&&l!==void 0?l:""),(u=(b=a.options).audioOutput)!==null&&u!==void 0||(b.audioOutput={});const g=(d=a.getActiveDevice(r))!==null&&d!==void 0?d:a.options.audioOutput.deviceId;a.options.audioOutput.deviceId=i;try{a.options.webAudioMix&&((h=a.audioContext)===null||h===void 0||h.setSinkId(i)),yield Promise.all(Array.from(a.remoteParticipants.values()).map(m=>m.setAudioOutput({deviceId:i})))}catch(m){throw a.options.audioOutput.deviceId=g,m}}return(w||r==="audiooutput")&&(a.localParticipant.activeDeviceMap.set(r,r==="audiooutput"&&((p=a.options.audioOutput)===null||p===void 0?void 0:p.deviceId)||i),a.emit(j.ActiveDeviceChanged,r,i)),y}()})}setupLocalParticipantEvents(){this.localParticipant.on(z.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(z.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(z.AttributesChanged,this.onLocalAttributesChanged).on(z.TrackMuted,this.onLocalTrackMuted).on(z.TrackUnmuted,this.onLocalTrackUnmuted).on(z.LocalTrackPublished,this.onLocalTrackPublished).on(z.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(z.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(z.MediaDevicesError,this.onMediaDevicesError).on(z.AudioStreamAcquired,this.startAudio).on(z.ChatMessage,this.onLocalChatMessageSent).on(z.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,r){if(this.state===re.Connecting||this.state===re.Reconnecting){const u=()=>{this.onTrackAdded(e,n,r),d()},d=()=>{this.off(j.Reconnected,u),this.off(j.Connected,u),this.off(j.Disconnected,d)};this.once(j.Reconnected,u),this.once(j.Connected,u),this.once(j.Disconnected,d);return}if(this.state===re.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const i=a2(n.id),a=i[0];let o=i[1],s=e.id;if(o&&o.startsWith("TR")&&(s=o),a===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(u=>u.sid===a);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(a),this.logContext);return}let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={}),c.addSubscribedMediaTrack(e,s,n,r,l)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var r;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==re.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(i=>{i.trackPublications.forEach(a=>{i.unpublishTrack(a.trackSid)})}),this.localParticipant.trackPublications.forEach(i=>{var a,o,s;i.track&&this.localParticipant.unpublishTrack(i.track,e),e?((a=i.track)===null||a===void 0||a.detach(),(o=i.track)===null||o===void 0||o.stop()):(s=i.track)===null||s===void 0||s.stopMonitor()}),this.localParticipant.off(z.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(z.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(z.AttributesChanged,this.onLocalAttributesChanged).off(z.TrackMuted,this.onLocalTrackMuted).off(z.TrackUnmuted,this.onLocalTrackUnmuted).off(z.LocalTrackPublished,this.onLocalTrackPublished).off(z.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(z.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(z.MediaDevicesError,this.onMediaDevicesError).off(z.AudioStreamAcquired,this.startAudio).off(z.ChatMessage,this.onLocalChatMessageSent).off(z.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),lt()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(r=navigator.mediaDevices)===null||r===void 0||r.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(re.Disconnected),this.emit(j.Disconnected,n)}}}handleParticipantDisconnected(e,n){var r;this.remoteParticipants.delete(e),n&&(n.trackPublications.forEach(i=>{n.unpublishTrack(i.trackSid,!0)}),this.emit(j.ParticipantDisconnected,n),(r=this.localParticipant)===null||r===void 0||r.handleParticipantDisconnected(n.identity))}handleStreamHeader(e,n){return S(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const i=this.byteStreamHandlers.get(e.topic);if(!i){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let a;const o={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:ss(e.timestamp),attributes:e.attributes},s=new ReadableStream({start:c=>{a=c,this.byteStreamControllers.set(e.streamId,{info:o,controller:a,startTime:Date.now()})}});i(new aE(o,s,ss(e.totalLength)),{identity:n})}else if(e.contentHeader.case==="textHeader"){const i=this.textStreamHandlers.get(e.topic);if(!i){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let a;const o={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},s=new ReadableStream({start:c=>{a=c,this.textStreamControllers.set(e.streamId,{info:o,controller:a,startTime:Date.now()})}});i(new oE(o,s,ss(e.totalLength)),{identity:n})}})}handleStreamChunk(e){const n=this.byteStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e);const r=this.textStreamControllers.get(e.streamId);r&&e.content.length>0&&r.controller.enqueue(e)}handleStreamTrailer(e){const n=this.textStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.textStreamControllers.delete(e.streamId));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close(),this.byteStreamControllers.delete(e.streamId))}acquireAudioContext(){return S(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=xy())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(i=>i.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),pt(200)])}catch(i){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:i}))}const r=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";r!==this.canPlaybackAudio&&(this.audioEnabled=r,this.emit(j.AudioPlaybackStatusChanged,r))})}createParticipant(e,n){var r;let i;return n?i=Js.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):i=new Js(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&i.setAudioOutput(this.options.audioOutput).catch(a=>this.log.warn("Could not set audio output: ".concat(a.message),this.logContext)),i}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const i=this.remoteParticipants.get(e);return n&&i.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),i}const r=this.createParticipant(e,n);return this.remoteParticipants.set(e,r),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(j.ParticipantConnected,r),r.on(z.TrackPublished,i=>{this.emitWhenConnected(j.TrackPublished,i,r)}).on(z.TrackSubscribed,(i,a)=>{i.kind===_.Kind.Audio?(i.on(U.AudioPlaybackStarted,this.handleAudioPlaybackStarted),i.on(U.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):i.kind===_.Kind.Video&&(i.on(U.VideoPlaybackFailed,this.handleVideoPlaybackFailed),i.on(U.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(j.TrackSubscribed,i,a,r)}).on(z.TrackUnpublished,i=>{this.emit(j.TrackUnpublished,i,r)}).on(z.TrackUnsubscribed,(i,a)=>{this.emit(j.TrackUnsubscribed,i,a,r)}).on(z.TrackMuted,i=>{this.emitWhenConnected(j.TrackMuted,i,r)}).on(z.TrackUnmuted,i=>{this.emitWhenConnected(j.TrackUnmuted,i,r)}).on(z.ParticipantMetadataChanged,i=>{this.emitWhenConnected(j.ParticipantMetadataChanged,i,r)}).on(z.ParticipantNameChanged,i=>{this.emitWhenConnected(j.ParticipantNameChanged,i,r)}).on(z.AttributesChanged,i=>{this.emitWhenConnected(j.ParticipantAttributesChanged,i,r)}).on(z.ConnectionQualityChanged,i=>{this.emitWhenConnected(j.ConnectionQualityChanged,i,r)}).on(z.ParticipantPermissionsChanged,i=>{this.emitWhenConnected(j.ParticipantPermissionsChanged,i,r)}).on(z.TrackSubscriptionStatusChanged,(i,a)=>{this.emitWhenConnected(j.TrackSubscriptionStatusChanged,i,a,r)}).on(z.TrackSubscriptionFailed,(i,a)=>{this.emit(j.TrackSubscriptionFailed,i,r,a)}).on(z.TrackSubscriptionPermissionChanged,(i,a)=>{this.emitWhenConnected(j.TrackSubscriptionPermissionChanged,i,a,r)}),n&&r.updateInfo(n),r}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((r,i)=>(r.push(...i.getTrackPublications()),r),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&v2(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=He.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Ht.STATE_MISMATCH))):e=0},gE)}clearConnectionReconcile(){this.connectionReconcileInterval&&He.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(j.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,r]=e;this.emit(n,...r)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(this.state===re.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,r]);else if(this.state===re.Connected)return this.emit(e,...r);return!1}simulateParticipants(e){return S(this,void 0,void 0,function*(){var n,r;const i=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),a=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new bh({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:be.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Ka({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(j.SignalConnected),this.emit(j.Connected),this.setAndEmitConnectionState(re.Connected),i.video){const o=new td(_.Kind.Video,new ii({source:Ie.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:zt.AUDIO,name:"video-dummy"}),new Zs(i.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:um(160*((n=a.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(z.LocalTrackPublished,o)}if(i.audio){const o=new td(_.Kind.Audio,new ii({source:Ie.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:zt.AUDIO}),new Ks(i.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:fl(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(z.LocalTrackPublished,o)}for(let o=0;o<a.count-1;o+=1){let s=new Ka({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:Cu.ACTIVE,tracks:[],joinedAt:be.parse(Date.now())});const c=this.getOrCreateParticipant(s.identity,s);if(a.video){const l=um(160*((r=a.aspectRatios[o%a.aspectRatios.length])!==null&&r!==void 0?r:1),160,!1,!0),u=new ii({source:Ie.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:zt.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),s.tracks=[...s.tracks,u]}if(a.audio){const l=fl(),u=new ii({source:Ie.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:zt.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),s.tracks=[...s.tracks,u]}c.updateInfo(s)}})}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(e!==j.ActiveSpeakersChanged&&e!==j.TranscriptionReceived){const a=jy(r).filter(o=>o!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:a}))}return super.emit(e,...r)}}_i.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function jy(t){return t.map(e=>{if(e)return Array.isArray(e)?jy(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Ut;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Ut||(Ut={}));class ar extends cn.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Ut.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new _i(r.roomOptions),this.connectOptions=r.connectOptions,this.options=r}run(e){return S(this,void 0,void 0,function*(){if(this.status!==Ut.IDLE)throw Error("check is running already");this.setStatus(Ut.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Ut.SKIPPED&&this.setStatus(this.isSuccess()?Ut.SUCCESS:Ut.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return S(this,void 0,void 0,function*(){return this.room.state===re.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return S(this,void 0,void 0,function*(){this.room&&this.room.state!==re.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Ut.SKIPPED)}switchProtocol(e){return S(this,void 0,void 0,function*(){let n=!1,r=!1;if(this.room.on(j.Reconnecting,()=>{n=!0}),this.room.once(j.Reconnected,()=>{r=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(a=>setTimeout(a,1e3)),!n)return;const i=Date.now()+1e4;for(;Date.now()<i;){if(r)return;yield pt(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class vE extends ar{get description(){return"Cloud regions"}perform(){return S(this,void 0,void 0,function*(){const e=new Xu(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],r=new Set;for(let a=0;a<3;a++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(r.has(o))continue;r.add(o);const s=yield this.checkCloudRegion(o);this.appendMessage("".concat(s.region," RTT: ").concat(s.rtt,"ms, duration: ").concat(s.duration,"ms")),n.push(s)}n.sort((a,o)=>(a.duration-o.duration)*.5+(a.rtt-o.rtt)*.5);const i=n[0];this.bestStats=i,this.appendMessage("best Cloud region: ".concat(i.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return S(this,void 0,void 0,function*(){var n,r;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const i=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!i)throw new Error("Region not found");const a=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,s=1e6/o,c="A".repeat(o),l=Date.now();for(let p=0;p<s;p++)yield a.write(c);yield a.close();const u=Date.now(),d=yield(r=this.room.engine.pcManager)===null||r===void 0?void 0:r.publisher.getStats(),h={region:i,rtt:1e4,duration:u-l};return d==null||d.forEach(p=>{p.type==="candidate-pair"&&p.nominated&&(h.rtt=p.currentRoundTripTime*1e3)}),yield this.disconnect(),h})}}const Cl=1e4;class bE extends ar{get description(){return"Connection via UDP vs TCP"}perform(){return S(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const r=this.bestStats;this.appendMessage("upstream bitrate: ".concat((r.bitrateTotal/r.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((r.rttTotal/r.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((r.jitterTotal/r.count*1e3).toFixed(2)," ms")),r.packetsLost>0&&this.appendWarning("packets lost: ".concat((r.packetsLost/r.packetsSent*100).toFixed(2),"%")),r.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((r.qualityLimitationDurations.bandwidth/(Cl/1e3)*100).toFixed(2),"%")),r.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((r.qualityLimitationDurations.cpu/(Cl/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return S(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const r=n.getContext("2d");if(!r)throw new Error("Could not get canvas context");let i=0;const a=()=>{i=(i+1)%360,r.fillStyle="hsl(".concat(i,", 100%, 50%)"),r.fillRect(0,0,n.width,n.height),requestAnimationFrame(a)};a();const o=n.captureStream(30).getVideoTracks()[0],s=(yield this.room.localParticipant.publishTrack(o,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,c={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},l=setInterval(()=>S(this,void 0,void 0,function*(){const u=yield s.getRTCStatsReport();u==null||u.forEach(d=>{d.type==="outbound-rtp"?(c.packetsSent=d.packetsSent,c.qualityLimitationDurations=d.qualityLimitationDurations,c.bitrateTotal+=d.targetBitrate,c.count++):d.type==="remote-inbound-rtp"&&(c.packetsLost=d.packetsLost,c.rttTotal+=d.roundTripTime,c.jitterTotal+=d.jitter)})}),1e3);return yield new Promise(u=>setTimeout(u,Cl)),clearInterval(l),o.stop(),n.remove(),yield this.disconnect(),c})}}function Ay(t){return S(this,void 0,void 0,function*(){var e,n;t??(t={}),(e=t.audio)!==null&&e!==void 0||(t.audio={deviceId:"default"}),(n=t.video)!==null&&n!==void 0||(t.video={deviceId:"default"});const{audioProcessor:r,videoProcessor:i}=Ph(t),a=Sy(t,Py,Ry),o=Tc(a),s=navigator.mediaDevices.getUserMedia(o);t.audio&&(Ae.userMediaPromiseMap.set("audioinput",s),s.catch(()=>Ae.userMediaPromiseMap.delete("audioinput"))),t.video&&(Ae.userMediaPromiseMap.set("videoinput",s),s.catch(()=>Ae.userMediaPromiseMap.delete("videoinput")));const c=yield s;return Promise.all(c.getTracks().map(l=>S(this,void 0,void 0,function*(){const u=l.kind==="audio";u?a.audio:a.video;let d;const h=u?o.audio:o.video;typeof h!="boolean"&&(d=h);const p=l.getSettings().deviceId;d!=null&&d.deviceId&&Jn(d.deviceId)!==p?d.deviceId=p:d||(d={deviceId:p});const b=Oy(l,d);return b.kind===_.Kind.Video?b.source=_.Source.Camera:b.kind===_.Kind.Audio&&(b.source=_.Source.Microphone),b.mediaStream=c,Tn(b)&&r?yield b.setProcessor(r):Di(b)&&i&&(yield b.setProcessor(i)),b})))})}function yE(t){return S(this,void 0,void 0,function*(){return(yield Ay({audio:!1,video:t}))[0]})}function kE(t){return S(this,void 0,void 0,function*(){return(yield Ay({audio:t,video:!1}))[0]})}class wE extends ar{get description(){return"Can publish audio"}perform(){return S(this,void 0,void 0,function*(){var e;const n=yield this.connect(),r=yield kE();if(yield Ty(r,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(r),yield new Promise(o=>setTimeout(o,3e3));const i=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let a=0;if(i.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="audio"||!o.kind&&o.mediaType==="audio")&&(a=o.packetsSent)}),a===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(a," audio packets"))})}}class CE extends ar{get description(){return"Can publish video"}perform(){return S(this,void 0,void 0,function*(){var e;const n=yield this.connect(),r=yield yE();yield this.checkForVideo(r.mediaStreamTrack),n.localParticipant.publishTrack(r),yield new Promise(o=>setTimeout(o,5e3));const i=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let a=0;if(i.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(a+=o.packetsSent)}),a===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(a," video packets"))})}checkForVideo(e){return S(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const r=document.createElement("video");r.srcObject=n,r.muted=!0,yield new Promise(i=>{r.onplay=()=>{setTimeout(()=>{var a,o,s,c;const l=document.createElement("canvas"),u=e.getSettings(),d=(o=(a=u.width)!==null&&a!==void 0?a:r.videoWidth)!==null&&o!==void 0?o:1280,h=(c=(s=u.height)!==null&&s!==void 0?s:r.videoHeight)!==null&&c!==void 0?c:720;l.width=d,l.height=h;const p=l.getContext("2d");p.drawImage(r,0,0);const b=p.getImageData(0,0,l.width,l.height).data;let y=!0;for(let w=0;w<b.length;w+=4)if(b[w]!==0||b[w+1]!==0||b[w+2]!==0){y=!1;break}y?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),i()},1e3)},r.play()}),r.remove()})}}class SE extends ar{get description(){return"Resuming connection after interruption"}perform(){return S(this,void 0,void 0,function*(){var e;const n=yield this.connect();let r=!1,i=!1,a;const o=new Promise(l=>{setTimeout(l,5e3),a=l}),s=()=>{r=!0};n.on(j.SignalReconnecting,s).on(j.Reconnecting,s).on(j.Reconnected,()=>{i=!0,a(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield o,r){if(!i||n.state!==re.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class TE extends ar{get description(){return"Can connect via TURN"}perform(){return S(this,void 0,void 0,function*(){var e,n;const r=new Rh,i=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let a=!1,o=!1,s=!1;for(let c of i.iceServers)for(let l of c.urls)l.startsWith("turn:")?(o=!0,s=!0):l.startsWith("turns:")&&(o=!0,s=!0,a=!0),l.startsWith("stun:")&&(s=!0);s?o&&!a&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class xE extends ar{get description(){return"Establishing WebRTC connection"}perform(){return S(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(j.SignalConnected,()=>{const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(i,a)=>{if(i.candidate){const o=new RTCIceCandidate(i);let s="".concat(o.protocol," ").concat(o.address,":").concat(o.port," ").concat(o.type);o.address&&(EE(o.address)?s+=" (private)":o.protocol==="tcp"&&o.tcpType==="passive"?(e=!0,s+=" (passive)"):o.protocol==="udp"&&(n=!0)),this.appendMessage(s)}r&&r(i,a)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=i=>{i instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(i.errorCode," ").concat(i.errorText," ").concat(i.url))})});try{yield this.connect(),X.info("now the room is connected")}catch(r){throw this.appendWarning("ports need to be open on firewall in order to connect."),r}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function EE(t){const e=t.split(".");if(e.length===4){if(e[0]==="10"||e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class PE extends ar{get description(){return"Connecting to signal connection via WebSocket"}perform(){return S(this,void 0,void 0,function*(){var e,n,r;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let i=new Rh;const a=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(a.serverVersion,".")),((e=a.serverInfo)===null||e===void 0?void 0:e.edition)===xb.Cloud&&!((n=a.serverInfo)===null||n===void 0)&&n.region&&this.appendMessage("LiveKit Cloud: ".concat((r=a.serverInfo)===null||r===void 0?void 0:r.region)),yield i.close()})}}class O5 extends cn.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=r}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Ut.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Ut.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return S(this,void 0,void 0,function*(){const n=this.getNextCheckId(),r=new e(this.url,this.token,this.options),i=o=>{this.updateCheck(n,o)};r.on("update",i);const a=yield r.run();return r.off("update",i),a})}checkWebsocket(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(PE)})}checkWebRTC(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(xE)})}checkTURN(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(TE)})}checkReconnect(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(SE)})}checkPublishAudio(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(wE)})}checkPublishVideo(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(CE)})}checkConnectionProtocol(){return S(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(bE);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(vE)})}}Px("error");const RE=t=>{const e=new TextDecoder().decode(t);if(e!==null&&typeof e=="object")return e;try{const n=JSON.parse(e);if(n===null||typeof n!="object")throw new Error("Invalid parsed");return n}catch{return null}},Uy=({handler:t,context:e,speakersEnabled:n,micEnabled:r})=>{const[i,a]=L.useState("pending"),[o,s]=Ef(!1,100),[c,l]=Ef(!1,100),[u,d]=L.useState([]),h=L.useRef(null),p=L.useRef(null),b=L.useRef(null),[y,w]=L.useState(null),f=L.useCallback(async()=>{const v=h.current;v!=null&&(p.current!=null&&(p.current.stop(),p.current=null),b.current!=null&&(b.current.getTracks().forEach(C=>{C.stop()}),b.current=null),w(null),h.current=null,d([]),t.setRequestOverride(void 0),await v.disconnect())},[d,w,t]);L.useEffect(()=>{const v=h.current;v!=null&&v.localParticipant.setMicrophoneEnabled(r)},[r]),L.useEffect(()=>{if(y==null)return;const v=n?1:0;y.volume=v},[y,n]);const g=L.useCallback(async()=>{a("pending");let v=null;try{v=await t.getVoiceCredentials(e)}catch{a("error");return}if(v==null)return;const C=x=>{const N=x.some(A=>A.isAgent),M=x.some(A=>A.isLocal);l(N),s(M)},T=x=>{if(x.kind===_.Kind.Audio){p.current=x;const N=x.attach();w(N),N.play()}},E=x=>{s(x)};try{const x=new _i;h.current=x,b.current=await navigator.mediaDevices.getUserMedia({audio:!0}),x.on(j.TrackSubscribed,T),x.on(j.ActiveSpeakersChanged,C),x.localParticipant.on(z.IsSpeakingChanged,E),x.on(j.MediaDevicesError,()=>{console.info("media devices error")}),x.on(j.Disconnected,()=>{a("terminated"),s(!1),l(!1),f()}),t.setRequestOverride(N=>{const M=new TextEncoder().encode(JSON.stringify(N.request));x.localParticipant.publishData(M).catch(A=>{console.error("Failed to publish data to LiveKit:",A)})}),x.on(j.DataReceived,(N,M)=>{d(A=>[...A,{modalities:RE(N)??{},from:M==null?void 0:M.identity,timestamp:Date.now()}])}),await x.connect(v.url,v.token,{autoSubscribe:!0}),await x.localParticipant.setMicrophoneEnabled(!0),x.startAudio(),a("active")}catch(x){x instanceof DOMException&&x.name==="NotAllowedError"?a("noAudioPermissions"):a("error")}},[t,e,a,l,l,w,d]),m=async()=>{await f(),g()};return L.useEffect(()=>(g(),()=>{f()}),[g,f]),{roomState:i,isUserSpeaking:o,isApplicationSpeaking:c,retry:m,modalities:u}},Oo=({className:t,children:e})=>k.jsx("div",{className:K("relative flex flex-col items-center justify-center",t),children:e}),Fy=({className:t,modalities:e,customModalities:n,handler:r})=>{const i=L.useRef(null),a=e.map(o=>{const s=Object.entries(o.modalities).map(([c,l])=>{const u=n[c];return u==null?null:{key:c,value:l,Component:u}}).filter(c=>c!=null);return s.length===0?null:k.jsx("div",{className:"space-y-2 last:h-full",children:s.map(({key:c,value:l,Component:u})=>k.jsx(u,{className:"backdrop-blur-overlay",data:l,conversationHandler:r,enabled:!0},c))},o.timestamp)}).filter(Boolean);return L.useEffect(()=>{const o=i.current;if(o==null)return;const s=o.lastChild;s instanceof HTMLElement&&s.scrollIntoView({behavior:"smooth"})},[a.length]),a.length===0?null:k.jsx("div",{className:t,ref:i,children:a})},IE=({handler:t,speakersEnabled:e,colorMode:n,brandIcon:r,className:i,context:a,customModalities:o={}})=>{const[s,c]=L.useState(!0),{roomState:l,isUserSpeaking:u,isApplicationSpeaking:d,retry:h,modalities:p}=Uy({micEnabled:s,speakersEnabled:e,handler:t,context:a});return l==="pending"?k.jsx(Oo,{className:i,children:k.jsx(Q0,{})}):l==="error"||l==="noAudioPermissions"?k.jsxs(Oo,{className:i,children:[k.jsx(J0,{}),k.jsx("div",{className:"w-full px-3 h-20 flex items-center",children:k.jsx(Ir,{type:"ghost",label:"Retry",Icon:qa,onClick:()=>{h()}})})]}):l==="terminated"?k.jsx(Oo,{className:i,children:k.jsxs("div",{className:K("flex-grow flex flex-col items-center justify-center gap-6 text-primary-80"),children:[k.jsx(Va,{className:"w-20 h-20 text-primary-20"}),k.jsxs("div",{className:"text-center",children:[k.jsx("h3",{className:"text-xl mb-2",children:"The conversation has ended"}),k.jsx("p",{children:"You can close this panel now or restart."})]})]})}):k.jsxs(Oo,{className:i,children:[k.jsxs("div",{className:"rounded-full w-fit relative",children:[k.jsx("div",{className:K("w-[128px] h-[128px] p-4 z-10 relative rounded-full overflow-hidden bg-cover bg-center",r!=null?"":n==="dark"?"bg-[rgb(40,41,47)]":"bg-[rgb(175,175,175)]"),style:r!=null?{backgroundImage:`url(${r})`}:{},children:r==null?k.jsx(Va,{className:"w-full h-full text-primary-40"}):null}),d?k.jsx($a,{className:"rounded-full"}):null]}),k.jsx(Fy,{className:"absolute p-4 top-0 left-0 right-0 bottom-[72px] z-10 space-y-2 max-h-full overflow-auto border-b border-primary-10",modalities:p,customModalities:o,handler:t}),k.jsxs("div",{className:"w-fit flex-none absolute bottom-4 left-1/2 transform -translate-x-1/2",children:[u?k.jsx($a,{className:"rounded-inner"}):null,k.jsx(Ve,{Icon:s?Fs:ph,label:"Voice",type:s?"activated":"ghost",onClick:()=>{c(b=>!b)}})]})]})},Im=({onClose:t,handler:e,reset:n,className:r})=>k.jsxs("div",{className:K("p-2 md:p-3 flex flex-col flex-grow justify-center gap-2",r),children:[k.jsx(Ir,{label:"Restart conversation",Icon:qa,type:"ghost",onClick:n}),k.jsx(Ir,{label:"Talk to an agent",Icon:j0,type:"ghost",onClick:()=>{e.sendIntent("NLX.Escalation"),t()}})]});function Lh(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let jr=Lh();function By(t){jr=t}const ya={exec:()=>null};function le(t,e=""){let n=typeof t=="string"?t:t.source;const r={replace:(i,a)=>{let o=typeof a=="string"?a:a.source;return o=o.replace(tt.caret,"$1"),n=n.replace(i,o),r},getRegex:()=>new RegExp(n,e)};return r}const tt={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},_E=/^(?:[ \t]*(?:\n|$))+/,OE=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,NE=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,ao=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,ME=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,zy=/(?:[*+-]|\d{1,9}[.)])/,Vy=le(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,zy).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),Dh=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,LE=/^[^\n]+/,jh=/(?!\s*\])(?:\\.|[^\[\]\\])+/,DE=le(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",jh).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),jE=le(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,zy).getRegex(),Ec="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Ah=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,AE=le("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Ah).replace("tag",Ec).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Hy=le(Dh).replace("hr",ao).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ec).getRegex(),UE=le(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Hy).getRegex(),Uh={blockquote:UE,code:OE,def:DE,fences:NE,heading:ME,hr:ao,html:AE,lheading:Vy,list:jE,newline:_E,paragraph:Hy,table:ya,text:LE},_m=le("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",ao).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ec).getRegex(),FE={...Uh,table:_m,paragraph:le(Dh).replace("hr",ao).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",_m).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ec).getRegex()},BE={...Uh,html:le(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Ah).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ya,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:le(Dh).replace("hr",ao).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Vy).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},zE=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,VE=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,qy=/^( {2,}|\\)\n(?!\s*$)/,HE=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Pc=/[\p{P}\p{S}]/u,Fh=/[\s\p{P}\p{S}]/u,$y=/[^\s\p{P}\p{S}]/u,qE=le(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Fh).getRegex(),$E=/(?!~)[\p{P}\p{S}]/u,WE=/(?!~)[\s\p{P}\p{S}]/u,KE=/(?:[^\s\p{P}\p{S}]|~)/u,GE=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,ZE=le(/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,"u").replace(/punct/g,Pc).getRegex(),Wy="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",JE=le(Wy,"gu").replace(/notPunctSpace/g,$y).replace(/punctSpace/g,Fh).replace(/punct/g,Pc).getRegex(),QE=le(Wy,"gu").replace(/notPunctSpace/g,KE).replace(/punctSpace/g,WE).replace(/punct/g,$E).getRegex(),YE=le("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,$y).replace(/punctSpace/g,Fh).replace(/punct/g,Pc).getRegex(),XE=le(/\\(punct)/,"gu").replace(/punct/g,Pc).getRegex(),eP=le(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),tP=le(Ah).replace("(?:-->|$)","-->").getRegex(),nP=le("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",tP).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Qs=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,rP=le(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",Qs).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Ky=le(/^!?\[(label)\]\[(ref)\]/).replace("label",Qs).replace("ref",jh).getRegex(),Gy=le(/^!?\[(ref)\](?:\[\])?/).replace("ref",jh).getRegex(),iP=le("reflink|nolink(?!\\()","g").replace("reflink",Ky).replace("nolink",Gy).getRegex(),Bh={_backpedal:ya,anyPunctuation:XE,autolink:eP,blockSkip:GE,br:qy,code:VE,del:ya,emStrongLDelim:ZE,emStrongRDelimAst:JE,emStrongRDelimUnd:YE,escape:zE,link:rP,nolink:Gy,punctuation:qE,reflink:Ky,reflinkSearch:iP,tag:nP,text:HE,url:ya},aP={...Bh,link:le(/^!?\[(label)\]\((.*?)\)/).replace("label",Qs).getRegex(),reflink:le(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Qs).getRegex()},nd={...Bh,emStrongRDelimAst:QE,url:le(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},oP={...nd,br:le(qy).replace("{2,}","*").getRegex(),text:le(nd.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},No={normal:Uh,gfm:FE,pedantic:BE},Yi={normal:Bh,gfm:nd,breaks:oP,pedantic:aP},sP={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Om=t=>sP[t];function Yt(t,e){if(e){if(tt.escapeTest.test(t))return t.replace(tt.escapeReplace,Om)}else if(tt.escapeTestNoEncode.test(t))return t.replace(tt.escapeReplaceNoEncode,Om);return t}function Nm(t){try{t=encodeURI(t).replace(tt.percentDecode,"%")}catch{return null}return t}function Mm(t,e){var n;const r=t.replace(tt.findPipe,(o,s,c)=>{let l=!1,u=s;for(;--u>=0&&c[u]==="\\";)l=!l;return l?"|":" |"}),i=r.split(tt.splitPipe);let a=0;if(i[0].trim()||i.shift(),i.length>0&&!((n=i.at(-1))!=null&&n.trim())&&i.pop(),e)if(i.length>e)i.splice(e);else for(;i.length<e;)i.push("");for(;a<i.length;a++)i[a]=i[a].trim().replace(tt.slashPipe,"|");return i}function Xi(t,e,n){const r=t.length;if(r===0)return"";let i=0;for(;i<r&&t.charAt(r-i-1)===e;)i++;return t.slice(0,r-i)}function cP(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let r=0;r<t.length;r++)if(t[r]==="\\")r++;else if(t[r]===e[0])n++;else if(t[r]===e[1]&&(n--,n<0))return r;return-1}function Lm(t,e,n,r,i){const a=e.href,o=e.title||null,s=t[1].replace(i.other.outputLinkReplace,"$1");if(t[0].charAt(0)!=="!"){r.state.inLink=!0;const c={type:"link",raw:n,href:a,title:o,text:s,tokens:r.inlineTokens(s)};return r.state.inLink=!1,c}return{type:"image",raw:n,href:a,title:o,text:s}}function lP(t,e,n){const r=t.match(n.other.indentCodeCompensation);if(r===null)return e;const i=r[1];return e.split(`
`).map(a=>{const o=a.match(n.other.beginningSpace);if(o===null)return a;const[s]=o;return s.length>=i.length?a.slice(i.length):a}).join(`
`)}class Ys{constructor(e){ie(this,"options"),ie(this,"rules"),ie(this,"lexer"),this.options=e||jr}space(e){const n=this.rules.block.newline.exec(e);if(n&&n[0].length>0)return{type:"space",raw:n[0]}}code(e){const n=this.rules.block.code.exec(e);if(n){const r=n[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:n[0],codeBlockStyle:"indented",text:this.options.pedantic?r:Xi(r,`
`)}}}fences(e){const n=this.rules.block.fences.exec(e);if(n){const r=n[0],i=lP(r,n[3]||"",this.rules);return{type:"code",raw:r,lang:n[2]?n[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):n[2],text:i}}}heading(e){const n=this.rules.block.heading.exec(e);if(n){let r=n[2].trim();if(this.rules.other.endingHash.test(r)){const i=Xi(r,"#");(this.options.pedantic||!i||this.rules.other.endingSpaceChar.test(i))&&(r=i.trim())}return{type:"heading",raw:n[0],depth:n[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(e){const n=this.rules.block.hr.exec(e);if(n)return{type:"hr",raw:Xi(n[0],`
`)}}blockquote(e){const n=this.rules.block.blockquote.exec(e);if(n){let r=Xi(n[0],`
`).split(`
`),i="",a="";const o=[];for(;r.length>0;){let s=!1;const c=[];let l;for(l=0;l<r.length;l++)if(this.rules.other.blockquoteStart.test(r[l]))c.push(r[l]),s=!0;else if(!s)c.push(r[l]);else break;r=r.slice(l);const u=c.join(`
`),d=u.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");i=i?`${i}
${u}`:u,a=a?`${a}
${d}`:d;const h=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(d,o,!0),this.lexer.state.top=h,r.length===0)break;const p=o.at(-1);if((p==null?void 0:p.type)==="code")break;if((p==null?void 0:p.type)==="blockquote"){const b=p,y=b.raw+`
`+r.join(`
`),w=this.blockquote(y);o[o.length-1]=w,i=i.substring(0,i.length-b.raw.length)+w.raw,a=a.substring(0,a.length-b.text.length)+w.text;break}else if((p==null?void 0:p.type)==="list"){const b=p,y=b.raw+`
`+r.join(`
`),w=this.list(y);o[o.length-1]=w,i=i.substring(0,i.length-p.raw.length)+w.raw,a=a.substring(0,a.length-b.raw.length)+w.raw,r=y.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:i,tokens:o,text:a}}}list(e){let n=this.rules.block.list.exec(e);if(n){let r=n[1].trim();const i=r.length>1,a={type:"list",raw:"",ordered:i,start:i?+r.slice(0,-1):"",loose:!1,items:[]};r=i?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=i?r:"[*+-]");const o=this.rules.other.listItemRegex(r);let s=!1;for(;e;){let l=!1,u="",d="";if(!(n=o.exec(e))||this.rules.block.hr.test(e))break;u=n[0],e=e.substring(u.length);let h=n[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,g=>" ".repeat(3*g.length)),p=e.split(`
`,1)[0],b=!h.trim(),y=0;if(this.options.pedantic?(y=2,d=h.trimStart()):b?y=n[1].length+1:(y=n[2].search(this.rules.other.nonSpaceChar),y=y>4?1:y,d=h.slice(y),y+=n[1].length),b&&this.rules.other.blankLine.test(p)&&(u+=p+`
`,e=e.substring(p.length+1),l=!0),!l){const g=this.rules.other.nextBulletRegex(y),m=this.rules.other.hrRegex(y),v=this.rules.other.fencesBeginRegex(y),C=this.rules.other.headingBeginRegex(y),T=this.rules.other.htmlBeginRegex(y);for(;e;){const E=e.split(`
`,1)[0];let x;if(p=E,this.options.pedantic?(p=p.replace(this.rules.other.listReplaceNesting,"  "),x=p):x=p.replace(this.rules.other.tabCharGlobal,"    "),v.test(p)||C.test(p)||T.test(p)||g.test(p)||m.test(p))break;if(x.search(this.rules.other.nonSpaceChar)>=y||!p.trim())d+=`
`+x.slice(y);else{if(b||h.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||v.test(h)||C.test(h)||m.test(h))break;d+=`
`+p}!b&&!p.trim()&&(b=!0),u+=E+`
`,e=e.substring(E.length+1),h=x.slice(y)}}a.loose||(s?a.loose=!0:this.rules.other.doubleBlankLine.test(u)&&(s=!0));let w=null,f;this.options.gfm&&(w=this.rules.other.listIsTask.exec(d),w&&(f=w[0]!=="[ ] ",d=d.replace(this.rules.other.listReplaceTask,""))),a.items.push({type:"list_item",raw:u,task:!!w,checked:f,loose:!1,text:d,tokens:[]}),a.raw+=u}const c=a.items.at(-1);if(c)c.raw=c.raw.trimEnd(),c.text=c.text.trimEnd();else return;a.raw=a.raw.trimEnd();for(let l=0;l<a.items.length;l++)if(this.lexer.state.top=!1,a.items[l].tokens=this.lexer.blockTokens(a.items[l].text,[]),!a.loose){const u=a.items[l].tokens.filter(h=>h.type==="space"),d=u.length>0&&u.some(h=>this.rules.other.anyLine.test(h.raw));a.loose=d}if(a.loose)for(let l=0;l<a.items.length;l++)a.items[l].loose=!0;return a}}html(e){const n=this.rules.block.html.exec(e);if(n)return{type:"html",block:!0,raw:n[0],pre:n[1]==="pre"||n[1]==="script"||n[1]==="style",text:n[0]}}def(e){const n=this.rules.block.def.exec(e);if(n){const r=n[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),i=n[2]?n[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=n[3]?n[3].substring(1,n[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):n[3];return{type:"def",tag:r,raw:n[0],href:i,title:a}}}table(e){var n;const r=this.rules.block.table.exec(e);if(!r||!this.rules.other.tableDelimiter.test(r[2]))return;const i=Mm(r[1]),a=r[2].replace(this.rules.other.tableAlignChars,"").split("|"),o=(n=r[3])!=null&&n.trim()?r[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],s={type:"table",raw:r[0],header:[],align:[],rows:[]};if(i.length===a.length){for(const c of a)this.rules.other.tableAlignRight.test(c)?s.align.push("right"):this.rules.other.tableAlignCenter.test(c)?s.align.push("center"):this.rules.other.tableAlignLeft.test(c)?s.align.push("left"):s.align.push(null);for(let c=0;c<i.length;c++)s.header.push({text:i[c],tokens:this.lexer.inline(i[c]),header:!0,align:s.align[c]});for(const c of o)s.rows.push(Mm(c,s.header.length).map((l,u)=>({text:l,tokens:this.lexer.inline(l),header:!1,align:s.align[u]})));return s}}lheading(e){const n=this.rules.block.lheading.exec(e);if(n)return{type:"heading",raw:n[0],depth:n[2].charAt(0)==="="?1:2,text:n[1],tokens:this.lexer.inline(n[1])}}paragraph(e){const n=this.rules.block.paragraph.exec(e);if(n){const r=n[1].charAt(n[1].length-1)===`
`?n[1].slice(0,-1):n[1];return{type:"paragraph",raw:n[0],text:r,tokens:this.lexer.inline(r)}}}text(e){const n=this.rules.block.text.exec(e);if(n)return{type:"text",raw:n[0],text:n[0],tokens:this.lexer.inline(n[0])}}escape(e){const n=this.rules.inline.escape.exec(e);if(n)return{type:"escape",raw:n[0],text:n[1]}}tag(e){const n=this.rules.inline.tag.exec(e);if(n)return!this.lexer.state.inLink&&this.rules.other.startATag.test(n[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(n[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(n[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(n[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:n[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:n[0]}}link(e){const n=this.rules.inline.link.exec(e);if(n){const r=n[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(r)){if(!this.rules.other.endAngleBracket.test(r))return;const o=Xi(r.slice(0,-1),"\\");if((r.length-o.length)%2===0)return}else{const o=cP(n[2],"()");if(o>-1){const s=(n[0].indexOf("!")===0?5:4)+n[1].length+o;n[2]=n[2].substring(0,o),n[0]=n[0].substring(0,s).trim(),n[3]=""}}let i=n[2],a="";if(this.options.pedantic){const o=this.rules.other.pedanticHrefTitle.exec(i);o&&(i=o[1],a=o[3])}else a=n[3]?n[3].slice(1,-1):"";return i=i.trim(),this.rules.other.startAngleBracket.test(i)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(r)?i=i.slice(1):i=i.slice(1,-1)),Lm(n,{href:i&&i.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},n[0],this.lexer,this.rules)}}reflink(e,n){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){const i=(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," "),a=n[i.toLowerCase()];if(!a){const o=r[0].charAt(0);return{type:"text",raw:o,text:o}}return Lm(r,a,r[0],this.lexer,this.rules)}}emStrong(e,n,r=""){let i=this.rules.inline.emStrongLDelim.exec(e);if(!(!i||i[3]&&r.match(this.rules.other.unicodeAlphaNumeric))&&(!(i[1]||i[2])||!r||this.rules.inline.punctuation.exec(r))){const a=[...i[0]].length-1;let o,s,c=a,l=0;const u=i[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(u.lastIndex=0,n=n.slice(-1*e.length+a);(i=u.exec(n))!=null;){if(o=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!o)continue;if(s=[...o].length,i[3]||i[4]){c+=s;continue}else if((i[5]||i[6])&&a%3&&!((a+s)%3)){l+=s;continue}if(c-=s,c>0)continue;s=Math.min(s,s+c+l);const d=[...i[0]][0].length,h=e.slice(0,a+i.index+d+s);if(Math.min(a,s)%2){const b=h.slice(1,-1);return{type:"em",raw:h,text:b,tokens:this.lexer.inlineTokens(b)}}const p=h.slice(2,-2);return{type:"strong",raw:h,text:p,tokens:this.lexer.inlineTokens(p)}}}}codespan(e){const n=this.rules.inline.code.exec(e);if(n){let r=n[2].replace(this.rules.other.newLineCharGlobal," ");const i=this.rules.other.nonSpaceChar.test(r),a=this.rules.other.startingSpaceChar.test(r)&&this.rules.other.endingSpaceChar.test(r);return i&&a&&(r=r.substring(1,r.length-1)),{type:"codespan",raw:n[0],text:r}}}br(e){const n=this.rules.inline.br.exec(e);if(n)return{type:"br",raw:n[0]}}del(e){const n=this.rules.inline.del.exec(e);if(n)return{type:"del",raw:n[0],text:n[2],tokens:this.lexer.inlineTokens(n[2])}}autolink(e){const n=this.rules.inline.autolink.exec(e);if(n){let r,i;return n[2]==="@"?(r=n[1],i="mailto:"+r):(r=n[1],i=r),{type:"link",raw:n[0],text:r,href:i,tokens:[{type:"text",raw:r,text:r}]}}}url(e){var n;let r;if(r=this.rules.inline.url.exec(e)){let i,a;if(r[2]==="@")i=r[0],a="mailto:"+i;else{let o;do o=r[0],r[0]=((n=this.rules.inline._backpedal.exec(r[0]))==null?void 0:n[0])??"";while(o!==r[0]);i=r[0],r[1]==="www."?a="http://"+r[0]:a=r[0]}return{type:"link",raw:r[0],text:i,href:a,tokens:[{type:"text",raw:i,text:i}]}}}inlineText(e){const n=this.rules.inline.text.exec(e);if(n){const r=this.lexer.state.inRawBlock;return{type:"text",raw:n[0],text:n[0],escaped:r}}}}class Pt{constructor(e){ie(this,"tokens"),ie(this,"options"),ie(this,"state"),ie(this,"tokenizer"),ie(this,"inlineQueue"),this.tokens=[],this.tokens.links=Object.create(null),this.options=e||jr,this.options.tokenizer=this.options.tokenizer||new Ys,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const n={other:tt,block:No.normal,inline:Yi.normal};this.options.pedantic?(n.block=No.pedantic,n.inline=Yi.pedantic):this.options.gfm&&(n.block=No.gfm,this.options.breaks?n.inline=Yi.breaks:n.inline=Yi.gfm),this.tokenizer.rules=n}static get rules(){return{block:No,inline:Yi}}static lex(e,n){return new Pt(n).lex(e)}static lexInline(e,n){return new Pt(n).inlineTokens(e)}lex(e){e=e.replace(tt.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){const r=this.inlineQueue[n];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],r=!1){var i,a,o;for(this.options.pedantic&&(e=e.replace(tt.tabCharGlobal,"    ").replace(tt.spaceLine,""));e;){let s;if((a=(i=this.options.extensions)==null?void 0:i.block)!=null&&a.some(l=>(s=l.call({lexer:this},e,n))?(e=e.substring(s.raw.length),n.push(s),!0):!1))continue;if(s=this.tokenizer.space(e)){e=e.substring(s.raw.length);const l=n.at(-1);s.raw.length===1&&l!==void 0?l.raw+=`
`:n.push(s);continue}if(s=this.tokenizer.code(e)){e=e.substring(s.raw.length);const l=n.at(-1);(l==null?void 0:l.type)==="paragraph"||(l==null?void 0:l.type)==="text"?(l.raw+=`
`+s.raw,l.text+=`
`+s.text,this.inlineQueue.at(-1).src=l.text):n.push(s);continue}if(s=this.tokenizer.fences(e)){e=e.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.heading(e)){e=e.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.hr(e)){e=e.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.blockquote(e)){e=e.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.list(e)){e=e.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.html(e)){e=e.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.def(e)){e=e.substring(s.raw.length);const l=n.at(-1);(l==null?void 0:l.type)==="paragraph"||(l==null?void 0:l.type)==="text"?(l.raw+=`
`+s.raw,l.text+=`
`+s.raw,this.inlineQueue.at(-1).src=l.text):this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title});continue}if(s=this.tokenizer.table(e)){e=e.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.lheading(e)){e=e.substring(s.raw.length),n.push(s);continue}let c=e;if((o=this.options.extensions)!=null&&o.startBlock){let l=1/0;const u=e.slice(1);let d;this.options.extensions.startBlock.forEach(h=>{d=h.call({lexer:this},u),typeof d=="number"&&d>=0&&(l=Math.min(l,d))}),l<1/0&&l>=0&&(c=e.substring(0,l+1))}if(this.state.top&&(s=this.tokenizer.paragraph(c))){const l=n.at(-1);r&&(l==null?void 0:l.type)==="paragraph"?(l.raw+=`
`+s.raw,l.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=l.text):n.push(s),r=c.length!==e.length,e=e.substring(s.raw.length);continue}if(s=this.tokenizer.text(e)){e=e.substring(s.raw.length);const l=n.at(-1);(l==null?void 0:l.type)==="text"?(l.raw+=`
`+s.raw,l.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=l.text):n.push(s);continue}if(e){const l="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(l);break}else throw new Error(l)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var r,i,a;let o=e,s=null;if(this.tokens.links){const u=Object.keys(this.tokens.links);if(u.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(o))!=null;)u.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(o=o.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.blockSkip.exec(o))!=null;)o=o.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(o))!=null;)o=o.slice(0,s.index)+"++"+o.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let c=!1,l="";for(;e;){c||(l=""),c=!1;let u;if((i=(r=this.options.extensions)==null?void 0:r.inline)!=null&&i.some(h=>(u=h.call({lexer:this},e,n))?(e=e.substring(u.raw.length),n.push(u),!0):!1))continue;if(u=this.tokenizer.escape(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.tag(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.link(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(u.raw.length);const h=n.at(-1);u.type==="text"&&(h==null?void 0:h.type)==="text"?(h.raw+=u.raw,h.text+=u.text):n.push(u);continue}if(u=this.tokenizer.emStrong(e,o,l)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.codespan(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.br(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.del(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.autolink(e)){e=e.substring(u.raw.length),n.push(u);continue}if(!this.state.inLink&&(u=this.tokenizer.url(e))){e=e.substring(u.raw.length),n.push(u);continue}let d=e;if((a=this.options.extensions)!=null&&a.startInline){let h=1/0;const p=e.slice(1);let b;this.options.extensions.startInline.forEach(y=>{b=y.call({lexer:this},p),typeof b=="number"&&b>=0&&(h=Math.min(h,b))}),h<1/0&&h>=0&&(d=e.substring(0,h+1))}if(u=this.tokenizer.inlineText(d)){e=e.substring(u.raw.length),u.raw.slice(-1)!=="_"&&(l=u.raw.slice(-1)),c=!0;const h=n.at(-1);(h==null?void 0:h.type)==="text"?(h.raw+=u.raw,h.text+=u.text):n.push(u);continue}if(e){const h="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(h);break}else throw new Error(h)}}return n}}class Xs{constructor(e){ie(this,"options"),ie(this,"parser"),this.options=e||jr}space(e){return""}code({text:e,lang:n,escaped:r}){var i;const a=(i=(n||"").match(tt.notSpaceStart))==null?void 0:i[0],o=e.replace(tt.endingNewline,"")+`
`;return a?'<pre><code class="language-'+Yt(a)+'">'+(r?o:Yt(o,!0))+`</code></pre>
`:"<pre><code>"+(r?o:Yt(o,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:n}){return`<h${n}>${this.parser.parseInline(e)}</h${n}>
`}hr(e){return`<hr>
`}list(e){const n=e.ordered,r=e.start;let i="";for(let s=0;s<e.items.length;s++){const c=e.items[s];i+=this.listitem(c)}const a=n?"ol":"ul",o=n&&r!==1?' start="'+r+'"':"";return"<"+a+o+`>
`+i+"</"+a+`>
`}listitem(e){var n;let r="";if(e.task){const i=this.checkbox({checked:!!e.checked});e.loose?((n=e.tokens[0])==null?void 0:n.type)==="paragraph"?(e.tokens[0].text=i+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=i+" "+Yt(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:i+" ",text:i+" ",escaped:!0}):r+=i+" "}return r+=this.parser.parse(e.tokens,!!e.loose),`<li>${r}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let n="",r="";for(let a=0;a<e.header.length;a++)r+=this.tablecell(e.header[a]);n+=this.tablerow({text:r});let i="";for(let a=0;a<e.rows.length;a++){const o=e.rows[a];r="";for(let s=0;s<o.length;s++)r+=this.tablecell(o[s]);i+=this.tablerow({text:r})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+n+`</thead>
`+i+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){const n=this.parser.parseInline(e.tokens),r=e.header?"th":"td";return(e.align?`<${r} align="${e.align}">`:`<${r}>`)+n+`</${r}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${Yt(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:n,tokens:r}){const i=this.parser.parseInline(r),a=Nm(e);if(a===null)return i;e=a;let o='<a href="'+e+'"';return n&&(o+=' title="'+Yt(n)+'"'),o+=">"+i+"</a>",o}image({href:e,title:n,text:r}){const i=Nm(e);if(i===null)return Yt(r);e=i;let a=`<img src="${e}" alt="${r}"`;return n&&(a+=` title="${Yt(n)}"`),a+=">",a}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:Yt(e.text)}}class zh{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class Rt{constructor(e){ie(this,"options"),ie(this,"renderer"),ie(this,"textRenderer"),this.options=e||jr,this.options.renderer=this.options.renderer||new Xs,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new zh}static parse(e,n){return new Rt(n).parse(e)}static parseInline(e,n){return new Rt(n).parseInline(e)}parse(e,n=!0){var r,i;let a="";for(let o=0;o<e.length;o++){const s=e[o];if((i=(r=this.options.extensions)==null?void 0:r.renderers)!=null&&i[s.type]){const l=s,u=this.options.extensions.renderers[l.type].call({parser:this},l);if(u!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(l.type)){a+=u||"";continue}}const c=s;switch(c.type){case"space":{a+=this.renderer.space(c);continue}case"hr":{a+=this.renderer.hr(c);continue}case"heading":{a+=this.renderer.heading(c);continue}case"code":{a+=this.renderer.code(c);continue}case"table":{a+=this.renderer.table(c);continue}case"blockquote":{a+=this.renderer.blockquote(c);continue}case"list":{a+=this.renderer.list(c);continue}case"html":{a+=this.renderer.html(c);continue}case"paragraph":{a+=this.renderer.paragraph(c);continue}case"text":{let l=c,u=this.renderer.text(l);for(;o+1<e.length&&e[o+1].type==="text";)l=e[++o],u+=`
`+this.renderer.text(l);n?a+=this.renderer.paragraph({type:"paragraph",raw:u,text:u,tokens:[{type:"text",raw:u,text:u,escaped:!0}]}):a+=u;continue}default:{const l='Token with "'+c.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return a}parseInline(e,n=this.renderer){var r,i;let a="";for(let o=0;o<e.length;o++){const s=e[o];if((i=(r=this.options.extensions)==null?void 0:r.renderers)!=null&&i[s.type]){const l=this.options.extensions.renderers[s.type].call({parser:this},s);if(l!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){a+=l||"";continue}}const c=s;switch(c.type){case"escape":{a+=n.text(c);break}case"html":{a+=n.html(c);break}case"link":{a+=n.link(c);break}case"image":{a+=n.image(c);break}case"strong":{a+=n.strong(c);break}case"em":{a+=n.em(c);break}case"codespan":{a+=n.codespan(c);break}case"br":{a+=n.br(c);break}case"del":{a+=n.del(c);break}case"text":{a+=n.text(c);break}default:{const l='Token with "'+c.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return a}}class ka{constructor(e){ie(this,"options"),ie(this,"block"),this.options=e||jr}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?Pt.lex:Pt.lexInline}provideParser(){return this.block?Rt.parse:Rt.parseInline}}ie(ka,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));class uP{constructor(...e){ie(this,"defaults",Lh()),ie(this,"options",this.setOptions),ie(this,"parse",this.parseMarkdown(!0)),ie(this,"parseInline",this.parseMarkdown(!1)),ie(this,"Parser",Rt),ie(this,"Renderer",Xs),ie(this,"TextRenderer",zh),ie(this,"Lexer",Pt),ie(this,"Tokenizer",Ys),ie(this,"Hooks",ka),this.use(...e)}walkTokens(e,n){var r,i;let a=[];for(const o of e)switch(a=a.concat(n.call(this,o)),o.type){case"table":{const s=o;for(const c of s.header)a=a.concat(this.walkTokens(c.tokens,n));for(const c of s.rows)for(const l of c)a=a.concat(this.walkTokens(l.tokens,n));break}case"list":{const s=o;a=a.concat(this.walkTokens(s.items,n));break}default:{const s=o;(i=(r=this.defaults.extensions)==null?void 0:r.childTokens)!=null&&i[s.type]?this.defaults.extensions.childTokens[s.type].forEach(c=>{const l=s[c].flat(1/0);a=a.concat(this.walkTokens(l,n))}):s.tokens&&(a=a.concat(this.walkTokens(s.tokens,n)))}}return a}use(...e){const n=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(r=>{const i={...r};if(i.async=this.defaults.async||i.async||!1,r.extensions&&(r.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){const o=n.renderers[a.name];o?n.renderers[a.name]=function(...s){let c=a.renderer.apply(this,s);return c===!1&&(c=o.apply(this,s)),c}:n.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const o=n[a.level];o?o.unshift(a.tokenizer):n[a.level]=[a.tokenizer],a.start&&(a.level==="block"?n.startBlock?n.startBlock.push(a.start):n.startBlock=[a.start]:a.level==="inline"&&(n.startInline?n.startInline.push(a.start):n.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(n.childTokens[a.name]=a.childTokens)}),i.extensions=n),r.renderer){const a=this.defaults.renderer||new Xs(this.defaults);for(const o in r.renderer){if(!(o in a))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;const s=o,c=r.renderer[s],l=a[s];a[s]=(...u)=>{let d=c.apply(a,u);return d===!1&&(d=l.apply(a,u)),d||""}}i.renderer=a}if(r.tokenizer){const a=this.defaults.tokenizer||new Ys(this.defaults);for(const o in r.tokenizer){if(!(o in a))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;const s=o,c=r.tokenizer[s],l=a[s];a[s]=(...u)=>{let d=c.apply(a,u);return d===!1&&(d=l.apply(a,u)),d}}i.tokenizer=a}if(r.hooks){const a=this.defaults.hooks||new ka;for(const o in r.hooks){if(!(o in a))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;const s=o,c=r.hooks[s],l=a[s];ka.passThroughHooks.has(o)?a[s]=u=>{if(this.defaults.async)return Promise.resolve(c.call(a,u)).then(h=>l.call(a,h));const d=c.call(a,u);return l.call(a,d)}:a[s]=(...u)=>{let d=c.apply(a,u);return d===!1&&(d=l.apply(a,u)),d}}i.hooks=a}if(r.walkTokens){const a=this.defaults.walkTokens,o=r.walkTokens;i.walkTokens=function(s){let c=[];return c.push(o.call(this,s)),a&&(c=c.concat(a.call(this,s))),c}}this.defaults={...this.defaults,...i}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,n){return Pt.lex(e,n??this.defaults)}parser(e,n){return Rt.parse(e,n??this.defaults)}parseMarkdown(e){return(n,r)=>{const i={...r},a={...this.defaults,...i},o=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&i.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof n>"u"||n===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof n!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));a.hooks&&(a.hooks.options=a,a.hooks.block=e);const s=a.hooks?a.hooks.provideLexer():e?Pt.lex:Pt.lexInline,c=a.hooks?a.hooks.provideParser():e?Rt.parse:Rt.parseInline;if(a.async)return Promise.resolve(a.hooks?a.hooks.preprocess(n):n).then(l=>s(l,a)).then(l=>a.hooks?a.hooks.processAllTokens(l):l).then(l=>a.walkTokens?Promise.all(this.walkTokens(l,a.walkTokens)).then(()=>l):l).then(l=>c(l,a)).then(l=>a.hooks?a.hooks.postprocess(l):l).catch(o);try{a.hooks&&(n=a.hooks.preprocess(n));let l=s(n,a);a.hooks&&(l=a.hooks.processAllTokens(l)),a.walkTokens&&this.walkTokens(l,a.walkTokens);let u=c(l,a);return a.hooks&&(u=a.hooks.postprocess(u)),u}catch(l){return o(l)}}}onError(e,n){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const i="<p>An error occurred:</p><pre>"+Yt(r.message+"",!0)+"</pre>";return n?Promise.resolve(i):i}if(n)return Promise.reject(r);throw r}}}const Nr=new uP;function oe(t,e){return Nr.parse(t,e)}oe.options=oe.setOptions=function(t){return Nr.setOptions(t),oe.defaults=Nr.defaults,By(oe.defaults),oe};oe.getDefaults=Lh;oe.defaults=jr;oe.use=function(...t){return Nr.use(...t),oe.defaults=Nr.defaults,By(oe.defaults),oe};oe.walkTokens=function(t,e){return Nr.walkTokens(t,e)};oe.parseInline=Nr.parseInline;oe.Parser=Rt;oe.parser=Rt.parse;oe.Renderer=Xs;oe.TextRenderer=zh;oe.Lexer=Pt;oe.lexer=Pt.lex;oe.Tokenizer=Ys;oe.Hooks=ka;oe.parse=oe;oe.options;oe.setOptions;oe.use;oe.walkTokens;oe.parseInline;Rt.parse;Pt.lex;const rd=({message:t})=>k.jsxs("div",{className:"bg-error-secondary text-error-primary text-base p-3 rounded-inner flex items-center gap-2",children:[k.jsx(U0,{className:"w-4 h-4 flex-none"}),k.jsx("p",{className:"text-primary-80",children:t})]}),dP=({handler:t,message:e,responseIndex:n,messageIndex:r})=>e.choices.length>0?k.jsx("ul",{className:"space-y-2 max-h-[40vh] overflow-auto no-scrollbar",children:e.choices.map((i,a)=>e.selectedChoiceId==null||i.choiceId===e.selectedChoiceId?k.jsx("li",{className:"w-full",children:k.jsx(Ir,{type:"ghost",Icon:yc,onClick:e.selectedChoiceId==null?()=>{t.sendChoice(i.choiceId,{},{responseIndex:n,messageIndex:r})}:void 0,label:i.choiceText})},a):null)}):null,Sl=({text:t,bubble:e,files:n})=>k.jsxs("div",{className:"space-y-2",children:[k.jsx("div",{className:"flex justify-end pl-10 text-base",children:k.jsx("div",{className:K("text-primary-60 rounded-inner whitespace-pre-wrap",e?"bg-primary-5 p-3":""),children:t})}),n!=null?k.jsx("div",{className:"flex flex-wrap justify-end gap-2",children:n.map((r,i)=>k.jsx("img",{className:"rounded-inner h-20",src:URL.createObjectURL(r)},i))}):null]}),Dm=({text:t,number:e})=>k.jsxs("span",{className:"flex items-center gap-2",children:[k.jsx("span",{className:"bg-primary-10 text-primary-60 text-xs px-1.5 py-0.5 rounded-inner",children:e}),t]}),hP=t=>{const e=new Map;return t.forEach((n,r)=>{const i={fileName:n.fileName,content:n.content,presignedUrl:n.presignedUrl,metadata:void 0,pageNumber:void 0},a=JSON.stringify(i),o=e.get(a);e.set(a,o==null?{source:i,indices:[r]}:{...o,indices:[...o.indices,r]})}),[...e.values()]},pP=({sources:t})=>{const[e,n]=L.useState(!1),r=L.useMemo(()=>hP(t),[t]);return r.length===0?null:k.jsxs("details",{className:"space-y-2",open:e,onToggle:i=>{n(i.currentTarget.open)},children:[k.jsxs("summary",{className:"flex cursor-pointer items-center gap-2 rounded-inner hover:bg-primary-5 text-primary-80",children:[k.jsx(DS,{type:"ghost",Icon:e?O0:N0}),"Sources"]}),k.jsx("ol",{className:"space-y-2",children:r.map(({source:i,indices:a},o)=>{const s=i.fileName??i.content??"Source",c="p-3 bg-primary-5 rounded-inner w-full flex items-center justify-between text-primary-80",l=a.map(u=>String(u+1)).join(", ");return k.jsx("li",{children:i.presignedUrl!=null?k.jsxs("a",{href:i.presignedUrl,className:K(c,"hover:bg-primary-10"),children:[k.jsx(Dm,{text:s,number:l}),k.jsx(B0,{className:"w-4 h-4 text-primary-60"})]}):k.jsx("div",{className:c,children:k.jsx(Dm,{text:s,number:l})})},o)})})]})},fP=({responses:t,colorMode:e,chatMode:n,uploadedFiles:r,userMessageBubble:i,agentMessageBubble:a,lastApplicationResponseIndex:o,isWaiting:s,customModalities:c,handler:l,className:u,enabled:d})=>{const h=L.useRef(null),p=L.useRef(null);return L.useEffect(()=>{!n&&!s&&setTimeout(()=>{var b;(b=p.current)==null||b.scrollIntoView({behavior:"smooth"})})},[s,n]),L.useEffect(()=>{var b;if(n){const y=(b=h.current)==null?void 0:b.lastChild;y instanceof HTMLElement&&y.scrollIntoView({behavior:"smooth"})}},[t.length,n]),k.jsxs("div",{className:K("relative",u),children:[k.jsx("div",{"data-theme":e==="dark"?"light":"dark",className:K("absolute inset-x-0 h-[1px] top-0 bg-background opacity-[0.01] backdrop-blur-md")}),!n&&s?k.jsx(Q0,{label:"Thinking",className:"absolute inset-0"}):null,k.jsxs("div",{className:K("absolute inset-0 p-2 md:p-3 overflow-y-auto no-scrollbar space-y-8",!n&&s?"opacity-0":"opacity-100"),ref:h,children:[t.map((b,y)=>{var w;if(b.type===et.User)return b.payload.type==="text"?k.jsx(Sl,{text:b.payload.text,bubble:i},y):b.payload.type==="structured"&&b.payload.utterance!=null&&b.payload.uploadIds!=null?k.jsx(Sl,{bubble:i,text:b.payload.utterance,files:b.payload.uploadIds.map(g=>r[g]).filter(g=>g!=null)},y):null;if(b.type===et.Failure)return k.jsx(rd,{message:b.payload.text},y);const f=o!=null&&y===o;return k.jsxs(L.Fragment,{children:[k.jsxs("div",{className:K("space-y-2",!n&&f?"min-h-full":""),ref:f?p:void 0,children:[b.payload.messages.map((g,m)=>k.jsx("div",{className:"text-base",children:k.jsx("div",{className:K("space-y-6 markdown",a?"p-3 w-fit bg-secondary-40 mr-10 rounded-inner":""),dangerouslySetInnerHTML:{__html:oe(g.text,{async:!1})}})},m)),((w=b.payload.metadata)==null?void 0:w.sources)!=null?k.jsx(pP,{sources:b.payload.metadata.sources}):null,Object.entries(b.payload.modalities??{}).map(([g,m])=>{const v=c[g];return v==null?(console.warn(`Custom component implementation missing for the ${g} modality.`),null):k.jsx(v,{data:m,conversationHandler:l,enabled:d},g)})]}),b.payload.messages.map((g,m)=>{if(g.selectedChoiceId!=null){const v=g.choices.find(C=>C.choiceId===g.selectedChoiceId);return v==null?null:k.jsx(Sl,{text:v.choiceText,bubble:i},m)}return null})]},y)}),n&&s?k.jsxs("div",{className:"text-primary-60 flex items-center gap-1 text-base",children:[k.jsx("span",{className:"w-5 h-5 block flex-none text-accent",children:k.jsx(mh,{})}),"Thinking..."]}):null]},"messages")]})};function id(){return id=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},id.apply(null,arguments)}function mP(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var gP=L.useLayoutEffect,vP=function(t){var e=Cr.useRef(t);return gP(function(){e.current=t}),e},jm=function(t,e){if(typeof t=="function"){t(e);return}t.current=e},bP=function(t,e){var n=Cr.useRef();return Cr.useCallback(function(r){t.current=r,n.current&&jm(n.current,null),n.current=e,e&&jm(e,r)},[e])},Am={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},yP=function(t){Object.keys(Am).forEach(function(e){t.style.setProperty(e,Am[e],"important")})},Um=yP,Qe=null,Fm=function(t,e){var n=t.scrollHeight;return e.sizingStyle.boxSizing==="border-box"?n+e.borderSize:n-e.paddingSize};function kP(t,e,n,r){n===void 0&&(n=1),r===void 0&&(r=1/0),Qe||(Qe=document.createElement("textarea"),Qe.setAttribute("tabindex","-1"),Qe.setAttribute("aria-hidden","true"),Um(Qe)),Qe.parentNode===null&&document.body.appendChild(Qe);var i=t.paddingSize,a=t.borderSize,o=t.sizingStyle,s=o.boxSizing;Object.keys(o).forEach(function(h){var p=h;Qe.style[p]=o[p]}),Um(Qe),Qe.value=e;var c=Fm(Qe,t);Qe.value=e,c=Fm(Qe,t),Qe.value="x";var l=Qe.scrollHeight-i,u=l*n;s==="border-box"&&(u=u+i+a),c=Math.max(u,c);var d=l*r;return s==="border-box"&&(d=d+i+a),c=Math.min(d,c),[c,l]}var Bm=function(){},wP=function(t,e){return t.reduce(function(n,r){return n[r]=e[r],n},{})},CP=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],SP=!!document.documentElement.currentStyle,TP=function(t){var e=window.getComputedStyle(t);if(e===null)return null;var n=wP(CP,e),r=n.boxSizing;if(r==="")return null;SP&&r==="border-box"&&(n.width=parseFloat(n.width)+parseFloat(n.borderRightWidth)+parseFloat(n.borderLeftWidth)+parseFloat(n.paddingRight)+parseFloat(n.paddingLeft)+"px");var i=parseFloat(n.paddingBottom)+parseFloat(n.paddingTop),a=parseFloat(n.borderBottomWidth)+parseFloat(n.borderTopWidth);return{sizingStyle:n,paddingSize:i,borderSize:a}},xP=TP;function Zy(t,e,n){var r=vP(n);L.useLayoutEffect(function(){var i=function(a){return r.current(a)};if(t)return t.addEventListener(e,i),function(){return t.removeEventListener(e,i)}},[])}var EP=function(t){Zy(window,"resize",t)},PP=function(t){Zy(document.fonts,"loadingdone",t)},RP=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],IP=function(t,e){var n=t.cacheMeasurements,r=t.maxRows,i=t.minRows,a=t.onChange,o=a===void 0?Bm:a,s=t.onHeightChange,c=s===void 0?Bm:s,l=mP(t,RP),u=l.value!==void 0,d=L.useRef(null),h=bP(d,e),p=L.useRef(0),b=L.useRef(),y=function(){var f=d.current,g=n&&b.current?b.current:xP(f);if(g){b.current=g;var m=kP(g,f.value||f.placeholder||"x",i,r),v=m[0],C=m[1];p.current!==v&&(p.current=v,f.style.setProperty("height",v+"px","important"),c(v,{rowHeight:C}))}},w=function(f){u||y(),o(f)};return L.useLayoutEffect(y),EP(y),PP(y),L.createElement("textarea",id({},l,{onChange:w,ref:h}))},_P=L.forwardRef(IP);const zm=8,OP=({className:t,handler:e,uploadUrl:n,onFileUpload:r,enabled:i})=>{const[a,o]=L.useState(!1),[s,c]=L.useState(""),[l,u]=L.useState(null),[d,h]=L.useState(null),p=L.useRef(null),b=L.useRef(null),y=Z0();L.useEffect(()=>{var x;y&&((x=b.current)==null||x.focus())},[y]);const w=L.useMemo(()=>s.trim()==="",[s]),[f,g]=L.useState(!1),m=w&&d==null||f||!i,v=()=>{if(m)return;const x=(N,M)=>{(M==null?void 0:M.type)===et.Application&&(g(!1),e.unsubscribe(x),c(""),h(null),y&&setTimeout(()=>{var A;(A=b.current)==null||A.focus()}))};e.subscribe(x),g(!0),n!=null&&d!=null?e.sendStructured({uploadIds:[n.uploadId],utterance:s}):e.sendText(s)},C=n!=null&&i,T=()=>{u("Something went wrong. Please try again.")},E=x=>{var N,M;if(n==null){T();return}const A=(M=(N=x.target)==null?void 0:N.files)==null?void 0:M[0];if(A==null){T();return}const{name:W,size:Q,type:O}=A;if(h({name:W,size:Q,type:O}),Q/1024**2>zm){u(`The file is too big. Max file size: ${zm}mb`);return}fetch(n.url,{method:"PUT",headers:{"Content-Type":"image/jpeg"},body:A}).then(()=>{u(null),r({uploadId:n.uploadId,file:A})}).catch(()=>{T()})};return k.jsx("div",{className:K("relative",t),children:k.jsxs("div",{className:K("bg-primary-5 transition-colors duration-200 p-2 rounded-outer text-base font-normal",a?"":"hover:bg-secondary-20"),children:[l!=null&&k.jsxs("div",{className:"flex items-center py-1 mb-2 w-full bg-error-secondary rounded-inner",children:[k.jsx(yu,{size:16}),k.jsx("span",{className:"truncate ml-1",children:l})]}),d&&k.jsxs(k.Fragment,{children:[k.jsxs("div",{className:"flex items-center justify-between mb-2 w-full",children:[k.jsxs("p",{className:"flex items-center truncate mx-2",children:[l!=null?k.jsx(yu,{size:16,className:"text-error-primary"}):k.jsx(M0,{size:16,className:"text-primary-60"}),k.jsx("span",{className:"truncate ml-3",children:d.name})]}),k.jsx(Ve,{className:"flex-none",Icon:D0,label:"Delete",onClick:C?()=>{h(null),u(null),p.current!=null&&(p.current.value="")}:void 0,type:"ghost"})]}),k.jsx("hr",{className:"border-b-px border-background mb-2 -mx-2"})]}),k.jsxs("div",{className:K("flex items-end gap-1"),children:[C&&d==null?k.jsxs(k.Fragment,{children:[k.jsx("label",{htmlFor:"file-upload",className:"p-3 w-10 h-10 flex-none block transition-colors rounded-inner bg-primary-80 hover:bg-primary-80 text-secondary-80 cursor-pointer",children:k.jsx(bu,{})}),k.jsx("input",{type:"file",id:"file-upload",className:"sr-only",accept:".jpg, .jpeg, .png, .webp, .mp4, .mpeg4, .avi, .mov, .pdf",onChange:E,ref:p})]}):k.jsx(Ve,{className:"flex-none",Icon:bu,label:"Upload file",type:"ghost"}),k.jsx(_P,{disabled:f||!i,className:K("h-10 w-full resize-none mr-2 px-2 py-2 outline-none","bg-transparent text-primary-80 placeholder:text-primary-40 caret-accent","disabled:text-primary-40"),placeholder:"Type something",maxRows:10,onFocus:()=>{o(!0)},onBlur:()=>{o(!1)},value:s,onChange:x=>{c(x.target.value)},onKeyDown:x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),v())},ref:b}),k.jsx(Ve,{className:"flex-none",label:"Send message",onClick:m?void 0:()=>{v()},type:"main",Icon:yc})]})]})})},NP=t=>({"--font-family":t.fontFamily,"--inner-border-radius":t.innerBorderRadius,"--outer-border-radius":t.outerBorderRadius,"--primary-80":t.primary80,"--primary-60":t.primary60,"--primary-40":t.primary40,"--primary-20":t.primary20,"--primary-10":t.primary10,"--primary-5":t.primary5,"--primary-1":t.primary1,"--secondary-80":t.secondary80,"--secondary-60":t.secondary60,"--secondary-40":t.secondary40,"--secondary-20":t.secondary20,"--secondary-10":t.secondary10,"--secondary-5":t.secondary5,"--secondary-1":t.secondary1,"--accent":t.accent,"--accent-20":t.accent20,"--background":t.background,"--overlay":t.overlay,"--warning-primary":t.warningPrimary,"--warning-secondary":t.warningSecondary,"--error-primary":t.errorPrimary,"--error-secondary":t.errorSecondary}),MP={fontFamily:'"Neue Haas Grotesk", sans-serif',innerBorderRadius:"12px",outerBorderRadius:"20px",primary80:"rgba(0, 2, 9, 0.8)",primary60:"rgba(0, 2, 9, 0.6)",primary40:"rgba(0, 2, 9, 0.4)",primary20:"rgba(0, 2, 9, 0.2)",primary10:"rgba(0, 2, 9, 0.1)",primary5:"rgba(0, 2, 9, 0.05)",primary1:"rgba(0, 2, 9, 0.01)",secondary80:"rgba(255, 255, 255, 0.85)",secondary60:"rgba(255, 255, 255, 0.65)",secondary40:"rgba(255, 255, 255, 0.45)",secondary20:"rgba(255, 255, 255, 0.25)",secondary10:"rgba(255, 255, 255, 0.15)",secondary5:"rgba(255, 255, 255, 0.08)",secondary1:"rgba(255, 255, 255, 0.01)",accent:"rgb(28, 99, 218)",accent20:"rgba(28, 99, 218, 0.2)",background:"rgba(220, 220, 220, 0.9)",overlay:"rgba(0, 2, 9, 0.4)",warningPrimary:"rgb(220, 159, 3)",warningSecondary:"rgb(255, 242, 209)",errorPrimary:"rgb(157, 3, 3)",errorSecondary:"rgb(255, 223, 230)"},LP={fontFamily:'"Neue Haas Grotesk", sans-serif',innerBorderRadius:"12px",outerBorderRadius:"20px",primary80:"rgba(255, 255, 255, 0.85)",primary60:"rgba(255, 255, 255, 0.65)",primary40:"rgba(255, 255, 255, 0.45)",primary20:"rgba(255, 255, 255, 0.25)",primary10:"rgba(255, 255, 255, 0.15)",primary5:"rgba(255, 255, 255, 0.08)",primary1:"rgba(255, 255, 255, 0.01)",secondary80:"rgba(0, 2, 9, 0.8)",secondary60:"rgba(0, 2, 9, 0.6)",secondary40:"rgba(0, 2, 9, 0.4)",secondary20:"rgba(0, 2, 9, 0.2)",secondary10:"rgba(0, 2, 9, 0.1)",secondary5:"rgba(0, 2, 9, 0.05)",secondary1:"rgba(0, 2, 9, 0.01)",accent:"rgb(174, 202, 255)",accent20:"rgba(174, 202, 255, 0.25)",background:"rgba(0, 2, 9, 0.9)",overlay:"rgba(0, 2, 9, 0.4)",warningPrimary:"rgb(255, 214, 108)",warningSecondary:"rgb(95, 65, 29)",errorPrimary:"rgb(255, 133, 162)",errorSecondary:"rgb(94, 4, 4)"},DP=(t,e)=>{const n={};return t.accent!=null&&t.accent20==null&&(n.accent20=`color-mix(in srgb, ${t.accent} 20%, transparent)`),t.primary80!=null&&(t.primary60==null&&(n.primary60=`rgb(from ${t.primary80} r g b / 0.6)`),t.primary40==null&&(n.primary40=`rgb(from ${t.primary80} r g b / 0.4)`),t.primary20==null&&(n.primary20=`rgb(from ${t.primary80} r g b / 0.2)`),t.primary10==null&&(n.primary10=`rgb(from ${t.primary80} r g b / 0.1)`),t.primary5==null&&(n.primary5=`rgb(from ${t.primary80} r g b / 0.05)`),t.primary1==null&&(n.primary1=`rgb(from ${t.primary80} r g b / 0.01)`)),t.secondary80!=null&&(t.secondary60==null&&(n.secondary60=`rgb(from ${t.secondary80} r g b / 0.6)`),t.secondary40==null&&(n.secondary40=`rgb(from ${t.secondary80} r g b / 0.4)`),t.secondary20==null&&(n.secondary20=`rgb(from ${t.secondary80} r g b / 0.2)`),t.secondary10==null&&(n.secondary10=`rgb(from ${t.secondary80} r g b / 0.1)`),t.secondary5==null&&(n.secondary5=`rgb(from ${t.secondary80} r g b / 0.05)`),t.secondary1==null&&(n.secondary1=`rgb(from ${t.secondary80} r g b / 0.01)`)),{...e,...n,...t}},ls=({colorMode:t,children:e,theme:n,className:r})=>{const i=DP(n??{},t==="dark"?LP:MP);return k.jsx("div",{className:K(r,"font-sans"),style:{...NP(i),colorScheme:t},children:e})},Jy="bg-background backdrop-blur text-primary-80 rounded-outer p-2 w-[calc(100vw-16px)] max-w-[360px] space-y-4",Vm=({children:t,renderCollapse:e,onClose:n})=>k.jsxs("div",{className:Jy,children:[e&&k.jsx("div",{className:"flex items-center justify-end",children:k.jsx(Ve,{onClick:n,Icon:Ha,type:"ghost",label:"Close"})}),t]}),Hm=({children:t,className:e})=>k.jsx("div",{className:K("bg-background rounded-outer p-2 w-fit flex items-center gap-2",e),children:t}),jP=({handler:t,context:e,onClose:n,customModalities:r,renderCollapse:i})=>{const[a,o]=L.useState(!0),[s,c]=L.useState(!0),l=()=>{n(new Event("close"))},{roomState:u,isUserSpeaking:d,isApplicationSpeaking:h,retry:p,modalities:b}=Uy({micEnabled:a,speakersEnabled:s,handler:t,context:e});return u==="error"?k.jsxs(Vm,{renderCollapse:i,onClose:l,children:[k.jsx(rd,{message:"I couldnt connect"}),k.jsx(Ir,{type:"ghost",label:"Retry",Icon:qa,onClick:()=>{p()}})]}):u==="noAudioPermissions"?k.jsxs(Vm,{renderCollapse:i,onClose:l,children:[k.jsx(rd,{message:"Connect your microphone and speaker"}),k.jsx(Ir,{type:"ghost",label:"Retry",Icon:qa,onClick:()=>{p()}})]}):u==="pending"?k.jsxs(Hm,{className:"relative",children:[k.jsx(Ve,{Icon:Fs,label:"Microphone",type:"ghost",className:"invisible"}),k.jsx(Ve,{Icon:Bs,label:"Speakers",type:"ghost",className:"invisible"}),k.jsx(Ve,{Icon:Ha,label:"Close",type:"ghost",className:"invisible"}),k.jsx("span",{className:"w-6 h-6 block text-accent absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:k.jsx(mh,{})})]}):k.jsxs(Hm,{children:[k.jsxs("div",{className:"w-fit relative",children:[d?k.jsx($a,{className:"rounded-inner"}):null,k.jsx(Ve,{Icon:a?Fs:ph,label:"Microphone",type:a?"activated":"ghost",onClick:()=>{o(y=>!y)}})]}),k.jsxs("div",{className:"w-fit relative",children:[h?k.jsx($a,{className:"rounded-inner"}):null,k.jsx(Ve,{Icon:s?Bs:fh,label:"Speakers",type:s?"activated":"ghost",onClick:()=>{c(y=>!y)}})]}),k.jsx(Ve,{label:"Close",Icon:Ha,type:"error",onClick:()=>{l()}}),k.jsx(Fy,{className:K(Jy,"absolute right-0 -top-2 transform -translate-y-full max-h-[360px] overflow-auto"),modalities:b,customModalities:r,handler:t})]})};var AP=Object.prototype.toString;function UP(t){return typeof t=="function"||AP.call(t)==="[object Function]"}function FP(t){var e=Number(t);return isNaN(e)?0:e===0||!isFinite(e)?e:(e>0?1:-1)*Math.floor(Math.abs(e))}var BP=Math.pow(2,53)-1;function zP(t){var e=FP(t);return Math.min(Math.max(e,0),BP)}function Bt(t,e){var n=Array,r=Object(t);if(t==null)throw new TypeError("Array.from requires an array-like object - not null or undefined");for(var i=zP(r.length),a=UP(n)?Object(new n(i)):new Array(i),o=0,s;o<i;)s=r[o],a[o]=s,o+=1;return a.length=i,a}function Za(t){"@babel/helpers - typeof";return Za=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Za(t)}function VP(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function HP(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Qy(r.key),r)}}function qP(t,e,n){return e&&HP(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function $P(t,e,n){return e=Qy(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Qy(t){var e=WP(t,"string");return Za(e)=="symbol"?e:e+""}function WP(t,e){if(Za(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Za(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var KP=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];VP(this,t),$P(this,"items",void 0),this.items=e}return qP(t,[{key:"add",value:function(e){return this.has(e)===!1&&this.items.push(e),this}},{key:"clear",value:function(){this.items=[]}},{key:"delete",value:function(e){var n=this.items.length;return this.items=this.items.filter(function(r){return r!==e}),n!==this.items.length}},{key:"forEach",value:function(e){var n=this;this.items.forEach(function(r){e(r,r,n)})}},{key:"has",value:function(e){return this.items.indexOf(e)!==-1}},{key:"size",get:function(){return this.items.length}}])}();const GP=typeof Set>"u"?Set:KP;function Je(t){var e;return(e=t.localName)!==null&&e!==void 0?e:t.tagName.toLowerCase()}var ZP={article:"article",aside:"complementary",button:"button",datalist:"listbox",dd:"definition",details:"group",dialog:"dialog",dt:"term",fieldset:"group",figure:"figure",form:"form",footer:"contentinfo",h1:"heading",h2:"heading",h3:"heading",h4:"heading",h5:"heading",h6:"heading",header:"banner",hr:"separator",html:"document",legend:"legend",li:"listitem",math:"math",main:"main",menu:"list",nav:"navigation",ol:"list",optgroup:"group",option:"option",output:"status",progress:"progressbar",section:"region",summary:"button",table:"table",tbody:"rowgroup",textarea:"textbox",tfoot:"rowgroup",td:"cell",th:"columnheader",thead:"rowgroup",tr:"row",ul:"list"},JP={caption:new Set(["aria-label","aria-labelledby"]),code:new Set(["aria-label","aria-labelledby"]),deletion:new Set(["aria-label","aria-labelledby"]),emphasis:new Set(["aria-label","aria-labelledby"]),generic:new Set(["aria-label","aria-labelledby","aria-roledescription"]),insertion:new Set(["aria-label","aria-labelledby"]),none:new Set(["aria-label","aria-labelledby"]),paragraph:new Set(["aria-label","aria-labelledby"]),presentation:new Set(["aria-label","aria-labelledby"]),strong:new Set(["aria-label","aria-labelledby"]),subscript:new Set(["aria-label","aria-labelledby"]),superscript:new Set(["aria-label","aria-labelledby"])};function QP(t,e){return["aria-atomic","aria-busy","aria-controls","aria-current","aria-description","aria-describedby","aria-details","aria-dropeffect","aria-flowto","aria-grabbed","aria-hidden","aria-keyshortcuts","aria-label","aria-labelledby","aria-live","aria-owns","aria-relevant","aria-roledescription"].some(function(n){var r;return t.hasAttribute(n)&&!((r=JP[e])!==null&&r!==void 0&&r.has(n))})}function Yy(t,e){return QP(t,e)}function YP(t){var e=e3(t);if(e===null||ad.indexOf(e)!==-1){var n=XP(t);if(ad.indexOf(e||"")===-1||Yy(t,n||""))return n}return e}function XP(t){var e=ZP[Je(t)];if(e!==void 0)return e;switch(Je(t)){case"a":case"area":case"link":if(t.hasAttribute("href"))return"link";break;case"img":return t.getAttribute("alt")===""&&!Yy(t,"img")?"presentation":"img";case"input":{var n=t,r=n.type;switch(r){case"button":case"image":case"reset":case"submit":return"button";case"checkbox":case"radio":return r;case"range":return"slider";case"email":case"tel":case"text":case"url":return t.hasAttribute("list")?"combobox":"textbox";case"search":return t.hasAttribute("list")?"combobox":"searchbox";case"number":return"spinbutton";default:return null}}case"select":return t.hasAttribute("multiple")||t.size>1?"listbox":"combobox"}return null}function e3(t){var e=t.getAttribute("role");if(e!==null){var n=e.trim().split(" ")[0];if(n.length>0)return n}return null}var ad=["presentation","none"];function ge(t){return t!==null&&t.nodeType===t.ELEMENT_NODE}function Xy(t){return ge(t)&&Je(t)==="caption"}function us(t){return ge(t)&&Je(t)==="input"}function t3(t){return ge(t)&&Je(t)==="optgroup"}function n3(t){return ge(t)&&Je(t)==="select"}function r3(t){return ge(t)&&Je(t)==="table"}function i3(t){return ge(t)&&Je(t)==="textarea"}function a3(t){var e=t.ownerDocument===null?t:t.ownerDocument,n=e.defaultView;if(n===null)throw new TypeError("no window available");return n}function o3(t){return ge(t)&&Je(t)==="fieldset"}function s3(t){return ge(t)&&Je(t)==="legend"}function c3(t){return ge(t)&&Je(t)==="slot"}function l3(t){return ge(t)&&t.ownerSVGElement!==void 0}function u3(t){return ge(t)&&Je(t)==="svg"}function d3(t){return l3(t)&&Je(t)==="title"}function ec(t,e){if(ge(t)&&t.hasAttribute(e)){var n=t.getAttribute(e).split(" "),r=t.getRootNode?t.getRootNode():t.ownerDocument;return n.map(function(i){return r.getElementById(i)}).filter(function(i){return i!==null})}return[]}function vn(t,e){return ge(t)?e.indexOf(YP(t))!==-1:!1}function h3(t){return t.trim().replace(/\s\s+/g," ")}function p3(t,e){if(!ge(t))return!1;if(t.hasAttribute("hidden")||t.getAttribute("aria-hidden")==="true")return!0;var n=e(t);return n.getPropertyValue("display")==="none"||n.getPropertyValue("visibility")==="hidden"}function f3(t){return vn(t,["button","combobox","listbox","textbox"])||e1(t,"range")}function e1(t,e){if(!ge(t))return!1;switch(e){case"range":return vn(t,["meter","progressbar","scrollbar","slider","spinbutton"]);default:throw new TypeError("No knowledge about abstract role '".concat(e,"'. This is likely a bug :("))}}function qm(t,e){var n=Bt(t.querySelectorAll(e));return ec(t,"aria-owns").forEach(function(r){n.push.apply(n,Bt(r.querySelectorAll(e)))}),n}function m3(t){return n3(t)?t.selectedOptions||qm(t,"[selected]"):qm(t,'[aria-selected="true"]')}function g3(t){return vn(t,ad)}function v3(t){return Xy(t)}function b3(t){return vn(t,["button","cell","checkbox","columnheader","gridcell","heading","label","legend","link","menuitem","menuitemcheckbox","menuitemradio","option","radio","row","rowheader","switch","tab","tooltip","treeitem"])}function y3(t){return!1}function k3(t){return us(t)||i3(t)?t.value:t.textContent||""}function $m(t){var e=t.getPropertyValue("content");return/^["'].*["']$/.test(e)?e.slice(1,-1):""}function t1(t){var e=Je(t);return e==="button"||e==="input"&&t.getAttribute("type")!=="hidden"||e==="meter"||e==="output"||e==="progress"||e==="select"||e==="textarea"}function n1(t){if(t1(t))return t;var e=null;return t.childNodes.forEach(function(n){if(e===null&&ge(n)){var r=n1(n);r!==null&&(e=r)}}),e}function w3(t){if(t.control!==void 0)return t.control;var e=t.getAttribute("for");return e!==null?t.ownerDocument.getElementById(e):n1(t)}function C3(t){var e=t.labels;if(e===null)return e;if(e!==void 0)return Bt(e);if(!t1(t))return null;var n=t.ownerDocument;return Bt(n.querySelectorAll("label")).filter(function(r){return w3(r)===t})}function S3(t){var e=t.assignedNodes();return e.length===0?Bt(t.childNodes):e}function r1(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=new GP,r=typeof Map>"u"?void 0:new Map,i=a3(t),a=e.compute,o=a===void 0?"name":a,s=e.computedStyleSupportsPseudoElements,c=s===void 0?e.getComputedStyle!==void 0:s,l=e.getComputedStyle,u=l===void 0?i.getComputedStyle.bind(i):l,d=e.hidden,h=d===void 0?!1:d,p=function(m,v){if(v!==void 0)throw new Error("use uncachedGetComputedStyle directly for pseudo elements");if(r===void 0)return u(m);var C=r.get(m);if(C)return C;var T=u(m,v);return r.set(m,T),T};function b(m,v){var C="";if(ge(m)&&c){var T=u(m,"::before"),E=$m(T);C="".concat(E," ").concat(C)}var x=c3(m)?S3(m):Bt(m.childNodes).concat(ec(m,"aria-owns"));if(x.forEach(function(A){var W=g(A,{isEmbeddedInLabel:v.isEmbeddedInLabel,isReferenced:!1,recursion:!0}),Q=ge(A)?p(A).getPropertyValue("display"):"inline",O=Q!=="inline"?" ":"";C+="".concat(O).concat(W).concat(O)}),ge(m)&&c){var N=u(m,"::after"),M=$m(N);C="".concat(C," ").concat(M)}return C.trim()}function y(m,v){var C=m.getAttributeNode(v);return C!==null&&!n.has(C)&&C.value.trim()!==""?(n.add(C),C.value):null}function w(m){return ge(m)?y(m,"title"):null}function f(m){if(!ge(m))return null;if(o3(m)){n.add(m);for(var v=Bt(m.childNodes),C=0;C<v.length;C+=1){var T=v[C];if(s3(T))return g(T,{isEmbeddedInLabel:!1,isReferenced:!1,recursion:!1})}}else if(r3(m)){n.add(m);for(var E=Bt(m.childNodes),x=0;x<E.length;x+=1){var N=E[x];if(Xy(N))return g(N,{isEmbeddedInLabel:!1,isReferenced:!1,recursion:!1})}}else if(u3(m)){n.add(m);for(var M=Bt(m.childNodes),A=0;A<M.length;A+=1){var W=M[A];if(d3(W))return W.textContent}return null}else if(Je(m)==="img"||Je(m)==="area"){var Q=y(m,"alt");if(Q!==null)return Q}else if(t3(m)){var O=y(m,"label");if(O!==null)return O}if(us(m)&&(m.type==="button"||m.type==="submit"||m.type==="reset")){var V=y(m,"value");if(V!==null)return V;if(m.type==="submit")return"Submit";if(m.type==="reset")return"Reset"}var $=C3(m);if($!==null&&$.length!==0)return n.add(m),Bt($).map(function(q){return g(q,{isEmbeddedInLabel:!0,isReferenced:!1,recursion:!0})}).filter(function(q){return q.length>0}).join(" ");if(us(m)&&m.type==="image"){var J=y(m,"alt");if(J!==null)return J;var R=y(m,"title");return R!==null?R:"Submit Query"}if(vn(m,["button"])){var F=b(m,{isEmbeddedInLabel:!1});if(F!=="")return F}return null}function g(m,v){if(n.has(m))return"";if(!h&&p3(m,p)&&!v.isReferenced)return n.add(m),"";var C=ge(m)?m.getAttributeNode("aria-labelledby"):null,T=C!==null&&!n.has(C)?ec(m,"aria-labelledby"):[];if(o==="name"&&!v.isReferenced&&T.length>0)return n.add(C),T.map(function(Q){return g(Q,{isEmbeddedInLabel:v.isEmbeddedInLabel,isReferenced:!0,recursion:!1})}).join(" ");var E=v.recursion&&f3(m)&&o==="name";if(!E){var x=(ge(m)&&m.getAttribute("aria-label")||"").trim();if(x!==""&&o==="name")return n.add(m),x;if(!g3(m)){var N=f(m);if(N!==null)return n.add(m),N}}if(vn(m,["menu"]))return n.add(m),"";if(E||v.isEmbeddedInLabel||v.isReferenced){if(vn(m,["combobox","listbox"])){n.add(m);var M=m3(m);return M.length===0?us(m)?m.value:"":Bt(M).map(function(Q){return g(Q,{isEmbeddedInLabel:v.isEmbeddedInLabel,isReferenced:!1,recursion:!0})}).join(" ")}if(e1(m,"range"))return n.add(m),m.hasAttribute("aria-valuetext")?m.getAttribute("aria-valuetext"):m.hasAttribute("aria-valuenow")?m.getAttribute("aria-valuenow"):m.getAttribute("value")||"";if(vn(m,["textbox"]))return n.add(m),k3(m)}if(b3(m)||ge(m)&&v.isReferenced||v3(m)||y3()){var A=b(m,{isEmbeddedInLabel:v.isEmbeddedInLabel});if(A!=="")return n.add(m),A}if(m.nodeType===m.TEXT_NODE)return n.add(m),m.textContent||"";if(v.recursion)return n.add(m),b(m,{isEmbeddedInLabel:v.isEmbeddedInLabel});var W=w(m);return W!==null?(n.add(m),W):(n.add(m),"")}return h3(g(t,{isEmbeddedInLabel:!1,isReferenced:o==="description",recursion:!1}))}function Ja(t){"@babel/helpers - typeof";return Ja=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ja(t)}function Wm(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Km(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Wm(Object(n),!0).forEach(function(r){T3(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Wm(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function T3(t,e,n){return e=x3(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function x3(t){var e=E3(t,"string");return Ja(e)=="symbol"?e:e+""}function E3(t,e){if(Ja(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Ja(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Gm(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=ec(t,"aria-describedby").map(function(a){return r1(a,Km(Km({},e),{},{compute:"description"}))}).join(" ");if(n===""){var r=t.getAttribute("aria-description");n=r===null?"":r}if(n===""){var i=t.getAttribute("title");n=i===null?"":i}return n}function P3(t){return vn(t,["caption","code","deletion","emphasis","generic","insertion","none","paragraph","presentation","strong","subscript","superscript"])}function od(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return P3(t)?"":r1(t,e)}const R3=t=>t instanceof HTMLTextAreaElement?{value:t.value}:t.type==="checkbox"?{value:t.checked,options:[{value:!0,selected:t.checked,text:"checked"},{value:!1,selected:!t.checked,text:"unchecked"}]}:{value:t.value},I3=t=>{if(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement){const e=od(t)??"";return{name:e===""?t.name:e,description:Gm(t),type:t.type,placeholder:t.placeholder,...R3(t)}}else if(t instanceof HTMLSelectElement){const e=od(t)??"";return{name:e===""?t.name:e,description:Gm(t),type:t.type,value:t.value,options:Array.from(t.options).map(n=>({value:n.value,text:n.text,selected:n.selected}))}}throw new TypeError("Unsupported element type")},_3=()=>{const t=Array.from(document.querySelectorAll("input, textarea, select")).map((n,r)=>({index:r,id:`${n.tagName.toLowerCase()}-${r}`,element:n})),e={};return t.forEach(({id:n,element:r})=>{e[n]=r}),{context:t.map(({id:n,element:r})=>({id:n,...I3(r)})),formElements:e}},wa=(t,...e)=>{console.debug(`[NLX V+] ${t}`,...e)};function Vh(t,e,n){function r(s,c){var l;Object.defineProperty(s,"_zod",{value:s._zod??{},enumerable:!1}),(l=s._zod).traits??(l.traits=new Set),s._zod.traits.add(t),e(s,c);for(const u in o.prototype)u in s||Object.defineProperty(s,u,{value:o.prototype[u].bind(s)});s._zod.constr=o,s._zod.def=c}const i=(n==null?void 0:n.Parent)??Object;class a extends i{}Object.defineProperty(a,"name",{value:t});function o(s){var c;const l=n!=null&&n.Parent?new a:this;r(l,s),(c=l._zod).deferred??(c.deferred=[]);for(const u of l._zod.deferred)u();return l}return Object.defineProperty(o,"init",{value:r}),Object.defineProperty(o,Symbol.hasInstance,{value:s=>{var c,l;return n!=null&&n.Parent&&s instanceof n.Parent?!0:(l=(c=s==null?void 0:s._zod)==null?void 0:c.traits)==null?void 0:l.has(t)}}),Object.defineProperty(o,"name",{value:t}),o}class ds extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const O3={};function i1(t){return O3}function N3(t){const e=Object.values(t).filter(n=>typeof n=="number");return Object.entries(t).filter(([n,r])=>e.indexOf(+n)===-1).map(([n,r])=>r)}function M3(t,e){return typeof e=="bigint"?e.toString():e}function Mo(t,e=0){var n;if(t.aborted===!0)return!0;for(let r=e;r<t.issues.length;r++)if(((n=t.issues[r])==null?void 0:n.continue)!==!0)return!0;return!1}function Lo(t){return typeof t=="string"?t:t==null?void 0:t.message}function a1(t,e,n){var r,i,a,o,s,c;const l={...t,path:t.path??[]};if(!t.message){const u=Lo((a=(i=(r=t.inst)==null?void 0:r._zod.def)==null?void 0:i.error)==null?void 0:a.call(i,t))??Lo((o=e==null?void 0:e.error)==null?void 0:o.call(e,t))??Lo((s=n.customError)==null?void 0:s.call(n,t))??Lo((c=n.localeError)==null?void 0:c.call(n,t))??"Invalid input";l.message=u}return delete l.inst,delete l.continue,e!=null&&e.reportInput||delete l.input,l}const o1=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),t.message=JSON.stringify(e,M3,2),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},L3=Vh("$ZodError",o1),s1=Vh("$ZodError",o1,{Parent:Error}),D3=t=>(e,n,r)=>{const i=r?{...r,async:!1}:{async:!1},a=e._zod.run({value:n,issues:[]},i);if(a instanceof Promise)throw new ds;return a.issues.length?{success:!1,error:new(t??L3)(a.issues.map(o=>a1(o,i,i1())))}:{success:!0,data:a.value}},c1=D3(s1),j3=t=>async(e,n,r)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let a=e._zod.run({value:n,issues:[]},i);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new t(a.issues.map(o=>a1(o,i,i1())))}:{success:!0,data:a.value}},A3=j3(s1),U3={major:4,minor:1,patch:1},Zm=Vh("$ZodType",(t,e)=>{var n,r;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=U3;const i=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&i.unshift(t);for(const a of i)for(const o of a._zod.onattach)o(t);if(i.length===0)(r=t._zod).deferred??(r.deferred=[]),(n=t._zod.deferred)==null||n.push(()=>{t._zod.run=t._zod.parse});else{const a=(s,c,l)=>{let u=Mo(s),d;for(const h of c){if(h._zod.def.when){if(!h._zod.def.when(s))continue}else if(u)continue;const p=s.issues.length,b=h._zod.check(s);if(b instanceof Promise&&(l==null?void 0:l.async)===!1)throw new ds;if(d||b instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await b,s.issues.length!==p&&(u||(u=Mo(s,p)))});else{if(s.issues.length===p)continue;u||(u=Mo(s,p))}}return d?d.then(()=>s):s},o=(s,c,l)=>{if(Mo(s))return s.aborted=!0,s;const u=a(c,i,l);if(u instanceof Promise){if(l.async===!1)throw new ds;return u.then(d=>t._zod.parse(d,l))}return t._zod.parse(u,l)};t._zod.run=(s,c)=>{if(c.skipChecks)return t._zod.parse(s,c);if(c.direction==="backward"){const u=t._zod.parse({value:s.value,issues:[]},{...c,skipChecks:!0});return u instanceof Promise?u.then(d=>o(d,s,c)):o(u,s,c)}const l=t._zod.parse(s,c);if(l instanceof Promise){if(c.async===!1)throw new ds;return l.then(u=>a(u,i,c))}return a(l,i,c)}}t["~standard"]={validate:a=>{var o;try{const s=c1(t,a);return s.success?{value:s.data}:{issues:(o=s.error)==null?void 0:o.issues}}catch{return A3(t,a).then(s=>{var c;return s.success?{value:s.data}:{issues:(c=s.error)==null?void 0:c.issues}})}},vendor:"zod",version:1}});class l1{constructor(){this._map=new Map,this._idmap=new Map}add(e,...n){const r=n[0];if(this._map.set(e,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){const n=this._map.get(e);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(e),this}get(e){const n=e._zod.parent;if(n){const r={...this.get(n)??{}};delete r.id;const i={...r,...this._map.get(e)};return Object.keys(i).length?i:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function F3(){return new l1}const B3=F3();class Jm{constructor(e){this.counter=0,this.metadataRegistry=(e==null?void 0:e.metadata)??B3,this.target=(e==null?void 0:e.target)??"draft-2020-12",this.unrepresentable=(e==null?void 0:e.unrepresentable)??"throw",this.override=(e==null?void 0:e.override)??(()=>{}),this.io=(e==null?void 0:e.io)??"output",this.seen=new Map}process(e,n={path:[],schemaPath:[]}){var r,i,a,o;const s=e._zod.def,c={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},l=this.seen.get(e);if(l)return l.count++,n.schemaPath.includes(e)&&(l.cycle=n.path),l.schema;const u={schema:{},count:1,cycle:void 0,path:n.path};this.seen.set(e,u);const d=(i=(r=e._zod).toJSONSchema)==null?void 0:i.call(r);if(d)u.schema=d;else{const p={...n,schemaPath:[...n.schemaPath,e],path:n.path},b=e._zod.parent;if(b)u.ref=b,this.process(b,p),this.seen.get(b).isParent=!0;else{const y=u.schema;switch(s.type){case"string":{const w=y;w.type="string";const{minimum:f,maximum:g,format:m,patterns:v,contentEncoding:C}=e._zod.bag;if(typeof f=="number"&&(w.minLength=f),typeof g=="number"&&(w.maxLength=g),m&&(w.format=c[m]??m,w.format===""&&delete w.format),C&&(w.contentEncoding=C),v&&v.size>0){const T=[...v];T.length===1?w.pattern=T[0].source:T.length>1&&(u.schema.allOf=[...T.map(E=>({...this.target==="draft-7"||this.target==="draft-4"||this.target==="openapi-3.0"?{type:"string"}:{},pattern:E.source}))])}break}case"number":{const w=y,{minimum:f,maximum:g,format:m,multipleOf:v,exclusiveMaximum:C,exclusiveMinimum:T}=e._zod.bag;typeof m=="string"&&m.includes("int")?w.type="integer":w.type="number",typeof T=="number"&&(this.target==="draft-4"?(w.minimum=T,w.exclusiveMinimum=!0):w.exclusiveMinimum=T),typeof f=="number"&&(w.minimum=f,typeof T=="number"&&this.target!=="draft-4"&&(T>=f?delete w.minimum:delete w.exclusiveMinimum)),typeof C=="number"&&(this.target==="draft-4"?(w.maximum=C,w.exclusiveMaximum=!0):w.exclusiveMaximum=C),typeof g=="number"&&(w.maximum=g,typeof C=="number"&&this.target!=="draft-4"&&(C<=g?delete w.maximum:delete w.exclusiveMaximum)),typeof v=="number"&&(w.multipleOf=v);break}case"boolean":{const w=y;w.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{y.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{y.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const w=y,{minimum:f,maximum:g}=e._zod.bag;typeof f=="number"&&(w.minItems=f),typeof g=="number"&&(w.maxItems=g),w.type="array",w.items=this.process(s.element,{...p,path:[...p.path,"items"]});break}case"object":{const w=y;w.type="object",w.properties={};const f=s.shape;for(const v in f)w.properties[v]=this.process(f[v],{...p,path:[...p.path,"properties",v]});const g=new Set(Object.keys(f)),m=new Set([...g].filter(v=>{const C=s.shape[v]._zod;return this.io==="input"?C.optin===void 0:C.optout===void 0}));m.size>0&&(w.required=Array.from(m)),((a=s.catchall)==null?void 0:a._zod.def.type)==="never"?w.additionalProperties=!1:s.catchall?s.catchall&&(w.additionalProperties=this.process(s.catchall,{...p,path:[...p.path,"additionalProperties"]})):this.io==="output"&&(w.additionalProperties=!1);break}case"union":{const w=y,f=s.options.map((g,m)=>this.process(g,{...p,path:[...p.path,"anyOf",m]}));if(this.target==="openapi-3.0"){const g=f.filter(v=>v.type!=="null"),m=g.length!==f.length;g.length===1?Object.assign(w,g[0]):w.anyOf=g,m&&(w.nullable=!0)}else w.anyOf=f;break}case"intersection":{const w=y,f=this.process(s.left,{...p,path:[...p.path,"allOf",0]}),g=this.process(s.right,{...p,path:[...p.path,"allOf",1]}),m=C=>"allOf"in C&&Object.keys(C).length===1,v=[...m(f)?f.allOf:[f],...m(g)?g.allOf:[g]];w.allOf=v;break}case"tuple":{const w=y;w.type="array";const f=s.items.map((v,C)=>this.process(v,{...p,path:[...p.path,"prefixItems",C]}));if(this.target==="draft-2020-12"?w.prefixItems=f:w.items=f,s.rest){const v=this.process(s.rest,{...p,path:[...p.path,"items"]});this.target==="draft-2020-12"?w.items=v:w.additionalItems=v}s.rest&&(w.items=this.process(s.rest,{...p,path:[...p.path,"items"]}));const{minimum:g,maximum:m}=e._zod.bag;typeof g=="number"&&(w.minItems=g),typeof m=="number"&&(w.maxItems=m);break}case"record":{const w=y;w.type="object",this.target!=="draft-4"&&(w.propertyNames=this.process(s.keyType,{...p,path:[...p.path,"propertyNames"]})),w.additionalProperties=this.process(s.valueType,{...p,path:[...p.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const w=y,f=N3(s.entries);f.every(g=>typeof g=="number")&&(w.type="number"),f.every(g=>typeof g=="string")&&(w.type="string"),w.enum=f;break}case"literal":{const w=y,f=[];for(const g of s.values)if(g===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof g=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");f.push(Number(g))}else f.push(g);if(f.length!==0)if(f.length===1){const g=f[0];w.type=g===null?"null":typeof g,this.target==="draft-4"||this.target==="openapi-3.0"?w.enum=[g]:w.const=g}else f.every(g=>typeof g=="number")&&(w.type="number"),f.every(g=>typeof g=="string")&&(w.type="string"),f.every(g=>typeof g=="boolean")&&(w.type="string"),f.every(g=>g===null)&&(w.type="null"),w.enum=f;break}case"file":{const w=y,f={type:"string",format:"binary",contentEncoding:"binary"},{minimum:g,maximum:m,mime:v}=e._zod.bag;g!==void 0&&(f.minLength=g),m!==void 0&&(f.maxLength=m),v?v.length===1?(f.contentMediaType=v[0],Object.assign(w,f)):w.anyOf=v.map(C=>({...f,contentMediaType:C})):Object.assign(w,f);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const w=this.process(s.innerType,p);this.target==="openapi-3.0"?(Object.assign(y,w),y.nullable=!0,u.ref=s.innerType):y.anyOf=[w,{type:"null"}];break}case"nonoptional":{this.process(s.innerType,p),u.ref=s.innerType;break}case"success":{const w=y;w.type="boolean";break}case"default":{this.process(s.innerType,p),u.ref=s.innerType,y.default=JSON.parse(JSON.stringify(s.defaultValue));break}case"prefault":{this.process(s.innerType,p),u.ref=s.innerType,this.io==="input"&&(y._prefault=JSON.parse(JSON.stringify(s.defaultValue)));break}case"catch":{this.process(s.innerType,p),u.ref=s.innerType;let w;try{w=s.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}y.default=w;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const w=y,f=e._zod.pattern;if(!f)throw new Error("Pattern not found in template literal");w.type="string",w.pattern=f.source;break}case"pipe":{const w=this.io==="input"?s.in._zod.def.type==="transform"?s.out:s.in:s.out;this.process(w,p),u.ref=w;break}case"readonly":{this.process(s.innerType,p),u.ref=s.innerType,y.readOnly=!0;break}case"promise":{this.process(s.innerType,p),u.ref=s.innerType;break}case"optional":{this.process(s.innerType,p),u.ref=s.innerType;break}case"lazy":{const w=e._zod.innerType;this.process(w,p),u.ref=w;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}case"function":{if(this.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema");break}}}}const h=this.metadataRegistry.get(e);return h&&Object.assign(u.schema,h),this.io==="input"&&Oe(e)&&(delete u.schema.examples,delete u.schema.default),this.io==="input"&&u.schema._prefault&&((o=u.schema).default??(o.default=u.schema._prefault)),delete u.schema._prefault,this.seen.get(e).schema}emit(e,n){var r,i,a,o,s,c;const l={cycles:(n==null?void 0:n.cycles)??"ref",reused:(n==null?void 0:n.reused)??"inline",external:(n==null?void 0:n.external)??void 0},u=this.seen.get(e);if(!u)throw new Error("Unprocessed schema. This is a bug in Zod.");const d=w=>{var f;const g=this.target==="draft-2020-12"?"$defs":"definitions";if(l.external){const C=(f=l.external.registry.get(w[0]))==null?void 0:f.id,T=l.external.uri??(x=>x);if(C)return{ref:T(C)};const E=w[1].defId??w[1].schema.id??`schema${this.counter++}`;return w[1].defId=E,{defId:E,ref:`${T("__shared")}#/${g}/${E}`}}if(w[1]===u)return{ref:"#"};const m=`#/${g}/`,v=w[1].schema.id??`__schema${this.counter++}`;return{defId:v,ref:m+v}},h=w=>{if(w[1].schema.$ref)return;const f=w[1],{ref:g,defId:m}=d(w);f.def={...f.schema},m&&(f.defId=m);const v=f.schema;for(const C in v)delete v[C];v.$ref=g};if(l.cycles==="throw")for(const w of this.seen.entries()){const f=w[1];if(f.cycle)throw new Error(`Cycle detected: #/${(r=f.cycle)==null?void 0:r.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const w of this.seen.entries()){const f=w[1];if(e===w[0]){h(w);continue}if(l.external){const g=(i=l.external.registry.get(w[0]))==null?void 0:i.id;if(e!==w[0]&&g){h(w);continue}}if((a=this.metadataRegistry.get(w[0]))!=null&&a.id){h(w);continue}if(f.cycle){h(w);continue}if(f.count>1&&l.reused==="ref"){h(w);continue}}const p=(w,f)=>{const g=this.seen.get(w),m=g.def??g.schema,v={...m};if(g.ref===null)return;const C=g.ref;if(g.ref=null,C){p(C,f);const T=this.seen.get(C).schema;T.$ref&&(f.target==="draft-7"||f.target==="draft-4"||f.target==="openapi-3.0")?(m.allOf=m.allOf??[],m.allOf.push(T)):(Object.assign(m,T),Object.assign(m,v))}g.isParent||this.override({zodSchema:w,jsonSchema:m,path:g.path??[]})};for(const w of[...this.seen.entries()].reverse())p(w[0],{target:this.target});const b={};if(this.target==="draft-2020-12"?b.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?b.$schema="http://json-schema.org/draft-07/schema#":this.target==="draft-4"?b.$schema="http://json-schema.org/draft-04/schema#":this.target==="openapi-3.0"||console.warn(`Invalid target: ${this.target}`),(o=l.external)!=null&&o.uri){const w=(s=l.external.registry.get(e))==null?void 0:s.id;if(!w)throw new Error("Schema is missing an `id` property");b.$id=l.external.uri(w)}Object.assign(b,u.def);const y=((c=l.external)==null?void 0:c.defs)??{};for(const w of this.seen.entries()){const f=w[1];f.def&&f.defId&&(y[f.defId]=f.def)}l.external||Object.keys(y).length>0&&(this.target==="draft-2020-12"?b.$defs=y:b.definitions=y);try{return JSON.parse(JSON.stringify(b))}catch{throw new Error("Error converting schema to JSON.")}}}function z3(t,e){if(t instanceof l1){const r=new Jm(e),i={};for(const s of t._idmap.entries()){const[c,l]=s;r.process(l)}const a={},o={registry:t,uri:e==null?void 0:e.uri,defs:i};for(const s of t._idmap.entries()){const[c,l]=s;a[c]=r.emit(l,{...e,external:o})}if(Object.keys(i).length>0){const s=r.target==="draft-2020-12"?"$defs":"definitions";a.__shared={[s]:i}}return{schemas:a}}const n=new Jm(e);return n.process(t),n.emit(t,e)}function Oe(t,e){const n=e??{seen:new Set};if(n.seen.has(t))return!1;n.seen.add(t);const r=t._zod.def;switch(r.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return Oe(r.element,n);case"object":{for(const i in r.shape)if(Oe(r.shape[i],n))return!0;return!1}case"union":{for(const i of r.options)if(Oe(i,n))return!0;return!1}case"intersection":return Oe(r.left,n)||Oe(r.right,n);case"tuple":{for(const i of r.items)if(Oe(i,n))return!0;return!!(r.rest&&Oe(r.rest,n))}case"record":return Oe(r.keyType,n)||Oe(r.valueType,n);case"map":return Oe(r.keyType,n)||Oe(r.valueType,n);case"set":return Oe(r.valueType,n);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return Oe(r.innerType,n);case"lazy":return Oe(r.getter(),n);case"default":return Oe(r.innerType,n);case"prefault":return Oe(r.innerType,n);case"custom":return!1;case"transform":return!0;case"pipe":return Oe(r.in,n)||Oe(r.out,n);case"success":return!1;case"catch":return!1;case"function":return!1}throw new Error(`Unknown schema type: ${r.type}`)}const V3=(t,e=50,n=1/0)=>{let r=null,i=null,a=Promise.resolve();return(...o)=>{i??(i=Date.now());const s=()=>{a=a.then(async()=>{try{await t.apply(null,o)}catch{}}),i=null};r&&clearTimeout(r),Date.now()-i>n?s():r=setTimeout(()=>{s()},e)}},H3=(t,e,n,r)=>{let i={fields:[],destinations:[],actions:[]};const a=V3(async()=>{const{context:s,state:c}=n(q3(e));if(!uh(i,s)){try{wa("Automatic context sent:",s),await t.sendContext({"nlx:vpContext":s})}catch{}r(c),i=s}},50,300);a();const o=new MutationObserver(a);return o.observe(document.body,{subtree:!0,childList:!0,attributes:!0}),{teardown:()=>{o.disconnect()},onCustomCommandsChange:s=>{e=s,a()}}},q3=t=>{const{context:e,formElements:n}=_3(),{context:r,links:i}=$3();return{context:{uri:window.location.pathname,fields:e,destinations:r,actions:t.map(a=>{const{handler:o,schema:s,...c}=a;return s!=null?{schema:s instanceof Zm?z3(s,{io:"input"}):s,...c}:c})},state:{formElements:n,links:i,customCommands:new Map(t.map(a=>{const o=a.schema;return[a.action,o instanceof Zm?s=>{const c=c1(o,s);c.success?a.handler(c.data):wa(`Custom command "${a.action}" received, but the payload ${JSON.stringify(s,null,2)} does not match the schema.`,c.error)}:a.handler]}))}}},$3=()=>{const t=Object.fromEntries(bC(Array.from(document.querySelectorAll("a")).map(e=>[od(e),e.getAttribute("href")??""])));return{context:Object.keys(t),links:t}},W3=(t,e,n)=>{const r=i=>{switch(wa("Command received",i),i.classification){case"navigation":if(e.navigation!=null)e.navigation(i.action,i.destination,n.current.links);else if(e.automaticContext!==!1)switch(i.action){case"page_next":window.history.forward();break;case"page_previous":window.history.back();break;case"page_custom":if(i.destination!=null){const a=n.current.links[i.destination];if(a!=null)window.location.href=a;else try{new URL(i.destination),window.location.href=i.destination}catch{wa('Custom page navigation action received, but no URL found for destination".',i.destination)}}break;case"page_unknown":wa("Unknown page navigation action received, no automatic handling available.")}break;case"input":(e==null?void 0:e.input)!=null?e.input(i.fields,n.current.formElements):(e==null?void 0:e.automaticContext)!==!1&&i.fields.forEach(a=>{if(n.current.formElements[a.id]!=null){const o=n.current.formElements[a.id];typeof a.value=="string"?o.value=a.value:o instanceof HTMLInputElement&&o.type==="checkbox"&&(o.checked=a.value),o.classList.add("voice-updated"),o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(()=>{o.classList.remove("voice-updated")},2e3)}});break;case"custom":if(n.current.customCommands.has(i.action)){const a=n.current.customCommands.get(i.action);i.payload!=null&&a(i.payload)}(e==null?void 0:e.custom)!=null&&(e.automaticContext!==!1&&console.warn("bidirectional.custom is deprecated in automatic context mode. Please use `setCustomBidirectionalCommands` instead."),e.custom(i.action,i.payload));break}};return t.addEventListener("voicePlusCommand",r),()=>{t.removeEventListener("voicePlusCommand",r)}},u1=L.forwardRef((t,e)=>{var n;const r=sessionStorage.getItem("nlxActiveVoiceConversationId")===t.config.conversationId,i=L.useMemo(()=>{const R=sessionStorage.getItem("nlxActiveConversationResponses")??"{}";try{const F=JSON.parse(R);if(Array.isArray(F[t.config.conversationId]))return F[t.config.conversationId]}catch{return null}},[t.config.conversationId]),a=L.useMemo(()=>dS({responses:i,...t.config}),[t.config,i]),[o,s]=L.useState([]),c=((n=o[o.length-1])==null?void 0:n.type)===et.User,l=t.colorMode??"dark",[u,d]=L.useState(t.embedded||r),h=uS(t.config),[p,b]=L.useState(!1),y=L.useRef(t.embedded||r),w=t.input??"text",f=L.useCallback(R=>{t.onClose!=null&&(t.onClose(R),sessionStorage.removeItem("nlxActiveVoiceConversationId"),(w==="voice"||w==="voiceMini")&&a.reset({clearResponses:!0}),R.defaultPrevented||d(!1))},[t.onClose,d]);L.useEffect(()=>{y.current=u},[u]),L.useImperativeHandle(e,()=>({setExpanded:d,getExpanded(){return y.current},getConversationHandler(){return a},setCustomBidirectionalCommands:R=>{C.current(R)}}),[a,d]),L.useEffect(()=>{const R=F=>{s(F);const q=a.currentConversationId();w==="text"&&q!=null&&sessionStorage.setItem("nlxActiveConversationResponses",JSON.stringify({[q]:F}))};return a.subscribe(R),()=>{a.unsubscribe(R)}},[a,s]);const g=L.useRef(r);L.useEffect(()=>{!u||g.current||(g.current=!0,(w!=="text"||i==null||i.length===0)&&t.initializeConversation(a,t.initialContext),t.config.conversationId!=null&&sessionStorage.setItem("nlxActiveVoiceConversationId",t.config.conversationId))},[t.initializeConversation,t.initialContext,a,u]);const m=L.useRef({formElements:{},links:{},customCommands:new Map}),v=L.useRef([]),C=L.useRef(R=>{var F;if(((F=t.bidirectional)==null?void 0:F.automaticContext)!==!1)v.current=R;else throw new Error("Custom commands can only be set when automatic context is enabled.")});L.useEffect(()=>{if(u&&t.bidirectional!=null&&t.bidirectional.automaticContext!==!1){const{teardown:R,onCustomCommandsChange:F}=H3(a,v.current,t.bidirectional.customizeAutomaticContext??(q=>q),q=>{m.current=q});return C.current=F,R}},[u,a,t.bidirectional]),L.useEffect(()=>{if(t.bidirectional!=null&&(t.bidirectional.navigation!=null||t.bidirectional.input!=null||t.bidirectional.custom!=null||t.bidirectional.automaticContext!==!1))return W3(a,t.bidirectional,m)},[t.bidirectional,a]);const T=t.windowSize??(t.embedded?"full":"half"),E=L.useMemo(()=>{const R=vf(q=>q.type===et.Application,o);if(R===-1)return null;const F=o[R];return(F==null?void 0:F.type)!==et.Application?null:{index:R,response:F}},[o]),x=L.useMemo(()=>{if(E==null)return;const R=vf(q=>q.choices.length>0,E.response.payload.messages);if(R===-1)return;const F=E.response.payload.messages[R];if(F!=null)return{message:F,messageIndex:R,responseIndex:E.index}},[E]),[N,M]=L.useState({}),A=t.customModalities??{},[W,Q]=L.useState(!0),[O,V]=L.useState(0),$=()=>{a.reset({clearResponses:!0}),w!=="voice"&&t.initializeConversation(a,t.initialContext);const R=a.currentConversationId();sessionStorage.getItem("nlxConversationId")!==null&&(R==null?sessionStorage.removeItem("nlxConversationId"):sessionStorage.setItem("nlxConversationId",R)),R!=null&&sessionStorage.setItem("nlxActiveVoiceConversationId",R),V(F=>F+1)};if(a==null)return null;if(!u)return t.launchIcon!==!1?k.jsx(ls,{className:"fixed z-launchButton bottom-2 right-2 w-fit",theme:t.theme,colorMode:l,children:k.jsx(LS,{className:"backdrop-blur",iconUrl:typeof t.launchIcon=="string"?t.launchIcon:void 0,Custom:typeof t.launchIcon=="function"?t.launchIcon:void 0,onClick:()=>{d(!0)},label:"Expand chat"})}):null;if(w==="voiceMini")return k.jsx(ls,{theme:t.theme,colorMode:l,className:K("w-fit",t.embedded?"":"fixed z-touchpoint bottom-2 right-2"),children:k.jsx(jP,{handler:a,context:t.initialContext,onClose:()=>{f(new Event("close"))},renderCollapse:t.onClose!=null,customModalities:A},O)});const J=()=>{var R,F;return p?k.jsx(Im,{reset:()=>{$(),b(!1)},className:K("flex-none",T==="full"?"w-full md:max-w-content md:mx-auto":""),onClose:()=>{b(!1)},handler:a}):h?k.jsxs(k.Fragment,{children:[k.jsx(fP,{enabled:t.enabled,userMessageBubble:t.userMessageBubble??!1,agentMessageBubble:t.agentMessageBubble??!1,chatMode:t.chatMode??!1,isWaiting:c,lastApplicationResponseIndex:E==null?void 0:E.index,responses:o,colorMode:l,handler:a,uploadedFiles:N,customModalities:A,className:K("flex-grow",T==="full"?"w-full md:max-w-content md:mx-auto":"")}),k.jsxs("div",{className:K("p-2 md:p-3 flex flex-col flex-none gap-2",T==="full"?"w-full md:max-w-content md:mx-auto":""),children:[x!=null?k.jsx(dP,{...x,handler:a}):null,(x==null?void 0:x.message.selectedChoiceId)!=null?null:k.jsx(OP,{enabled:t.enabled,handler:a,uploadUrl:(F=(R=E==null?void 0:E.response.payload.metadata)==null?void 0:R.uploadUrls)==null?void 0:F[0],onFileUpload:({uploadId:q,file:Z})=>{M(ue=>({...ue,[q]:Z}))}})]})]}):k.jsx(J0,{})};return k.jsxs(ls,{theme:t.theme,colorMode:l,className:K("grid grid-cols-2 xl:grid-cols-[1fr_632px]",t.embedded?"w-full h-full":"fixed inset-0 z-touchpoint"),children:[T==="half"?k.jsx("div",{className:"hidden md:block bg-overlay"}):null,k.jsxs("div",{className:K("w-full bg-background text-primary-80 flex relative flex-col h-full backdrop-blur-overlay",{"col-span-2 md:col-span-1":T==="half","col-span-2":T==="full"}),children:[k.jsx(HS,{windowSize:t.embedded?"embedded":T,errorThemedCloseButton:w==="voice",speakerControls:w==="voice"?{enabled:W,setEnabled:Q}:void 0,colorMode:l,brandIcon:t.brandIcon,isSettingsOpen:p,enabled:t.enabled,toggleSettings:t.enableSettings?()=>{b(R=>!R)}:void 0,renderCollapse:t.onClose!=null,collapse:f,reset:$}),w==="text"?J():k.jsxs(k.Fragment,{children:[p?k.jsx(Im,{className:K("flex-none",T==="full"?"w-full md:max-w-content md:mx-auto":""),onClose:()=>{b(!1)},reset:()=>{$(),b(!1)},handler:a}):null,k.jsx(IE,{initializeConversation:t.initializeConversation,brandIcon:t.brandIcon,handler:a,speakersEnabled:W,colorMode:l,className:p?"hidden":"flex-grow",context:t.initialContext,customModalities:A},O)]})]})]})});u1.displayName="App";const d1=`*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:var(--font-family);font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]{display:none}*{font-family:var(--font-family)!important}*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.pointer-events-none{pointer-events:none}.visible{visibility:visible}.invisible{visibility:hidden}.collapse{visibility:collapse}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{top:0;right:0;bottom:0;left:0}.inset-x-0{left:0;right:0}.-top-2{top:-.5rem}.bottom-2{bottom:.5rem}.bottom-4{bottom:1rem}.bottom-\\[72px\\]{bottom:72px}.left-0{left:0}.left-1\\/2{left:50%}.right-0{right:0}.right-2{right:.5rem}.top-0{top:0}.top-1\\/2{top:50%}.z-10{z-index:10}.z-launchButton{z-index:100}.z-touchpoint{z-index:1000}.col-span-1{grid-column:span 1 / span 1}.col-span-2{grid-column:span 2 / span 2}.-mx-2{margin-left:-.5rem;margin-right:-.5rem}.mx-2{margin-left:.5rem;margin-right:.5rem}.mx-auto{margin-left:auto;margin-right:auto}.mb-2{margin-bottom:.5rem}.ml-1{margin-left:.25rem}.ml-2{margin-left:.5rem}.ml-3{margin-left:.75rem}.ml-auto{margin-left:auto}.mr-10{margin-right:2.5rem}.mr-2{margin-right:.5rem}.block{display:block}.inline{display:inline}.flex{display:flex}.grid{display:grid}.contents{display:contents}.hidden{display:none}.h-10{height:2.5rem}.h-20{height:5rem}.h-24{height:6rem}.h-4{height:1rem}.h-5{height:1.25rem}.h-52{height:13rem}.h-6{height:1.5rem}.h-64{height:16rem}.h-72{height:18rem}.h-8{height:2rem}.h-\\[128px\\]{height:128px}.h-\\[1px\\]{height:1px}.h-\\[360px\\]{height:360px}.h-full{height:100%}.max-h-\\[360px\\]{max-height:360px}.max-h-\\[40vh\\]{max-height:40vh}.max-h-full{max-height:100%}.min-h-full{min-height:100%}.w-10{width:2.5rem}.w-20{width:5rem}.w-24{width:6rem}.w-4{width:1rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-72{width:18rem}.w-8{width:2rem}.w-80{width:20rem}.w-\\[128px\\]{width:128px}.w-\\[calc\\(100vw-16px\\)\\]{width:calc(100vw - 16px)}.w-fit{width:-moz-fit-content;width:fit-content}.w-full{width:100%}.max-w-\\[360px\\]{max-width:360px}.max-w-content{max-width:640px}.flex-none{flex:none}.shrink-0{flex-shrink:0}.flex-grow{flex-grow:1}.-translate-x-1\\/2{--tw-translate-x: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-x-full{--tw-translate-x: -100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-1\\/2{--tw-translate-y: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-full{--tw-translate-y: -100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes ping{75%,to{transform:scale(2);opacity:0}}.animate-ping{animation:ping 1s cubic-bezier(0,0,.2,1) infinite}.cursor-pointer{cursor:pointer}.resize-none{resize:none}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.grid-cols-\\[320px\\,1fr\\]{grid-template-columns:320px 1fr}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-end{align-items:flex-end}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-1{gap:.25rem}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.gap-x-2{-moz-column-gap:.5rem;column-gap:.5rem}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.space-y-6>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(2rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem * var(--tw-space-y-reverse))}.space-y-px>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(1px * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1px * var(--tw-space-y-reverse))}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.whitespace-pre-wrap{white-space:pre-wrap}.rounded-full{border-radius:9999px}.rounded-inner{border-radius:var(--inner-border-radius)}.rounded-outer{border-radius:var(--outer-border-radius)}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-background{border-color:var(--background)}.border-primary-10{border-color:var(--primary-10)}.bg-\\[rgb\\(175\\,175\\,175\\)\\]{--tw-bg-opacity: 1;background-color:rgb(175 175 175 / var(--tw-bg-opacity))}.bg-\\[rgb\\(40\\,41\\,47\\)\\]{--tw-bg-opacity: 1;background-color:rgb(40 41 47 / var(--tw-bg-opacity))}.bg-accent{background-color:var(--accent)}.bg-background{background-color:var(--background)}.bg-black\\/50{background-color:#00000080}.bg-current{background-color:currentColor}.bg-error-primary{background-color:var(--error-primary)}.bg-error-secondary{background-color:var(--error-secondary)}.bg-overlay{background-color:var(--overlay)}.bg-primary-10{background-color:var(--primary-10)}.bg-primary-5{background-color:var(--primary-5)}.bg-primary-80{background-color:var(--primary-80)}.bg-secondary-40{background-color:var(--secondary-40)}.bg-secondary-60{background-color:var(--secondary-60)}.bg-transparent{background-color:transparent}.bg-cover{background-size:cover}.bg-center{background-position:center}.object-cover{-o-object-fit:cover;object-fit:cover}.p-2{padding:.5rem}.p-3{padding:.75rem}.p-4{padding:1rem}.px-1{padding-left:.25rem;padding-right:.25rem}.px-1\\.5{padding-left:.375rem;padding-right:.375rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.py-0{padding-top:0;padding-bottom:0}.py-0\\.5{padding-top:.125rem;padding-bottom:.125rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-2\\.5{padding-top:.625rem;padding-bottom:.625rem}.py-4{padding-top:1rem;padding-bottom:1rem}.pl-10{padding-left:2.5rem}.pl-4{padding-left:1rem}.pr-2{padding-right:.5rem}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.font-sans{font-family:var(--font-family)}.text-base{font-size:1rem;line-height:1.5rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-normal{font-weight:400}.text-accent{color:var(--accent)}.text-accent-20{color:var(--accent-20)}.text-error-primary{color:var(--error-primary)}.text-primary-20{color:var(--primary-20)}.text-primary-40{color:var(--primary-40)}.text-primary-60{color:var(--primary-60)}.text-primary-80{color:var(--primary-80)}.text-secondary-40{color:var(--secondary-40)}.text-secondary-80{color:var(--secondary-80)}.placeholder-primary-20::-moz-placeholder{color:var(--primary-20)}.placeholder-primary-20::placeholder{color:var(--primary-20)}.placeholder-primary-40::-moz-placeholder{color:var(--primary-40)}.placeholder-primary-40::placeholder{color:var(--primary-40)}.caret-accent{caret-color:var(--accent)}.opacity-0{opacity:0}.opacity-100{opacity:1}.opacity-\\[0\\.01\\]{opacity:.01}.outline-none{outline:2px solid transparent;outline-offset:2px}.outline{outline-style:solid}.outline-0{outline-width:0px}.outline-2{outline-width:2px}.outline-accent{outline-color:var(--accent)}.drop-shadow{--tw-drop-shadow: drop-shadow(0 1px 2px rgb(0 0 0 / .1)) drop-shadow(0 1px 1px rgb(0 0 0 / .06));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-blur{--tw-backdrop-blur: blur(8px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-md{--tw-backdrop-blur: blur(12px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-overlay{--tw-backdrop-blur: blur(48px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-200{transition-duration:.2s}.duration-500{transition-duration:.5s}.no-scrollbar::-webkit-scrollbar{display:none}.no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}@property --glow-opacity{syntax: "<percentage>"; inherits: false; initial-value: 0%;}.fullscreen-error svg{animation:error-glow 3s ease infinite;--glow-opacity: 0%;filter:drop-shadow(0 0 6px color-mix(in srgb,transparent,var(--accent) var(--glow-opacity)))}@keyframes error-glow{0%{color:var(--primary);fill-opacity:8%;--glow-opacity: 0%}22%{color:var(--primary);fill-opacity:8%;--glow-opacity: 0%}35%{color:var(--accent);fill-opacity:80%;--glow-opacity: 60%}45%{color:var(--accent);fill-opacity:70%;--glow-opacity: 30%}55%{color:var(--accent);fill-opacity:60%;--glow-opacity: 60%}60%{color:var(--primary);fill-opacity:8%;--glow-opacity: 0%}to{color:var(--primary);fill-opacity:8%;--glow-opacity: 0%}}.markdown ul{list-style-position:inside;list-style-type:disc}.markdown ol{list-style-position:inside;list-style-type:decimal}.markdown hr{border-color:var(--primary-20)}.markdown a{text-decoration-line:underline}.markdown h1,.markdown h2,.markdown h3{font-weight:700}.placeholder\\:text-primary-40::-moz-placeholder{color:var(--primary-40)}.placeholder\\:text-primary-40::placeholder{color:var(--primary-40)}.before\\:absolute:before{content:var(--tw-content);position:absolute}.before\\:inset-0:before{content:var(--tw-content);top:0;right:0;bottom:0;left:0}.before\\:-z-10:before{content:var(--tw-content);z-index:-10}.before\\:bg-transparent:before{content:var(--tw-content);background-color:transparent}.before\\:transition-colors:before{content:var(--tw-content);transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.before\\:content-\\[\\'\\'\\]:before{--tw-content: "";content:var(--tw-content)}.after\\:pointer-events-none:after{content:var(--tw-content);pointer-events:none}.after\\:absolute:after{content:var(--tw-content);position:absolute}.after\\:inset-0:after{content:var(--tw-content);top:0;right:0;bottom:0;left:0}.after\\:rounded-outer:after{content:var(--tw-content);border-radius:var(--outer-border-radius)}.after\\:content-\\[\\'\\'\\]:after{--tw-content: "";content:var(--tw-content)}.last\\:h-full:last-child{height:100%}.hover\\:bg-primary-10:hover{background-color:var(--primary-10)}.hover\\:bg-primary-5:hover{background-color:var(--primary-5)}.hover\\:bg-primary-80:hover{background-color:var(--primary-80)}.hover\\:bg-secondary-20:hover{background-color:var(--secondary-20)}.hover\\:text-primary-80:hover{color:var(--primary-80)}.hover\\:after\\:bg-primary-10:hover:after{content:var(--tw-content);background-color:var(--primary-10)}.focus\\:outline-0:focus{outline-width:0px}.focus\\:before\\:bg-primary-10:focus:before{content:var(--tw-content);background-color:var(--primary-10)}.focus\\:before\\:bg-primary-40:focus:before{content:var(--tw-content);background-color:var(--primary-40)}.focus\\:before\\:bg-primary-5:focus:before{content:var(--tw-content);background-color:var(--primary-5)}.focus\\:before\\:bg-primary-80:focus:before{content:var(--tw-content);background-color:var(--primary-80)}.enabled\\:hover\\:before\\:bg-primary-10:hover:enabled:before{content:var(--tw-content);background-color:var(--primary-10)}.enabled\\:hover\\:before\\:bg-primary-40:hover:enabled:before{content:var(--tw-content);background-color:var(--primary-40)}.enabled\\:hover\\:before\\:bg-primary-5:hover:enabled:before{content:var(--tw-content);background-color:var(--primary-5)}.enabled\\:hover\\:before\\:bg-primary-80:hover:enabled:before{content:var(--tw-content);background-color:var(--primary-80)}.enabled\\:active\\:before\\:bg-secondary-10:active:enabled:before{content:var(--tw-content);background-color:var(--secondary-10)}.disabled\\:bg-accent-20:disabled{background-color:var(--accent-20)}.disabled\\:bg-primary-10:disabled{background-color:var(--primary-10)}.disabled\\:bg-primary-5:disabled{background-color:var(--primary-5)}.disabled\\:bg-secondary-20:disabled{background-color:var(--secondary-20)}.disabled\\:text-primary-20:disabled{color:var(--primary-20)}.disabled\\:text-primary-40:disabled{color:var(--primary-40)}.disabled\\:text-secondary-40:disabled{color:var(--secondary-40)}@media (min-width: 768px){.md\\:absolute{position:absolute}.md\\:left-0{left:0}.md\\:right-0{right:0}.md\\:top-0{top:0}.md\\:-order-1{order:-1}.md\\:col-span-1{grid-column:span 1 / span 1}.md\\:mx-auto{margin-left:auto;margin-right:auto}.md\\:block{display:block}.md\\:w-fit{width:-moz-fit-content;width:fit-content}.md\\:max-w-content{max-width:640px}.md\\:-translate-x-full{--tw-translate-x: -100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.md\\:flex-col{flex-direction:column}.md\\:p-3{padding:.75rem}}@media (min-width: 1280px){.xl\\:grid-cols-\\[1fr_632px\\]{grid-template-columns:1fr 632px}}`,Qa=({children:t,className:e,faded:n})=>k.jsx("p",{className:K("text-base",n?"text-primary-60":"text-primary-80",e),children:t}),K3=({children:t,className:e})=>k.jsx("p",{className:K("text-sm text-primary-60",e),children:t}),Hh=({children:t,className:e,selected:n,onClick:r,href:i,newTab:a})=>{const o=K("block shrink-0 rounded-inner overflow-hidden","w-80 space-y-px",n?"outline outline-2 outline-accent":"",r!=null||i!=null?"hover:bg-primary-5":"",e);return L.useEffect(()=>{i==null&&a!=null&&console.warn("Setting the `newTab` prop on the `<CustomCard/>` has no effect if the `href` is not also set.")},[i,a]),i!=null?k.jsx("a",{className:o,href:i,onClick:r,...a?{target:"_blank",rel:"noreferrer"}:{},children:t}):r!=null?k.jsx("button",{className:o,onClick:r,children:t}):k.jsx("div",{className:o,children:t})},qh=({src:t,alt:e})=>k.jsx("img",{src:t,alt:e,className:"w-full h-52 object-cover"}),$h=({left:t,right:e,icon:n})=>k.jsxs("div",{className:"flex items-center relative justify-between gap-2 bg-primary-5 px-3 py-4",children:[k.jsx("div",{className:"space-y-1 text-left",children:t}),k.jsx("div",{className:"space-y-1 text-right",children:e}),n!=null?k.jsx(n,{className:"text-primary-60 w-4 h-4 absolute top-1/2 left-1/2 transform -translate-y-1/2 -translate-x-1/2"}):null]});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var h1=function(t,e){return(h1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])})(t,e)},G3,Do,Z3=(function(t){/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/(function(){var e={}.hasOwnProperty;function n(){for(var r=[],i=0;i<arguments.length;i++){var a=arguments[i];if(a){var o=typeof a;if(o==="string"||o==="number")r.push(a);else if(Array.isArray(a)&&a.length){var s=n.apply(null,a);s&&r.push(s)}else if(o==="object")for(var c in a)e.call(a,c)&&a[c]&&r.push(c)}}return r.join(" ")}t.exports?(n.default=n,t.exports=n):window.classNames=n})()}(Do={path:G3,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(e==null&&Do.path)}},Do.exports),Do.exports);function sd(t,e,n){var r,i,a,o,s;function c(){var u=Date.now()-o;u<e&&u>=0?r=setTimeout(c,e-u):(r=null,n||(s=t.apply(a,i),a=i=null))}e==null&&(e=100);var l=function(){a=this,i=arguments,o=Date.now();var u=n&&!r;return r||(r=setTimeout(c,e)),u&&(s=t.apply(a,i),a=i=null),s};return l.clear=function(){r&&(clearTimeout(r),r=null)},l.flush=function(){r&&(s=t.apply(a,i),a=i=null,clearTimeout(r),r=null)},l}sd.debounce=sd;var J3=sd;(function(t,e){e===void 0&&(e={});var n=e.insertAt;if(typeof document<"u"){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",n==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}})(`.indiana-scroll-container {
  overflow: auto; }
  .indiana-scroll-container--dragging {
    scroll-behavior: auto !important; }
    .indiana-scroll-container--dragging > * {
      pointer-events: none;
      cursor: -webkit-grab;
      cursor: grab; }
  .indiana-scroll-container--hide-scrollbars {
    overflow: hidden;
    overflow: -moz-scrollbars-none;
    -ms-overflow-style: none;
    scrollbar-width: none; }
    .indiana-scroll-container--hide-scrollbars::-webkit-scrollbar {
      display: none !important;
      height: 0 !important;
      width: 0 !important;
      background: transparent !important;
      -webkit-appearance: none !important; }
  .indiana-scroll-container--native-scroll {
    overflow: auto; }

.indiana-dragging {
  cursor: -webkit-grab;
  cursor: grab; }
`);var Tl,Q3=(Tl="indiana-scroll-container",function(t,e){if(!t)return Tl;var n;typeof t=="string"?n=t:e=t;var r=Tl;return n&&(r+="__"+n),r+(e?Object.keys(e).reduce(function(i,a){var o=e[a];return o&&(i+=" "+(typeof o=="boolean"?r+"--"+a:r+"--"+a+"_"+o)),i},""):"")}),Y3=function(t){function e(n){var r=t.call(this,n)||this;return r.onEndScroll=function(){r.scrolling=!1,!r.pressed&&r.started&&r.processEnd()},r.onScroll=function(i){var a=r.container.current;a.scrollLeft===r.scrollLeft&&a.scrollTop===r.scrollTop||(r.scrolling=!0,r.processScroll(i),r.onEndScroll())},r.onTouchStart=function(i){var a=r.props.nativeMobileScroll;if(r.isDraggable(i.target))if(r.internal=!0,a&&r.scrolling)r.pressed=!0;else{var o=i.touches[0];r.processClick(i,o.clientX,o.clientY),!a&&r.props.stopPropagation&&i.stopPropagation()}},r.onTouchEnd=function(i){var a=r.props.nativeMobileScroll;r.pressed&&(!r.started||r.scrolling&&a?r.pressed=!1:r.processEnd(),r.forceUpdate())},r.onTouchMove=function(i){var a=r.props.nativeMobileScroll;if(r.pressed&&(!a||!r.isMobile)){var o=i.touches[0];o&&r.processMove(i,o.clientX,o.clientY),i.preventDefault(),r.props.stopPropagation&&i.stopPropagation()}},r.onMouseDown=function(i){r.isDraggable(i.target)&&r.isScrollable()&&(r.internal=!0,r.props.buttons.indexOf(i.button)!==-1&&(r.processClick(i,i.clientX,i.clientY),i.preventDefault(),r.props.stopPropagation&&i.stopPropagation()))},r.onMouseMove=function(i){r.pressed&&(r.processMove(i,i.clientX,i.clientY),i.preventDefault(),r.props.stopPropagation&&i.stopPropagation())},r.onMouseUp=function(i){r.pressed&&(r.started?r.processEnd():(r.internal=!1,r.pressed=!1,r.forceUpdate(),r.props.onClick&&r.props.onClick(i)),i.preventDefault(),r.props.stopPropagation&&i.stopPropagation())},r.container=Cr.createRef(),r.onEndScroll=J3(r.onEndScroll,300),r.scrolling=!1,r.started=!1,r.pressed=!1,r.internal=!1,r.getRef=r.getRef.bind(r),r}return function(n,r){function i(){this.constructor=n}h1(n,r),n.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}(e,t),e.prototype.componentDidMount=function(){var n=this.props.nativeMobileScroll,r=this.container.current;window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd),r.addEventListener("touchstart",this.onTouchStart,{passive:!1}),r.addEventListener("mousedown",this.onMouseDown,{passive:!1}),n&&(this.isMobile=this.isMobileDevice(),this.isMobile&&this.forceUpdate())},e.prototype.componentWillUnmount=function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},e.prototype.getElement=function(){return this.container.current},e.prototype.isMobileDevice=function(){return window.orientation!==void 0||navigator.userAgent.indexOf("IEMobile")!==-1},e.prototype.isDraggable=function(n){var r=this.props.ignoreElements;if(r){var i=n.closest(r);return i===null||i.contains(this.getElement())}return!0},e.prototype.isScrollable=function(){var n=this.container.current;return n&&(n.scrollWidth>n.clientWidth||n.scrollHeight>n.clientHeight)},e.prototype.processClick=function(n,r,i){var a=this.container.current;this.scrollLeft=a.scrollLeft,this.scrollTop=a.scrollTop,this.clientX=r,this.clientY=i,this.pressed=!0},e.prototype.processStart=function(n){n===void 0&&(n=!0);var r=this.props.onStartScroll;this.started=!0,n&&document.body.classList.add("indiana-dragging"),r&&r({external:!this.internal}),this.forceUpdate()},e.prototype.processScroll=function(n){if(this.started){var r=this.props.onScroll;r&&r({external:!this.internal})}else this.processStart(!1)},e.prototype.processMove=function(n,r,i){var a=this.props,o=a.horizontal,s=a.vertical,c=a.activationDistance,l=a.onScroll,u=this.container.current;this.started?(o&&(u.scrollLeft-=r-this.clientX),s&&(u.scrollTop-=i-this.clientY),l&&l({external:!this.internal}),this.clientX=r,this.clientY=i,this.scrollLeft=u.scrollLeft,this.scrollTop=u.scrollTop):(o&&Math.abs(r-this.clientX)>c||s&&Math.abs(i-this.clientY)>c)&&(this.clientX=r,this.clientY=i,this.processStart())},e.prototype.processEnd=function(){var n=this.props.onEndScroll;this.container.current&&n&&n({external:!this.internal}),this.pressed=!1,this.started=!1,this.scrolling=!1,this.internal=!1,document.body.classList.remove("indiana-dragging"),this.forceUpdate()},e.prototype.getRef=function(n){[this.container,this.props.innerRef].forEach(function(r){r&&(typeof r=="function"?r(n):r.current=n)})},e.prototype.render=function(){var n=this.props,r=n.children,i=n.draggingClassName,a=n.className,o=n.style,s=n.hideScrollbars,c=n.component;return Cr.createElement(c,{className:Z3(a,this.pressed&&i,Q3({dragging:this.pressed,"hide-scrollbars":s,"native-scroll":this.isMobile})),style:o,ref:this.getRef,onScroll:this.onScroll},r)},e.defaultProps={nativeMobileScroll:!0,hideScrollbars:!0,activationDistance:10,vertical:!0,horizontal:!0,stopPropagation:!1,style:{},component:"div",buttons:[0]},e}(L.PureComponent);const p1=({className:t,children:e})=>k.jsx(Y3,{className:K("flex gap-x-2 overflow-x-auto no-scrollbar px-2 -mx-2",t),children:e});function Qm(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function X3(t,e,n){return e=nc(e),function(r,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}(r)}(t,g1()?Reflect.construct(e,n||[],nc(t).constructor):e.apply(t,n))}function e5(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function t5(t,e,n){return Object.defineProperty(t,"prototype",{writable:!1}),t}function f1(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(c,l){if(c){if(typeof c=="string")return Qm(c,l);var u={}.toString.call(c).slice(8,-1);return u==="Object"&&c.constructor&&(u=c.constructor.name),u==="Map"||u==="Set"?Array.from(c):u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?Qm(c,l):void 0}}(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var c=n.next();return o=c.done,c},e:function(c){s=!0,a=c},f:function(){try{o||n.return==null||n.return()}finally{if(s)throw a}}}}function m1(t,e,n){return(e=function(r){var i=function(a,o){if(typeof a!="object"||!a)return a;var s=a[Symbol.toPrimitive];if(s!==void 0){var c=s.call(a,o);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(a)}(r,"string");return typeof i=="symbol"?i:i+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function tc(){return tc=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},tc.apply(null,arguments)}function nc(t){return nc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},nc(t)}function n5(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cd(t,e)}function g1(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(g1=function(){return!!t})()}function Ym(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function jo(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ym(Object(n),!0).forEach(function(r){m1(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ym(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function v1(t,e){if(t==null)return{};var n,r,i=function(o,s){if(o==null)return{};var c={};for(var l in o)if({}.hasOwnProperty.call(o,l)){if(s.includes(l))continue;c[l]=o[l]}return c}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(r=0;r<a.length;r++)n=a[r],e.includes(n)||{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function cd(t,e){return cd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},cd(t,e)}function Ca(t,e){var n,r=e.replacementChars,i=e.replacement,a=e.separate,o=r,s="",c=f1(t);try{for(c.s();!(n=c.n()).done;){var l,u=n.value,d=!Object.prototype.hasOwnProperty.call(i,u)&&((l=i[o[0]])===null||l===void 0?void 0:l.test(u));(a&&u===o[0]||d)&&(o=o.slice(1),s+=u)}}catch(h){c.e(h)}finally{c.f()}return s}function b1(t,e){var n,r=e.mask,i=e.replacement,a=e.separate,o=e.showMask,s=0,c="",l=f1(r);try{for(l.s();!(n=l.n()).done;){var u=n.value;if(!o&&t[s]===void 0)break;Object.prototype.hasOwnProperty.call(i,u)&&t[s]!==void 0?c+=t[s++]:c+=u}}catch(h){l.e(h)}finally{l.f()}if(a&&!o){for(var d=r.length-1;d>=0&&c[d]===r[d];d--);c=c.slice(0,d+1)}return c}function y1(t,e){for(var n=e.mask,r=e.replacement,i=[],a=0;a<n.length;a++){var o,s=(o=t[a])!==null&&o!==void 0?o:n[a],c=Object.prototype.hasOwnProperty.call(r,s)?"replacement":t[a]!==void 0&&t[a]!==n[a]?"input":"mask";i.push({type:c,value:s,index:a})}return i}function ji(t){return t.length>0?m1({},t,/./):{}}function ld(t,e){for(var n=e.start,r=n===void 0?0:n,i=e.end,a=e.mask,o=e.replacement,s=e.separate,c=t.slice(r,i),l=a.slice(r,i),u="",d=0;d<l.length;d++){var h=Object.prototype.hasOwnProperty.call(o,l[d]);h&&c[d]!==void 0&&c[d]!==l[d]?u+=c[d]:h&&s&&(u+=l[d])}return u}function k1(t,e){var n=e.mask,r=e.replacement,i=typeof r=="string"?ji(r):r,a=RegExp("[^".concat(Object.keys(i).join(""),"]"),"g");return b1(Ca(t,{replacementChars:n.replace(a,""),replacement:i,separate:!1}),{mask:n,replacement:i,separate:!1,showMask:!1})}function r5(t,e){var n=e.mask,r=e.replacement,i=typeof r=="string"?ji(r):r,a=ld(t,{mask:n,replacement:i,separate:!1}),o=RegExp("[^".concat(Object.keys(i).join(""),"]"),"g");return Ca(a,{replacementChars:n.replace(o,""),replacement:i,separate:!1})}function i5(t,e){var n=e.mask,r=e.replacement,i=typeof r=="string"?ji(r):r;return y1(k1(t,{mask:n,replacement:i}),{mask:n,replacement:i})}var a5=["[","]","\\","/","^","$",".","|","?","*","+","(",")","{","}"];function Xm(t){return a5.includes(t)?"\\".concat(t):t}function o5(t,e){for(var n=e.mask,r=e.replacement,i=typeof r=="string"?ji(r):r,a=t==="partial"||t==="partial-inexact",o=t==="full"||t==="partial",s="",c=0;c<n.length;c++){var l=n[c];c===0&&(s="^"),a&&(s+="("),s+=Object.prototype.hasOwnProperty.call(i,l)?"".concat(o?"(?!".concat(Xm(l),")"):"","(").concat(i[l].source,")"):Xm(l),c===n.length-1&&(a&&(s+=")?".repeat(n.length)),s+="$")}return s}function s5(t,e){return new Proxy(t,{set:function(n,r,i){return r==="current"&&(i!==t.current&&(t.current!==null&&e.unregister(t.current),i!==null&&e.register(i)),n[r]=i,!0)}})}function c5(t,e,n){return e=Ya(e),function(r,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}(r)}(t,Wh()?Reflect.construct(e,n||[],Ya(t).constructor):e.apply(t,n))}function w1(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function C1(t,e,n){return Object.defineProperty(t,"prototype",{writable:!1}),t}function l5(t,e,n){return(e=function(r){var i=function(a,o){if(typeof a!="object"||!a)return a;var s=a[Symbol.toPrimitive];if(s!==void 0){var c=s.call(a,o);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(a)}(r,"string");return typeof i=="symbol"?i:i+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ya(t){return Ya=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ya(t)}function u5(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xa(t,e)}function Wh(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Wh=function(){return!!t})()}function eg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function tg(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?eg(Object(n),!0).forEach(function(r){l5(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):eg(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function d5(t,e){if(t==null)return{};var n,r,i=function(o,s){if(o==null)return{};var c={};for(var l in o)if({}.hasOwnProperty.call(o,l)){if(s.includes(l))continue;c[l]=o[l]}return c}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(r=0;r<a.length;r++)n=a[r],e.includes(n)||{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function Xa(t,e){return Xa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},Xa(t,e)}function ud(t){return ud=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ud(t)}function dd(t){var e=typeof Map=="function"?new Map:void 0;return dd=function(n){if(n===null||!function(i){try{return Function.toString.call(i).indexOf("[native code]")!==-1}catch{return typeof i=="function"}}(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(n))return e.get(n);e.set(n,r)}function r(){return function(i,a,o){if(Wh())return Reflect.construct.apply(null,arguments);var s=[null];s.push.apply(s,a);var c=new(i.bind.apply(i,s));return o&&Xa(c,o.prototype),c}(n,arguments,Ya(this).constructor)}return r.prototype=Object.create(n.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Xa(r,n)},dd(t)}var Sa=function(t){function e(n){var r;return w1(this,e),(r=c5(this,e,[n])).name="SyntheticChangeError",r}return u5(e,t),C1(e)}(dd(Error)),ng,h5=["options"],p5=["text","email","tel","search","url"],S1=C1(function t(e){var n=e.init,r=e.tracking;w1(this,t);var i=new WeakMap;this.register=function(a){var o;if(p5.includes(a.type)){var s=(o=a._wrapperState)!==null&&o!==void 0?o:{},c=s.initialValue,l=c===void 0?"":c,u=s.controlled,d=u!==void 0&&u,h=n({initialValue:a.value||l,controlled:d}),p=h.value,b=h.options,y={value:p,options:b,fallbackOptions:b},w={id:-1,cachedId:-1},f={value:"",selectionStart:0,selectionEnd:0},g=Object.getOwnPropertyDescriptor("_valueTracker"in a?a:HTMLInputElement.prototype,"value");Object.defineProperty(a,"value",tg(tg({},g),{},{set:function(T){var E;f.value=T,g==null||(E=g.set)===null||E===void 0||E.call(a,T)}})),a.value=p;var m=function(){var T=function(){var E,x;f.selectionStart=(E=a.selectionStart)!==null&&E!==void 0?E:0,f.selectionEnd=(x=a.selectionEnd)!==null&&x!==void 0?x:0,w.id=window.setTimeout(T)};w.id=window.setTimeout(T)},v=function(){window.clearTimeout(w.id),w.id=-1,w.cachedId=-1},C=function(T){try{var E,x;if(w.cachedId===w.id)throw new Sa("The input selection has not been updated.");w.cachedId=w.id;var N=a.value,M=a.selectionStart,A=a.selectionEnd;if(M===null||A===null)throw new Sa("The selection attributes have not been initialized.");var W,Q=f.value;if(T.inputType===void 0&&(f.selectionStart=0,f.selectionEnd=Q.length),M>f.selectionStart?W="insert":M<=f.selectionStart&&M<f.selectionEnd?W="deleteBackward":M===f.selectionEnd&&N.length<Q.length&&(W="deleteForward"),W===void 0||(W==="deleteBackward"||W==="deleteForward")&&N.length>Q.length)throw new Sa("Input type detection error.");var O="",V=f.selectionStart,$=f.selectionEnd;if(W==="insert")O=N.slice(f.selectionStart,M);else{var J=Q.length-N.length;V=M,$=M+J}y.value!==Q?y.options=y.fallbackOptions:y.fallbackOptions=y.options;var R=y.options,F=r({inputType:W,previousValue:Q,previousOptions:R,value:N,addedValue:O,changeStart:V,changeEnd:$,selectionStart:M,selectionEnd:A}),q=F.options,Z=d5(F,h5);a.value=Z.value,a.setSelectionRange(Z.selectionStart,Z.selectionEnd),y.value=Z.value,y.options=q,f.selectionStart=Z.selectionStart,f.selectionEnd=Z.selectionEnd,(E=a._valueTracker)===null||E===void 0||(x=E.setValue)===null||x===void 0||x.call(E,Q)}catch(ue){if(a.value=f.value,a.setSelectionRange(f.selectionStart,f.selectionEnd),T.preventDefault(),T.stopPropagation(),ue.name!=="SyntheticChangeError")throw ue}};document.activeElement===a&&m(),a.addEventListener("focus",m),a.addEventListener("blur",v),a.addEventListener("input",C),i.set(a,{onFocus:m,onBlur:v,onInput:C})}},this.unregister=function(a){var o=i.get(a);o!==void 0&&(a.removeEventListener("focus",o.onFocus),a.removeEventListener("blur",o.onBlur),a.removeEventListener("input",o.onInput),i.delete(a))}});ng=S1,Object.defineProperty(ng.prototype,Symbol.toStringTag,{writable:!1,enumerable:!1,configurable:!0,value:"Input"});function f5(t,e){return L.useCallback(function(n){t.current=n,typeof e=="function"?e(n):ud(e)==="object"&&e!==null&&(e.current=n)},[t,e])}var rg,m5=["track","modify"];function qr(t){var e,n,r,i;return{mask:(e=t.mask)!==null&&e!==void 0?e:"",replacement:typeof t.replacement=="string"?ji(t.replacement):(n=t.replacement)!==null&&n!==void 0?n:{},showMask:(r=t.showMask)!==null&&r!==void 0&&r,separate:(i=t.separate)!==null&&i!==void 0&&i,track:t.track,modify:t.modify}}var T1=function(t){function e(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e5(this,e),(n=X3(this,e,[{init:function(i){var a=i.initialValue,o=i.controlled,s=qr(r),c=s.mask,l=s.replacement,u=s.separate,d=s.showMask;return a=o||a?a:d?c:"",{value:a,options:{mask:c,replacement:l,separate:u}}},tracking:function(i){var a=i.inputType,o=i.previousValue,s=i.previousOptions,c=i.addedValue,l=i.changeStart,u=i.changeEnd,d=qr(r),h=d.track,p=d.modify,b=v1(d,m5),y=b.mask,w=b.replacement,f=b.showMask,g=b.separate,m=jo(jo({},a==="insert"?{inputType:a,data:c}:{inputType:a,data:null}),{},{value:o,selectionStart:l,selectionEnd:u}),v=h==null?void 0:h(m);if(v===!1)throw new Sa("Custom tracking stop.");v===null?c="":v!==!0&&v!==void 0&&(c=v);var C=p==null?void 0:p(m);(C==null?void 0:C.mask)!==void 0&&(y=C.mask),(C==null?void 0:C.replacement)!==void 0&&(w=typeof(C==null?void 0:C.replacement)=="string"?ji(C==null?void 0:C.replacement):C.replacement),(C==null?void 0:C.showMask)!==void 0&&(f=C.showMask),(C==null?void 0:C.separate)!==void 0&&(g=C.separate);var T=ld(o,jo({end:l},s)),E=ld(o,jo({start:u},s)),x=RegExp("[^".concat(Object.keys(w).join(""),"]"),"g"),N=y.replace(x,"");if(T&&(T=Ca(T,{replacementChars:N,replacement:w,separate:g}),N=N.slice(T.length)),c&&(c=Ca(c,{replacementChars:N,replacement:w,separate:!1}),N=N.slice(c.length)),a==="insert"&&c==="")throw new Sa("The character does not match the key value of the `replacement` object.");if(g){var M=y.slice(l,u).replace(x,""),A=M.length-c.length;A<0?E=E.slice(-A):A>0&&(E=M.slice(-A)+E)}E&&(E=Ca(E,{replacementChars:N,replacement:w,separate:g}));var W=b1(T+c+E,{mask:y,replacement:w,separate:g,showMask:f}),Q=function(O){var V,$,J,R=O.inputType,F=O.value,q=O.addedValue,Z=O.beforeChangeValue,ue=O.mask,or=O.replacement,ln=O.separate,sr=y1(F,{mask:ue,replacement:or}).filter(function(Rc){var Gh=Rc.type;return Gh==="input"||ln&&Gh==="replacement"}),Zt=(V=sr[Z.length+q.length-1])===null||V===void 0?void 0:V.index,Nt=($=sr[Z.length-1])===null||$===void 0?void 0:$.index,Ar=(J=sr[Z.length+q.length])===null||J===void 0?void 0:J.index;if(R==="insert"){if(Zt!==void 0)return Zt+1;if(Ar!==void 0)return Ar;if(Nt!==void 0)return Nt+1}if(R==="deleteForward"){if(Ar!==void 0)return Ar;if(Nt!==void 0)return Nt+1}if(R==="deleteBackward"){if(Nt!==void 0)return Nt+1;if(Ar!==void 0)return Ar}var Kh=F.split("").findIndex(function(Rc){return Object.prototype.hasOwnProperty.call(or,Rc)});return Kh!==-1?Kh:F.length}({inputType:a,value:W,addedValue:c,beforeChangeValue:T,mask:y,replacement:w,separate:g});return{value:W,selectionStart:Q,selectionEnd:Q,options:{mask:y,replacement:w,separate:g}}}}])).format=function(i){return k1(i,qr(r))},n.formatToParts=function(i){return i5(i,qr(r))},n.unformat=function(i){return r5(i,qr(r))},n.generatePattern=function(i){return o5(i,qr(r))},n}return n5(e,S1),t5(e)}();rg=T1,Object.defineProperty(rg.prototype,Symbol.toStringTag,{writable:!1,enumerable:!1,configurable:!0,value:"Mask"});function g5(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.mask,n=t.replacement,r=t.showMask,i=t.separate,a=t.track,o=t.modify,s=L.useRef(null),c=L.useRef({mask:e,replacement:n,showMask:r,separate:i,track:a,modify:o});return c.current.mask=e,c.current.replacement=n,c.current.showMask=r,c.current.separate=i,c.current.track=a,c.current.modify=o,L.useMemo(function(){return s5(s,new T1(c.current))},[])}var v5=["component","mask","replacement","showMask","separate","track","modify"];function b5(t,e){var n=t.component,r=t.mask,i=t.replacement,a=t.showMask,o=t.separate,s=t.track,c=t.modify,l=v1(t,v5),u=g5({mask:r,replacement:i,showMask:a,separate:o,track:s,modify:c}),d=f5(u,e);return n?Cr.createElement(n,tc({ref:d},l)):Cr.createElement("input",tc({ref:d},l))}var y5=L.forwardRef(b5);const k5={mask:"MM / DD / YYYY",replacement:{D:/\d/,M:/\d/,Y:/\d/},showMask:!0},x1=({onSubmit:t,className:e})=>{const n=t==null,[r,i]=L.useState(null);return k.jsxs("div",{className:K("relative bg-primary-5 flex items-center justify-between pl-4 py-2 pr-2 rounded-outer transition-colors duration-500 before:content-[''] before:absolute before:transition-colors before:-z-10 before:inset-0 before:bg-transparent",n?"":"hover:bg-secondary-20",e),children:[k.jsxs("div",{className:"flex items-center",children:[k.jsx(L0,{className:"w-4 h-4 text-primary-60"}),k.jsx(y5,{...k5,className:K("bg-transparent text-primary-80 outline-0 ml-2 py-2.5",n?"placeholder-primary-20 pointer-events-none":"placeholder-primary-40"),placeholder:"MM / DD / YYYY",onChange:a=>{const o=a.target.value,[s,c,l]=o.split(" / ");s!=null&&s.length===2&&c!=null&&c.length===2&&l!=null&&l.length===4?i(`${l}-${s}-${c}`):i(null)}})]}),k.jsx(Ve,{className:"flex-none",label:"Send message",onClick:r==null||t==null?void 0:()=>{t(r)},type:"main",Icon:yc})]})},E1=(t,e)=>n=>{t.type==="slot"&&e.sendSlots({[t.id]:n}),t.type==="context"&&e.sendContext({[t.id]:n})},w5=({data:t,conversationHandler:e})=>{const n=L.useMemo(()=>E1(t.$saveAs,e),[t.$saveAs,e]);return k.jsx(x1,{onSubmit:n})},C5=({data:t})=>k.jsxs(Hh,{children:[t.thumbnail!=null?k.jsx(qh,{src:t.thumbnail,alt:t.thumbnailAlt}):null,t.rows!=null?t.rows.map((e,n)=>k.jsx($h,{left:k.jsx(Qa,{faded:!0,children:e.label}),right:k.jsx(Qa,{children:e.value})},n)):null]}),S5=({data:t,conversationHandler:e})=>{const[n,r]=L.useState(null),i=L.useMemo(()=>E1(t.$saveAs,e),[t.$saveAs,e]),a=o=>{r(o),i(o)};return k.jsx(p1,{children:t.cards.map((o,s)=>k.jsxs(Hh,{selected:o.id===n,onClick:o.id!=null?()=>{o.id!=null&&a(o.id)}:void 0,children:[o.thumbnail!=null?k.jsx(qh,{src:o.thumbnail,alt:o.thumbnailAlt}):null,o.rows!=null?o.rows.map((c,l)=>k.jsx($h,{left:k.jsx(Qa,{faded:!0,children:c.label}),right:k.jsx(Qa,{children:c.value})},l)):null]},o.id??s))})},N5=({children:t,mode:e,theme:n})=>k.jsxs(k.Fragment,{children:[k.jsx("style",{children:d1}),k.jsx(ls,{className:"bg-background p-4 rounded-outer space-y-4",theme:n,colorMode:e,children:t})]}),M5=kC.version,T5=t=>nC.bind((e,...n)=>L.createElement(t[e]??e,...n)),L5=T5({TextButton:Ir,IconButton:Ve,BaseText:Qa,SmallText:K3,DateInput:x1,Carousel:p1,CustomCard:Hh,CustomCardRow:$h,CustomCardImageRow:qh,Ripple:$a,...MS}),x5=()=>{const t=crypto.randomUUID();return sessionStorage.setItem("nlxConversationId",t),t},E5=()=>{const t=crypto.randomUUID();return localStorage.setItem("nlxUserId",t),t},P5=t=>{const e=t.config.applicationUrl??("botUrl"in t.config?t.config.botUrl:void 0);"botUrl"in t.config&&console.warn("The 'botUrl' configuration option is deprecated. Use 'applicationUrl' instead.");const n={...t.customModalities??{},DefaultDateInput:w5,DefaultCard:C5,DefaultCarousel:S5};return{...t,config:{...t.config,applicationUrl:e,conversationId:t.config.conversationId??sessionStorage.getItem("nlxConversationId")??x5(),userId:t.config.userId??localStorage.getItem("nlxUserId")??E5(),bidirectional:t.bidirectional==null?t.config.bidirectional??!1:!0},input:t.input??"text",customModalities:n,initializeConversation:t.initializeConversation??((r,i)=>{((t==null?void 0:t.input)??"text")==="text"&&r.sendWelcomeFlow(i)})}};let P1=()=>{const t=document.createElement("style");t.textContent=`:where(nlx-touchpoint.nlx-text, nlx-touchpoint.nlx-voice) {
    display: block;
    height: 350px;
  }
  :where(nlx-touchpoint.nlx-voiceMini) {
   display: inline-block;

  }`,document.head.appendChild(t),P1=()=>{}};var oi,aa,An,Ta,hs,hd;class R5 extends HTMLElement{constructor(){super(...arguments),Ai(this,hs),Ai(this,oi,null),Ai(this,aa,null),Ai(this,An,null),ie(this,"onRef",null),ie(this,"embedded",!0),ie(this,"onClose",null),ie(this,"enableSettings",!1),Ai(this,Ta,!0)}set enabled(e){Ct(this,Ta)!==e&&(ps(this,Ta,e),Zh(this,hs,hd).call(this))}set touchpointConfiguration(e){uh(Ct(this,An),e)||(ps(this,An,e),Zh(this,hs,hd).call(this))}connectedCallback(){var e;if(Ct(this,An)==null&&this.getAttribute("configuration")!=null)try{this.touchpointConfiguration=JSON.parse(this.getAttribute("configuration")??"")}catch(n){throw new Error("Failed to parse touchpoint configuration: "+(n instanceof Error?n.message:String(n)))}this.embedded&&(P1(),this.classList.add(`nlx-${((e=Ct(this,An))==null?void 0:e.input)??"text"}`))}disconnectedCallback(){var e;(e=Ct(this,oi))==null||e.unmount()}}oi=new WeakMap,aa=new WeakMap,An=new WeakMap,Ta=new WeakMap,hs=new WeakSet,hd=function(){if(Ct(this,aa)??ps(this,aa,this.attachShadow({mode:"closed"})),Ct(this,oi)??ps(this,oi,y0(Ct(this,aa))),Ct(this,An)!=null){const t=P5(Ct(this,An));Ct(this,oi).render(k.jsxs(k.Fragment,{children:[k.jsx("style",{children:d1}),k.jsx(u1,{...t,embedded:this.embedded,onClose:this.onClose,enableSettings:this.enableSettings,enabled:Ct(this,Ta),ref:e=>{var n;e!=null&&((n=this.onRef)==null||n.call(this,e))}})]}))}};const I5=(t,e)=>{customElements.get(t)==null&&customElements.define(t,e)};I5("nlx-touchpoint",R5);const D5=t=>new Promise(e=>{const n=document.createElement("nlx-touchpoint");n.embedded=!1,n.onRef=r=>{e({set expanded(i){r.setExpanded(i)},get expanded(){return r.getExpanded()},get conversationHandler(){return r.getConversationHandler()},teardown:()=>{document.body.removeChild(n)},setCustomBidirectionalCommands(i){r.setCustomBidirectionalCommands(i)}})},n.onClose=()=>{},n.enableSettings=!0,n.touchpointConfiguration=t,document.body.appendChild(n)});export{Qa as BaseText,p1 as Carousel,Hh as CustomCard,qh as CustomCardImageRow,$h as CustomCardRow,x1 as DateInput,Ve as IconButton,MS as Icons,N5 as PreviewContainer,Cr as React,$a as Ripple,K3 as SmallText,Ir as TextButton,_3 as analyzePageForms,D5 as create,L5 as html,M5 as version};
