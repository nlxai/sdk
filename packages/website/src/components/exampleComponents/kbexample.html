<!-- Touchpoint sample HTML -->
<!-- Downloaded from https://developers.nlx.ai -->
<html lang="en">
  <head>
    <title>Touchpoint Sample HTML</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>

  <body>
    <script
      defer
      src="https://unpkg.com/@nlxai/touchpoint-ui/lib/index.umd.js"
    ></script>
    <script type="module">
      const contentLoaded = () => {
        if (document.readyState === "loading") {
          return new Promise((resolve) => {
            window.addEventListener("DOMContentLoaded", () => {
              resolve();
            });
          });
        } else {
          return Promise.resolve();
        }
      };

      await contentLoaded();
      const { Icons, html, create, React, BaseText, TextButton, SmallText } =
        nlxai.touchpointUi;
      const MuseumExhibitCarousel = ({ data, conversationHandler }) => {
        const [selected, setSelected] = React.useState(null);

        return html`
          <Carousel>
            ${data.map(
              (exhibit, index) =>
                html` <CustomCard
                  key=${index}
                  selected=${selected === index}
                  onClick=${() => {
                    setSelected(index);
                    conversationHandler.sendChoice(exhibit.id);
                  }}
                >
                  <CustomCardImageRow
                    src=${exhibit.imageUrl}
                    alt=${exhibit.name}
                  />
                  <CustomCardRow
                    left=${html`<BaseText faded><div /></BaseText>`}
                    right=${html`<BaseText>${exhibit.name}</BaseText>`}
                  />
                  <CustomCardRow
                    left=${html`<BaseText faded>Dates:</BaseText>`}
                    right=${html`<BaseText
                      >Through ${exhibit.endDate}</BaseText
                    >`}
                  />
                </CustomCard>`,
            )}
          </Carousel>
        `;
      };

      const MuseumExhibitDetails = ({ data, conversationHandler }) => {
        console.log("MuseumExhibitDetails data", data);
        // put other imagees into a carousel
        const detailedUrls = data.detailImageUrls;
        return html`
          <Carousel>
            <CustomCard>
              <CustomCardImageRow src=${data.imageUrl} alt=${data.name} />
            </CustomCard>
            ${detailedUrls.map(
              (imageUrl) =>
                html` <CustomCard>
                  <CustomCardImageRow src=${imageUrl} alt=${data.name} />
                </CustomCard>`,
            )}
          </Carousel>
          <BaseText faded>Dates</BaseText>
          <BaseText>Through ${data.endDate}</BaseText>

          <BaseText faded>Location</BaseText>
          <BaseText>${data.galleryLocation}</BaseText>

          <BaseText faded>About this exhibition</BaseText>
          <BaseText>${data.summary}</BaseText>
        `;
      };

      const touchpoint = await nlxai.touchpointUi.create({
        config: {
          applicationUrl:
            "https://bots.dev.studio.nlx.ai/c/5KCQGKJ7itnkafMnFfiRz/H4NQhl5oiHUsEmZm3Zpvj",
          headers: {
            "nlx-api-key": "RGgxSTYilkK/khOFvxotFSjE6LPR/S04",
          },
          languageCode: "en-US",
          userId: "REPLACE_WITH_USER_ID",
        },
        colorMode: "dark",
        input: "text",
        theme: {
          fontFamily: '"Neue Haas Grotesk", sans-serif',
          accent: "#AECAFF",
        },
        customModalities: {
          MuseumExhibitDetails: MuseumExhibitDetails,
          MuseumExhibitCarousel: MuseumExhibitCarousel,
        },
      });
      const conversationHandler = touchpoint.conversationHandler;
      const myListenerFunction = (history, message) => {
        // Only process if we have a new bot message
        console.log("---message---");
        console.log(JSON.stringify(message, null, 2));
        console.log("---<message>---");
        if (!message || message.type !== "bot") return;
        const modalities = message.payload?.modalities;
        if (!modalities) return;
        // console.log("Modalities received:", modalities);
      };

      // Start listening to the conversation
      conversationHandler.subscribe(myListenerFunction);
    </script>
  </body>
</html>
